void 0!==VMM.Timeline&&void 0===VMM.Timeline.TimeNav&&(VMM.Timeline.TimeNav=function(e,t,a){function n(e){P.nav.constraint.left=P.width/2,P.nav.constraint.right=P.nav.constraint.right_min-P.width/2,R.updateConstraint(P.nav.constraint),VMM.Lib.css(x,"left",Math.round(P.width/2)+2),VMM.Lib.css(H,"left",Math.round(P.width/2)-8),c(P.current_slide,P.ease,P.duration,!0,e)}function r(){VMM.fireEvent(X,"UPDATE")}function s(){R.cancelSlide(),P.nav.multiplier.current>P.nav.multiplier.min&&(P.nav.multiplier.current=P.nav.multiplier.current<=1?P.nav.multiplier.current-.25:P.nav.multiplier.current>5?P.nav.multiplier.current>16?Math.round(P.nav.multiplier.current-10):Math.round(P.nav.multiplier.current-4):Math.round(P.nav.multiplier.current-1),P.nav.multiplier.current<=0&&(P.nav.multiplier.current=P.nav.multiplier.min),u())}function l(){R.cancelSlide(),P.nav.multiplier.current<P.nav.multiplier.max&&(P.nav.multiplier.current=P.nav.multiplier.current>4?P.nav.multiplier.current>16?Math.round(P.nav.multiplier.current+10):Math.round(P.nav.multiplier.current+4):Math.round(P.nav.multiplier.current+1),P.nav.multiplier.current>=P.nav.multiplier.max&&(P.nav.multiplier.current=P.nav.multiplier.max),u())}function o(){R.cancelSlide(),c(0),r()}function d(e){var t=0,a=0;e||(e=window.event),e.originalEvent&&(e=e.originalEvent),void 0!==e.wheelDeltaX&&(t=e.wheelDeltaY/6,t=Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)?e.wheelDeltaX/6:0),t&&(e.preventDefault&&e.preventDefault(),e.returnValue=!1),a=VMM.Lib.position(A).left+t,a>P.nav.constraint.left?a=P.width/2:a<P.nav.constraint.right&&(a=P.nav.constraint.right),VMM.Lib.css(A,"left",a)}function u(){trace("config.nav.multiplier "+P.nav.multiplier.current),y(!0),V(!0),_(Y,J,!0,!0),_(O,Z,!0),P.nav.constraint.left=P.width/2,P.nav.constraint.right=P.nav.constraint.right_min-P.width/2,R.updateConstraint(P.nav.constraint)}function m(e){R.cancelSlide(),c(e.data.number),r()}function M(e){VMM.Lib.toggleClass(e.data.elem,"zFront")}function c(e,t,a){var n,i,r,s,l;for(trace("GO TO MARKER"),n=P.ease,i=P.duration,r=!1,s=!1,et=e,at.left=P.width/2-K[et].pos_left,at.visible.left=Math.abs(at.left)-100,at.visible.right=Math.abs(at.left)+P.width+100,0==et&&(s=!0),et+1==K.length&&(r=!0),null!=t&&""!=t&&(n=t),null!=a&&""!=a&&(i=a),l=0;l<K.length;l++)VMM.Lib.removeClass(K[l].marker,"active");P.start_page&&"start"==K[0].type&&(VMM.Lib.visible(K[0].marker,!1),VMM.Lib.addClass(K[0].marker,"start")),VMM.Lib.addClass(K[et].marker,"active"),VMM.Lib.stop(A),VMM.Lib.animate(A,i,n,{left:at.left})}function h(){var e,t=0,a=0,n=0,i=[],r=0;for(r=0;r<K.length;r++)"start"==W[r].type||(e=b(rt,K[r].relative_pos),t=a,a=e.begin,n=a-t,i.push(n));return VMM.Util.average(i).mean}function p(){var e=P.nav.multiplier.current,t=0;for(t=0;e>t;t++)h()<75&&P.nav.multiplier.current>1&&(P.nav.multiplier.current=P.nav.multiplier.current-1)}function v(){var e=g(W[0].startdate),t=g(W[W.length-1].enddate);ot.eon.type="eon",ot.eon.first=e.eons,ot.eon.base=Math.floor(e.eons),ot.eon.last=t.eons,ot.eon.number=B.eons,ot.eon.multiplier=nt.eons,ot.eon.minor=nt.eons,ot.era.type="era",ot.era.first=e.eras,ot.era.base=Math.floor(e.eras),ot.era.last=t.eras,ot.era.number=B.eras,ot.era.multiplier=nt.eras,ot.era.minor=nt.eras,ot.epoch.type="epoch",ot.epoch.first=e.epochs,ot.epoch.base=Math.floor(e.epochs),ot.epoch.last=t.epochs,ot.epoch.number=B.epochs,ot.epoch.multiplier=nt.epochs,ot.epoch.minor=nt.epochs,ot.age.type="age",ot.age.first=e.ages,ot.age.base=Math.floor(e.ages),ot.age.last=t.ages,ot.age.number=B.ages,ot.age.multiplier=nt.ages,ot.age.minor=nt.ages,ot.millenium.type="millenium",ot.millenium.first=e.milleniums,ot.millenium.base=Math.floor(e.milleniums),ot.millenium.last=t.milleniums,ot.millenium.number=B.milleniums,ot.millenium.multiplier=nt.millenium,ot.millenium.minor=nt.millenium,ot.century.type="century",ot.century.first=e.centuries,ot.century.base=Math.floor(e.centuries),ot.century.last=t.centuries,ot.century.number=B.centuries,ot.century.multiplier=nt.century,ot.century.minor=nt.century,ot.decade.type="decade",ot.decade.first=e.decades,ot.decade.base=Math.floor(e.decades),ot.decade.last=t.decades,ot.decade.number=B.decades,ot.decade.multiplier=nt.decade,ot.decade.minor=nt.decade,ot.year.type="year",ot.year.first=e.years,ot.year.base=Math.floor(e.years),ot.year.last=t.years,ot.year.number=B.years,ot.year.multiplier=1,ot.year.minor=nt.month,ot.month.type="month",ot.month.first=e.months,ot.month.base=Math.floor(e.months),ot.month.last=t.months,ot.month.number=B.months,ot.month.multiplier=1,ot.month.minor=Math.round(nt.week),ot.week.type="week",ot.week.first=e.weeks,ot.week.base=Math.floor(e.weeks),ot.week.last=t.weeks,ot.week.number=B.weeks,ot.week.multiplier=1,ot.week.minor=7,ot.day.type="day",ot.day.first=e.days,ot.day.base=Math.floor(e.days),ot.day.last=t.days,ot.day.number=B.days,ot.day.multiplier=1,ot.day.minor=24,ot.hour.type="hour",ot.hour.first=e.hours,ot.hour.base=Math.floor(e.hours),ot.hour.last=t.hours,ot.hour.number=B.hours,ot.hour.multiplier=1,ot.hour.minor=60,ot.minute.type="minute",ot.minute.first=e.minutes,ot.minute.base=Math.floor(e.minutes),ot.minute.last=t.minutes,ot.minute.number=B.minutes,ot.minute.multiplier=1,ot.minute.minor=60,ot.second.type="decade",ot.second.first=e.seconds,ot.second.base=Math.floor(e.seconds),ot.second.last=t.seconds,ot.second.number=B.seconds,ot.second.multiplier=1,ot.second.minor=10}function g(e){var t={};return t.days=e/it.day,t.weeks=t.days/it.week,t.months=t.days/it.month,t.years=t.months/it.year,t.hours=t.days*it.hour,t.minutes=t.days*it.minute,t.seconds=t.days*it.second,t.decades=t.years/it.decade,t.centuries=t.years/it.century,t.milleniums=t.years/it.millenium,t.ages=t.years/it.age,t.epochs=t.years/it.epoch,t.eras=t.years/it.era,t.eons=t.years/it.eon,t}function f(e,t,a){var n,i,r=e.type,s={start:"",end:"",type:r};return n=g(t),s.start=t.months,"eon"==r?s.start=n.eons:"era"==r?s.start=n.eras:"epoch"==r?s.start=n.epochs:"age"==r?s.start=n.ages:"millenium"==r?s.start=t.milleniums:"century"==r?s.start=n.centuries:"decade"==r?s.start=n.decades:"year"==r?s.start=n.years:"month"==r?s.start=n.months:"week"==r?s.start=n.weeks:"day"==r?s.start=n.days:"hour"==r?s.start=n.hours:"minute"==r&&(s.start=n.minutes),"date"==type.of(a)?(i=g(a),s.end=a.months,"eon"==r?s.end=i.eons:"era"==r?s.end=i.eras:"epoch"==r?s.end=i.epochs:"age"==r?s.end=i.ages:"millenium"==r?s.end=a.milleniums:"century"==r?s.end=i.centuries:"decade"==r?s.end=i.decades:"year"==r?s.end=i.years:"month"==r?s.end=i.months:"week"==r?s.end=i.weeks:"day"==r?s.end=i.days:"hour"==r?s.end=i.hours:"minute"==r&&(s.end=i.minutes)):s.end=s.start,s}function b(e,t){return{begin:(t.start-rt.base)*(P.nav.interval_width/P.nav.multiplier.current),end:(t.end-rt.base)*(P.nav.interval_width/P.nav.multiplier.current)}}function y(e){var t,a,n,i,r,s,l=2,o=0,d=-2,u=0,m=150,M=6,c=0,h=P.width,p=[],v=6,g={left:at.visible.left-h,right:at.visible.right+h},f=0,y=0;for(P.nav.minor_width=P.width,VMM.Lib.removeClass(".flag","row1"),VMM.Lib.removeClass(".flag","row2"),VMM.Lib.removeClass(".flag","row3"),f=0;f<K.length;f++){if(a=K[f],n=b(rt,K[f].relative_pos),i=0,r=!1,s={id:f,pos:0,row:0},n.begin=Math.round(n.begin+d),n.end=Math.round(n.end+d),t=Math.round(n.end-n.begin),a.pos_left=n.begin,et==f&&(at.left=P.width/2-n,at.visible.left=Math.abs(at.left),at.visible.right=Math.abs(at.left)+P.width,g.left=at.visible.left-h,g.right=at.visible.right+h),Math.abs(n.begin)>=g.left&&Math.abs(n.begin)<=g.right&&(r=!0),e?(VMM.Lib.stop(a.marker),VMM.Lib.animate(a.marker,P.duration/2,P.ease,{left:n.begin})):(VMM.Lib.stop(a.marker),VMM.Lib.css(a.marker,"left",n.begin)),f==et&&(c=n.begin),t>5&&(VMM.Lib.css(a.lineevent,"height",M),VMM.Lib.css(a.lineevent,"top",m),e?VMM.Lib.animate(a.lineevent,P.duration/2,P.ease,{width:t}):VMM.Lib.css(a.lineevent,"width",t)),Q.length>0){for(y=0;y<Q.length;y++)y<P.nav.rows.current.length&&a.tag==Q[y]&&(l=y,y==P.nav.rows.current.length-1&&(trace("ON LAST ROW"),VMM.Lib.addClass(a.flag,"flag-small-last")));i=P.nav.rows.current[l]}else n.begin-o.begin<P.nav.marker.width+P.spacing?l<P.nav.rows.current.length-1?l++:(l=0,u++):(u=1,l=1),i=P.nav.rows.current[l];o=n,s.pos=n,s.row=l,p.push(s),p.length>v&&p.remove(0),e?(VMM.Lib.stop(a.flag),VMM.Lib.animate(a.flag,P.duration,P.ease,{top:i})):(VMM.Lib.stop(a.flag),VMM.Lib.css(a.flag,"top",i)),P.start_page&&"start"==K[f].type&&VMM.Lib.visible(a.marker,!1),n>P.nav.minor_width&&(P.nav.minor_width=n),n<P.nav.minor_left&&(P.nav.minor_left=n)}e&&(VMM.Lib.stop(A),VMM.Lib.animate(A,P.duration/2,P.ease,{left:P.width/2-c}))}function V(e){var t,a,n,i,r,s,l=0,o=0;for(l=0;l<$.length;l++){if(t=$[l],a=b(rt,t.relative_pos),n=0,i=0,r=P.nav.marker.height*P.nav.rows.full.length,s=a.end-a.begin,""!=t.tag){for(r=P.nav.marker.height*P.nav.rows.full.length/P.nav.rows.current.length,o=0;o<Q.length;o++)o<P.nav.rows.current.length&&t.tag==Q[o]&&(i=o);n=P.nav.rows.current[i]}else n=-1;e?(VMM.Lib.stop(t.content),VMM.Lib.stop(t.text_content),VMM.Lib.animate(t.content,P.duration/2,P.ease,{top:n,left:a.begin,width:s,height:r}),VMM.Lib.animate(t.text_content,P.duration/2,P.ease,{left:a.begin})):(VMM.Lib.stop(t.content),VMM.Lib.stop(t.text_content),VMM.Lib.css(t.content,"left",a.begin),VMM.Lib.css(t.content,"width",s),VMM.Lib.css(t.content,"height",r),VMM.Lib.css(t.content,"top",n),VMM.Lib.css(t.text_content,"left",a.begin))}}function _(e,t,a,n){var r,s,l,o,d,u,m,M=0,c=P.width,h={left:at.visible.left-c,right:at.visible.right+c};for(not_too_many=!0,i=0,P.nav.minor_left=0,t.length>100&&(not_too_many=!1,trace("TOO MANY "+t.length)),i=0;i<t.length;i++)r=t[i].element,t[i].date,s=t[i].visible,l=b(rt,t[i].relative_pos),o=l.begin,d=t[i].animation,u=!0,m=!1,d.pos=o,d.animate=!1,Math.abs(o)>=h.left&&Math.abs(o)<=h.right&&(m=!0),P.nav.multiplier.current>16&&n?u=!1:65>o-M&&(35>o-M?0==i%4?0==o&&(u=!1):u=!1:VMM.Util.isEven(i)||(u=!1)),u?t[i].is_detached&&(VMM.Lib.append(e,r),t[i].is_detached=!1):(t[i].is_detached=!0,VMM.Lib.detach(r)),s?u?(d.opacity="100",a&&m&&(d.animate=!0)):(d.opacity="0",a&&not_too_many&&(d.animate=!0),t[i].interval_visible=!1):(d.opacity="100",u?(a&&not_too_many?d.animate=!0:a&&m&&(d.animate=!0),t[i].interval_visible=!0):a&&not_too_many&&(d.animate=!0)),M=o,o>P.nav.minor_width&&(P.nav.minor_width=o),o<P.nav.minor_left&&(P.nav.minor_left=o),d.animate?VMM.Lib.animate(r,P.duration/2,P.ease,{opacity:d.opacity,left:d.pos}):(VMM.Lib.css(r,"opacity",d.opacity),VMM.Lib.css(r,"left",o));P.nav.constraint.right_min=-P.nav.minor_width+P.width,P.nav.constraint.right=P.nav.constraint.right_min+P.width/2,VMM.Lib.css(N,"left",P.nav.minor_left-P.width/2),VMM.Lib.width(N,P.nav.minor_width+P.width+Math.abs(P.nav.minor_left))}function w(e,t,a){var n,i,r,s,l=0,o=!0,d=0,u=0,m=Math.ceil(e.number)+2,M={flag:!1,offset:0},c=0;for(VMM.attachElement(a,""),e.date=new Date(W[0].startdate.getFullYear(),0,1,0,0,0),n=e.date.getTimezoneOffset(),c=0;m>c;c++)trace(e.type),r=!1,s={element:VMM.appendAndGetElement(a,"<div>",e.classname),date:new Date(W[0].startdate.getFullYear(),0,1,0,0,0),visible:!1,date_string:"",type:e.interval_type,relative_pos:0,is_detached:!1,animation:{animate:!1,pos:"",opacity:"100"}},"eon"==e.type?(o&&(i=5e8*Math.floor(W[0].startdate.getFullYear()/5e8)),s.date.setFullYear(i+5e8*l),r=!0):"era"==e.type?(o&&(i=1e8*Math.floor(W[0].startdate.getFullYear()/1e8)),s.date.setFullYear(i+1e8*l),r=!0):"epoch"==e.type?(o&&(i=1e7*Math.floor(W[0].startdate.getFullYear()/1e7)),s.date.setFullYear(i+1e7*l),r=!0):"age"==e.type?(o&&(i=1e6*Math.floor(W[0].startdate.getFullYear()/1e6)),s.date.setFullYear(i+1e6*l),r=!0):"millenium"==e.type?(o&&(i=1e3*Math.floor(W[0].startdate.getFullYear()/1e3)),s.date.setFullYear(i+1e3*l),r=!0):"century"==e.type?(o&&(i=100*Math.floor(W[0].startdate.getFullYear()/100)),s.date.setFullYear(i+100*l),r=!0):"decade"==e.type?(o&&(i=10*Math.floor(W[0].startdate.getFullYear()/10)),s.date.setFullYear(i+10*l),r=!0):"year"==e.type?(o&&(i=W[0].startdate.getFullYear()),s.date.setFullYear(i+l),r=!0):"month"==e.type?(o&&(i=W[0].startdate.getMonth()),s.date.setMonth(i+l)):"week"==e.type?(o&&(i=W[0].startdate.getMonth()),s.date.setMonth(W[0].startdate.getMonth()),s.date.setDate(i+7*l)):"day"==e.type?(o&&(i=W[0].startdate.getDate()),s.date.setMonth(W[0].startdate.getMonth()),s.date.setDate(i+l)):"hour"==e.type?(o&&(i=W[0].startdate.getHours()),s.date.setMonth(W[0].startdate.getMonth()),s.date.setDate(W[0].startdate.getDate()),s.date.setHours(i+l)):"minute"==e.type?(o&&(i=W[0].startdate.getMinutes()),s.date.setMonth(W[0].startdate.getMonth()),s.date.setDate(W[0].startdate.getDate()),s.date.setHours(W[0].startdate.getHours()),s.date.setMinutes(i+l)):"second"==e.type?(o&&(i=W[0].startdate.getSeconds()),s.date.setMonth(W[0].startdate.getMonth()),s.date.setDate(W[0].startdate.getDate()),s.date.setHours(W[0].startdate.getHours()),s.date.setMinutes(W[0].startdate.getMinutes()),s.date.setSeconds(i+l)):"millisecond"==e.type&&(o&&(i=W[0].startdate.getMilliseconds()),s.date.setMonth(W[0].startdate.getMonth()),s.date.setDate(W[0].startdate.getDate()),s.date.setHours(W[0].startdate.getHours()),s.date.setMinutes(W[0].startdate.getMinutes()),s.date.setSeconds(W[0].startdate.getSeconds()),s.date.setMilliseconds(i+l)),"Firefox"==VMM.Browser.browser&&("1970"==s.date.getFullYear()&&s.date.getTimezoneOffset()!=n?(trace("FIREFOX 1970 TIMEZONE OFFSET "+s.date.getTimezoneOffset()+" SHOULD BE "+n),trace(e.type+" "+e.date),M.offset=s.date.getTimezoneOffset()/60,M.flag=!0,s.date.setHours(s.date.getHours()+M.offset)):M.flag&&(M.flag=!1,s.date.setHours(s.date.getHours()+M.offset),r&&(M.flag=!0))),s.date_string=r?s.date.getFullYear()<0?""+Math.abs(s.date.getFullYear())+" B.C.":s.date.getFullYear():VMM.Date.prettyDate(s.date,!0),l+=1,o=!1,s.relative_pos=f(rt,s.date),d=s.relative_pos.begin,s.relative_pos.begin>u&&(u=s.relative_pos.begin),VMM.appendElement(s.element,s.date_string),VMM.Lib.css(s.element,"text-indent",-(VMM.Lib.width(s.element)/2)),VMM.Lib.css(s.element,"opacity","0"),t.push(s);VMM.Lib.width(N,u),_(a,t)}function L(){var e=0,t=0;if(VMM.attachElement(X,""),A=VMM.appendAndGetElement(X,"<div>","timenav"),T=VMM.appendAndGetElement(A,"<div>","content"),G=VMM.appendAndGetElement(A,"<div>","time"),F=VMM.appendAndGetElement(G,"<div>","time-interval-minor"),N=VMM.appendAndGetElement(F,"<div>","minor"),O=VMM.appendAndGetElement(G,"<div>","time-interval-major"),Y=VMM.appendAndGetElement(G,"<div>","time-interval"),C=VMM.appendAndGetElement(X,"<div>","timenav-background"),x=VMM.appendAndGetElement(C,"<div>","timenav-line"),H=VMM.appendAndGetElement(C,"<div>","timenav-indicator"),S=VMM.appendAndGetElement(C,"<div>","timenav-interval-background","<div class='top-highlight'></div>"),U=VMM.appendAndGetElement(X,"<div>","vco-toolbar"),E(),k(),D(),p(),y(!1),V(),_(Y,J,!1,!0),_(O,Z),P.start_page&&($backhome=VMM.appendAndGetElement(U,"<div>","back-home","<div class='icon'></div>"),VMM.bindEvent(".back-home",o,"click"),VMM.Lib.attribute($backhome,"title",VMM.master_config.language.messages.return_to_title),VMM.Lib.attribute($backhome,"rel","timeline-tooltip")),R=new VMM.DragSlider,R.createPanel(X,A,P.nav.constraint,P.touch),P.touch&&P.start_page?(VMM.Lib.addClass(U,"touch"),VMM.Lib.css(U,"top",55),VMM.Lib.css(U,"left",10)):(P.start_page&&VMM.Lib.css(U,"top",27),z=VMM.appendAndGetElement(U,"<div>","zoom-in","<div class='icon'></div>"),I=VMM.appendAndGetElement(U,"<div>","zoom-out","<div class='icon'></div>"),VMM.bindEvent(z,s,"click"),VMM.bindEvent(I,l,"click"),VMM.Lib.attribute(z,"title",VMM.master_config.language.messages.expand_timeline),VMM.Lib.attribute(z,"rel","timeline-tooltip"),VMM.Lib.attribute(I,"title",VMM.master_config.language.messages.contract_timeline),VMM.Lib.attribute(I,"rel","timeline-tooltip"),U.tooltip({selector:"div[rel=timeline-tooltip]",placement:"right"}),VMM.bindEvent(X,d,"DOMMouseScroll"),VMM.bindEvent(X,d,"mousewheel")),0!=P.nav.zoom.adjust)if(P.nav.zoom.adjust<0)for(e=0;e<Math.abs(P.nav.zoom.adjust);e++)l();else for(t=0;t<P.nav.zoom.adjust;t++)s();tt=!0,n(!0),VMM.fireEvent(X,"LOADED")}function E(){var e=0,t=0;for(B=g(W[W.length-1].enddate-W[0].startdate,!0),trace(B),v(),B.centuries>W.length/P.nav.density?(rt=ot.century,st=ot.millenium,lt=ot.decade):B.decades>W.length/P.nav.density?(rt=ot.decade,st=ot.century,lt=ot.year):B.years>W.length/P.nav.density?(rt=ot.year,st=ot.decade,lt=ot.month):B.months>W.length/P.nav.density?(rt=ot.month,st=ot.year,lt=ot.day):B.days>W.length/P.nav.density?(rt=ot.day,st=ot.month,lt=ot.hour):B.hours>W.length/P.nav.density?(rt=ot.hour,st=ot.day,lt=ot.minute):B.minutes>W.length/P.nav.density?(rt=ot.minute,st=ot.hour,lt=ot.second):B.seconds>W.length/P.nav.density?(rt=ot.second,st=ot.minute,lt=ot.second):(trace("NO IDEA WHAT THE TYPE SHOULD BE"),rt=ot.day,st=ot.month,lt=ot.hour),trace("INTERVAL TYPE: "+rt.type),trace("INTERVAL MAJOR TYPE: "+st.type),w(rt,J,Y),w(st,Z,O),e=0;e<J.length;e++)for(t=0;t<Z.length;t++)J[e].date_string==Z[t].date_string&&VMM.attachElement(J[e].element,"")}function k(){var e,t,a,n,i,r,s,l,o,d,u,c=0,h=0,p=0;for(K=[],$=[],c=0;c<W.length;c++)l="",o=!1,e=VMM.appendAndGetElement(T,"<div>","marker"),t=VMM.appendAndGetElement(e,"<div>","flag"),a=VMM.appendAndGetElement(t,"<div>","flag-content"),n=VMM.appendAndGetElement(e,"<div>","dot"),i=VMM.appendAndGetElement(e,"<div>","line"),r=VMM.appendAndGetElement(i,"<div>","event-line"),_marker_relative_pos=f(rt,W[c].startdate,W[c].enddate),_marker_thumb="",null!=W[c].asset&&""!=W[c].asset?VMM.appendElement(a,VMM.MediaElement.thumbnail(W[c].asset,24,24,W[c].uniqueid)):VMM.appendElement(a,"<div style='margin-right:7px;height:50px;width:2px;float:left;'></div>"),""==W[c].title||" "==W[c].title?(trace("TITLE NOTHING"),void 0!==W[c].slug&&""!=W[c].slug?(trace("SLUG"),l=VMM.Util.untagify(W[c].slug),o=!0):(d=VMM.MediaType(W[c].asset.media),"quote"==d.type||"unknown"==d.type?(l=VMM.Util.untagify(d.id),o=!0):o=!1)):""!=W[c].title||" "!=W[c].title?(trace(W[c].title),l=VMM.Util.untagify(W[c].title),o=!0):trace("TITLE SLUG NOT FOUND "+W[c].slug),o?VMM.appendElement(a,"<h3>"+l+"</h3>"):(VMM.appendElement(a,"<h3>"+l+"</h3>"),VMM.appendElement(a,"<h3 id='marker_content_"+W[c].uniqueid+"'>"+l+"</h3>")),VMM.Lib.attr(e,"id",""+("marker_"+W[c].uniqueid)),VMM.bindEvent(t,m,"",{number:c}),VMM.bindEvent(t,M,"mouseenter mouseleave",{number:c,elem:t}),s={marker:e,flag:t,lineevent:r,type:"marker",full:!0,relative_pos:_marker_relative_pos,tag:W[c].tag,pos_left:0},"start"==W[c].type&&(trace("BUILD MARKER HAS START PAGE"),P.start_page=!0,s.type="start"),"storify"==W[c].type&&(s.type="storify"),W[c].tag&&Q.push(W[c].tag),K.push(s);for(Q=VMM.Util.deDupeArray(Q),P.nav.rows.current=Q.length>3?P.nav.rows.half:P.nav.rows.full,h=0;h<Q.length;h++)h<P.nav.rows.current.length&&(u=VMM.appendAndGetElement(C,"<div>","timenav-tag"),VMM.Lib.addClass(u,"timenav-tag-row-"+(h+1)),Q.length>3?VMM.Lib.addClass(u,"timenav-tag-size-half"):VMM.Lib.addClass(u,"timenav-tag-size-full"),VMM.appendElement(u,"<div><h3>"+Q[h]+"</h3></div>"));if(Q.length>3)for(p=0;p<K.length;p++)VMM.Lib.addClass(K[p].flag,"flag-small"),K[p].full=!1}function D(){var e,t,a=6,n=0,i=0;for(i=0;i<j.length;i++)e={content:VMM.appendAndGetElement(T,"<div>","era"),text_content:VMM.appendAndGetElement(Y,"<div>","era"),startdate:VMM.Date.parse(j[i].startDate),enddate:VMM.Date.parse(j[i].endDate),title:j[i].headline,uniqueid:VMM.Util.unique_ID(6),tag:"",relative_pos:""},VMM.Date.prettyDate(e.startdate),VMM.Date.prettyDate(e.enddate),t="<div>&nbsp;</div>",void 0!==j[i].tag&&(e.tag=j[i].tag),e.relative_pos=f(rt,e.startdate,e.enddate),VMM.Lib.attr(e.content,"id",e.uniqueid),VMM.Lib.attr(e.text_content,"id",e.uniqueid+"_text"),VMM.Lib.addClass(e.content,"era"+(n+1)),VMM.Lib.addClass(e.text_content,"era"+(n+1)),a>n?n++:n=0,VMM.appendElement(e.content,t),VMM.appendElement(e.text_content,VMM.Util.unlinkify(e.title)),$.push(e)}trace("VMM.Timeline.TimeNav");var A,T,G,F,Y,O,C,S,x,H,N,U,z,I,R,q,j,P=VMM.Timeline.Config,B={},X=e,W=[],$=[],K=[],J=[],Z=[],Q=[],et=0,tt=!1,at={left:"",visible:{left:"",right:""}},nt={day:24,month:12,year:10,hour:60,minute:60,second:1e3,decade:10,century:100,millenium:1e3,age:1e6,epoch:1e7,era:1e8,eon:5e8,week:4.34812141,days_in_month:30.4368499,days_in_week:7,weeks_in_month:4.34812141,weeks_in_year:52.177457,days_in_year:365.242199,hours_in_day:24},it={day:864e5,week:7,month:30.4166666667,year:12,hour:24,minute:1440,second:86400,decade:10,century:100,millenium:1e3,age:1e6,epoch:1e7,era:1e8,eon:5e8},rt={type:"year",number:10,first:1970,last:2011,multiplier:100,classname:"_idd",interval_type:"interval"},st={type:"year",number:10,first:1970,last:2011,multiplier:100,classname:"major",interval_type:"interval major"},lt={type:"year",number:10,first:1970,last:2011,multiplier:100,classname:"_dd_minor",interval_type:"interval minor"},ot={day:{},month:{},year:{},hour:{},minute:{},second:{},decade:{},century:{},millenium:{},week:{},age:{},epoch:{},era:{},eon:{}};q=P.nav.marker.height/2,P.nav.rows={full:[1,2*q,4*q],half:[1,q,2*q,3*q,4*q,5*q],current:[]},null!=t&&""!=t&&(P.nav.width=t),null!=a&&""!=a&&(P.nav.height=a),this.init=function(e,t){trace("VMM.Timeline.TimeNav init"),void 0!==e?this.setData(e,t):trace("WAITING ON DATA")},this.setData=function(e,t){void 0!==e?(W={},W=e,j=t,L()):trace("NO DATA")},this.setSize=function(e,t){null!=e&&(P.width=e),null!=t&&(P.height=t),tt&&n()},this.setMarker=function(e,t,a){c(e,t,a)},this.getCurrentNumber=function(){return et}});