void 0!==VMM.Timeline&&void 0===VMM.Timeline.DataObj&&(VMM.Timeline.DataObj={data_obj:{},model_array:[],getData:function(e){if(VMM.Timeline.DataObj.data_obj={},VMM.fireEvent(global,VMM.Timeline.Config.events.messege,VMM.Timeline.Config.language.messages.loading_timeline),"object"==type.of(e))trace("DATA SOURCE: JSON OBJECT"),VMM.Timeline.DataObj.parseJSON(e);else if("string"==type.of(e))if(e.match("%23"))trace("DATA SOURCE: TWITTER SEARCH"),VMM.Timeline.DataObj.model.tweets.getData("%23medill");else if(e.match("spreadsheet"))trace("DATA SOURCE: GOOGLE SPREADSHEET"),VMM.Timeline.DataObj.model.googlespreadsheet.getData(e);else if(e.match("storify.com"))trace("DATA SOURCE: STORIFY"),VMM.Timeline.DataObj.model.storify.getData(e);else if(e.match(".jsonp"))trace("DATA SOURCE: JSONP"),LoadLib.js(e,VMM.Timeline.DataObj.onJSONPLoaded);else{trace("DATA SOURCE: JSON");var t="";t=e.indexOf("?")>-1?e+"&callback=onJSONP_Data":e+"?callback=onJSONP_Data",VMM.getJSON(t,VMM.Timeline.DataObj.parseJSON)}else"html"==type.of(e)?(trace("DATA SOURCE: HTML"),VMM.Timeline.DataObj.parseHTML(e)):trace("DATA SOURCE: UNKNOWN")},onJSONPLoaded:function(){trace("JSONP IS LOADED"),VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,storyjs_jsonp_data)},parseHTML:function(){var e,t;trace("parseHTML"),trace("WARNING: THIS IS STILL ALPHA AND WILL NOT WORK WITH ID's other than #timeline"),e=VMM.Timeline.DataObj.data_template_obj,VMM.Lib.find("#timeline section","time")[0]&&(e.timeline.startDate=VMM.Lib.html(VMM.Lib.find("#timeline section","time")[0]),e.timeline.headline=VMM.Lib.html(VMM.Lib.find("#timeline section","h2")),e.timeline.text=VMM.Lib.html(VMM.Lib.find("#timeline section","article")),t=!1,0!=VMM.Lib.find("#timeline section","figure img").length?(t=!0,e.timeline.asset.media=VMM.Lib.attr(VMM.Lib.find("#timeline section","figure img"),"src")):0!=VMM.Lib.find("#timeline section","figure a").length&&(t=!0,e.timeline.asset.media=VMM.Lib.attr(VMM.Lib.find("#timeline section","figure a"),"href")),t&&(0!=VMM.Lib.find("#timeline section","cite").length&&(e.timeline.asset.credit=VMM.Lib.html(VMM.Lib.find("#timeline section","cite"))),0!=VMM.Lib.find(this,"figcaption").length&&(e.timeline.asset.caption=VMM.Lib.html(VMM.Lib.find("#timeline section","figcaption"))))),VMM.Lib.each("#timeline li",function(){var t,a=!1,i={type:"default",startDate:"",headline:"",text:"",asset:{media:"",credit:"",caption:""},tags:"Optional"};0!=VMM.Lib.find(this,"time")&&(a=!0,i.startDate=VMM.Lib.html(VMM.Lib.find(this,"time")[0]),VMM.Lib.find(this,"time")[1]&&(i.endDate=VMM.Lib.html(VMM.Lib.find(this,"time")[1])),i.headline=VMM.Lib.html(VMM.Lib.find(this,"h3")),i.text=VMM.Lib.html(VMM.Lib.find(this,"article")),t=!1,0!=VMM.Lib.find(this,"figure img").length?(t=!0,i.asset.media=VMM.Lib.attr(VMM.Lib.find(this,"figure img"),"src")):0!=VMM.Lib.find(this,"figure a").length&&(t=!0,i.asset.media=VMM.Lib.attr(VMM.Lib.find(this,"figure a"),"href")),t&&(0!=VMM.Lib.find(this,"cite").length&&(i.asset.credit=VMM.Lib.html(VMM.Lib.find(this,"cite"))),0!=VMM.Lib.find(this,"figcaption").length&&(i.asset.caption=VMM.Lib.html(VMM.Lib.find(this,"figcaption")))),trace(i),e.timeline.date.push(i))}),VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,e)},parseJSON:function(e){trace("parseJSON"),"default"==e.timeline.type?(trace("DATA SOURCE: JSON STANDARD TIMELINE"),VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,e)):"twitter"==e.timeline.type?(trace("DATA SOURCE: JSON TWEETS"),VMM.Timeline.DataObj.model_Tweets.buildData(e)):(trace("DATA SOURCE: UNKNOWN JSON"),trace(type.of(e.timeline)))},model:{googlespreadsheet:{getData:function(e){function t(){a=VMM.getJSON(s,function(e){clearTimeout(l),VMM.Timeline.DataObj.model.googlespreadsheet.buildData(e)}).error(function(e,t){trace("Google Docs ERROR"),trace("Google Docs ERROR: "+t+" "+e.responseText)}).success(function(){clearTimeout(l)})}var a,i,n,s,l,o=0;i=VMM.Util.getUrlVars(e).key,n=VMM.Util.getUrlVars(e).worksheet,void 0===n&&(n="od6"),s="https://spreadsheets.google.com/feeds/list/"+i+"/"+n+"/public/values?alt=json",l=setTimeout(function(){trace("Google Docs timeout "+s),trace(s),3>o?(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Still waiting on Google Docs, trying again "+o),o++,a.abort(),t()):VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Google Docs is not responding")},16e3),t()},buildData:function(e){function t(e){return void 0!==e?e.$t:""}var a,i,n,s,l,o=VMM.Timeline.DataObj.data_template_obj,r=!1;if(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Parsing Google Doc Data"),void 0!==e.feed.entry)for(r=!0,a=0;a<e.feed.entry.length;a++)i=e.feed.entry[a],n="",void 0!==i.gsx$type?n=i.gsx$type.$t:void 0!==i.gsx$titleslide&&(n=i.gsx$titleslide.$t),n.match("start")||n.match("title")?(o.timeline.startDate=t(i.gsx$startdate),o.timeline.headline=t(i.gsx$headline),o.timeline.asset.media=t(i.gsx$media),o.timeline.asset.caption=t(i.gsx$mediacaption),o.timeline.asset.credit=t(i.gsx$mediacredit),o.timeline.text=t(i.gsx$text),o.timeline.type="google spreadsheet"):n.match("era")?(s={startDate:t(i.gsx$startdate),endDate:t(i.gsx$enddate),headline:t(i.gsx$headline),text:t(i.gsx$text),tag:t(i.gsx$tag)},o.timeline.era.push(s)):(l={type:"google spreadsheet",startDate:t(i.gsx$startdate),endDate:t(i.gsx$enddate),headline:t(i.gsx$headline),text:t(i.gsx$text),tag:t(i.gsx$tag),asset:{media:t(i.gsx$media),credit:t(i.gsx$mediacredit),caption:t(i.gsx$mediacaption),thumbnail:t(i.gsx$mediathumbnail)}},o.timeline.date.push(l));r?(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Finished Parsing Data"),VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,o)):(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,VMM.Language.messages.loading+" Google Doc Data (cells)"),trace("There may be too many entries. Still trying to load data. Now trying to load cells to avoid Googles limitation on cells"),VMM.Timeline.DataObj.model.googlespreadsheet.getDataCells(e.feed.link[0].href))},getDataCells:function(e){function t(){a=VMM.getJSON(n,function(e){clearTimeout(s),VMM.Timeline.DataObj.model.googlespreadsheet.buildDataCells(e)}).error(function(e,t){trace("Google Docs ERROR"),trace("Google Docs ERROR: "+t+" "+e.responseText)}).success(function(){clearTimeout(s)})}var a,i,n,s,l=0;i=VMM.Util.getUrlVars(e).key,n="https://spreadsheets.google.com/feeds/cells/"+i+"/od6/public/values?alt=json",s=setTimeout(function(){trace("Google Docs timeout "+n),trace(n),3>l?(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Still waiting on Google Docs, trying again "+l),l++,a.abort(),t()):VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Google Docs is not responding")},16e3),t()},buildDataCells:function(e){function t(e){return void 0!==e?e.$t:""}var a,i,n,s,l,o=VMM.Timeline.DataObj.data_template_obj,r=!1,m=["timeline"],d=[],c=0,M=0;if(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,VMM.Language.messages.loading_timeline+" Parsing Google Doc Data (cells)"),void 0!==e.feed.entry){for(r=!0,M=0;M<e.feed.entry.length;M++)a=e.feed.entry[M],parseInt(a.gs$cell.row)>c&&(c=parseInt(a.gs$cell.row));for(M=0;c+1>M;M++)i={type:"",startDate:"",endDate:"",headline:"",text:"",tag:"",asset:{media:"",credit:"",caption:"",thumbnail:""}},d.push(i);for(M=0;M<e.feed.entry.length;M++)a=e.feed.entry[M],n="",s={content:t(a.gs$cell),col:a.gs$cell.col,row:a.gs$cell.row,name:""},1==s.row?("Start Date"==s.content?n="startDate":"End Date"==s.content?n="endDate":"Headline"==s.content?n="headline":"Text"==s.content?n="text":"Media"==s.content?n="media":"Media Credit"==s.content?n="credit":"Media Caption"==s.content?n="caption":"Media Thumbnail"==s.content?n="thumbnail":"Type"==s.content?n="type":"Tag"==s.content&&(n="tag"),m.push(n)):(s.name=m[s.col],d[s.row][s.name]=s.content);for(M=0;M<d.length;M++)i=d[M],i.type.match("start")||i.type.match("title")?(o.timeline.startDate=i.startDate,o.timeline.headline=i.headline,o.timeline.asset.media=i.media,o.timeline.asset.caption=i.caption,o.timeline.asset.credit=i.credit,o.timeline.text=i.text,o.timeline.type="google spreadsheet"):i.type.match("era")?(l={startDate:i.startDate,endDate:i.endDate,headline:i.headline,text:i.text,tag:i.tag},o.timeline.era.push(l)):(i={type:"google spreadsheet",startDate:i.startDate,endDate:i.endDate,headline:i.headline,text:i.text,tag:i.tag,asset:{media:i.media,credit:i.credit,caption:i.caption,thumbnail:i.thumbnail}},o.timeline.date.push(i))}r?(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Finished Parsing Data"),VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,o)):VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Unable to load Google Doc data source")}},storify:{getData:function(e){var t,a,i;VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Loading Storify..."),t=e.split("storify.com/")[1],a="http://api.storify.com/v1/stories/"+t+"?per_page=300&callback=?",i=setTimeout(function(){trace("STORIFY timeout"),VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Storify is not responding")},6e3),VMM.getJSON(a,VMM.Timeline.DataObj.model.storify.buildData).error(function(e,t){trace("STORIFY error"),trace("STORIFY ERROR: "+t+" "+e.responseText)}).success(function(){clearTimeout(i)})},buildData:function(e){var t,a,i,n,s,l,o,r,m;for(VMM.fireEvent(global,VMM.Timeline.Config.events.messege,"Parsing Data"),t=VMM.Timeline.DataObj.data_template_obj,t.timeline.startDate=new Date(e.content.date.created),t.timeline.headline=e.content.title,trace(e),a="",i=e.content.author.username,n="",void 0!==e.content.author.name&&(i=e.content.author.name,n=e.content.author.username+"&nbsp;"),void 0!==e.content.description&&null!=e.content.description&&(a+=e.content.description),a+="<div class='storify'>",a+="<div class='vcard author'><a class='screen-name url' href='"+e.content.author.permalink+"' target='_blank'>",a+="<span class='avatar'><img src='"+e.content.author.avatar+"' style='max-width: 32px; max-height: 32px;'></span>",a+="<span class='fn'>"+i+"</span>",a+="<span class='nickname'>"+n+"<span class='thumbnail-inline'></span></span>",a+="</a>",a+="</div>",a+="</div>",t.timeline.text=a,t.timeline.asset.media=e.content.thumbnail,t.timeline.type="storify",s=0;s<e.content.elements.length;s++)l=e.content.elements[s],o=!1,new Date(l.posted_at),trace(l.type),r={type:"storify",startDate:l.posted_at,endDate:l.posted_at,headline:" ",slug:"",text:"",asset:{media:"",credit:"",caption:""}},"image"==l.type?(void 0!==l.source.name?"flickr"==l.source.name?(r.asset.media="http://flickr.com/photos/"+l.meta.pathalias+"/"+l.meta.id+"/",r.asset.credit="<a href='"+r.asset.media+"'>"+l.attribution.name+"</a>",r.asset.credit+=" on <a href='"+l.source.href+"'>"+l.source.name+"</a>"):"instagram"==l.source.name?(r.asset.media=l.permalink,r.asset.credit="<a href='"+l.permalink+"'>"+l.attribution.name+"</a>",r.asset.credit+=" on <a href='"+l.source.href+"'>"+l.source.name+"</a>"):(r.asset.credit="<a href='"+l.permalink+"'>"+l.attribution.name+"</a>",void 0!==l.source.href&&(r.asset.credit+=" on <a href='"+l.source.href+"'>"+l.source.name+"</a>"),r.asset.media=l.data.image.src):(r.asset.credit="<a href='"+l.permalink+"'>"+l.attribution.name+"</a>",r.asset.media=l.data.image.src),r.slug=l.attribution.name,void 0!==l.data.image.caption&&"undefined"!=l.data.image.caption&&(r.asset.caption=l.data.image.caption,r.slug=l.data.image.caption)):"quote"==l.type?l.permalink.match("twitter")?(r.asset.media=l.permalink,r.slug=VMM.Util.untagify(l.data.quote.text)):l.permalink.match("storify")&&(o=!0,r.asset.media="<blockquote>"+l.data.quote.text.replace(/<\s*\/?\s*b\s*.*?>/g,"")+"</blockquote>"):"link"==l.type?(r.headline=l.data.link.title,r.text=l.data.link.description,r.asset.media="undefined"!=l.data.link.thumbnail&&""!=l.data.link.thumbnail?l.data.link.thumbnail:l.permalink,r.asset.caption="<a href='"+l.permalink+"' target='_blank'>"+l.data.link.title+"</a>",r.slug=l.data.link.title):"text"==l.type?l.permalink.match("storify")&&(o=!0,e.content.author.username,void 0!==l.attribution.name&&(i=l.attribution.name,n=l.attribution.username+"&nbsp;"),m="<div class='storify'>",m+="<blockquote><p>"+l.data.text.replace(/<\s*\/?\s*b\s*.*?>/g,"")+"</p></blockquote>",m+="<div class='vcard author'><a class='screen-name url' href='"+l.attribution.href+"' target='_blank'>",m+="<span class='avatar'><img src='"+l.attribution.thumbnail+"' style='max-width: 32px; max-height: 32px;'></span>",m+="<span class='fn'>"+i+"</span>",m+="<span class='nickname'>"+n+"<span class='thumbnail-inline'></span></span>",m+="</a></div></div>",r.text=m,s+1>=e.content.elements.length?r.startDate=e.content.elements[s-1].posted_at:"text"==e.content.elements[s+1].type&&e.content.elements[s+1].permalink.match("storify")?s+2>=e.content.elements.length?r.startDate=e.content.elements[s-1].posted_at:"text"==e.content.elements[s+2].type&&e.content.elements[s+2].permalink.match("storify")?s+3>=e.content.elements.length?r.startDate=e.content.elements[s-1].posted_at:"text"==e.content.elements[s+3].type&&e.content.elements[s+3].permalink.match("storify")?r.startDate=e.content.elements[s-1].posted_at:(trace("LEVEL 3"),r.startDate=e.content.elements[s+3].posted_at):(trace("LEVEL 2"),r.startDate=e.content.elements[s+2].posted_at):(trace("LEVEL 1"),r.startDate=e.content.elements[s+1].posted_at),r.endDate=r.startDate):"video"==l.type?(r.headline=l.data.video.title,r.asset.caption=l.data.video.description,r.asset.caption=l.source.username,r.asset.media=l.data.video.src):(trace("NO MATCH "),trace(l)),o&&(r.slug=VMM.Util.untagify(l.data.text)),t.timeline.date.push(r);VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,t)}},tweets:{type:"twitter",buildData:function(e){VMM.bindEvent(global,VMM.Timeline.DataObj.model.tweets.onTwitterDataReady,"TWEETSLOADED"),VMM.ExternalAPI.twitter.getTweets(e.timeline.tweets)},getData:function(e){VMM.bindEvent(global,VMM.Timeline.DataObj.model.tweets.onTwitterDataReady,"TWEETSLOADED"),VMM.ExternalAPI.twitter.getTweetSearch(e)},onTwitterDataReady:function(e,t){var a,i,n=VMM.Timeline.DataObj.data_template_obj;for(a=0;a<t.tweetdata.length;a++)i={type:"tweets",startDate:"",headline:"",text:"",asset:{media:"",credit:"",caption:""},tags:"Optional"},i.startDate=t.tweetdata[a].raw.created_at,i.headline=type.of(t.tweetdata[a].raw.from_user_name)?t.tweetdata[a].raw.from_user_name+" (<a href='https://twitter.com/"+t.tweetdata[a].raw.from_user+"'>"+"@"+t.tweetdata[a].raw.from_user+"</a>)":t.tweetdata[a].raw.user.name+" (<a href='https://twitter.com/"+t.tweetdata[a].raw.user.screen_name+"'>"+"@"+t.tweetdata[a].raw.user.screen_name+"</a>)",i.asset.media=t.tweetdata[a].content,n.timeline.date.push(i);VMM.fireEvent(global,VMM.Timeline.Config.events.data_ready,n)}}},data_template_obj:{timeline:{headline:"",description:"",asset:{media:"",credit:"",caption:""},date:[],era:[]}},date_obj:{startDate:"2012,2,2,11,30",headline:"",text:"",asset:{media:"http://youtu.be/vjVfu8-Wp6s",credit:"",caption:""},tags:"Optional"}});