/**
* oEmbed Plugin plugin
* Licensed under the MIT license
* jQuery Embed Plugin: http://code.google.com/p/jquery-oembed/ (MIT License)
* Plugin for: http://ckeditor.com/license (GPL/LGPL/MPL: http://ckeditor.com/license)
*/

!function(){CKEDITOR.plugins.add("oembed",{requires:["dialog"],lang:["de","en","fr","nl","pl","ru"],afterInit:function(e){var t=e.dataProcessor,n=t&&t.dataFilter;return e.config.oembed_ShowIframePreview?(n._.elements.iframe&&delete n._.elements.iframe,void 0):(n&&"undefined"==n._.elements.iframe&&n.addRules({elements:{iframe:function(t){return e.createFakeParserElement(t,"cke_iframe","iframe",!0)}}}),void 0)},init:function(e){function t(){"undefined"==typeof jQuery?CKEDITOR.scriptLoader.load("http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js",function(){void 0===jQuery.fn.oembed&&CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(CKEDITOR.plugins.getPath("oembed")+"libs/jquery.oembed.min.js"))}):void 0===jQuery.fn.oembed&&CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(CKEDITOR.plugins.getPath("oembed")+"libs/jquery.oembed.min.js"))}function n(t,n,i,o,l,d){jQuery("body").oembed(t,{onEmbed:function(t){var o,l,d=new CKEDITOR.dom.element("div");"string"==typeof t.code?(null!=e.config.oembed_WrapperClass&&d.addClass(e.config.oembed_WrapperClass),o=CKEDITOR.dom.element.createFromHtml(t.code),"IFRAME"==o.$.tagName&&e.config.oembed_ShowIframePreview===!1?(l=e.createFakeElement(o,"cke_iframe","iframe",!0),l.appendTo(d)):o.appendTo(d),n.insertElement(d),i&&CKEDITOR.dialog.getCurrent().hide()):"string"==typeof t.code[0].outerHTML?(null!=e.config.oembed_WrapperClass&&d.addClass(e.config.oembed_WrapperClass),o=CKEDITOR.dom.element.createFromHtml(t.code[0].outerHTML),"IFRAME"==o.$.tagName&&e.config.oembed_ShowIframePreview===!1?(l=e.createFakeElement(o,"cke_iframe","iframe",!0),l.appendTo(d)):o.appendTo(d),n.insertElement(d),i&&CKEDITOR.dialog.getCurrent().hide()):alert(e.lang.oembed.noEmbedCode)},onError:function(t){t.indexOf("vimeo.com")>0?alert(e.lang.oembed.noVimeo):alert(e.lang.oembed.Error)},maxHeight:l,maxWidth:o,useResponsiveResize:d,embedMethod:"editor"})}(null==e.config.oembed_ShowIframePreview||"undefined"==e.config.oembed_ShowIframePreview)&&(e.config.oembed_ShowIframePreview=!1),e.plugins.iframe||e.config.oembed_ShowIframePreview||CKEDITOR.addCss("img.cke_iframe{background-image: url("+CKEDITOR.getUrl(CKEDITOR.plugins.getPath("oembed")+"images/placeholder.png")+");"+"background-position: center center;"+"background-repeat: no-repeat;"+"border: 1px solid #a9a9a9;"+"width: 80px;"+"height: 80px;"+"}"),t(),CKEDITOR.tools.extend(CKEDITOR.editor.prototype,{oEmbed:function(t,i,o,l){function d(){(null==i||"undefined"==i)&&(i=null),(null==o||"undefined"==o)&&(o=null),(null==l||"undefined"==l)&&(l=!1),n(t,e,!1,i,o,l)}return t.length<1||t.indexOf("http")<0?(alert(e.lang.oembed.invalidUrl),!1):(void 0===jQuery.fn.oembed?CKEDITOR.scriptLoader.load(CKEDITOR.getUrl(CKEDITOR.plugins.getPath("oembed")+"libs/jquery.oembed.min.js"),function(){d()}):d(),!0)}}),e.addCommand("oembed",new CKEDITOR.dialogCommand("oembed")),e.ui.addButton("oembed",{label:e.lang.oembed.button,command:"oembed",icon:this.path+"images/icon.png"});var i=function(){var e=this.getDialog(),t=this.getValue(),n=e.getContentElement("general","maxSizeBox").getElement(),i=e.getContentElement("general","sizeBox").getElement();"noresize"==t?(n.hide(),i.hide()):"custom"==t?(n.hide(),i.show()):(n.show(),i.hide())};String.prototype.beginsWith=function(e){return 0===this.indexOf(e)},CKEDITOR.dialog.add("oembed",function(e){return{title:e.lang.oembed.title,minWidth:CKEDITOR.env.ie&&CKEDITOR.env.quirks?568:550,minHeight:155,onShow:function(){var e=this.getContentElement("general","resizeType").getValue(),t=this.getContentElement("general","maxSizeBox").getElement(),n=this.getContentElement("general","sizeBox").getElement();"noresize"==e?(t.hide(),n.hide()):"custom"==e?(t.hide(),n.show()):(t.show(),n.hide())},onOk:function(){var t,i,o,l=this.getValueOf("general","embedCode"),d=this.getContentElement("general","resizeType").getValue(),a=null,m=null,r=!1,g=this.getParentEditor(),s=this.getContentElement("general","autoCloseDialog").getValue();if(l.length<1||l.indexOf("http")<0)return alert(e.lang.oembed.invalidUrl),!1;if("noresize"==d?r=!1:"responsive"==d?(a=this.getContentElement("general","maxWidth").getInputElement().getValue(),m=this.getContentElement("general","maxHeight").getInputElement().getValue(),r=!0):"custom"==d&&(a=this.getContentElement("general","width").getInputElement().getValue(),m=this.getContentElement("general","height").getInputElement().getValue(),r=!1),l.indexOf(";")>0)for(t=l.split(";"),i=0;i<t.length;i++)o=t[i],o.length>1&&o.beginsWith("http")&&n(o,g,!1,a,m,r),i==t.length-1&&CKEDITOR.dialog.getCurrent().hide();else n(l,g,s,a,m,r);return!1},contents:[{label:e.lang.common.generalTab,id:"general",elements:[{type:"html",id:"oembedHeader",html:'<div style="white-space:normal;width:500px;padding-bottom:10px">'+e.lang.oembed.pasteUrl+"</div>"},{type:"text",id:"embedCode",focus:function(){this.getElement().focus()},label:e.lang.oembed.url,title:e.lang.oembed.pasteUrl},{type:"hbox",widths:["50%","50%"],children:[{id:"resizeType",type:"select",label:e.lang.oembed.resizeType,"default":"noresize",items:[[e.lang.oembed.noresize,"noresize"],[e.lang.oembed.responsive,"responsive"],[e.lang.oembed.custom,"custom"]],onChange:i},{type:"hbox",id:"maxSizeBox",widths:["120px","120px"],style:"float:left;position:absolute;left:58%;width:200px",children:[{type:"text",width:"100px",id:"maxWidth","default":null!=e.config.oembed_maxWidth?e.config.oembed_maxWidth:"560",label:e.lang.oembed.maxWidth,title:e.lang.oembed.maxWidthTitle},{type:"text",id:"maxHeight",width:"120px","default":null!=e.config.oembed_maxHeight?e.config.oembed_maxHeight:"315",label:e.lang.oembed.maxHeight,title:e.lang.oembed.maxHeightTitle}]},{type:"hbox",id:"sizeBox",widths:["120px","120px"],style:"float:left;position:absolute;left:58%;width:200px",children:[{type:"text",id:"width",width:"100px","default":null!=e.config.oembed_maxWidth?e.config.oembed_maxWidth:"560",label:e.lang.oembed.width,title:e.lang.oembed.widthTitle},{type:"text",id:"height",width:"120px","default":null!=e.config.oembed_maxHeight?e.config.oembed_maxHeight:"315",label:e.lang.oembed.height,title:e.lang.oembed.heightTitle}]}]},{type:"checkbox",id:"autoCloseDialog","default":"checked",label:e.lang.oembed.autoClose,title:e.lang.oembed.autoClose}]}]}})}})}();