/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

!function(t,e,i){function n(){e.Transport["xhr-polling"].apply(this,arguments),this.index=e.j.length;var t=this;e.j.push(function(e){t._(e)})}var o=i.document&&"MozAppearance"in i.document.documentElement.style;t["jsonp-polling"]=n,e.util.inherit(n,e.Transport["xhr-polling"]),n.prototype.name="jsonp-polling",n.prototype.post=function(t){function i(){n(),c.socket.setBuffer(!1)}function n(){c.iframe&&c.form.removeChild(c.iframe);try{o=document.createElement('<iframe name="'+c.iframeId+'">')}catch(t){o=document.createElement("iframe"),o.name=c.iframeId}o.id=c.iframeId,c.form.appendChild(o),c.iframe=o}var o,r,s,a,c=this,p=e.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.form||(r=document.createElement("form"),s=document.createElement("textarea"),a=this.iframeId="socketio_iframe_"+this.index,r.className="socketio",r.style.position="absolute",r.style.top="0px",r.style.left="0px",r.style.display="none",r.target=a,r.method="POST",r.setAttribute("accept-charset","utf-8"),s.name="d",r.appendChild(s),document.body.appendChild(r),this.form=r,this.area=s),this.form.action=this.prepareUrl()+p,n(),this.area.value=e.JSON.stringify(t);try{this.form.submit()}catch(m){}this.iframe.attachEvent?o.onreadystatechange=function(){"complete"==c.iframe.readyState&&i()}:this.iframe.onload=i,this.socket.setBuffer(!0)},n.prototype.get=function(){var t,i=this,n=document.createElement("script"),r=e.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),n.async=!0,n.src=this.prepareUrl()+r,n.onerror=function(){i.onClose()},t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(n,t),this.script=n,o&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},n.prototype._=function(t){return this.onData(t),this.isOpen&&this.get(),this},n.prototype.ready=function(t,i){var n=this;return o?(e.util.load(function(){i.call(n)}),void 0):i.call(this)},n.check=function(){return"document"in i},n.xdomainCheck=function(){return!0},e.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);