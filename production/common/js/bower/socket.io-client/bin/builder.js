/*!
 * socket.io-node
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

// start with the license header

var args,fs=null,socket=null,uglify=null,activeXObfuscator=null,template="/*! Socket.IO.%ext% build:"+socket.version+", %type%. Copyright(c) 2011 LearnBoost <dev@learnboost.com> MIT Licensed */\n",development=template.replace("%type%","development").replace("%ext%","js"),production=template.replace("%type%","production").replace("%ext%","min.js"),starttagIF="// if node",endtagIF="// end node",base=["io.js","util.js","events.js","json.js","parser.js","transport.js","socket.js","namespace.js"],baseTransports={websocket:["transports/websocket.js"],flashsocket:["transports/websocket.js","transports/flashsocket.js","vendor/web-socket-js/swfobject.js","vendor/web-socket-js/web_socket.js"],htmlfile:["transports/xhr.js","transports/htmlfile.js"],"xhr-polling":["transports/xhr.js","transports/xhr-polling.js"],"jsonp-polling":["transports/xhr.js","transports/xhr-polling.js","transports/jsonp-polling.js"]},wrapperPre="\nvar io = ('undefined' === typeof module ? {} : module.exports);\n(function() {\n",wrapperPost='\nif (typeof define === "function" && define.amd) {\n  define([], function () { return io; });\n}\n})();',builder=module.exports=function(){var e,t,r,s,n,o,i=null,a=Array.prototype.slice.call(arguments,0),l={minify:!0,node:!1,custom:[]};a.forEach(function(s){var n=Object.prototype.toString.call(s).replace(/\[object\s(\w+)\]/gi,"$1").toLowerCase();switch(n){case"array":return e=s;case"object":return t=s;case"function":return r=s}}),t=t||{},e=e||Object.keys(baseTransports);for(s in t)l[s]=t[s];return n=[],base.forEach(function(e){n.push(__dirname+"/../lib/"+e)}),e.forEach(function(e){var t=baseTransports[e];return t?(t.forEach(function(e){var t=__dirname+"/../lib/"+e;~n.indexOf(t)||n.push(t)}),void 0):(i="Unsupported transport `"+e+"` supplied as argument.",void 0)}),i?r(i):(o={},n.forEach(function(e){fs.readFile(e,function(t,s){var a,c,p;if(t&&(i=t),o[e]=s,Object.keys(o).length===n.length){if(i)return r(i);a=development,c=0,l.node||(a+=wrapperPre),n.forEach(function(e){a+=o[e]}),l.custom.length&&l.custom.forEach(function(e){a+=e}),l.node||(a+=wrapperPost),a=activeXObfuscator(a),l.node||(a=a.split("\n").filter(function(e){var t=e.indexOf(starttagIF)>=0,r=e.indexOf(endtagIF)>=0,s=c;return t&&(c++,s=c),r&&c--,0==s}).join("\n")),l.minify&&(p=uglify.parser.parse(a),p=uglify.uglify.ast_mangle(p),p=uglify.uglify.ast_squeeze(p),a=production+uglify.uglify.gen_code(p,{ascii_only:!0})),r(i,a)}})}),void 0)};builder.version=socket.version,builder.transports=baseTransports,module.parent||(args=process.argv.slice(2),builder(args.length?args:!1,{minify:!1},function(e,t){return e?console.error(e):(fs.write(fs.openSync(__dirname+"/../dist/socket.io.js","w"),t,0,"utf8"),console.log("Successfully generated the development build: socket.io.js"),void 0)}),builder(args.length?args:!1,function(e,t){return e?console.error(e):(fs.write(fs.openSync(__dirname+"/../dist/socket.io.min.js","w"),t,0,"utf8"),console.log("Successfully generated the production build: socket.io.min.js"),void 0)}));