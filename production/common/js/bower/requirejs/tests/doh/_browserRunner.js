window.dojo&&dojo.provide("doh._browserRunner"),function(){var topdog,byId,_addOnEvt,escapeXml,_logBacklog,_loggedMsgLen,sendToLogPane,findTarget,loaded,groupTemplate,testTemplate,groupNodes,_groupTogglers,_getGroupToggler,addGroupToList,addFixtureToList,getFixtureNode,getGroupNode,updateBacklog,_nameTimes,_playSound,tabzidx,_showTab,runAll,listHeightTimer,setListHeight,_thisGroup,_thisUrl,otr;doh.setTimeout=function(e,t){return setTimeout(e,t)};try{topdog=window.parent==window||!Boolean(window.parent.doh)}catch(e){topdog=!0}topdog?(byId=function(e){return document.getElementById(e)},_addOnEvt=function(e,t,o){var r,n;o||(o=window),r=t,"string"==typeof t&&(r=o[t]),n=function(){return r.apply(o,arguments)},window.dojo&&"load"==e?dojo.addOnLoad(n):window.attachEvent?window.attachEvent("on"+e,n):window.addEventListener?window.addEventListener(e,n,!1):document.addEventListener&&document.addEventListener(e,n,!1)},escapeXml=function(e){return e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;")},_logBacklog=[],_loggedMsgLen=0,sendToLogPane=function(e,t){var o,r,n,d,i="";for(o=0;o<e.length;o++)i+=" "+e[o];if(i=escapeXml(i),i=i.replace("	","&nbsp;&nbsp;&nbsp;&nbsp;").replace(" ","&nbsp;").replace("\n","<br>&nbsp;"),!byId("logBody"))return _logBacklog.push(i),void 0;if(_logBacklog.length&&!t)for(;r=_logBacklog.shift();)sendToLogPane(r,!0);n=byId("logBody"),d=document.createElement("div"),d.innerHTML=i,n.appendChild(d),_loggedMsgLen++},findTarget=function(e){for(;e&&!e.getAttribute("_target");)e=e.parentNode,e.getAttribute||(e=null);return e},doh._jumpToLog=function(e){var t,o,r,n,d,i,s,a=findTarget(e?e.target:window.event.srcElement);a&&(t=Number(a.getAttribute("_target")),o=byId("logBody"),t>=o.childNodes.length||(r=o.childNodes[t],r.scrollIntoView(),window.dojo&&(n=dojo.style(r.parentNode.parentNode,"backgroundColor"),d=dojo.style(a.parentNode,"backgroundColor"),i=dojo.animateProperty({node:r,duration:500,properties:{backgroundColor:{start:d,end:n}},onEnd:function(){r.style.backgroundColor=""}}),s=dojo.animateProperty({node:r,duration:500,properties:{backgroundColor:{start:n,end:d}},onEnd:function(){i.play()}}),s.play())))},doh._jumpToSuite=function(e){var t,o,r=findTarget(e?e.target:window.event.srcElement);r&&(t=r.getAttribute("_target"),o=getGroupNode(t),o&&o.scrollIntoView())},doh._init=function(e){return function(){var t=byId("logBody");if(t){for(;t.firstChild;)t.removeChild(t.firstChild);_loggedMsgLen=0}this._totalTime=0,this._suiteCount=0,e.apply(doh,arguments)}}(doh._init),doh._setupGroupForRun=function(e){return function(t){var o,r=doh._groups[t];doh._curTestCount=r.length,doh._curGroupCount=1,o=getGroupNode(t),o&&o.getElementsByTagName("td")[2].setAttribute("_target",_loggedMsgLen+1),e.apply(doh,arguments)}}(doh._setupGroupForRun),doh._report=function(e){return function(){var t,o,r,n,d,i,s,a,u,l,h,g,p,c,m,T,_,f,y,b,N=byId("testList");if(N&&(t=N.getElementsByTagName("tfoot"),t.length&&N.removeChild(t[0]),o=N.createTFoot(),r=o.insertRow(-1),r.className="inProgress",n=r.insertCell(-1),n.colSpan=2,n.innerHTML="Result",n=r.insertCell(-1),n.innerHTML=this._testCount+" tests in "+this._groupCount+" groups /<span class='failure'>"+this._errorCount+"</span> errors, <span class='failure'>"+this._failureCount+"</span> failures",n.setAttribute("_target",_loggedMsgLen+1),r.insertCell(-1).innerHTML=doh._totalTime+"ms"),d=null,doh.perfTestResults){window.dojo?(dojo.require("dojox.charting.Chart2D"),dojo.require("dojox.charting.DataChart"),dojo.require("dojox.charting.plot2d.Scatter"),dojo.require("dojox.charting.plot2d.Lines"),dojo.require("dojo.data.ItemFileReadStore"),d=doh._dojoPlotPerfResults):d=doh._asciiPlotPerfResults;try{s=byId("perfTestsBody"),a=[],doh.perfTestResults&&doh.showPerfTestsPage();for(i in doh.perfTestResults){u=doh.perfTestResults[i],l=document.createElement("h1"),l.appendChild(document.createTextNode("Group: "+i)),s.appendChild(l),h=document.createElement("blockquote"),s.appendChild(h);for(g in u)if(p=u[g]){for(c=document.createElement("h3"),c.appendChild(document.createTextNode("TEST: "+g)),c.style.textDecoration="underline",h.appendChild(c),m=document.createElement("div"),h.appendChild(m),T="<b>TRIAL SIZE: </b>"+p.trials[0].testIterations+" iterations<br>"+"<b>NUMBER OF TRIALS: </b>"+p.trials.length+"<br>",f=[],y=[],_=0;_<p.trials.length;_++)f.push(p.trials[_].average),y.push(p.trials[_].executionTime);T+="<b>AVERAGE TRIAL EXECUTION TIME: </b>"+doh.average(y).toFixed(10)+"ms.<br>",T+="<b>MAXIMUM TEST ITERATION TIME: </b>"+doh.max(f).toFixed(10)+"ms.<br>",T+="<b>MINIMUM TEST ITERATION TIME: </b>"+doh.min(f).toFixed(10)+"ms.<br>",T+="<b>AVERAGE TEST ITERATION TIME: </b>"+doh.average(f).toFixed(10)+"ms.<br>",T+="<b>MEDIAN TEST ITERATION TIME: </b>"+doh.median(f).toFixed(10)+"ms.<br>",T+="<b>VARIANCE TEST ITERATION TIME: </b>"+doh.variance(f).toFixed(10)+"ms.<br>",T+="<b>STANDARD DEVIATION ON TEST ITERATION TIME: </b>"+doh.standardDeviation(f).toFixed(10)+"ms.<br>",m.innerHTML=T,m=document.createElement("div"),m.innerHTML="<h3>Average Test Execution Time (in milliseconds, with median line)</h3>",h.appendChild(m),m=document.createElement("div"),dojo.style(m,"width","600px"),dojo.style(m,"height","250px"),h.appendChild(m),a.push({div:m,title:"Average Test Execution Time",data:f}),m=document.createElement("div"),m.innerHTML="<h3>Average Trial Execution Time (in milliseconds, with median line)</h3>",h.appendChild(m),m=document.createElement("div"),dojo.style(m,"width","600px"),dojo.style(m,"height","250px"),h.appendChild(m),a.push({div:m,title:"Average Trial Execution Time",data:y})}}b=function(){if(a.length){var e=a.shift();d(e.div,e.title,e.data)}doh.setTimeout(b,50)},doh.setTimeout(b,150)}catch(E){doh.debug(E)}}e.apply(doh,arguments)}}(doh._report),doh.debug=this.opera&&opera.postError?function(){var e,t="";for(e=0;e<arguments.length;e++)t+=" "+arguments[e];sendToLogPane([t]),opera.postError("DEBUG:"+t)}:window.console?function(){var e,t="";for(e=0;e<arguments.length;e++)t+=" "+arguments[e];sendToLogPane([t]),console.log("DEBUG:"+t)}:function(){sendToLogPane.call(window,arguments)},loaded=!1,groupTemplate=null,testTemplate=null,groupNodes={},_groupTogglers={},_getGroupToggler=function(e,t){if(_groupTogglers[e])return _groupTogglers[e];var o=!0;return _groupTogglers[e]=function(r,n){var d,i=groupNodes[e].__items;if(o||n){for(o=!1,d=0;d<i.length;d++)i[d].style.display="";t.innerHTML="&#9660;"}else{for(o=!0,d=0;d<i.length;d++)i[d].style.display="none";t.innerHTML="&#9658;"}}},addGroupToList=function(e){var t,o,r,n,d;if(byId("testList"))return t=byId("testList").tBodies[0],o=groupTemplate.cloneNode(!0),r=o.getElementsByTagName("td"),n=r[0],n.onclick=_getGroupToggler(e,n),d=r[1].getElementsByTagName("input")[0],d.group=e,d.onclick=function(){doh._groups[e].skip=!this.checked},r[2].innerHTML="<div class='testGroupName'>"+e+"</div><div style='width:0;'>&nbsp;</div>",r[3].innerHTML="",t.appendChild(o),o},addFixtureToList=function(e,t){var o,r,n,d;if(testTemplate)return o=groupNodes[e],o.__items||(o.__items=[]),r=testTemplate.cloneNode(!0),n=r.getElementsByTagName("td"),n[2].innerHTML=t.name,n[3].innerHTML="",d=(o.__lastFixture||o.__groupNode).nextSibling,d?d.parentNode.insertBefore(r,d):o.__groupNode.parentNode.appendChild(r),r.style.display="none",o.__items.push(r),o.__lastFixture=r},getFixtureNode=function(e,t){return groupNodes[e]?groupNodes[e][t.name]:null},getGroupNode=function(e){return groupNodes[e]?groupNodes[e].__groupNode:null},updateBacklog=[],doh._updateTestList=function(e,t,o){if(!loaded)return e&&t&&updateBacklog.push([e,t]),void 0;if(updateBacklog.length&&!o)for(var r;r=updateBacklog.shift();)doh._updateTestList(r[0],r[1],!0);e&&t&&(groupNodes[e]||(groupNodes[e]={__groupNode:addGroupToList(e)}),groupNodes[e][t.name]||(groupNodes[e][t.name]=addFixtureToList(e,t)))},doh._testRegistered=doh._updateTestList,doh._groupStarted=function(e){0==this._suiteCount&&(this._runedSuite=0,this._currentGlobalProgressBarWidth=0,this._suiteCount=this._testCount),doh._inGroup!=e&&(doh._groupTotalTime=0,doh._runed=0,doh._inGroup=e,this._runedSuite++);var t=getGroupNode(e);t&&(t.className="inProgress")},doh._groupFinished=function(e,t){var o,r=getGroupNode(e);r&&doh._inGroup==e&&(doh._totalTime+=doh._groupTotalTime,r.getElementsByTagName("td")[3].innerHTML=doh._groupTotalTime+"ms",r.getElementsByTagName("td")[2].lastChild.className="",doh._inGroup=null,o=doh._updateGlobalProgressBar(this._runedSuite/this._groupCount,t,e),r.className=o?"failure":"success",doh._currentGlobalProgressBarWidth=parseInt(1e4*(this._runedSuite/this._groupCount))/100),doh._inGroup==e&&this.debug('Total time for GROUP "',e,'" is ',doh._groupTotalTime,"ms")},doh._testStarted=function(e,t){var o=getFixtureNode(e,t);o&&(o.className="inProgress")},_nameTimes={},_playSound=function(e){var t,o;byId("hiddenAudio")&&byId("audio")&&byId("audio").checked&&(t=_nameTimes[e],(!t||new Date-t>700)&&(_nameTimes[e]=new Date,o=document.createElement("span"),byId("hiddenAudio").appendChild(o),o.innerHTML='<embed src="_sounds/'+e+'.wav" autostart="true" loop="false" hidden="true" width="1" height="1"></embed>'))},doh._updateGlobalProgressBar=function(e,t,o){var r,n=byId("progressOuter"),d=n.childNodes[doh._runedSuite-1];return d||(d=document.createElement("div"),n.appendChild(d),d.className="success",d.setAttribute("_target",o)),t||d._failure||(d._failure=!0,d.className="failure",o&&d.setAttribute("title","failed group "+o)),r=parseInt(1e4*e)/100,d.style.width=r-doh._currentGlobalProgressBarWidth+"%",d._failure},doh._testFinished=function(e,t,o){var r,n,d,i,s=getFixtureNode(e,t),a=t.endTime-t.startTime;s&&(s.getElementsByTagName("td")[3].innerHTML=a+"ms",s.className=o?"success":"failure",s.getElementsByTagName("td")[2].setAttribute("_target",_loggedMsgLen),o||(_playSound("doh"),r=getGroupNode(e),r&&(r.className="failure",_getGroupToggler(e)(null,!0)))),doh._inGroup==e&&(r=getGroupNode(e),doh._runed++,r&&doh._curTestCount&&(n=doh._runed/doh._curTestCount,d=this._updateGlobalProgressBar((doh._runedSuite+n-1)/doh._groupCount,o,e),i=r.getElementsByTagName("td")[2].lastChild,i.className=d?"failure":"success",i.style.width=parseInt(100*n)+"%",r.getElementsByTagName("td")[3].innerHTML=parseInt(1e4*n)/100+"%")),this._groupTotalTime+=a,this.debug(o?"PASSED":"FAILED","test:",t.name,a,"ms")},doh.registerUrl=function(e,t,o){var r=new String(e);this.register(e,{name:t,setUp:function(){doh.currentGroupName=r,doh.currentGroup=this,doh.currentUrl=t,this.d=new doh.Deferred,doh.currentTestDeferred=this.d,doh.showTestPage(),byId("testBody").src=t},timeout:o||1e4,runTest:function(){return this.d},tearDown:function(){doh.currentGroupName=null,doh.currentGroup=null,doh.currentTestDeferred=null,doh.currentUrl=null,doh.showLogPage()}})},tabzidx=1,_showTab=function(toShow,toHide){var i,node;for(i=0;i<toHide.length;i++)node=byId(toHide[i]),node&&(node.style.display="none");if(toShow=byId(toShow))with(toShow.style)display="",zIndex=++tabzidx},doh.showTestPage=function(){_showTab("testBody",["logBody","perfTestsBody"])},doh.showLogPage=function(){_showTab("logBody",["testBody","perfTestsBody"])},doh.showPerfTestsPage=function(){_showTab("perfTestsBody",["testBody","logBody"])},runAll=!0,doh.toggleRunAll=function(){var e,t,o,r;if(runAll=!runAll,byId("testList"))for(e=byId("testList").tBodies[0],t=e.getElementsByTagName("input"),o=0;r=t[o++];)r.checked=runAll,doh._groups[r.group].skip=!runAll},listHeightTimer=null,setListHeight=function(){listHeightTimer&&clearTimeout(listHeightTimer);var e=byId("testList");e&&(listHeightTimer=doh.setTimeout(function(){e.style.display="none",e.style.display=""},10))},_addOnEvt("resize",setListHeight),_addOnEvt("load",setListHeight),_addOnEvt("load",function(){loaded||(loaded=!0,groupTemplate=byId("groupTemplate"),groupTemplate&&(groupTemplate.parentNode.removeChild(groupTemplate),groupTemplate.style.display="",testTemplate=byId("testTemplate"),testTemplate.parentNode.removeChild(testTemplate),testTemplate.style.display="",doh._updateTestList()))}),_addOnEvt("load",function(){var e,t,o,r,n,d=doh._onEnd;if(doh._onEnd=function(){d.apply(doh,arguments),0==doh._failureCount?(doh.debug("WOOHOO!!"),_playSound("woohoo")):console.debug("doh._failureCount:",doh._failureCount),byId("play")&&t()},byId("play")){for(e=!1,t=function(){e?(byId("play").style.display=byId("pausedMsg").style.display="",byId("playingMsg").style.display=byId("pause").style.display="none",e=!1):(byId("play").style.display=byId("pausedMsg").style.display="none",byId("playingMsg").style.display=byId("pause").style.display="",e=!0)},doh.run=function(e){return function(){return doh._currentGroup||t(),e.apply(doh,arguments)}}(doh.run),o=byId("toggleButtons").getElementsByTagName("span"),n=0;r=o[n++];)r.onclick=t;doh._dojoPlotPerfResults=function(e,t,o){var r,n,d,i,s,a,u,l=doh.median(o),h=[];for(r=0;r<o.length;r++)h.push(l);n={label:"name",items:[{name:t,trials:o},{name:"Median",trials:h}]},d=new dojo.data.ItemFileReadStore({data:n}),i=Math.floor(doh.min(o)),s=Math.ceil(doh.max(o)),a=(s-i)/10,i>0&&(i-=a,0>i&&(i=0),i=Math.floor(i)),s>0&&(s+=a,s=Math.ceil(s)),a=(s-i)/10,u=new dojox.charting.DataChart(e,{type:dojox.charting.plot2d.Lines,displayRange:o.length,xaxis:{min:1,max:o.length,majorTickStep:Math.ceil((o.length-1)/10),htmlLabels:!1},yaxis:{min:i,max:s,majorTickStep:a,vertical:!0,htmlLabels:!1}}),u.setStore(d,{name:"*"},"trials")},doh._asciiPlotPerfResults=function(){}}})):(_doh=window.parent.doh,_thisGroup=_doh.currentGroupName,_thisUrl=_doh.currentUrl,_thisGroup&&(doh._testRegistered=function(e,t){_doh._updateTestList(_thisGroup,t)},doh._onEnd=function(){_doh._errorCount+=doh._errorCount,_doh._failureCount+=doh._failureCount,_doh._testCount+=doh._testCount,_doh.currentTestDeferred.callback(!0)},otr=doh._getTestObj,doh._getTestObj=function(){var e=otr.apply(doh,arguments);return e.name=_thisUrl+"::"+arguments[0]+"::"+e.name,e},doh.debug=doh.hitch(_doh,"debug"),doh.registerUrl=doh.hitch(_doh,"registerUrl"),doh._testStarted=function(e,t){_doh._testStarted(_thisGroup,t)},doh._testFinished=function(e,t,o){if(_doh._testFinished(_thisGroup,t,o),doh.perfTestResults)try{gName=""+e;for(var r=t.name;r.indexOf("::")>=0;)r=r.substring(r.indexOf("::")+2,r.length);_doh.perfTestResults||(_doh.perfTestResults={}),_doh.perfTestResults[gName]||(_doh.perfTestResults[gName]={}),_doh.perfTestResults[gName][t.name]=doh.perfTestResults[gName][r]}catch(n){doh.debug(n)}},doh._groupStarted=function(){this._setParent||(_doh._curTestCount=this._testCount,_doh._curGroupCount=this._groupCount,this._setParent=!0)},doh._report=function(){}))}();