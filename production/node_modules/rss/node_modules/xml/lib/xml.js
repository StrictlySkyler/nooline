function xml(e,t){function n(e){f?process.nextTick(e):e()}function r(e,t){if(void 0!==t&&(u+=t),e&&!c&&(a=a||new Stream,c=!0),e&&c){var r=u;n(function(){a.emit("data",r)}),u=""}}function i(e,t){format(r,resolve(e,s,s?1:0),t)}function o(){if(a){var e=u;n(function(){a.emit("data",e)}),a.emit("end"),a.readable=!1,a.emit("close")}}"object"!=typeof t&&(t={indent:t});var a=t.stream?new Stream:null,u="",c=!1,s=t.indent?t.indent===!0?DEFAULT_INDENT:t.indent:"",f=!0;return n(function(){f=!1}),e&&e.forEach?e.forEach(function(t,n){var r;n+1===e.length&&(r=o),i(t,r)}):i(e,o),a?(a.readable=!0,a):u}function element(){var e=Array.prototype.slice.call(arguments),t={_elem:resolve(e)};return t.push=function(e){var t,n;if(!this.append)throw Error("not assigned to a parent!");t=this,n=this._elem.indent,format(this.append,resolve(e,n,this._elem.icount+(n?1:0)),function(){t.append(!0)})},t.close=function(e){void 0!==e&&this.push(e),this.end&&this.end()},t}function create_indent(e,t){return Array(t||0).join(e||"")}function resolve(e,t,n){function r(e){var t=Object.keys(e);t.forEach(function(t){s.push(attribute(t,e[t]))})}var i,o,a,u,c,s,f;if(n=n||0,i=create_indent(t,n),a=e,u=!1,"object"==typeof e&&(c=Object.keys(e),o=c[0],a=e[o],a._elem))return a._elem.name=o,a._elem.icount=n,a._elem.indent=t,a._elem.indents=i,a._elem.interrupt=a,a._elem;switch(s=[],f=[],typeof a){case"object":if(null===a)break;a._attr&&r(a._attr),a._cdata&&f.push(("<![CDATA["+a._cdata).replace(/\]\]>/g,"]]]]><![CDATA[>")+"]]>"),a.forEach&&(f.push(""),a.forEach(function(e){if("object"==typeof e){var i=Object.keys(e)[0];"_attr"==i?r(e._attr):f.push(resolve(e,t,n+1))}else f.push(create_indent(t,n+1)+escapeForXML(e))}),f.push(""));break;default:f.push(escapeForXML(a))}return{name:o,interrupt:u,attributes:s,content:f,icount:n,indents:i,indent:t}}function format(e,t,n){function r(){for(;t.content.length;){var r=t.content.shift();if(void 0!==r){if(i(r))return;format(e,r)}}e(!1,(o>1?t.indents:"")+(t.name?"</"+t.name+">":"")+(t.indent&&!n?"\n":"")),n&&n()}function i(t){return t.interrupt?(t.interrupt.append=e,t.interrupt.end=r,t.interrupt=!1,e(!0),!0):!1}if("object"!=typeof t)return e(!1,t);var o=t.interrupt?1:t.content.length;return e(!1,t.indents+(t.name?"<"+t.name:"")+(t.attributes.length?" "+t.attributes.join(" "):"")+(o?t.name?">":"":t.name?"/>":"")+(t.indent&&o>1?"\n":"")),o?(i(t)||r(),void 0):e(!1,t.indent?"\n":"")}function attribute(e,t){return e+"="+'"'+escapeForXML(t)+'"'}var escapeForXML=null,Stream=null.Stream,DEFAULT_INDENT="    ";module.exports=xml,module.exports.element=module.exports.Element=element;