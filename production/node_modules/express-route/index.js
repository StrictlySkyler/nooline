"use strict";function returnTrue(){return!0}function assertExt(t,r){return path.extname(t)===r}function Router(t,r,e){if(!t)throw Error("The first parameter must be an express application.");e||(e={}),"function"!=typeof e.ensureRestriction&&(e.ensureRestriction=returnTrue),Array.isArray(e.ext)||(e.ext=e.ext?[e.ext]:[".js"]),"boolean"!=typeof e.sync&&(e.sync=!0),this.app=t,this.dirPath=r,this.settings=e,this.reads=0,EventEmitter.call(this)}function statSync(t,r){var e=fs.statSync(t);r(null,e)}function readdirSync(t,r){var e=fs.readdirSync(t);r(null,e)}function route(t,r,e){var n=new Router(t,r,e);return n.readdirWithRoutes(r),n}var proto,fs=null,path=null,util=null,EventEmitter=require("events").EventEmitter;util.inherits(Router,EventEmitter),proto=Router.prototype,proto.readdirWithRoutes=function(t){var r=this,e=r.settings.sync,n=e?statSync:fs.stat,o=e?readdirSync:fs.readdir;r.reads+=1,n(t,function(e,i){if(e)throw e;r.reads-=1,i.isDirectory()?(r.reads+=1,o(t,function(e,o){if(e)throw e;r.reads+=o.length-1,o.forEach(function(e){n(path.join(t,e),function(n,o){if(n)throw n;r.reads-=1,o.isDirectory()?r.readdirWithRoutes(path.resolve(t,e)):r.settings.ext.some(function(t){return assertExt(e,t)})&&r.applyRoutes(require(path.resolve("./",t,e)))})})})):r.applyRoutes(require(path.resolve("./",t)))})},proto.applyRoutes=function(t){var r,e,n=this;for(e in t)t.hasOwnProperty(e)&&(r=t[e],Array.isArray(r)?r.forEach(function(t){n.applyRoute(e,t)}):n.applyRoute(e,r));0===n.reads&&this.emit("loaded")},proto.applyRoute=function(t,r){var e,n=this;if("function"==typeof r)n.app.get(t,r);else{if("function"!=typeof r.fn)throw Error("Wrong definition of the route. It must be a function or a object with `fn` property.");e=r.methods&&Array.isArray(r.methods)?r.methods:["get"],e.forEach(function(e){r.restricted?n.app[e](t,n.settings.ensureRestriction,r.fn):r&&n.app[e](t,r.fn)})}},route.Router=Router,module.exports=route;