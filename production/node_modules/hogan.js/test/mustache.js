/*
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

function send(t){buf+="-FOO "+t+" FOO-"}function is(t,e,a){t===e?(output("OK:   "+a),++passed):(output("FAIL: "+a),output("Expected |"+e+"|"),output("     Got |"+t+"|"),++failed)}function complete(){output("\nTests Complete"),output("--------------"),output("Passed: "+passed),output("Failed: "+failed),output("\n")}var output,Hogan,template,compiler,mustache_wrapper,engines,Mustache,Hogan2,context,text,partialText,s,t,buf,doc=this.document,fs=null,passed=0,failed=0;this.output||(output=function(t){return doc?doc.write(t+"<br/>"):console.log(t)}),Hogan=require(__dirname+"/../lib/hogan"),template=""+fs.readFileSync(__dirname+"/../lib/template.js"),compiler=""+fs.readFileSync(__dirname+"/../lib/compiler.js"),mustache_wrapper=""+fs.readFileSync(__dirname+"/../wrappers/mustache.js.mustache"),engines=Function(Hogan.compile(mustache_wrapper).render({template:template,compiler:compiler})+"; return {Hogan: Hogan, Mustache: Mustache};")(),Mustache=engines.Mustache,Hogan2=engines.Hogan,is(Mustache.hasOwnProperty("to_html"),!0,"Mustache has to_html method."),context={foo:"bar",mypartial:{baz:"qux"}},text="abc {{foo}} def {{>mypartial}} ghi",partialText="{{baz}}",s=Mustache.to_html(text,context,{mypartial:partialText}),is(s,"abc bar def qux ghi","Correct emulation of Mustache.js partial-name-in-context resolution."),t=Hogan2.compile(text),s=t.render(context,{mypartial:partialText}),is(s,"abc bar def  ghi","Hogan behavior not changed by Mustache.js emulation."),buf="",s=Mustache.to_html(text,context,{mypartial:partialText},send),is(buf,"-FOO abc bar def qux ghi FOO-","Correct emulation of Mustache.js sendFun."),complete();