/*
 *  Copyright 2011 Twitter, Inc.
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 */

var HoganTemplate=function(){function n(n){this.text=n}function t(n){var t=(null===n?"":n)+"";return c.test(t)?t.replace(r,"&amp;").replace(e,"&lt;").replace(o,"&gt;").replace(u,"&#39;").replace(i,"&quot;"):t}var r,e,o,u,i,c,f;return n.prototype={r:function(){return""},v:t,render:function(n,t){return this.r(n,t)},rp:function(n,t,r){var e=r[n];return e?e.render(t,r):""},rs:function(n,t,r){var e,o="",u=n[n.length-1];if(!f(u))return o=r(n,t);for(e=0;e<u.length;e++)n.push(u[e]),o+=r(n,t),n.pop();return o},s:function(n,t,r,e,o,u){if(f(n)&&0===n.length)return!1;e||"function"!=typeof n||(n=this.ls(n,t,r,o,u));var i=""===n||!!n;return!e&&i&&t&&t.push("object"==typeof n?n:t[t.length-1]),i},d:function(n,t,r,e){var o,u,i,c;if("."===n&&f(t[t.length-2]))return t[t.length-1];for(o=n.split("."),u=this.f(o[0],t,r,e),i=null,c=1;c<o.length;c++)u&&"object"==typeof u&&o[c]in u?(i=u,u=u[o[c]]):u="";return e&&!u?!1:(e||"function"!=typeof u||(t.push(i),u=this.lv(u,t,r),t.pop()),u)},f:function(n,t,r,e){var o,u=!1,i=null,c=!1;for(o=t.length-1;o>=0;o--)if(i=t[o],i&&"object"==typeof i&&n in i){u=i[n],c=!0;break}return c?(e||"function"!=typeof u||(u=this.lv(u,t,r)),u):e?!1:""},ho:function(n,t,r,e){var o=n.call(t,e,function(n){return Hogan.compile(n).render(t)}),u=Hogan.compile(""+o).render(t,r);return this.b=u,!1},b:"",ls:function(n,t,r,e,o){var u,i=t[t.length-1];return n.length>0?this.ho(n,i,r,this.text.substring(e,o)):(u=n.call(i),"function"==typeof u?this.ho(u,i,r,this.text.substring(e,o)):u)},lv:function(n,t,r){var e=t[t.length-1];return Hogan.compile(""+n.call(e)).render(e,r)}},r=/&/g,e=/</g,o=/>/g,u=/\'/g,i=/\"/g,c=/[&<>\"\']/,f=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)},n}(),Hogan=function(){function n(n){function e(){h.length>0&&(v.push(new String(h)),h="")}function o(){var n,t=!0;for(n=x;n<v.length;n++)if(t=v[n].tag&&b[v[n].tag]<b._v||!v[n].tag&&null==v[n].match(d),!t)return!1;return t}function u(n,t){if(e(),n&&o())for(var r=x;r<v.length;r++)v[r].tag||v.splice(r,1);else t||v.push({tag:"\n"});m=!1,x=v.length}function i(n,r){var e="="+H,o=n.indexOf(e,r),u=t(n.substring(n.indexOf("=",r)+1,o)).split(" ");return y=u[0],H=u[1],o+e.length-1}var c,f=n.length,a=0,l=1,p=2,g=a,s=null,h="",v=[],m=!1,_=0,x=0,y="{{",H="}}";for(_=0;f>_;_++)g==a?r(y,n,_)?(--_,e(),g=l):"\n"==n[_]?u(m):h+=n[_]:g==l?(_+=y.length-1,c=b[n[_+1]],s=c?n[_+1]:"_v",m=_,"="==s?(_=i(n,_),g=a):(c&&_++,g=p)):r(H,n,_)?(_+=H.length-1,v.push({tag:s,n:t(h),i:"/"==s?m-1:_+1}),h="",g=a,"{"==s&&_++):h+=n[_];return u(m,!0),v}function t(n){return n.trim?n.trim():n.replace(/^\s*|\s*$/g,"")}function r(n,t,r){if(t[r]!=n[0])return!1;for(var e=1,o=n.length;o>e;e++)if(t[r+e]!=n[e])return!1;return!0}function e(n,t,r,i){for(var c=[],f=null,a=null;n.length>0;)if(a=n.shift(),"#"==a.tag||"^"==a.tag||o(a,i))r.push(a),a.nodes=e(n,a.tag,r,i),c.push(a);else{if("/"==a.tag){if(0==r.length)throw Error("Closing tag without opener: /"+a.n);if(f=r.pop(),a.n!=f.n&&!u(a.n,f.n,i))throw Error("Nesting error: "+f.n+" vs. "+a.n);return f.end=a.i,c}c.push(a)}if(r.length>0)throw Error("missing closing tag: "+r.pop().n);return c}function o(n,t){for(var r=0,e=t.length;e>r;r++)if(t[r].o==n.n)return n.tag="#",!0}function u(n,t,r){for(var e=0,o=r.length;o>e;e++)if(r[e].c==n&&r[e].o==t)return!0}function i(n,t,r){var e,o='var c = [cx];var b = "";var _ = this;'+a(n)+"return b;";return r.asString?"function(cx,p){"+o+";};":(e=new HoganTemplate(t),e.r=Function("cx","p",o),e)}function c(n){return n.replace(y,"\\\\").replace(m,'\\"').replace(_,"\\n").replace(x,"\\r")}function f(n){return~n.indexOf(".")?"d":"f"}function a(n){var t,r,e,o="";for(t=0,r=n.length;r>t;t++)e=n[t].tag,"#"==e?o+=l(n[t].nodes,n[t].n,f(n[t].n),n[t].i,n[t].end):"^"==e?o+=p(n[t].nodes,n[t].n,f(n[t].n)):"<"==e||">"==e?o+=g(n[t].n):"{"==e||"&"==e?o+=s(n[t].n,f(n[t].n)):"\n"==e?o+=v("\n"):"_v"==e?o+=h(n[t].n,f(n[t].n)):void 0===e&&(o+=v(n[t]));return o}function l(n,t,r,e,o){var u="if(_.s(_."+r+'("'+c(t)+'",c,p,1),';return u+="c,p,0,"+e+","+o+")){",u+="b += _.rs(c,p,",u+='function(c,p){ var b = "";',u+=a(n),u+="return b;});c.pop();}",u+='else{b += _.b; _.b = ""};'}function p(n,t,r){var e="if (!_.s(_."+r+'("'+c(t)+'",c,p,1),c,p,1,0,0)){';return e+=a(n),e+="};"}function g(n){return'b += _.rp("'+c(n)+'",c[c.length - 1],p);'}function s(n,t){return"b += (_."+t+'("'+c(n)+'",c,p,0));'}function h(n,t){return"b += (_.v(_."+t+'("'+c(n)+'",c,p,0)));'}function v(n){return'b += "'+c(n)+'";'}var d=/\S/,b={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10},m=/\"/g,_=/\n/g,x=/\r/g,y=/\\/g;return{scan:n,parse:function(n,t){return t=t||{},e(n,"",[],t.sectionTags||[])},cache:{},compile:function(t,r){r=r||{};var e=this.cache[t];return e?e:(e=i(this.parse(n(t),r),t,r),this.cache[t]=e)}}}();"undefined"!=typeof module&&module.exports?(module.exports=Hogan,module.exports.Template=HoganTemplate):"undefined"!=typeof exports&&(exports.Hogan=Hogan,exports.HoganTemplate=HoganTemplate);