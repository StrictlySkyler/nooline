/**
 * socket.io
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

!function(t,e){function s(t,e){this.socket=t,this.name=e||"",this.flags={},this.json=new a(this,"json"),this.ackPackets=0,this.acks={}}function a(t,e){this.namespace=t,this.name=e}t.SocketNamespace=s,e.util.mixin(s,e.EventEmitter),s.prototype.$emit=e.EventEmitter.prototype.emit,s.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},s.prototype.packet=function(t){return t.endpoint=this.name,this.socket.packet(t),this.flags={},this},s.prototype.send=function(t,e){var s={type:this.flags.json?"json":"message",data:t};return"function"==typeof e&&(s.id=++this.ackPackets,s.ack=!0,this.acks[s.id]=e),this.packet(s)},s.prototype.emit=function(t){var e=Array.prototype.slice.call(arguments,1),s=e[e.length-1],a={type:"event",name:t};return"function"==typeof s&&(a.id=++this.ackPackets,a.ack="data",this.acks[a.id]=s,e=e.slice(0,e.length-1)),a.args=e,this.packet(a)},s.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},s.prototype.onPacket=function(t){function s(){i.packet({type:"ack",args:e.util.toArray(arguments),ackId:t.id})}var a,i=this;switch(t.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(t.reason||"booted"):this.$emit("disconnect",t.reason);break;case"message":case"json":a=["message",t.data],"data"==t.ack?a.push(s):t.ack&&this.packet({type:"ack",ackId:t.id}),this.$emit.apply(this,a);break;case"event":a=[t.name].concat(t.args),"data"==t.ack&&a.push(s),this.$emit.apply(this,a);break;case"ack":this.acks[t.ackId]&&(this.acks[t.ackId].apply(this,t.args),delete this.acks[t.ackId]);break;case"error":t.advice?this.socket.onError(t):"unauthorized"==t.reason?this.$emit("connect_failed",t.reason):this.$emit("error",t.reason)}},a.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},a.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);