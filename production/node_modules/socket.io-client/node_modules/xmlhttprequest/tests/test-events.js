var sys=require("util"),assert=require("assert"),http=require("http"),XMLHttpRequest=require("../lib/XMLHttpRequest").XMLHttpRequest,server=http.createServer(function(e,t){var r="HEAD"!=e.method?"Hello World":"";t.writeHead(200,{"Content-Type":"text/plain","Content-Length":Buffer.byteLength(r)}),"HEAD"!=e.method&&t.write(r),t.end(),assert.equal(onreadystatechange,!0),assert.equal(readystatechange,!0),assert.equal(removed,!0),sys.puts("done"),this.close()}).listen(8e3),xhr=new XMLHttpRequest,onreadystatechange=!1,readystatechange=!1,removed=!0,removedEvent=function(){removed=!1};xhr.onreadystatechange=function(){onreadystatechange=!0},xhr.addEventListener("readystatechange",function(){readystatechange=!0}),xhr.addEventListener("readystatechange",removedEvent),xhr.removeEventListener("readystatechange",removedEvent),xhr.open("GET","http://localhost:8000"),xhr.send();