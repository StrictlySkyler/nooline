var assert=null,Sender=null;describe("Sender",function(){describe("#send",function(){it("frames and sends a text message",function(n){var e,t="Hello world",o={write:function(n,t,o){e=n,process.nextTick(o)}},r=new Sender(o,{});r.send(t,{},function(){e.toString("utf8").should.eql("\x00"+t+"�"),n()})}),it("frames and sends an empty message",function(n){var e={write:function(){n()}},t=new Sender(e,{});t.send("",{},function(){})}),it("frames and sends a buffer",function(n){var e,t={write:function(n,t,o){e=n,process.nextTick(o)}},o=new Sender(t,{});o.send(new Buffer("foobar"),{},function(){e.toString("utf8").should.eql("\x00foobar�"),n()})}),it("frames and sends a binary message",function(n){var e,t="Hello world",o={write:function(n,t,o){e=n,process.nextTick(o)}},r=new Sender(o,{});r.send(t,{binary:!0},function(){e.toString("hex").should.eql("800b48656c6c6f20776f726c64"),n()})}),it("can fauxe stream data",function(n){var e=[],t={write:function(n,t,o){e.push(n),process.nextTick(o)}},o=new Sender(t,{});o.send(new Buffer("foobar"),{fin:!1},function(){}),o.send("bazbar",{fin:!1},function(){}),o.send(new Buffer("end"),{fin:!0},function(){e[0].toString("utf8").should.eql("\x00foobar"),e[1].toString("utf8").should.eql("bazbar"),e[2].toString("utf8").should.eql("end�"),n()})})}),describe("#close",function(){it("sends a hixie close frame",function(n){var e,t={write:function(n,t,o){e=n,process.nextTick(o)}},o=new Sender(t,{});o.close(null,null,null,function(){e.toString("utf8").should.eql("�\x00"),n()})}),it("sends a message end marker if fauxe streaming has started, before hixie close frame",function(n){var e=[],t={write:function(n,t,o){e.push(n),o&&process.nextTick(o)}},o=new Sender(t,{});o.send(new Buffer("foobar"),{fin:!1},function(){}),o.close(null,null,null,function(){e[0].toString("utf8").should.eql("\x00foobar"),e[1].toString("utf8").should.eql("�"),e[2].toString("utf8").should.eql("�\x00"),n()})})})});