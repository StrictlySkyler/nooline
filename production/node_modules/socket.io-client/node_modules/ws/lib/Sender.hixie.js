/*!
 * ws: a node.js websocket client
 * Copyright(c) 2011 Einar Otto Stangvik <einaros@gmail.com>
 * MIT Licensed
 */

function Sender(t){this.socket=t,this.continuationFrame=!1,this.isClosed=!1}var events=null,util=null,EventEmitter=events.EventEmitter;module.exports=Sender,util.inherits(Sender,events.EventEmitter),Sender.prototype.send=function(t,e,i){if(!this.isClosed){var r="string"==typeof t,n=r?Buffer.byteLength(t):t.length,o=n>127?2:1,s=0==this.continuationFrame,a=!(e&&void 0!==e.fin&&!e.fin),h=new Buffer((s?e&&e.binary?1+o:1:0)+n+(!a||e&&e.binary?0:1)),f=s?1:0;s&&(e&&e.binary?(h.write("","binary"),o>1&&h.write(String.fromCharCode(128+n/128),f++,"binary"),h.write(String.fromCharCode(127&n),f++,"binary")):h.write("\x00","binary")),r?h.write(t,f,"utf8"):t.copy(h,f,0),a?(e&&e.binary||h.write("ÿ",f+n,"binary"),this.continuationFrame=!1):this.continuationFrame=!0;try{this.socket.write(h,"binary",i)}catch(u){this.error(""+u)}}},Sender.prototype.close=function(t,e,i,r){if(!this.isClosed){this.isClosed=!0;try{this.continuationFrame&&this.socket.write(new Buffer([255],"binary")),this.socket.write(new Buffer([255,0]),"binary",r)}catch(n){this.error(""+n)}}},Sender.prototype.ping=function(){},Sender.prototype.pong=function(){},Sender.prototype.error=function(t){return this.emit("error",t),this};