function FlashWS(t){WS.call(this,t),this.flashPath=t.flashPath,this.policyPort=t.policyPort}function create(t,e){var o,n,a;return scripts[t]?e():(o=document.createElement("script"),n=!1,debug('loading "%s"',t),o.onload=o.onreadystatechange=function(){if(!n&&!scripts[t]){var a=o.readyState;a&&"loaded"!=a&&"complete"!=a||(debug('loaded "%s"',t),o.onload=o.onreadystatechange=null,n=!0,scripts[t]=!0,e())}},o.async=1,o.src=t,a=document.getElementsByTagName("head")[0],a.insertBefore(o,a.firstChild),void 0)}function load(t,e){function o(n){return t[n]?(create(t[n],function(){o(++n)}),void 0):e()}o(0)}var xobject,scripts,WS=null,util=null,debug=null;module.exports=FlashWS,xobject=global[["Active"].concat("Object").join("X")],util.inherits(FlashWS,WS),FlashWS.prototype.name="flashsocket",FlashWS.prototype.doOpen=function(){function t(t){return function(){var e=Array.prototype.join.call(arguments," ");debug("[websocketjs %s] %s",t,e)}}var e,o;this.check()&&(WEB_SOCKET_LOGGER={log:t("debug"),error:t("error")},WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0,WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,"undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=this.flashPath+"WebSocketMainInsecure.swf"),e=[this.flashPath+"web_socket.js"],"undefined"==typeof swfobject&&e.unshift(this.flashPath+"swfobject.js"),o=this,load(e,function(){o.ready(function(){WebSocket.__addTask(function(){WS.prototype.doOpen.call(o)})})}))},FlashWS.prototype.doClose=function(){if(this.socket){var t=this;WebSocket.__addTask(function(){WS.prototype.doClose.call(t)})}},FlashWS.prototype.write=function(){var t=this,e=arguments;WebSocket.__addTask(function(){WS.prototype.write.apply(t,e)})},FlashWS.prototype.ready=function(t){function e(){FlashWS.loaded||(843!=o.policyPort&&WebSocket.loadFlashPolicyFile("xmlsocket://"+o.host+":"+o.policyPort),WebSocket.__initialize(),FlashWS.loaded=!0),t.call(o)}if("undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject&&!(swfobject.getFlashPlayerVersion().major<10)){var o=this;return document.body?e():(util.load(e),void 0)}},FlashWS.prototype.check=function(){var t,e,o,n,a;if("undefined"!=typeof process)return!1;if("undefined"!=typeof WebSocket&&!("__initialize"in WebSocket))return!1;if(xobject){t=null;try{t=new xobject("ShockwaveFlash.ShockwaveFlash")}catch(i){}if(t)return!0}else for(e=0,o=navigator.plugins.length;o>e;e++)for(n=0,a=navigator.plugins[e].length;a>n;n++)if("Shockwave Flash"==navigator.plugins[e][n].description)return!0;return!1},scripts={};