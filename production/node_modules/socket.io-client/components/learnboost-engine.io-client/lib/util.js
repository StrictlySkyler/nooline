/**
 * Parses an URI
 *
 * @author Steven Levithan <stevenlevithan.com> (MIT license)
 * @api private
 */

var rvalidchars,rvalidescape,rvalidtokens,rvalidbraces,rtrimLeft,rtrimRight,re,parts,pageLoaded=!1,global="undefined"!=typeof window?window:global;exports.inherits=function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r},exports.keys=Object.keys||function(e){var t,r=[],o=Object.prototype.hasOwnProperty;for(t in e)o.call(e,t)&&r.push(t);return r},exports.on=function(e,t,r,o){e.attachEvent?e.attachEvent("on"+t,r):e.addEventListener&&e.addEventListener(t,r,o)},exports.load=function(e){return global.document&&"complete"===document.readyState||pageLoaded?e():(exports.on(global,"load",e,!1),void 0)},"undefined"!=typeof window&&exports.load(function(){pageLoaded=!0}),exports.defer=function(e){return exports.ua.webkit&&"undefined"==typeof importScripts?(exports.load(function(){setTimeout(e,100)}),void 0):e()},rvalidchars=/^[\],:{}\s]*$/,rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rtrimLeft=/^\s+/,rtrimRight=/\s+$/,exports.parseJSON=function(e){return"string"==typeof e&&e?(e=e.replace(rtrimLeft,"").replace(rtrimRight,""),global.JSON&&JSON.parse?JSON.parse(e):rvalidchars.test(e.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))?Function("return "+e)():void 0):null},exports.ua={},exports.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return!1}return void 0!=e.withCredentials}(),exports.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),exports.ua.gecko="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent),exports.ua.android="undefined"!=typeof navigator&&/android/i.test(navigator.userAgent),exports.ua.ios="undefined"!=typeof navigator&&/^(iPad|iPhone|iPod)$/.test(navigator.platform),exports.ua.ios6=exports.ua.ios&&/OS 6_/.test(navigator.userAgent),exports.request=function(e){if("undefined"!=typeof process){var t=null.XMLHttpRequest;return new t}if(e&&"undefined"!=typeof XDomainRequest&&!exports.ua.hasCORS)return new XDomainRequest;try{if(void 0!==t&&(!e||exports.ua.hasCORS))return new t}catch(r){}if(!e)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(r){}},re=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],exports.parseUri=function(e){for(var t=re.exec(e||""),r={},o=14;o--;)r[parts[o]]=t[o]||"";return r},exports.qs=function(e){var t,r="";for(t in e)e.hasOwnProperty(t)&&(r.length&&(r+="&"),r+=t+"="+encodeURIComponent(e[t]));return r};