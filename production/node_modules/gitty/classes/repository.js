function sync(t,o,e,n,i,r){var a,p,c=pty.spawn("git",[o,e,n],{cwd:t}),s=this;c.on("data",function(t){var o=t.toLowerCase();o.indexOf("username")>-1?c.write(r.user+"\r"):o.indexOf("password")>-1?c.write(r.pass+"\r"):o.indexOf("error")>-1||o.indexOf("fatal")>-1?a=parse.syncErr(o):p=parse.syncSuccess(o)}),c.on("exit",function(){i&&"function"==typeof i&&i.call(s,a,p)})}var fs=null,path=null,Command=null,parse=null,pty=null,Repository;Repository=function(t){var o=path.normalize(t),e=o.split("/");this.isRepository=fs.existsSync(o+"/.git"),this.name=e[e.length-1],this.path=o},Repository.prototype.init=function(t,o){var e=new Command(this.path,"init",o||[],""),n=this;e.exec(function(o,e,i){var r=o||i;n.isRepository=fs.existsSync(n.path+"/.git"),t&&"function"==typeof t&&t.call(n,r)})},Repository.prototype.log=function(t,o){var e='--pretty=format:\'{"commit": "%H","author": "%an <%ae>","date": "%ad","message": "%s"},\'',n=new Command(this.path,"log",[e],""),i=this;n.exec(function(o,e,n){var r=e,a=o||n;r&&(r=parse.log(r)),t&&"function"==typeof t&&t.call(i,a,r)},o)},Repository.prototype.status=function(t){var o=new Command(this.path,"status",[],""),e=new Command(this.path,"ls-files",["--other","--exclude-standard"],""),n=this;o.exec(function(o,i,r){var a=i,p=o||r;e.exec(function(o,e,i){var r=e;p||(p=o||i),a=parse.status(a,r),t&&"function"==typeof t&&t.call(n,p,a)})})},Repository.prototype.add=function(t,o,e){var n=t.join(" "),i=new Command(this.path,"add",[],n),r=this;i.exec(function(t,e,n){var i=t||n;o&&"function"==typeof o&&o.call(r,i)},e)},Repository.prototype.remove=function(t,o){var e=t.join(" "),n=new Command(this.path,"rm",["--cached"],e),i=this;n.exec(function(t,e,n){var r=t||n;o&&"function"==typeof o&&o.call(i,r)})},Repository.prototype.unstage=function(t,o){var e=t.join(" "),n=new Command(this.path,"reset HEAD",[],e),i=this;n.exec(function(t,e,n){var r=t||n;o&&"function"==typeof o&&o.call(i,r)})},Repository.prototype.commit=function(t,o,e){var n='"'+t+'"',i=new Command(this.path,"commit",["-m"],n),r=this;i.exec(function(t,e,n){var i=t||n,a=e?parse.commit(e):null;a&&a.error&&(i=a.error,a=null),o&&"function"==typeof o&&o.call(r,i,a)},e)},Repository.prototype.branches=function(t){var o=new Command(this.path,"branch",[],"");o.exec(function(o,e,n){var i=o||n,r=parse.branch(e);t&&"function"==typeof t&&t.call(this,i,r)})},Repository.prototype.branch=function(t,o){var e=new Command(this.path,"branch",[],t),n=this;e.exec(function(t,e,i){var r=t||i;o&&"function"==typeof o&&o.call(n,r)})},Repository.prototype.checkout=function(t,o){var e=new Command(this.path,"checkout",[],t),n=this;e.exec(function(t,e,i){n.branches(function(t,e){var i=t;o&&"function"==typeof o&&o.call(n,t||i,e)})})},Repository.prototype.merge=function(t,o){var e=new Command(this.path,"merge",[],t),n=this;e.exec(function(t,e,i){var r=t||i;o&&"function"==typeof o&&o.call(n,r)})},Repository.prototype.remote={},Repository.prototype.remote.add=function(t,o,e){var n=t+" "+o,i=new Command(this.path,"remote add",[],n),r=this;i.exec(function(t,o,n){var i=t||n;e&&"function"==typeof e&&e.call(r,i)})},Repository.prototype.remote.setUrl=function(t,o,e){var n=t+" "+o,i=new Command(this.path,"remote set-url",[],n),r=this;i.exec(function(t,o,n){var i=t||n;e&&"function"==typeof e&&e.call(r,i)})},Repository.prototype.remote.remove=function(t,o){var e=new Command(this.path,"remote rm",[],t),n=this;e.exec(function(t,e,i){var r=t||i;o&&"function"==typeof o&&o.call(n,r)})},Repository.prototype.remote.list=function(t){var o=new Command(this.path,"remote",["-v"],""),e=this;o.exec(function(o,n,i){var r=o||i,a=n;a&&(a=parse.remotes(a)),t&&"function"==typeof t&&t.call(e,r,a)})},Repository.prototype.push=function(t,o,e,n){sync(this.path,"push",t,o,e,n)},Repository.prototype.pull=function(t,o,e,n){sync(this.path,"pull",t,o,e,n)},Repository.prototype.reset=function(t,o){var e,n=new Command(this.path,"reset",["-q"],t),i=this;n.exec(function(t,n,r){e=t||r||e,i.log(function(t,n){e=t||e,o&&"function"==typeof o&&o.call(i,e,n)})})},Repository.prototype.graph=function(t){var o,e,n=new Command(this.path,"log",["--graph","--pretty=oneline","--abbrev-commit"],""),i=this;n.exec(function(n,r,a){o=n||a||o,!o&&r&&(e=null(r)),t&&"function"==typeof t&&t.call(i,o,e)})},module.exports=Repository;