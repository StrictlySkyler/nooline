/*!
 * Set the `name` property of the types. Used for debugging...
 */

/*!
 * This `char *` type is used by "allocCString()" above.
 */

/*!
 * Set the `type` property of the `NULL` pointer Buffer object.
 */

/*!
   * SlowBuffer convenience methods.
   */

function overwriteInspect(e){return"refinspect"===e.name?e:function(){var t=e.apply(this,arguments);return t.replace("Buffer","Buffer@0x"+this.address().toString(16))}}var opposite,int64temp,uint64temp,types,utfstringwarned,charPtrType,SlowBuffer,assert=null,debug=null;exports=module.exports=null,exports.refType=function(e){var t=exports.coerceType(e),r=Object.create(t);return r.indirection++,t.name&&(r.name=t.name+"*"),r},exports.derefType=function(e){var t,r=exports.coerceType(e);if(1===r.indirection)throw Error("Cannot create deref'd type for type with indirection 1");return t=Object.getPrototypeOf(r),t.indirection!==r.indirection-1&&(t=Object.create(r),t.indirection--),t},exports.coerceType=function(e){var t,r,n=e;if("string"==typeof n){if(n=exports.types[e])return n;if(n=e.replace(/\s+/g,"").toLowerCase(),"pointer"===n)n=exports.refType(exports.types.void);else if("string"===n)n=exports.types.CString;else if(t=0,n=n.replace(/\*/g,function(){return t++,""}),n=exports.types[n],t>0){assert(n&&"size"in n&&"indirection"in n,'could not determine a proper "type" from: '+JSON.stringify(e));for(r=0;t>r;r++)n=exports.refType(n)}}return assert(n&&"size"in n&&"indirection"in n,'could not determine a proper "type" from: '+JSON.stringify(e)),n},exports.getType=function(e){return e.type||(debug('WARN: no "type" found on buffer, setting default "type"',e),e.type={},e.type.size=e.length,e.type.indirection=1,e.type.get=function(){throw Error('unknown "type"; cannot get()')},e.type.set=function(){throw Error('unknown "type"; cannot set()')}),exports.coerceType(e.type)},exports.get=function(e,t,r){var n,o;return t||(t=0),r=r?exports.coerceType(r):exports.getType(e),debug("get(): (offset: %d)",t,e),assert(r.indirection>0,'"indirection" level must be at least 1'),1===r.indirection?r.get(e,t):(n=2===r.indirection?r.size:exports.sizeof.pointer,o=exports.readPointer(e,t,n),o.type=exports.derefType(r),o)},exports.set=function(e,t,r,n){t||(t=0),n=n?exports.coerceType(n):exports.getType(e),debug("set(): (offset: %d)",t,e,r),assert(n.indirection>=1,'"indirection" level must be at least 1'),1===n.indirection?n.set(e,t,r):exports.writePointer(e,t,r)},exports.alloc=function(e,t){var r,n,o=exports.coerceType(e);return debug('allocating Buffer for type with "size"',o.size),r=1===o.indirection?o.size:exports.sizeof.pointer,n=new Buffer(r),n.type=o,arguments.length>=2&&(debug("setting value on allocated buffer",t),exports.set(n,0,t,o)),n},exports.allocCString=function(e,t){var r,n;return null===e||void 0===e?exports.NULL:(r=Buffer.byteLength(e,t)+1,n=new Buffer(r),exports.writeCString(n,0,e,t),n.type=charPtrType,n)},exports.writeCString=function(e,t,r,n){var o,i;assert(Buffer.isBuffer(e),"expected a Buffer as the first argument"),assert.equal("string",typeof r,'expected a "string" as the third argument'),t||(t=0),n||(n="utf8"),o=e.length-t,i=e.write(r,t,o,n),e.writeUInt8(0,t+i)},exports["readInt64"+exports.endianness]=exports.readInt64,exports["readUInt64"+exports.endianness]=exports.readUInt64,exports["writeInt64"+exports.endianness]=exports.writeInt64,exports["writeUInt64"+exports.endianness]=exports.writeUInt64,opposite="LE"==exports.endianness?"BE":"LE",int64temp=new Buffer(exports.sizeof.int64),uint64temp=new Buffer(exports.sizeof.uint64),exports["readInt64"+opposite]=function(e,t){for(var r=0;r<exports.sizeof.int64;r++)int64temp[r]=e[t+exports.sizeof.int64-r-1];return exports.readInt64(int64temp,0)},exports["readUInt64"+opposite]=function(e,t){for(var r=0;r<exports.sizeof.uint64;r++)uint64temp[r]=e[t+exports.sizeof.uint64-r-1];return exports.readUInt64(uint64temp,0)},exports["writeInt64"+opposite]=function(e,t,r){exports.writeInt64(int64temp,0,r);for(var n=0;n<exports.sizeof.int64;n++)e[t+n]=int64temp[exports.sizeof.int64-n-1]},exports["writeUInt64"+opposite]=function(e,t,r){exports.writeUInt64(uint64temp,0,r);for(var n=0;n<exports.sizeof.uint64;n++)e[t+n]=uint64temp[exports.sizeof.uint64-n-1]},exports.ref=function(e){debug("creating a reference to buffer",e);var t=exports.refType(exports.getType(e));return exports.alloc(t,e)},exports.deref=function(e){return debug("dereferencing buffer",e),exports.get(e)},exports._attach=function(e,t){e._refs||(e._refs=[]),e._refs.push(t)},exports._writeObject=exports.writeObject,exports.writeObject=function(e,t,r){debug("writing Object to buffer",e,t,r),exports._writeObject(e,t,r),exports._attach(e,r)},exports._writePointer=exports.writePointer,exports.writePointer=function(e,t,r){debug("writing pointer to buffer",e,t,r),exports._writePointer(e,t,r),exports._attach(e,r)},exports._reinterpret=exports.reinterpret,exports.reinterpret=function(e,t,r){debug('reinterpreting buffer to "%d" bytes',t);var n=exports._reinterpret(e,t,r||0);return exports._attach(n,e),n},exports._reinterpretUntilZeros=exports.reinterpretUntilZeros,exports.reinterpretUntilZeros=function(e,t,r){debug('reinterpreting buffer to until "%d" NULL (0) bytes are found',t);var n=exports._reinterpretUntilZeros(e,t,r||0);return exports._attach(n,e),n},types=exports.types={},types.void={size:0,indirection:1,get:function(){return debug("getting `void` type (returns `null`)"),null},set:function(){debug("setting `void` type (no-op)")}},types.int8={size:exports.sizeof.int8,indirection:1,get:function(e,t){return e.readInt8(t||0)},set:function(e,t,r){return"string"==typeof r&&(r=r.charCodeAt(0)),e.writeInt8(r,t||0)}},types.uint8={size:exports.sizeof.uint8,indirection:1,get:function(e,t){return e.readUInt8(t||0)},set:function(e,t,r){return"string"==typeof r&&(r=r.charCodeAt(0)),e.writeUInt8(r,t||0)}},types.int16={size:exports.sizeof.int16,indirection:1,get:function(e,t){return e["readInt16"+exports.endianness](t||0)},set:function(e,t,r){return e["writeInt16"+exports.endianness](r,t||0)}},types.uint16={size:exports.sizeof.uint16,indirection:1,get:function(e,t){return e["readUInt16"+exports.endianness](t||0)},set:function(e,t,r){return e["writeUInt16"+exports.endianness](r,t||0)}},types.int32={size:exports.sizeof.int32,indirection:1,get:function(e,t){return e["readInt32"+exports.endianness](t||0)},set:function(e,t,r){return e["writeInt32"+exports.endianness](r,t||0)}},types.uint32={size:exports.sizeof.uint32,indirection:1,get:function(e,t){return e["readUInt32"+exports.endianness](t||0)},set:function(e,t,r){return e["writeUInt32"+exports.endianness](r,t||0)}},types.int64={size:exports.sizeof.int64,indirection:1,get:function(e,t){return e["readInt64"+exports.endianness](t||0)},set:function(e,t,r){return e["writeInt64"+exports.endianness](r,t||0)}},types.uint64={size:exports.sizeof.uint64,indirection:1,get:function(e,t){return e["readUInt64"+exports.endianness](t||0)},set:function(e,t,r){return e["writeUInt64"+exports.endianness](r,t||0)}},types.float={size:exports.sizeof.float,indirection:1,get:function(e,t){return e["readFloat"+exports.endianness](t||0)},set:function(e,t,r){return e["writeFloat"+exports.endianness](r,t||0)}},types.double={size:exports.sizeof.double,indirection:1,get:function(e,t){return e["readDouble"+exports.endianness](t||0)},set:function(e,t,r){return e["writeDouble"+exports.endianness](r,t||0)}},types.Object={size:exports.sizeof.Object,indirection:1,get:function(e,t){return e.readObject(t||0)},set:function(e,t,r){return e.writeObject(r,t||0)}},types.CString={size:exports.sizeof.pointer,alignment:exports.alignof.pointer,indirection:1,get:function(e,t){var r=e.readPointer(t);return r.isNull()?null:r.readCString(0)},set:function(e,t,r){var n=exports.allocCString(r);return e.writePointer(n,t)}},utfstringwarned=!1,Object.defineProperty(types,"Utf8String",{enumerable:!1,configurable:!0,get:function(){return utfstringwarned||(utfstringwarned=!0,console.error('"Utf8String" type is deprecated, use "CString" instead')),types.CString}}),["bool","byte","char","uchar","short","ushort","int","uint","long","ulong","longlong","ulonglong","size_t"].forEach(function(e){var t,r,n="bool"===e||"byte"===e||"size_t"===e||"u"===e[0],o=exports.sizeof[e];assert(o>=1&&8>=o),t="int"+8*o,n&&(t="u"+t),r=exports.types[t],assert(r),exports.types[e]=Object.create(r)}),Object.keys(exports.alignof).forEach(function(e){"pointer"!==e&&(exports.types[e].alignment=exports.alignof[e],assert(exports.types[e].alignment>0))}),exports.types.bool.get=function(e){return function(t,r){return e(t,r)?!0:!1}}(exports.types.bool.get),exports.types.bool.set=function(e){return function(t,r,n){return"number"!=typeof n&&(n=n?1:0),e(t,r,n)}}(exports.types.bool.set),Object.keys(exports.types).forEach(function(e){exports.types[e].name=e}),charPtrType=exports.refType(exports.types.char),exports.NULL.type=exports.types.void,exports.NULL_POINTER=exports.ref(exports.NULL),Buffer.prototype.address=function(){return exports.address(this)},Buffer.prototype.isNull=function(){return exports.isNull(this)},Buffer.prototype.ref=function(){return exports.ref(this)},Buffer.prototype.deref=function(){return exports.deref(this)},Buffer.prototype.readObject=function(e){return exports.readObject(this,e)},Buffer.prototype.writeObject=function(e,t){return exports.writeObject(this,t,e)},Buffer.prototype.readPointer=function(e,t){return exports.readPointer(this,e,t)},Buffer.prototype.writePointer=function(e,t){return exports.writePointer(this,t,e)},Buffer.prototype.readCString=function(e){return exports.readCString(this,e)},Buffer.prototype.writeCString=function(e,t,r){return exports.writeCString(this,t,e,r)},Buffer.prototype.readInt64BE=function(e){return exports.readInt64BE(this,e)},Buffer.prototype.writeInt64BE=function(e,t){return exports.writeInt64BE(this,t,e)},Buffer.prototype.readUInt64BE=function(e){return exports.readUInt64BE(this,e)},Buffer.prototype.writeUInt64BE=function(e,t){return exports.writeUInt64BE(this,t,e)},Buffer.prototype.readInt64LE=function(e){return exports.readInt64LE(this,e)},Buffer.prototype.writeInt64LE=function(e,t){return exports.writeInt64LE(this,t,e)},Buffer.prototype.readUInt64LE=function(e){return exports.readUInt64LE(this,e)},Buffer.prototype.writeUInt64LE=function(e,t){return exports.writeUInt64LE(this,t,e)},Buffer.prototype.reinterpret=function(e){return exports.reinterpret(this,e)},Buffer.prototype.reinterpretUntilZeros=function(e){return exports.reinterpretUntilZeros(this,e)},Buffer.prototype.inspect=overwriteInspect(Buffer.prototype.inspect),exports.NULL instanceof Buffer||(debug("extending SlowBuffer's prototype since it doesn't inherit from Buffer.prototype"),SlowBuffer=null.SlowBuffer,SlowBuffer.prototype.address=Buffer.prototype.address,SlowBuffer.prototype.isNull=Buffer.prototype.isNull,SlowBuffer.prototype.ref=Buffer.prototype.ref,SlowBuffer.prototype.deref=Buffer.prototype.deref,SlowBuffer.prototype.readObject=Buffer.prototype.readObject,SlowBuffer.prototype.writeObject=Buffer.prototype.writeObject,SlowBuffer.prototype.readPointer=Buffer.prototype.readPointer,SlowBuffer.prototype.writePointer=Buffer.prototype.writePointer,SlowBuffer.prototype.readCString=Buffer.prototype.readCString,SlowBuffer.prototype.writeCString=Buffer.prototype.writeCString,SlowBuffer.prototype.reinterpret=Buffer.prototype.reinterpret,SlowBuffer.prototype.reinterpretUntilZeros=Buffer.prototype.reinterpretUntilZeros,SlowBuffer.prototype.readInt64BE=Buffer.prototype.readInt64BE,SlowBuffer.prototype.writeInt64BE=Buffer.prototype.writeInt64BE,SlowBuffer.prototype.readUInt64BE=Buffer.prototype.readUInt64BE,SlowBuffer.prototype.writeUInt64BE=Buffer.prototype.writeUInt64BE,SlowBuffer.prototype.readInt64LE=Buffer.prototype.readInt64LE,SlowBuffer.prototype.writeInt64LE=Buffer.prototype.writeInt64LE,SlowBuffer.prototype.readUInt64LE=Buffer.prototype.readUInt64LE,SlowBuffer.prototype.writeUInt64LE=Buffer.prototype.writeUInt64LE,SlowBuffer.prototype.inspect=overwriteInspect(SlowBuffer.prototype.inspect));