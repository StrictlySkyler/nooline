/*!
 * Connect
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */

var http=null,res=http.ServerResponse.prototype,setHeader=res.setHeader,_renderHeaders=res._renderHeaders,writeHead=res.writeHead;res._hasConnectPatch||(res.__defineGetter__("headerSent",function(){return this._header}),res.setHeader=function(e,t){var r,s=e.toLowerCase();return this._headers&&"set-cookie"==s?(r=this.getHeader(e))&&(t=Array.isArray(r)?r.concat(t):[r,t]):"content-type"==s&&this.charset&&(t+="; charset="+this.charset),setHeader.call(this,e,t)},res._renderHeaders=function(){return this._emittedHeader||this.emit("header"),this._emittedHeader=!0,_renderHeaders.call(this)},res.writeHead=function(){return this._emittedHeader||this.emit("header"),this._emittedHeader=!0,writeHead.apply(this,arguments)},res._hasConnectPatch=!0);