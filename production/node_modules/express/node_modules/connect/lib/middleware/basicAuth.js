/*!
 * Connect - basicAuth
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */

var utils=null,unauthorized=utils.unauthorized;module.exports=function(r,e){var u,t;if("string"==typeof r){if(u=r,t=e,"string"!=typeof t)throw Error("password argument required");e=arguments[2],r=function(r,e){return r==u&&e==t}}return e=e||"Authorization Required",function(u,t,i){var n,o,s,a,d,l,f,h=u.headers.authorization;return u.user?i():h?(n=h.split(" "),2!==n.length?i(utils.error(400)):(o=n[0],s=""+new Buffer(n[1],"base64"),a=s.indexOf(":"),"Basic"!=o||0>a?i(utils.error(400)):(d=s.slice(0,a),l=s.slice(a+1),r.length>=3?(f=utils.pause(u),r(d,l,function(r,n){return r||!n?unauthorized(t,e):(u.user=u.remoteUser=n,i(),f.resume(),void 0)})):r(d,l)?(u.user=u.remoteUser=d,i()):unauthorized(t,e),void 0))):unauthorized(t,e)}};