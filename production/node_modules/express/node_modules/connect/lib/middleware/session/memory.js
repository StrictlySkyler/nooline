/*!
 * Connect - session - MemoryStore
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */

var Store=null,MemoryStore=module.exports=function(){this.sessions={}};MemoryStore.prototype.__proto__=Store.prototype,MemoryStore.prototype.get=function(e,o){var t=this;process.nextTick(function(){var s,r=t.sessions[e];r?(r=JSON.parse(r),s="string"==typeof r.cookie.expires?new Date(r.cookie.expires):r.cookie.expires,!s||new Date<s?o(null,r):t.destroy(e,o)):o()})},MemoryStore.prototype.set=function(e,o,t){var s=this;process.nextTick(function(){s.sessions[e]=JSON.stringify(o),t&&t()})},MemoryStore.prototype.destroy=function(e,o){var t=this;process.nextTick(function(){delete t.sessions[e],o&&o()})},MemoryStore.prototype.all=function(e){var o,t,s=[],r=Object.keys(this.sessions);for(o=0,t=r.length;t>o;++o)s.push(this.sessions[r[o]]);e(null,s)},MemoryStore.prototype.clear=function(e){this.sessions={},e&&e()},MemoryStore.prototype.length=function(e){e(null,Object.keys(this.sessions).length)};