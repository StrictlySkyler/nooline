/*!
 * Connect - static
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */

var send=null,utils=null,parse=utils.parseUrl,url=null;exports=module.exports=function(e,r){if(r=r||{},!e)throw Error("static() root path required");var t=!1!==r.redirect;return function(n,i,o){function a(){o(),l.resume()}function u(){var e,r;return t?(e=url.parse(n.originalUrl),e.pathname+="/",r=url.format(e),i.statusCode=303,i.setHeader("Location",r),i.end("Redirecting to "+utils.escape(r)),void 0):a()}function d(e){return 404==e.status?a():(o(e),void 0)}var s,l;return"GET"!=n.method&&"HEAD"!=n.method?o():(s=parse(n).pathname,l=utils.pause(n),send(n,s).maxage(r.maxAge||0).root(e).index(r.index||"index.html").hidden(r.hidden).on("error",d).on("directory",u).pipe(i),void 0)}},exports.mime=send.mime;