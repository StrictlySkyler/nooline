/*!
 * Connect - limit
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */

var utils=null,brokenPause=utils.brokenPause;module.exports=function(e){if("string"==typeof e&&(e=utils.parseBytes(e)),"number"!=typeof e)throw Error("limit() bytes required");return console.warn("connect.limit() will be removed in connect 3.0"),function(n,t,r){function i(){n.on("data",function(t){o+=Buffer.isBuffer(t)?t.length:Buffer.byteLength(t),o>e&&n.destroy()})}var o=0,s=n.headers["content-length"]?parseInt(n.headers["content-length"],10):null;return n._limit?r():(n._limit=!0,s&&s>e?r(utils.error(413)):(brokenPause?i():n.on("newListener",function u(e){"data"===e&&(n.removeListener("newListener",u),process.nextTick(i))}),r(),void 0))}};