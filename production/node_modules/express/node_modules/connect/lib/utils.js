/*!
 * Connect - utils
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 */

function noop(){}var http=null,crypto=null,parse=null.parse,sep=null.sep,signature=null,nodeVersion=process.versions.node.split(".");exports.brokenPause=0===parseInt(nodeVersion[0],10)&&parseInt(nodeVersion[1],10)<10,exports.hasBody=function(e){var n="transfer-encoding"in e.headers,r="content-length"in e.headers&&"0"!==e.headers["content-length"];return n||r},exports.mime=function(e){var n=e.headers["content-type"]||"";return n.split(";")[0]},exports.error=function(e,n){var r=Error(n||http.STATUS_CODES[e]);return r.status=e,r},exports.md5=function(e,n){return crypto.createHash("md5").update(e,"utf8").digest(n||"hex")},exports.merge=function(e,n){if(e&&n)for(var r in n)e[r]=n[r];return e},exports.escape=function(e){return(e+"").replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},exports.sign=function(e,n){return console.warn("do not use utils.sign(), use https://github.com/visionmedia/node-cookie-signature"),e+"."+crypto.createHmac("sha256",n).update(e).digest("base64").replace(/=+$/,"")},exports.unsign=function(e,n){console.warn("do not use utils.unsign(), use https://github.com/visionmedia/node-cookie-signature");var r=e.slice(0,e.lastIndexOf("."));return exports.sign(r,n)==e?r:!1},exports.parseSignedCookies=function(e,n){var r={};return Object.keys(e).forEach(function(t){var o=e[t];0==o.indexOf("s:")&&(o=signature.unsign(o.slice(2),n),o&&(r[t]=o,delete e[t]))}),r},exports.parseSignedCookie=function(e,n){return 0==e.indexOf("s:")?signature.unsign(e.slice(2),n):e},exports.parseJSONCookies=function(e){return Object.keys(e).forEach(function(n){var r=e[n],t=exports.parseJSONCookie(r);t&&(e[n]=t)}),e},exports.parseJSONCookie=function(e){if(0==e.indexOf("j:"))try{return JSON.parse(e.slice(2))}catch(n){}},exports.pause=exports.brokenPause?null:function(){return{end:noop,resume:noop}},exports.removeContentHeaders=function(e){Object.keys(e._headers).forEach(function(n){0==n.indexOf("content")&&e.removeHeader(n)})},exports.conditionalGET=function(e){return e.headers["if-modified-since"]||e.headers["if-none-match"]},exports.unauthorized=function(e,n){e.statusCode=401,e.setHeader("WWW-Authenticate",'Basic realm="'+n+'"'),e.end("Unauthorized")},exports.notModified=function(e){exports.removeContentHeaders(e),e.statusCode=304,e.end()},exports.etag=function(e){return'"'+e.size+"-"+Number(e.mtime)+'"'},exports.parseCacheControl=function(e){var n,r,t,o,s,i=e.split(","),a={};for(n=0,r=i.length;r>n;n++)t=i[n].split("="),o=t.shift().trim(),s=parseInt(t.shift(),10),a[o]=isNaN(s)?!0:s;return a},exports.parseUrl=function(e){var n=e._parsedUrl;return n&&n.href==e.url?n:e._parsedUrl=parse(e.url)},exports.parseBytes=null,exports.normalizeSlashes=function(e){return e.split(sep).join("/")};