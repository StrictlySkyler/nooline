// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

function test(a,n){count++,tests.push([a,n])}function run(){var a,n,e=tests.shift();return e?(a=e[0],n=e[1],console.log("# %s",a),n({same:assert.deepEqual,equal:assert.equal,end:function(){count--,run()}}),void 0):console.error("ok")}function TestReader(a,n){R.call(this,n),this.pos=0,this.len=a||100}var common=null,assert=null,R=null,util=null,tests=[],count=0;process.on("exit",function(){assert.equal(count,0)}),process.nextTick(run),util.inherits(TestReader,R),TestReader.prototype._read=function(a){setTimeout(function(){if(this.pos>=this.len)return this.push(null),this.push(null);if(a=Math.min(a,this.len-this.pos),0>=a)return this.push(null),this.push(null);this.pos+=a;var n=new Buffer(a);return n.fill("a"),console.log("this.push(ret)",n),this.push(n)}.bind(this),1)},test("setEncoding utf8",function(a){var n,e,t=new TestReader(100);t.setEncoding("utf8"),n=[],e=["aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa"],t.on("readable",function(){for(var a;null!==(a=t.read(10));)n.push(a)}),t.on("end",function(){a.same(n,e),a.end()})}),test("setEncoding hex",function(a){var n,e,t=new TestReader(100);t.setEncoding("hex"),n=[],e=["6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161"],t.on("readable",function(){for(var a;null!==(a=t.read(10));)n.push(a)}),t.on("end",function(){a.same(n,e),a.end()})}),test("setEncoding hex with read(13)",function(a){var n,e,t=new TestReader(100);t.setEncoding("hex"),n=[],e=["6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","16161"],t.on("readable",function(){console.log("readable once");for(var a;null!==(a=t.read(13));)n.push(a)}),t.on("end",function(){console.log("END"),a.same(n,e),a.end()})}),test("setEncoding base64",function(a){var n,e,t=new TestReader(100);t.setEncoding("base64"),n=[],e=["YWFhYWFhYW","FhYWFhYWFh","YWFhYWFhYW","FhYWFhYWFh","YWFhYWFhYW","FhYWFhYWFh","YWFhYWFhYW","FhYWFhYWFh","YWFhYWFhYW","FhYWFhYWFh","YWFhYWFhYW","FhYWFhYWFh","YWFhYWFhYW","FhYQ=="],t.on("readable",function(){for(var a;null!==(a=t.read(10));)n.push(a)}),t.on("end",function(){a.same(n,e),a.end()})}),test("encoding: utf8",function(a){var n=new TestReader(100,{encoding:"utf8"}),e=[],t=["aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa","aaaaaaaaaa"];n.on("readable",function(){for(var a;null!==(a=n.read(10));)e.push(a)}),n.on("end",function(){a.same(e,t),a.end()})}),test("encoding: hex",function(a){var n=new TestReader(100,{encoding:"hex"}),e=[],t=["6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161","6161616161"];n.on("readable",function(){for(var a;null!==(a=n.read(10));)e.push(a)}),n.on("end",function(){a.same(e,t),a.end()})}),test("encoding: hex with read(13)",function(a){var n=new TestReader(100,{encoding:"hex"}),e=[],t=["6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","1616161616161","6161616161616","16161"];n.on("readable",function(){for(var a;null!==(a=n.read(13));)e.push(a)}),n.on("end",function(){a.same(e,t),a.end()})}),test("encoding: base64",function(a){var n=new TestReader(100,{encoding:"base64"}),e=[],t=["YWFhYWFhYW","FhYWFhYWFh","YWFhYWFhYW","FhYWFhYWFh","YWFhYWFhYW","FhYWFhYWFh","YWFhYWFhYW","FhYWFhYWFh","YWFhYWFhYW","FhYWFhYWFh","YWFhYWFhYW","FhYWFhYWFh","YWFhYWFhYW","FhYQ=="];n.on("readable",function(){for(var a;null!==(a=n.read(10));)e.push(a)}),n.on("end",function(){a.same(e,t),a.end()})});