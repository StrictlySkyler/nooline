// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

function run(){var e=queue.pop();e?test(e[0],e[1],e[2],run):console.log("ok")}function test(e,n,u,c){function o(){var e,n;return i++,e=i,n=!1,function(u){if(u)throw u;n=!0,r++,assert.equal(r,e)}}var r,i,t,d,f;console.log("# decode=%j uncork=%j multi=%j",e,n,u),r=0,i=0,t=new stream.Writable({decodeStrings:e}),t._write=function(){assert(!1,"Should not call _write")},d=e?[{encoding:"buffer",chunk:[104,101,108,108,111,44,32]},{encoding:"buffer",chunk:[119,111,114,108,100]},{encoding:"buffer",chunk:[33]},{encoding:"buffer",chunk:[10,97,110,100,32,116,104,101,110,46,46,46]},{encoding:"buffer",chunk:[250,206,190,167,222,173,190,239,222,202,251,173]}]:[{encoding:"ascii",chunk:"hello, "},{encoding:"utf8",chunk:"world"},{encoding:"buffer",chunk:[33]},{encoding:"binary",chunk:"\nand then..."},{encoding:"hex",chunk:"facebea7deadbeefdecafbad"}],t._writev=function(e,n){f=e.map(function(e){return{encoding:e.encoding,chunk:Buffer.isBuffer(e.chunk)?Array.prototype.slice.call(e.chunk):e.chunk}}),n()},t.cork(),t.write("hello, ","ascii",o("hello")),t.write("world","utf8",o("world")),u&&t.cork(),t.write(new Buffer("!"),"buffer",o("!")),t.write("\nand then...","binary",o("and then")),u&&t.uncork(),t.write("facebea7deadbeefdecafbad","hex",o("hex")),n&&t.uncork(),t.end(o("end")),t.on("finish",function(){o("finish")(),assert.deepEqual(d,f),c()})}var decode,uncork,multi,common=null,assert=null,stream=null,queue=[];for(decode=0;2>decode;decode++)for(uncork=0;2>uncork;uncork++)for(multi=0;2>multi;multi++)queue.push([!!decode,!!uncork,!!multi]);run();