// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

function rethrow(){if(DEBUG){var t=Error();return function(n){if(n)throw t.message=n.message,n=t}}return function(t){if(t)throw t}}function maybeCallback(t){return"function"==typeof t?t:rethrow()}function makeCallback(t){return"function"!=typeof t?rethrow():function(){return t.apply(null,arguments)}}function assertEncoding(t){if(t&&!Buffer.isEncoding(t))throw Error("Unknown encoding: "+t)}function nullCheck(t,n){if(-1!==(""+t).indexOf("\x00")){var e=Error("Path must be a string without null bytes.");if(!n)throw e;return process.nextTick(function(){n(e)}),!1}return!0}function stringToFlags(t){if("string"!=typeof t)return t;if(!O_EXCL&&~t.indexOf("x"))throw errnoException("ENOSYS","fs.open(O_EXCL)");switch(t){case"r":return O_RDONLY;case"rs":return O_RDONLY|O_SYNC;case"r+":return O_RDWR;case"rs+":return O_RDWR|O_SYNC;case"w":return O_TRUNC|O_CREAT|O_WRONLY;case"wx":case"xw":return O_TRUNC|O_CREAT|O_WRONLY|O_EXCL;case"w+":return O_TRUNC|O_CREAT|O_RDWR;case"wx+":case"xw+":return O_TRUNC|O_CREAT|O_RDWR|O_EXCL;case"a":return O_APPEND|O_CREAT|O_WRONLY;case"ax":case"xa":return O_APPEND|O_CREAT|O_WRONLY|O_EXCL;case"a+":return O_APPEND|O_CREAT|O_RDWR;case"ax+":case"xa+":return O_APPEND|O_CREAT|O_RDWR|O_EXCL}throw Error("Unknown file open flag: "+t)}function modeNum(t,n){switch(typeof t){case"number":return t;case"string":return parseInt(t,8);default:return n?modeNum(n):void 0}}function preprocessSymlinkDestination(t,n){return isWindows?"junction"===n?pathModule._makeLong(t):(""+t).replace(/\//g,"\\"):t}function toUnixTimestamp(t){if("number"==typeof t)return t;if(t instanceof Date)return t.getTime()/1e3;throw Error("Cannot parse time: "+t)}function writeAll(t,n,e,r,i,o){o=maybeCallback(arguments[arguments.length-1]),fs.write(t,n,e,r,i,function(s,a){s?fs.close(t,function(){o&&o(s)}):a===r?fs.close(t,o):(e+=a,r-=a,i+=a,writeAll(t,n,e,r,i,o))})}function errnoException(t,n){var e=Error(n+" "+t);return e.errno=e.code=t,e.syscall=n,e}function FSWatcher(){var t,n;EventEmitter.call(this),t=this,n=process.binding("fs_event_wrap").FSEvent,this._handle=new n,this._handle.owner=this,this._handle.onchange=function(n,e,r){n?(t._handle.close(),t.emit("error",errnoException(errno,"watch"))):t.emit("change",e,r)}}function StatWatcher(){var t,n;EventEmitter.call(this),t=this,this._handle=new binding.StatWatcher,n=-1,this._handle.onchange=function(e,r,i){(-1!==n||-1!==i||e.nlink!==r.nlink)&&(n=i,t.emit("change",e,r))},this._handle.onstop=function(){t.emit("stop")}}function inStatWatchers(t){return Object.prototype.hasOwnProperty.call(statWatchers,t)&&statWatchers[t]}function allocNewPool(){pool=new Buffer(kPoolSize),pool.used=0}function ReadStream(t,n){if(!(this instanceof ReadStream))return new ReadStream(t,n);if(n=util._extend({bufferSize:65536,lowWaterMark:16384,highWaterMark:65536},n||{}),Readable.call(this,n),this.path=t,this.fd=n.hasOwnProperty("fd")?n.fd:null,this.flags=n.hasOwnProperty("flags")?n.flags:"r",this.mode=n.hasOwnProperty("mode")?n.mode:438,this.start=n.hasOwnProperty("start")?n.start:void 0,this.end=n.hasOwnProperty("start")?n.end:void 0,this.pos=void 0,void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(void 0===this.end)this.end=1/0;else if("number"!=typeof this.end)throw TypeError("end must be a Number");if(this.start>this.end)throw Error("start must be <= end");this.pos=this.start}"number"!=typeof this.fd&&this.open(),this.on("end",function(){this.destroy()})}function WriteStream(t,n){if(!(this instanceof WriteStream))return new WriteStream(t,n);if(n=util._extend({bufferSize:65536,lowWaterMark:16384,highWaterMark:65536},n||{}),Writable.call(this,n),this.path=t,this.fd=null,this.fd=n.hasOwnProperty("fd")?n.fd:null,this.flags=n.hasOwnProperty("flags")?n.flags:"w",this.mode=n.hasOwnProperty("mode")?n.mode:438,this.start=n.hasOwnProperty("start")?n.start:void 0,this.pos=void 0,this.bytesWritten=0,void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(this.start<0)throw Error("start must be >= zero");this.pos=this.start}"number"!=typeof this.fd&&this.open(),this.once("finish",this.close)}function SyncWriteStream(t){Stream.call(this),this.fd=t,this.writable=!0,this.readable=!1}var statWatchers,normalize,nextPartRe,splitRootRe,pool,util=null,pathModule=null,binding=process.binding("fs"),constants=process.binding("constants"),fs=exports,Stream=null.Stream,EventEmitter=null.EventEmitter,Readable=null,Writable=null,kMinPoolSpace=128,kPoolSize=40960,O_APPEND=constants.O_APPEND||0,O_CREAT=constants.O_CREAT||0,O_DIRECTORY=constants.O_DIRECTORY||0,O_EXCL=constants.O_EXCL||0,O_NOCTTY=constants.O_NOCTTY||0,O_NOFOLLOW=constants.O_NOFOLLOW||0,O_RDONLY=constants.O_RDONLY||0,O_RDWR=constants.O_RDWR||0,O_SYMLINK=constants.O_SYMLINK||0,O_SYNC=constants.O_SYNC||0,O_TRUNC=constants.O_TRUNC||0,O_WRONLY=constants.O_WRONLY||0,isWindows="win32"===process.platform,DEBUG=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);fs.Stats=binding.Stats,fs.Stats.prototype._checkModeProperty=function(t){return(this.mode&constants.S_IFMT)===t},fs.Stats.prototype.isDirectory=function(){return this._checkModeProperty(constants.S_IFDIR)},fs.Stats.prototype.isFile=function(){return this._checkModeProperty(constants.S_IFREG)},fs.Stats.prototype.isBlockDevice=function(){return this._checkModeProperty(constants.S_IFBLK)},fs.Stats.prototype.isCharacterDevice=function(){return this._checkModeProperty(constants.S_IFCHR)},fs.Stats.prototype.isSymbolicLink=function(){return this._checkModeProperty(constants.S_IFLNK)},fs.Stats.prototype.isFIFO=function(){return this._checkModeProperty(constants.S_IFIFO)},fs.Stats.prototype.isSocket=function(){return this._checkModeProperty(constants.S_IFSOCK)},fs.exists=function(t,n){function e(t){n&&n(t?!1:!0)}nullCheck(t,e)&&binding.stat(pathModule._makeLong(t),e)},fs.existsSync=function(t){try{return nullCheck(t),binding.stat(pathModule._makeLong(t)),!0}catch(n){return!1}},fs.readFile=function(t,n){function e(){0===o?(s=new Buffer(8192),fs.read(f,s,0,8192,-1,r)):fs.read(f,s,c,o-c,-1,r)}function r(t,n){return t?fs.close(f,function(){return l(t)}):0===n?i():(c+=n,0!==o?c===o?i():e():(a.push(s.slice(0,n)),e()),void 0)}function i(){fs.close(f,function(t){return 0===o?s=Buffer.concat(a,c):o>c&&(s=s.slice(0,c)),u&&(s=s.toString(u)),l(t,s)})}var o,s,a,c,f,u="string"==typeof n?n:null,l=maybeCallback(arguments[arguments.length-1]);assertEncoding(u),c=0,fs.open(t,constants.O_RDONLY,438,function(t,n){return t?l(t):(f=n,fs.fstat(f,function(t,n){return t?l(t):(o=n.size,0===o?(a=[],e()):(s=new Buffer(o),e(),void 0))}),void 0)})},fs.readFileSync=function(t,n){var e,r,i,o,s,a,c,f;assertEncoding(n),e=fs.openSync(t,constants.O_RDONLY,438),i=!0;try{r=fs.fstatSync(e).size,i=!1}finally{i&&fs.closeSync(e)}for(o=0,0===r?a=[]:s=new Buffer(r),c=!1;!c;){i=!0;try{0!==r?f=fs.readSync(e,s,o,r-o):(s=new Buffer(8192),f=fs.readSync(e,s,0,8192),f&&a.push(s.slice(0,f))),i=!1}finally{i&&fs.closeSync(e)}o+=f,c=0===f||0!==r&&o>=r}return fs.closeSync(e),0===r?s=Buffer.concat(a,o):r>o&&(s=s.slice(0,o)),n&&(s=s.toString(n)),s},Object.defineProperty(exports,"_stringToFlags",{enumerable:!1,value:stringToFlags}),fs.close=function(t,n){binding.close(t,makeCallback(n))},fs.closeSync=function(t){return binding.close(t)},fs.open=function(t,n,e,r){r=makeCallback(arguments[arguments.length-1]),e=modeNum(e,438),nullCheck(t,r)&&binding.open(pathModule._makeLong(t),stringToFlags(n),e,r)},fs.openSync=function(t,n,e){return e=modeNum(e,438),nullCheck(t),binding.open(pathModule._makeLong(t),stringToFlags(n),e)},fs.read=function(t,n,e,r,i,o){function s(t,e){o&&o(t,e||0,n)}if(!Buffer.isBuffer(n)){var a=arguments[4],c=arguments[3];assertEncoding(c),i=arguments[2],r=arguments[1],n=new Buffer(r),e=0,o=function(t,e){if(a){var r=e>0?n.toString(c,0,e):"";a(t,r,e)}}}binding.read(t,n,e,r,i,s)},fs.readSync=function(t,n,e,r,i){var o,s,a,c=!1;return Buffer.isBuffer(n)||(c=!0,o=arguments[3],assertEncoding(o),i=arguments[2],r=arguments[1],n=new Buffer(r),e=0),s=binding.read(t,n,e,r,i),c?(a=s>0?n.toString(o,0,s):"",[a,s]):s},fs.write=function(t,n,e,r,i,o){function s(t,e){o(t,e||0,n)}return Buffer.isBuffer(n)||(o=arguments[4],i=arguments[2],assertEncoding(arguments[3]),n=new Buffer(""+arguments[1],arguments[3]),e=0,r=n.length),r?(o=maybeCallback(o),binding.write(t,n,e,r,i,s),void 0):("function"==typeof o&&process.nextTick(function(){o(void 0,0)}),void 0)},fs.writeSync=function(t,n,e,r,i){return Buffer.isBuffer(n)||(i=arguments[2],assertEncoding(arguments[3]),n=new Buffer(""+arguments[1],arguments[3]),e=0,r=n.length),r?binding.write(t,n,e,r,i):0},fs.rename=function(t,n,e){e=makeCallback(e),nullCheck(t,e)&&nullCheck(n,e)&&binding.rename(pathModule._makeLong(t),pathModule._makeLong(n),e)},fs.renameSync=function(t,n){return nullCheck(t),nullCheck(n),binding.rename(pathModule._makeLong(t),pathModule._makeLong(n))},fs.truncate=function(t,n,e){return"number"==typeof t?fs.ftruncate(t,n,e):("function"==typeof n?(e=n,n=0):void 0===n&&(n=0),e=maybeCallback(e),fs.open(t,"w",function(t,r){return t?e(t):(binding.ftruncate(r,n,function(t){fs.close(r,function(n){e(t||n)})}),void 0)}),void 0)},fs.truncateSync=function(t,n){var e,r;if("number"==typeof t)return fs.ftruncateSync(t,n);void 0===n&&(n=0),e=fs.openSync(t,"w");try{r=fs.ftruncateSync(e,n)}finally{fs.closeSync(e)}return r},fs.ftruncate=function(t,n,e){"function"==typeof n?(e=n,n=0):void 0===n&&(n=0),binding.ftruncate(t,n,makeCallback(e))},fs.ftruncateSync=function(t,n){return void 0===n&&(n=0),binding.ftruncate(t,n)},fs.rmdir=function(t,n){n=makeCallback(n),nullCheck(t,n)&&binding.rmdir(pathModule._makeLong(t),n)},fs.rmdirSync=function(t){return nullCheck(t),binding.rmdir(pathModule._makeLong(t))},fs.fdatasync=function(t,n){binding.fdatasync(t,makeCallback(n))},fs.fdatasyncSync=function(t){return binding.fdatasync(t)},fs.fsync=function(t,n){binding.fsync(t,makeCallback(n))},fs.fsyncSync=function(t){return binding.fsync(t)},fs.mkdir=function(t,n,e){"function"==typeof n&&(e=n),e=makeCallback(e),nullCheck(t,e)&&binding.mkdir(pathModule._makeLong(t),modeNum(n,511),e)},fs.mkdirSync=function(t,n){return nullCheck(t),binding.mkdir(pathModule._makeLong(t),modeNum(n,511))},fs.sendfile=function(t,n,e,r,i){binding.sendfile(t,n,e,r,makeCallback(i))},fs.sendfileSync=function(t,n,e,r){return binding.sendfile(t,n,e,r)},fs.readdir=function(t,n){n=makeCallback(n),nullCheck(t,n)&&binding.readdir(pathModule._makeLong(t),n)},fs.readdirSync=function(t){return nullCheck(t),binding.readdir(pathModule._makeLong(t))},fs.fstat=function(t,n){binding.fstat(t,makeCallback(n))},fs.lstat=function(t,n){n=makeCallback(n),nullCheck(t,n)&&binding.lstat(pathModule._makeLong(t),n)},fs.stat=function(t,n){n=makeCallback(n),nullCheck(t,n)&&binding.stat(pathModule._makeLong(t),n)},fs.fstatSync=function(t){return binding.fstat(t)},fs.lstatSync=function(t){return nullCheck(t),binding.lstat(pathModule._makeLong(t))},fs.statSync=function(t){return nullCheck(t),binding.stat(pathModule._makeLong(t))},fs.readlink=function(t,n){n=makeCallback(n),nullCheck(t,n)&&binding.readlink(pathModule._makeLong(t),n)},fs.readlinkSync=function(t){return nullCheck(t),binding.readlink(pathModule._makeLong(t))},fs.symlink=function(t,n,e,r){var i="string"==typeof e?e:null;r=makeCallback(arguments[arguments.length-1]),nullCheck(t,r)&&nullCheck(n,r)&&binding.symlink(preprocessSymlinkDestination(t,i),pathModule._makeLong(n),i,r)},fs.symlinkSync=function(t,n,e){return e="string"==typeof e?e:null,nullCheck(t),nullCheck(n),binding.symlink(preprocessSymlinkDestination(t,e),pathModule._makeLong(n),e)},fs.link=function(t,n,e){e=makeCallback(e),nullCheck(t,e)&&nullCheck(n,e)&&binding.link(pathModule._makeLong(t),pathModule._makeLong(n),e)},fs.linkSync=function(t,n){return nullCheck(t),nullCheck(n),binding.link(pathModule._makeLong(t),pathModule._makeLong(n))},fs.unlink=function(t,n){n=makeCallback(n),nullCheck(t,n)&&binding.unlink(pathModule._makeLong(t),n)},fs.unlinkSync=function(t){return nullCheck(t),binding.unlink(pathModule._makeLong(t))},fs.fchmod=function(t,n,e){binding.fchmod(t,modeNum(n),makeCallback(e))},fs.fchmodSync=function(t,n){return binding.fchmod(t,modeNum(n))},constants.hasOwnProperty("O_SYMLINK")&&(fs.lchmod=function(t,n,e){e=maybeCallback(e),fs.open(t,constants.O_WRONLY|constants.O_SYMLINK,function(t,r){return t?(e(t),void 0):(fs.fchmod(r,n,function(t){fs.close(r,function(n){e(t||n)})}),void 0)})},fs.lchmodSync=function(t,n){var e,r,i,o=fs.openSync(t,constants.O_WRONLY|constants.O_SYMLINK);try{i=fs.fchmodSync(o,n)}catch(s){e=s}try{fs.closeSync(o)}catch(s){r=s}if(e||r)throw e||r;return i}),fs.chmod=function(t,n,e){e=makeCallback(e),nullCheck(t,e)&&binding.chmod(pathModule._makeLong(t),modeNum(n),e)},fs.chmodSync=function(t,n){return nullCheck(t),binding.chmod(pathModule._makeLong(t),modeNum(n))},constants.hasOwnProperty("O_SYMLINK")&&(fs.lchown=function(t,n,e,r){r=maybeCallback(r),fs.open(t,constants.O_WRONLY|constants.O_SYMLINK,function(t,i){return t?(r(t),void 0):(fs.fchown(i,n,e,r),void 0)})},fs.lchownSync=function(t,n,e){var r=fs.openSync(t,constants.O_WRONLY|constants.O_SYMLINK);return fs.fchownSync(r,n,e)}),fs.fchown=function(t,n,e,r){binding.fchown(t,n,e,makeCallback(r))},fs.fchownSync=function(t,n,e){return binding.fchown(t,n,e)},fs.chown=function(t,n,e,r){r=makeCallback(r),nullCheck(t,r)&&binding.chown(pathModule._makeLong(t),n,e,r)},fs.chownSync=function(t,n,e){return nullCheck(t),binding.chown(pathModule._makeLong(t),n,e)},fs._toUnixTimestamp=toUnixTimestamp,fs.utimes=function(t,n,e,r){r=makeCallback(r),nullCheck(t,r)&&binding.utimes(pathModule._makeLong(t),toUnixTimestamp(n),toUnixTimestamp(e),r)},fs.utimesSync=function(t,n,e){nullCheck(t),n=toUnixTimestamp(n),e=toUnixTimestamp(e),binding.utimes(pathModule._makeLong(t),n,e)},fs.futimes=function(t,n,e,r){n=toUnixTimestamp(n),e=toUnixTimestamp(e),binding.futimes(t,n,e,makeCallback(r))},fs.futimesSync=function(t,n,e){n=toUnixTimestamp(n),e=toUnixTimestamp(e),binding.futimes(t,n,e)},fs.writeFile=function(t,n,e,r){var i="string"==typeof e?e:"utf8";assertEncoding(i),r=maybeCallback(arguments[arguments.length-1]),fs.open(t,"w",438,function(t,e){if(t)r&&r(t);else{var o=Buffer.isBuffer(n)?n:new Buffer(""+n,i);writeAll(e,o,0,o.length,0,r)}})},fs.writeFileSync=function(t,n,e){var r,i,o;assertEncoding(e),r=fs.openSync(t,"w"),Buffer.isBuffer(n)||(n=new Buffer(""+n,e||"utf8")),i=0,o=n.length;try{for(;o>i;)i+=fs.writeSync(r,n,i,o-i,i)}finally{fs.closeSync(r)}},fs.appendFile=function(t,n,e,r){var i="string"==typeof e?e:"utf8";assertEncoding(i),r=maybeCallback(arguments[arguments.length-1]),fs.open(t,"a",438,function(t,e){if(t)return r(t);var o=Buffer.isBuffer(n)?n:new Buffer(""+n,i);writeAll(e,o,0,o.length,null,r)})},fs.appendFileSync=function(t,n,e){var r,i,o,s;assertEncoding(e),r=fs.openSync(t,"a"),Buffer.isBuffer(n)||(n=new Buffer(""+n,e||"utf8")),i=0,o=null,s=n.length;try{for(;s>i;)i+=fs.writeSync(r,n,i,s-i,o),o+=i}finally{fs.closeSync(r)}},util.inherits(FSWatcher,EventEmitter),FSWatcher.prototype.start=function(t,n){nullCheck(t);var e=this._handle.start(pathModule._makeLong(t),n);if(e)throw this._handle.close(),errnoException(errno,"watch")},FSWatcher.prototype.close=function(){this._handle.close()},fs.watch=function(t){var n,e,r;return nullCheck(t),"object"==typeof arguments[1]?(e=arguments[1],r=arguments[2]):(e={},r=arguments[1]),void 0===e.persistent&&(e.persistent=!0),n=new FSWatcher,n.start(t,e.persistent),r&&n.addListener("change",r),n},util.inherits(StatWatcher,EventEmitter),StatWatcher.prototype.start=function(t,n,e){nullCheck(t),this._handle.start(pathModule._makeLong(t),n,e)},StatWatcher.prototype.stop=function(){this._handle.stop()},statWatchers={},fs.watchFile=function(t){var n,e,r;if(nullCheck(t),r={interval:5007,persistent:!0},"object"==typeof arguments[1]?(r=util._extend(r,arguments[1]),e=arguments[2]):e=arguments[1],!e)throw Error("watchFile requires a listener function");return inStatWatchers(t)?n=statWatchers[t]:(n=statWatchers[t]=new StatWatcher,n.start(t,r.persistent,r.interval)),n.addListener("change",e),n},fs.unwatchFile=function(t,n){if(nullCheck(t),inStatWatchers(t)){var e=statWatchers[t];"function"==typeof n?e.removeListener("change",n):e.removeAllListeners("change"),0===e.listeners("change").length&&(e.stop(),statWatchers[t]=void 0)}},normalize=pathModule.normalize,nextPartRe=isWindows?/(.*?)(?:[\/\\]+|$)/g:/(.*?)(?:[\/]+|$)/g,splitRootRe=isWindows?/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/:/^[\/]*/,fs.realpathSync=function(t,n){function e(){var n=splitRootRe.exec(t);s=n[0].length,a=n[0],c=n[0],f="",isWindows&&!o[c]&&(fs.lstatSync(c),o[c]=!0)}var r,i,o,s,a,c,f,u,l,h,d,p;if(t=pathModule.resolve(t),n&&Object.prototype.hasOwnProperty.call(n,t))return n[t];for(r=t,i={},o={},e();s<t.length;)if(nextPartRe.lastIndex=s,u=nextPartRe.exec(t),f=a,a+=u[0],c=f+u[1],s=nextPartRe.lastIndex,!(o[c]||n&&n[c]===c)){if(n&&Object.prototype.hasOwnProperty.call(n,c))l=n[c];else{if(h=fs.lstatSync(c),!h.isSymbolicLink()){o[c]=!0,n&&(n[c]=c);continue}d=null,isWindows||(p=h.dev.toString(32)+":"+h.ino.toString(32),i.hasOwnProperty(p)&&(d=i[p])),null===d&&(fs.statSync(c),d=fs.readlinkSync(c)),l=pathModule.resolve(f,d),n&&(n[c]=l),isWindows||(i[p]=d)}t=pathModule.resolve(l,t.slice(s)),e()}return n&&(n[r]=t),t},fs.realpath=function(t,n,e){function r(){var n=splitRootRe.exec(t);l=n[0].length,h=n[0],d=n[0],p="",isWindows&&!u[d]?fs.lstat(d,function(t){return t?e(t):(u[d]=!0,i(),void 0)}):process.nextTick(i)}function i(){if(l>=t.length)return n&&(n[c]=t),e(null,t);nextPartRe.lastIndex=l;var r=nextPartRe.exec(t);return p=h,h+=r[0],d=p+r[1],l=nextPartRe.lastIndex,u[d]||n&&n[d]===d?process.nextTick(i):n&&Object.prototype.hasOwnProperty.call(n,d)?a(n[d]):fs.lstat(d,o)}function o(t,r){if(t)return e(t);if(!r.isSymbolicLink())return u[d]=!0,n&&(n[d]=d),process.nextTick(i);if(!isWindows){var o=r.dev.toString(32)+":"+r.ino.toString(32);if(f.hasOwnProperty(o))return s(null,f[o],d)}fs.stat(d,function(t){return t?e(t):(fs.readlink(d,function(t,n){isWindows||(f[o]=n),s(t,n)}),void 0)})}function s(t,r,i){if(t)return e(t);var o=pathModule.resolve(p,r);n&&(n[i]=o),a(o)}function a(n){t=pathModule.resolve(n,t.slice(l)),r()}var c,f,u,l,h,d,p;return"function"!=typeof e&&(e=maybeCallback(n),n=null),t=pathModule.resolve(t),n&&Object.prototype.hasOwnProperty.call(n,t)?process.nextTick(e.bind(null,null,n[t])):(c=t,f={},u={},r(),void 0)},fs.createReadStream=function(t,n){return new ReadStream(t,n)},util.inherits(ReadStream,Readable),fs.ReadStream=ReadStream,fs.FileReadStream=fs.ReadStream,ReadStream.prototype.open=function(){var t=this;fs.open(this.path,this.flags,this.mode,function(n,e){return n?(t.destroy(),t.emit("error",n),void 0):(t.fd=e,t.emit("open",e),t.read(),void 0)})},ReadStream.prototype._read=function(t,n){function e(t,e){if(t)return s.destroy(),n(t);var i=null;e>0&&(i=r.slice(o,o+e)),n(null,i)}var r,i,o,s;if("number"!=typeof this.fd)return this.once("open",function(){this._read(t,n)});if(!this.destroyed){if((!pool||pool.length-pool.used<kMinPoolSpace)&&(pool=null,allocNewPool()),r=pool,i=Math.min(pool.length-pool.used,t),o=pool.used,void 0!==this.pos&&(i=Math.min(this.end-this.pos+1,i)),0>=i)return n();s=this,fs.read(this.fd,pool,pool.used,i,this.pos,e),void 0!==this.pos&&(this.pos+=i),pool.used+=i}},ReadStream.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,"number"==typeof this.fd&&this.close())},ReadStream.prototype.close=function(t){function n(){fs.close(e.fd,function(t){t?e.emit("error",t):e.emit("close")})}if(t&&this.once("close",t),this.closed||"number"!=typeof this.fd)return"number"!=typeof this.fd&&this.once("open",n),process.nextTick(this.emit.bind(this,"close"));this.closed=!0;var e=this;n()},fs.createWriteStream=function(t,n){return new WriteStream(t,n)},util.inherits(WriteStream,Writable),fs.WriteStream=WriteStream,fs.FileWriteStream=fs.WriteStream,WriteStream.prototype.open=function(){fs.open(this.path,this.flags,this.mode,function(t,n){return t?(this.destroy(),this.emit("error",t),void 0):(this.fd=n,this.emit("open",n),void 0)}.bind(this))},WriteStream.prototype._write=function(t,n){return Buffer.isBuffer(t)?"number"!=typeof this.fd?this.once("open",this._write.bind(this,t,n)):(fs.write(this.fd,t,0,t.length,this.pos,function(t,e){return t?(this.destroy(),n(t)):(this.bytesWritten+=e,n(),void 0)}.bind(this)),void 0!==this.pos&&(this.pos+=t.length),void 0):this.emit("error",Error("Invalid data"))},WriteStream.prototype.destroy=ReadStream.prototype.destroy,WriteStream.prototype.close=ReadStream.prototype.close,WriteStream.prototype.destroySoon=WriteStream.prototype.end,util.inherits(SyncWriteStream,Stream),fs.SyncWriteStream=SyncWriteStream,SyncWriteStream.prototype.write=function(t,n,e){var r,i;if(n)if("string"==typeof n)r=n,i=e;else{if("function"!=typeof n)throw Error("bad arg");i=n}return assertEncoding(r),"string"==typeof t&&(t=new Buffer(t,r)),fs.writeSync(this.fd,t,0,t.length),i&&process.nextTick(i),!0},SyncWriteStream.prototype.end=function(t,n,e){t&&this.write(t,n,e),this.destroy()},SyncWriteStream.prototype.destroy=function(){return fs.closeSync(this.fd),this.fd=null,this.emit("close"),!0},SyncWriteStream.prototype.destroySoon=SyncWriteStream.prototype.destroy;