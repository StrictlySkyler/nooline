var assert=null,multiparty=null,http=null,path=null,TMP_PATH=path.join(__dirname,"..","tmp"),server=http.createServer(function(n,e){var t=new multiparty.Form;t.uploadDir=TMP_PATH,t.on("close",function(){throw Error('Unexpected "close" event')}),t.on("end",function(){throw Error('Unexpected "end" event')}),t.on("error",function(n){e.writeHead(500),e.end(n.message)}),t.parse(n)});server.listen(0,function(){var n='--foo\r\nContent-Disposition: form-data; name="file1"; filename="file1"\r\nContent-Type: application/octet-stream\r\n\r\nThis is the first file\r\n--foo\r\nContent-Type: application/octet-stream\r\nContent-Disposition: form-data; name="file2"; filename="file2"\r\nContent-Transfer-Encoding: unknown\r\n\r\nThis is the second file\r\n--foo--\r\n',e=http.request({method:"POST",port:server.address().port,headers:{"Content-Length":n.length,"Content-Type":"multipart/form-data; boundary=foo"}});e.on("response",function(n){assert.equal(n.statusCode,500),n.on("data",function(){}),n.on("end",function(){server.close()})}),e.end(n)});