var client,assert=null,http=null,net=null,multiparty=null,attachmentCount=510,server=http.createServer(function(t,n){var e=new multiparty.Form({maxFields:1e4});e.parse(t,function(t){assert.strictEqual(t.code,"EMFILE"),n.end(),client.end(),server.close()})});server.listen(function(){var t,n,e,r;for(client=net.connect(server.address().port),t="------WebKitFormBoundaryvfUZhxgsZDO7FXLF\r\n",n=t+'Content-Disposition: form-data; name="upload"; filename="blah1.txt"\r\n'+"Content-Type: text/plain\r\n"+"\r\n"+"hi1\r\n"+"\r\n",e=n.length*attachmentCount+t.length,client.write("POST /upload HTTP/1.1\r\nContent-Length: "+e+"\r\n"+"Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryvfUZhxgsZDO7FXLF\r\n"+"\r\n"),r=0;attachmentCount>r;r+=1)client.write(n);client.write(t)});