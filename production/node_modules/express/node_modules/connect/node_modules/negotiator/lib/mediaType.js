function parseAccept(e){return e.split(",").map(function(e){return parseMediaType(e.trim())}).filter(function(e){return e&&e.q>0})}function parseMediaType(e){var r,t,n,i,p,u=e.match(/\s*(\S+)\/([^;\s]+)\s*(?:;(.*))?/);return u?(r=u[1],t=u[2],n=""+r+"/"+t,i={},p=1,u[3]&&(i=u[3].split(";").map(function(e){return e.trim().split("=")}).reduce(function(e,r){return e[r[0]]=r[1],e},i),null!=i.q&&(p=parseFloat(i.q),delete i.q)),{type:r,subtype:t,params:i,q:p,full:n}):null}function getMediaTypePriority(e,r){return(r.filter(function(r){return specify(e,r)}).sort(function(e,r){return e.q>r.q?-1:1})[0]||{q:0}).q}function specifies(e,r){return"*"===e||e===r}function specify(e,r){var t,n=parseMediaType(e);return r.params&&(t=Object.keys(r.params),t.some(function(e){return!specifies(r.params[e],n.params[e])}))?null:specifies(r.type,n.type)&&specifies(r.subtype,n.subtype)?r:void 0}function preferredMediaTypes(e,r){return e=parseAccept(e||""),r?r.map(function(r){return[r,getMediaTypePriority(r,e)]}).filter(function(e){return e[1]>0}).sort(function(e,r){return e[1]===r[1]?0:e[1]>r[1]?-1:1}).map(function(e){return e[0]}):e.sort(function(e,r){return e.q<r.q?1:-1}).map(function(e){return e.full})}module.exports=preferredMediaTypes,preferredMediaTypes.preferredMediaTypes=preferredMediaTypes;