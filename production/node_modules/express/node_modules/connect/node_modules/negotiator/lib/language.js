function parseAcceptLanguage(r){return r.split(",").map(function(r){return parseLanguage(r.trim())}).filter(function(r){return r&&r.q>0})}function parseLanguage(r){var e,n,t,u,f,a,i,g=r.match(/^\s*(\S+?)(?:-(\S+?))?\s*(?:;(.*))?$/);if(!g)return null;if(e=g[1],n=g[2],t=e,n&&(t+="-"+n),u=1,g[3])for(f=g[3].split(";"),a=0;a<f.length;a++)i=f[a].split("="),"q"===i[0]&&(u=parseFloat(i[1]));return{prefix:e,suffix:n,q:u,full:t}}function getLanguagePriority(r,e){var n=getClosestMatch(r,e);return n?n.q:0}function getClosestMatch(r,e){var n=parseLanguage(r),t=e.filter(function(r){return r.full===n.full});return t.length?t[0]:(t=e.filter(function(r){return r.prefix===n.prefix&&!r.suffix}),t.length?t[0]:(t=e.filter(function(r){return r.prefix===n.prefix}),t.length?t[0]:(t=e.filter(function(r){return"*"===r.prefix}),t[0])))}function preferredLanguages(r,e){if(r=parseAcceptLanguage(r||""),e){var n=e.map(function(e){return[e,getLanguagePriority(e,r)]}).filter(function(r){return r[1]>0}).sort(function(r,e){return r[1]===e[1]?0:r[1]>e[1]?-1:1}).map(function(r){return r[0]});return n}return r.sort(function(r,e){return r.q<e.q?1:-1}).map(function(r){return r.full})}module.exports=preferredLanguages,preferredLanguages.preferredLanguages=preferredLanguages;