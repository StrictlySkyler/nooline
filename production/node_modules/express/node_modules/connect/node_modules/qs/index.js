function createObject(){return Object.create?Object.create(null):{}}function promote(r,e){var t,n;if(0==r[e].length)return r[e]=createObject();t=createObject();for(n in r[e])hasOwnProperty.call(r[e],n)&&(t[n]=r[e][n]);return r[e]=t,t}function parse(r,e,t,n){var o,i=r.shift();i?(o=e[t]=e[t]||[],"]"==i?isArray(o)?""!=n&&o.push(n):"object"==typeof o?o[objectKeys(o).length]=n:o=e[t]=[e[t],n]:~indexOf(i,"]")?(i=i.substr(0,i.length-1),!isint.test(i)&&isArray(o)&&(o=promote(e,t)),parse(r,o,i,n)):(!isint.test(i)&&isArray(o)&&(o=promote(e,t)),parse(r,o,i,n))):isArray(e[t])?e[t].push(n):e[t]="object"==typeof e[t]?n:void 0===e[t]?n:[e[t],n]}function merge(r,e,t){var n,o,i;if(~indexOf(e,"]"))n=e.split("["),n.length,parse(n,r,"base",t);else{if(!isint.test(e)&&isArray(r.base)){o=createObject();for(i in r.base)o[i]=r.base[i];r.base=o}set(r.base,e,t)}return r}function compact(r){var e,t,n;if("object"!=typeof r)return r;if(isArray(r)){e=[];for(t in r)hasOwnProperty.call(r,t)&&e.push(r[t]);return e}for(n in r)r[n]=compact(r[n]);return r}function restoreProto(r){if(!Object.create)return r;if(isArray(r))return r;if(r&&"object"!=typeof r)return r;for(var e in r)hasOwnProperty.call(r,e)&&(r[e]=restoreProto(r[e]));return r.__proto__=Object.prototype,r}function parseObject(r){var e={base:{}};return forEach(objectKeys(r),function(t){merge(e,t,r[t])}),compact(e.base)}function parseString(r){var e=reduce((r+"").split("&"),function(r,e){var t=indexOf(e,"="),n=lastBraceInKey(e),o=e.substr(0,n||t),i=e.substr(n||t,e.length),i=i.substr(indexOf(i,"=")+1,i.length);return""==o&&(o=e,i=""),""==o?r:merge(r,decode(o),decode(i))},{base:createObject()}).base;return restoreProto(compact(e))}function stringifyString(r,e){if(!e)throw new TypeError("stringify expects an object");return e+"="+encodeURIComponent(r)}function stringifyArray(r,e){var t,n=[];if(!e)throw new TypeError("stringify expects an object");for(t=0;t<r.length;t++)n.push(stringify(r[t],e+"["+t+"]"));return n.join("&")}function stringifyObject(r,e){var t,n,o,i=[],c=objectKeys(r);for(n=0,o=c.length;o>n;++n)t=c[n],""!=t&&(null==r[t]?i.push(encodeURIComponent(t)+"="):i.push(stringify(r[t],e?e+"["+encodeURIComponent(t)+"]":encodeURIComponent(t))));return i.join("&")}function set(r,e,t){var n=r[e];void 0===n?r[e]=t:isArray(n)?n.push(t):r[e]=[n,t]}function lastBraceInKey(r){var e,t,n,o=r.length;for(n=0;o>n;++n)if(t=r[n],"]"==t&&(e=!1),"["==t&&(e=!0),"="==t&&!e)return n}function decode(r){try{return decodeURIComponent(r.replace(/\+/g," "))}catch(e){return r}}var stringify,toString=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty,indexOf="function"==typeof Array.prototype.indexOf?function(r,e){return r.indexOf(e)}:function(r,e){for(var t=0;t<r.length;t++)if(r[t]===e)return t;return-1},isArray=Array.isArray||function(r){return"[object Array]"==toString.call(r)},objectKeys=Object.keys||function(r){var e,t=[];for(e in r)t.push(e);return t},forEach="function"==typeof Array.prototype.forEach?function(r,e){return r.forEach(e)}:function(r,e){for(var t=0;t<r.length;t++)e(r[t])},reduce=function(r,e,t){var n,o;if("function"==typeof r.reduce)return r.reduce(e,t);for(n=t,o=0;o<r.length;o++)n=e(n,r[o]);return n},isint=/^[0-9]+$/;exports.parse=function(r){return null==r||""==r?{}:"object"==typeof r?parseObject(r):parseString(r)},stringify=exports.stringify=function(r,e){return isArray(r)?stringifyArray(r,e):"[object Object]"==toString.call(r)?stringifyObject(r,e):"string"==typeof r?stringifyString(r,e):e+"="+encodeURIComponent(r+"")};