function keypress(e){function a(s){e.listeners("keypress").length>0?emitKey(e,s):(e.removeListener("data",a),e.on("newListener",n))}function n(s){"keypress"==s&&(e.on("data",a),e.removeListener("newListener",n))}isEmittingKeypress(e)||(e._emitKeypress=!0,e.listeners("keypress").length>0?e.on("data",a):e.on("newListener",n))}function isEmittingKeypress(e){var a=e._emitKeypress;return a||e.listeners("data").forEach(function(n){"onData"==n.name&&/emitKey/.test(""+n)&&(a=!0,e._emitKeypress=!0)}),a||e.listeners("newListener").forEach(function(n){"onNewListener"==n.name&&/keypress/.test(""+n)&&(a=!0,e._emitKeypress=!0)}),a}function emitKey(e,a){var n,s,r,t,c,m={name:void 0,ctrl:!1,meta:!1,shift:!1};if(Buffer.isBuffer(a)&&(a[0]>127&&void 0===a[1]?(a[0]-=128,a=""+a.toString(e.encoding||"utf-8")):a=a.toString(e.encoding||"utf-8")),m.sequence=a,"\r"===a||"\n"===a)m.name="enter";else if("	"===a)m.name="tab";else if("\b"===a||""===a||""===a||"\b"===a)m.name="backspace",m.meta=""===a.charAt(0);else if(""===a||""===a)m.name="escape",m.meta=2===a.length;else if(" "===a||" "===a)m.name="space",m.meta=2===a.length;else if("">=a)m.name=String.fromCharCode(a.charCodeAt(0)+"a".charCodeAt(0)-1),m.ctrl=!0;else if(1===a.length&&a>="a"&&"z">=a)m.name=a;else if(1===a.length&&a>="A"&&"Z">=a)m.name=a.toLowerCase(),m.shift=!0;else if(s=metaKeyCodeRe.exec(a))m.name=s[1].toLowerCase(),m.meta=!0,m.shift=/^[A-Z]$/.test(s[1]);else if(s=functionKeyCodeRe.exec(a))switch(r=(s[1]||"")+(s[2]||"")+(s[4]||"")+(s[6]||""),t=(s[3]||s[5]||1)-1,m.ctrl=!!(4&t),m.meta=!!(10&t),m.shift=!!(1&t),m.code=r,r){case"OP":m.name="f1";break;case"OQ":m.name="f2";break;case"OR":m.name="f3";break;case"OS":m.name="f4";break;case"[11~":m.name="f1";break;case"[12~":m.name="f2";break;case"[13~":m.name="f3";break;case"[14~":m.name="f4";break;case"[[A":m.name="f1";break;case"[[B":m.name="f2";break;case"[[C":m.name="f3";break;case"[[D":m.name="f4";break;case"[[E":m.name="f5";break;case"[15~":m.name="f5";break;case"[17~":m.name="f6";break;case"[18~":m.name="f7";break;case"[19~":m.name="f8";break;case"[20~":m.name="f9";break;case"[21~":m.name="f10";break;case"[23~":m.name="f11";break;case"[24~":m.name="f12";break;case"[A":m.name="up";break;case"[B":m.name="down";break;case"[C":m.name="right";break;case"[D":m.name="left";break;case"[E":m.name="clear";break;case"[F":m.name="end";break;case"[H":m.name="home";break;case"OA":m.name="up";break;case"OB":m.name="down";break;case"OC":m.name="right";break;case"OD":m.name="left";break;case"OE":m.name="clear";break;case"OF":m.name="end";break;case"OH":m.name="home";break;case"[1~":m.name="home";break;case"[2~":m.name="insert";break;case"[3~":m.name="delete";break;case"[4~":m.name="end";break;case"[5~":m.name="pageup";break;case"[6~":m.name="pagedown";break;case"[[5~":m.name="pageup";break;case"[[6~":m.name="pagedown";break;case"[7~":m.name="home";break;case"[8~":m.name="end";break;case"[a":m.name="up",m.shift=!0;break;case"[b":m.name="down",m.shift=!0;break;case"[c":m.name="right",m.shift=!0;break;case"[d":m.name="left",m.shift=!0;break;case"[e":m.name="clear",m.shift=!0;break;case"[2$":m.name="insert",m.shift=!0;break;case"[3$":m.name="delete",m.shift=!0;break;case"[5$":m.name="pageup",m.shift=!0;break;case"[6$":m.name="pagedown",m.shift=!0;break;case"[7$":m.name="home",m.shift=!0;break;case"[8$":m.name="end",m.shift=!0;break;case"Oa":m.name="up",m.ctrl=!0;break;case"Ob":m.name="down",m.ctrl=!0;break;case"Oc":m.name="right",m.ctrl=!0;break;case"Od":m.name="left",m.ctrl=!0;break;case"Oe":m.name="clear",m.ctrl=!0;break;case"[2^":m.name="insert",m.ctrl=!0;break;case"[3^":m.name="delete",m.ctrl=!0;break;case"[5^":m.name="pageup",m.ctrl=!0;break;case"[6^":m.name="pagedown",m.ctrl=!0;break;case"[7^":m.name="home",m.ctrl=!0;break;case"[8^":m.name="end",m.ctrl=!0;break;case"[Z":m.name="tab",m.shift=!0;break;default:m.name="undefined"}else if(a.length>1&&""!==a[0])return Array.prototype.forEach.call(a,function(a){emitKey(e,a)}),void 0;"[M"==m.code&&(m.name="mouse",a=m.sequence,c=a.charCodeAt(3),m.x=a.charCodeAt(4)-32,m.y=a.charCodeAt(5)-32,m.scroll=0,m.ctrl=!!(16&c),m.meta=!!(8&c),m.shift=!!(4&c),m.release=3===(3&c),64&c&&(m.scroll=1&c?1:-1),m.release||m.scroll||(m.button=3&c)),void 0===m.name&&(m=void 0),1===a.length&&(n=a),m&&"mouse"==m.name?e.emit("mousepress",m):(m||n)&&e.emit("keypress",n,m)}var metaKeyCodeRe,functionKeyCodeRe,exports=module.exports=keypress;exports.enableMouse=function(e){e.write("[?1000h")},exports.disableMouse=function(e){e.write("[?1000l")},metaKeyCodeRe=/^(?:\x1b)([a-zA-Z0-9])$/,functionKeyCodeRe=/^(?:\x1b+)(O|N|\[|\[\[)(?:(\d+)(?:;(\d+))?([~^$])|(?:1;)?(\d+)?([a-zA-Z]))/;