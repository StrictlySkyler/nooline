var http=null,path=null,connect=null,utils=connect.utils,sign=null.sign,normalizeType=null.normalizeType,normalizeTypes=null.normalizeTypes,etag=null.etag,statusCodes=http.STATUS_CODES,cookie=null,send=null,mime=connect.mime,basename=path.basename,extname=path.extname,res=module.exports={__proto__:http.ServerResponse.prototype};res.status=function(t){return this.statusCode=t,this},res.links=function(t){var e=this.get("Link")||"";return e&&(e+=", "),this.set("Link",e+Object.keys(t).map(function(e){return"<"+t[e]+'>; rel="'+e+'"'}).join(", "))},res.send=function(t){var e,s=this.req,n="HEAD"==s.method,r=this.app;switch(2==arguments.length&&("number"!=typeof t&&"number"==typeof arguments[1]?this.statusCode=arguments[1]:(this.statusCode=t,t=arguments[1])),typeof t){case"number":this.get("Content-Type")||this.type("txt"),this.statusCode=t,t=http.STATUS_CODES[t];break;case"string":this.get("Content-Type")||(this.charset=this.charset||"utf-8",this.type("html"));break;case"boolean":case"object":if(null==t)t="";else{if(!Buffer.isBuffer(t))return this.json(t);this.get("Content-Type")||this.type("bin")}}return void 0===t||this.get("Content-Length")||this.set("Content-Length",e=Buffer.isBuffer(t)?t.length:Buffer.byteLength(t)),r.settings.etag&&e>1024&&"GET"==s.method&&(this.get("ETag")||this.set("ETag",etag(t))),s.fresh&&(this.statusCode=304),(204==this.statusCode||304==this.statusCode)&&(this.removeHeader("Content-Type"),this.removeHeader("Content-Length"),this.removeHeader("Transfer-Encoding"),t=""),this.end(n?null:t),this},res.json=function(t){var e,s,n,r;return 2==arguments.length&&("number"==typeof arguments[1]?this.statusCode=arguments[1]:(this.statusCode=t,t=arguments[1])),e=this.app,s=e.get("json replacer"),n=e.get("json spaces"),r=JSON.stringify(t,s,n),this.charset=this.charset||"utf-8",this.get("Content-Type")||this.set("Content-Type","application/json"),this.send(r)},res.jsonp=function(t){var e,s,n,r,i,o;return 2==arguments.length&&("number"==typeof arguments[1]?this.statusCode=arguments[1]:(this.statusCode=t,t=arguments[1])),e=this.app,s=e.get("json replacer"),n=e.get("json spaces"),r=JSON.stringify(t,s,n).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"),i=this.req.query[e.get("jsonp callback name")],this.charset=this.charset||"utf-8",this.set("Content-Type","application/json"),i&&(Array.isArray(i)&&(i=i[0]),this.set("Content-Type","text/javascript"),o=i.replace(/[^\[\]\w$.]/g,""),r="typeof "+o+" === 'function' && "+o+"("+r+");"),this.send(r)},res.sendfile=function(t,e,s){function n(t){return o?void 0:(o=!0,i(),h.headerSent||h.removeHeader("Content-Disposition"),s?s(t):(h.headerSent||c(t),void 0))}function r(t){o||(i(),s&&t.on("end",s))}function i(){u.socket.removeListener("error",n)}var o,a,h=this,u=h.req,c=this.req.next;e=e||{},"function"==typeof e&&(s=e,e={}),u.socket.on("error",n),a=send(u,t),e.root&&a.root(e.root),a.maxage(e.maxAge||0),a.on("error",n),a.on("directory",c),a.on("stream",r),a.pipe(this),this.on("finish",i)},res.download=function(t,e,s){return"function"==typeof e&&(s=e,e=null),e=e||t,this.set("Content-Disposition",'attachment; filename="'+basename(e)+'"'),this.sendfile(t,s)},res.contentType=res.type=function(t){return this.set("Content-Type",~t.indexOf("/")?t:mime.lookup(t))},res.format=function(t){var e,s,n,r,i,o=this.req,a=o.next,h=t.default;return h&&delete t.default,e=Object.keys(t),s=o.accepts(e),this.vary("Accept"),s?(n=normalizeType(s).value,r=mime.charsets.lookup(n),r&&(n+="; charset="+r),this.set("Content-Type",n),t[s](o,this,a)):h?h():(i=Error("Not Acceptable"),i.status=406,i.types=normalizeTypes(e).map(function(t){return t.value}),a(i)),this},res.attachment=function(t){return t&&this.type(extname(t)),this.set("Content-Disposition",t?'attachment; filename="'+basename(t)+'"':"attachment"),this},res.set=res.header=function(t,e){if(2==arguments.length)Array.isArray(e)?e=e.map(String):e+="",this.setHeader(t,e);else for(var s in t)this.set(s,t[s]);return this},res.get=function(t){return this.getHeader(t)},res.clearCookie=function(t,e){var s={expires:new Date(1),path:"/"};return this.cookie(t,"",e?utils.merge(s,e):s)},res.cookie=function(t,e,s){var n,r;if(s=utils.merge({},s),n=this.req.secret,r=s.signed,r&&!n)throw Error('connect.cookieParser("secret") required for signed cookies');return"number"==typeof e&&(e=""+e),"object"==typeof e&&(e="j:"+JSON.stringify(e)),r&&(e="s:"+sign(e,n)),"maxAge"in s&&(s.expires=new Date(Date.now()+s.maxAge),s.maxAge/=1e3),null==s.path&&(s.path="/"),this.set("Set-Cookie",cookie.serialize(t,e+"",s)),this},res.location=function(t){var e,s=this.app,n=this.req,r={back:n.get("Referrer")||"/"};return t=r[t]||t,~t.indexOf("://")||0==t.indexOf("//")||("."==t[0]?(e=n.originalUrl.split("?")[0],t=e+("/"==e[e.length-1]?"":"/")+t):"/"!=t[0]&&(e=s.path(),t=e+"/"+t)),this.set("Location",t),this},res.redirect=function(t){var e,s="HEAD"==this.req.method,n=302;2==arguments.length&&("number"==typeof t?(n=t,t=arguments[1]):n=arguments[1]),this.location(t),t=this.get("Location"),this.format({text:function(){e=statusCodes[n]+". Redirecting to "+encodeURI(t)},html:function(){var s=utils.escape(t);e="<p>"+statusCodes[n]+'. Redirecting to <a href="'+s+'">'+s+"</a></p>"},"default":function(){e=""}}),this.statusCode=n,this.set("Content-Length",Buffer.byteLength(e)),this.end(s?null:e)},res.vary=function(t){var e,s=this;return t?Array.isArray(t)?(t.forEach(function(t){s.vary(t)}),void 0):(e=this.get("Vary"))?(e=e.split(/ *, */),~e.indexOf(t)||e.push(t),this.set("Vary",e.join(", ")),this):(this.set("Vary",t),this):this},res.render=function(t,e,s){var n=this,e=e||{},r=this.req,i=r.app;"function"==typeof e&&(s=e,e={}),e._locals=n.locals,s=s||function(t,e){return t?r.next(t):(n.send(e),void 0)},i.render(t,e,s)};