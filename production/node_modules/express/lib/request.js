var http=null,utils=null,connect=null,fresh=null,parseRange=null,parse=connect.utils.parseUrl,mime=connect.mime,req=exports=module.exports={__proto__:http.IncomingMessage.prototype};req.get=req.header=function(e){switch(e=e.toLowerCase()){case"referer":case"referrer":return this.headers.referrer||this.headers.referer;default:return this.headers[e]}},req.accepts=function(e){var t=arguments.length>1?[].slice.apply(arguments):e;return utils.accepts(t,this.get("Accept"))},req.acceptsEncoding=function(e){return!!~this.acceptedEncodings.indexOf(e)},req.acceptsCharset=function(e){var t=this.acceptedCharsets;return t.length?!!~t.indexOf(e):!0},req.acceptsLanguage=function(e){var t=this.acceptedLanguages;return t.length?!!~t.indexOf(e):!0},req.range=function(e){var t=this.get("Range");if(t)return parseRange(e,t)},req.__defineGetter__("acceptedEncodings",function(){var e=this.get("Accept-Encoding");return e?e.trim().split(/ *, */):[]}),req.__defineGetter__("accepted",function(){var e=this.get("Accept");return e?utils.parseAccept(e):[]}),req.__defineGetter__("acceptedLanguages",function(){var e=this.get("Accept-Language");return e?utils.parseParams(e).map(function(e){return e.value}):[]}),req.__defineGetter__("acceptedCharsets",function(){var e=this.get("Accept-Charset");return e?utils.parseParams(e).map(function(e){return e.value}):[]}),req.param=function(e,t){var r=this.params||{},n=this.body||{},s=this.query||{};return null!=r[e]&&r.hasOwnProperty(e)?r[e]:null!=n[e]?n[e]:null!=s[e]?s[e]:t},req.is=function(e){var t=this.get("Content-Type");return t?(t=t.split(";")[0],~e.indexOf("/")||(e=mime.lookup(e)),~e.indexOf("*")?(e=e.split("/"),t=t.split("/"),"*"==e[0]&&e[1]==t[1]?!0:"*"==e[1]&&e[0]==t[0]?!0:!1):!!~t.indexOf(e)):!1},req.__defineGetter__("protocol",function(){var e,t=this.app.get("trust proxy");return this.connection.encrypted?"https":t?(e=this.get("X-Forwarded-Proto")||"http",e.split(/\s*,\s*/)[0]):"http"}),req.__defineGetter__("secure",function(){return"https"==this.protocol}),req.__defineGetter__("ip",function(){return this.ips[0]||this.connection.remoteAddress}),req.__defineGetter__("ips",function(){var e=this.app.get("trust proxy"),t=this.get("X-Forwarded-For");return e&&t?t.split(/ *, */):[]}),req.__defineGetter__("auth",function(){var e,t=this.get("Authorization");if(t&&(e=t.split(" "),"basic"==e[0].toLowerCase()&&e[1]&&(t=e[1],t=(""+new Buffer(t,"base64")).match(/^([^:]*):(.*)$/))))return{username:t[1],password:t[2]}}),req.__defineGetter__("subdomains",function(){var e=this.app.get("subdomain offset");return(this.host||"").split(".").reverse().slice(e)}),req.__defineGetter__("path",function(){return parse(this).pathname}),req.__defineGetter__("host",function(){var e=this.app.get("trust proxy"),t=e&&this.get("X-Forwarded-Host");return(t=t||this.get("Host"))?t.split(":")[0]:void 0}),req.__defineGetter__("fresh",function(){var e=this.method,t=this.res.statusCode;return"GET"!=e&&"HEAD"!=e?!1:t>=200&&300>t||304==t?fresh(this.headers,this.res._headers):!1}),req.__defineGetter__("stale",function(){return!this.fresh}),req.__defineGetter__("xhr",function(){var e=this.get("X-Requested-With")||"";return"xmlhttprequest"==e.toLowerCase()});