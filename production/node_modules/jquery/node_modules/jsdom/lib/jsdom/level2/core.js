var INVALID_STATE_ERR,SYNTAX_ERR,INVALID_MODIFICATION_ERR,NAMESPACE_ERR,INVALID_ACCESS_ERR,ns,prevSetNamedItem,core=require("../level1/core").dom.level1.core;core=Object.create(core),INVALID_STATE_ERR=core.INVALID_STATE_ERR=11,SYNTAX_ERR=core.SYNTAX_ERR=12,INVALID_MODIFICATION_ERR=core.INVALID_MODIFICATION_ERR=13,NAMESPACE_ERR=core.NAMESPACE_ERR=14,INVALID_ACCESS_ERR=core.INVALID_ACCESS_ERR=15,ns={validate:function(e,t){if(!e)throw new core.DOMException(core.INVALID_CHARACTER_ERR,"namespace is undefined");if(null!==e.match(/[^0-9a-z\.:\-_]/i))throw new core.DOMException(core.INVALID_CHARACTER_ERR,e);var o=!1,r=e.split(":");if("xmlns"===e&&"http://www.w3.org/2000/xmlns/"!==t?o="localName is 'xmlns' but the namespaceURI is invalid":"xml"===e&&"http://www.w3.org/XML/1998/namespace"!==t?o="localName is 'xml' but the namespaceURI is invalid":":"===e[e.length-1]?o="Namespace seperator found with no localName":":"===e[0]?o="Namespace seperator found, without a prefix":r.length>2&&(o="Too many namespace seperators"),o)throw new core.DOMException(NAMESPACE_ERR,o+" ("+e+"@"+t+")")}},core.exceptionMessages.NAMESPACE_ERR="Invalid namespace",core.DOMImplementation.prototype.createDocumentType=function(e,t,o){ns.validate(e);var r=new core.DocumentType(null,e);return r._publicId=t?t:"",r._systemId=o?o:"",r},core.DOMImplementation.prototype.createDocument=function(e,t,o){var r,n;if((t||e)&&ns.validate(t,e),o&&null!==o._ownerDocument)throw new core.DOMException(core.WRONG_DOCUMENT_ERR);if(t&&t.indexOf(":")>-1&&!e)throw new core.DOMException(NAMESPACE_ERR);return r=new core.Document,o?(r.doctype=o,o._ownerDocument=r,r.appendChild(o)):r.doctype=null,o&&!o.entities&&(o.entities=new dom.EntityNodeMap),r._ownerDocument=r,t&&(n=r.createElementNS(e,t),r.appendChild(n)),r},core.Node.prototype.__defineGetter__("ownerDocument",function(){return this._ownerDocument||null}),core.Node.prototype.isSupported=function(e,t){return this._ownerDocument.implementation.hasFeature(e,t)},core.Node.prototype._namespaceURI=null,core.Node.prototype.__defineGetter__("namespaceURI",function(){return this._namespaceURI||null}),core.Node.prototype.__defineSetter__("namespaceURI",function(e){this._namespaceURI=e}),core.Node.prototype.__defineGetter__("prefix",function(){return this._prefix||null}),core.Node.prototype.__defineSetter__("prefix",function(e){if(this.readonly)throw new core.DOMException(core.NO_MODIFICATION_ALLOWED_ERR);if(ns.validate(e,this._namespaceURI),this._created&&!this._namespaceURI||"xmlns"===this._prefix||!this._prefix&&this._created)throw new core.DOMException(core.NAMESPACE_ERR);this._localName&&(this._nodeName=e+":"+this._localName),this._prefix=e}),core.Node.prototype.__defineGetter__("localName",function(){return this._localName||null}),core.Node.prototype.hasAttributes=function(){return this.nodeType===this.ELEMENT_NODE&&this._attributes&&this._attributes.length>0},core.NamedNodeMap.prototype.getNamedItemNS=function(e,t){return this._nsStore[e]&&this._nsStore[e][t]?this._nsStore[e][t]:null},core.AttrNodeMap.prototype.setNamedItemNS=function(e){if(e.nodeType!==this._ownerDocument.ATTRIBUTE_NODE)throw new core.DOMException(core.HIERARCHY_REQUEST_ERR);return core.NamedNodeMap.prototype.setNamedItemNS.call(this,e)},prevSetNamedItem=core.AttrNodeMap.prototype.setNamedItem,core.AttrNodeMap.prototype.setNamedItem=function(e){if(e.nodeType!==this._ownerDocument.ATTRIBUTE_NODE)throw new core.DOMException(core.HIERARCHY_REQUEST_ERR);return prevSetNamedItem.call(this,e)},core.NamedNodeMap.prototype.setNamedItemNS=function(e){if(this._readonly)throw new core.DOMException(core.NO_MODIFICATION_ALLOWED_ERR);var t=this._ownerDocument;if(this._parentNode&&this._parentNode._parentNode&&this._parentNode._parentNode.nodeType===t.ENTITY_NODE)throw new core.DOMException(core.NO_MODIFICATION_ALLOWED_ERR);if(this._ownerDocument!==e.ownerDocument)throw new core.DOMException(core.WRONG_DOCUMENT_ERR);if(e._ownerElement)throw new core.DOMException(core.INUSE_ATTRIBUTE_ERR);if(this._readonly===!0)throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR);return this._nsStore[e.namespaceURI]||(this._nsStore[e.namespaceURI]={}),this._nsStore[e.namespaceURI][e.localName]&&this._nsStore[e.namespaceURI][e.localName],this._nsStore[e.namespaceURI][e.localName]=e,e._specified=!0,e._ownerDocument=this._ownerDocument,this.setNamedItem(e)},core.NamedNodeMap.prototype.removeNamedItemNS=function(e,t){if(this.readonly)throw new core.DOMException(core.NO_MODIFICATION_ALLOWED_ERR);var o,r,n,i,c=this._parentNode,a=null;if(this._parentNode&&this._parentNode._parentNode&&this._parentNode._parentNode.nodeType===this._ownerDocument.ENTITY_NODE)throw new core.DOMException(core.NO_MODIFICATION_ALLOWED_ERR);if(this._nsStore[e]&&this._nsStore[e][t]&&(a=this._nsStore[e][t],this.removeNamedItem(a.qualifiedName),delete this._nsStore[e][t]),!a)throw new core.DOMException(core.NOT_FOUND_ERR);return c.ownerDocument.doctype&&c.ownerDocument.doctype._attributes&&(o=c.ownerDocument.doctype._attributes,n=o.getNamedItemNS(c._namespaceURI,c._localName)),n&&(i=n._attributes.getNamedItemNS(e,t),i&&(r=i.cloneNode(!0),r._created=!1,r._namespaceURI=a._namespaceURI,r._nodeName=a.name,r._localName=a._localName,r._prefix=a._prefix,this.setNamedItemNS(r),r._created=!0,r._specified=!1)),a},core.Attr.prototype.__defineGetter__("ownerElement",function(){return this._ownerElement||null}),core.Node.prototype._prefix=!1,core.Node.prototype.__defineSetter__("qualifiedName",function(e){ns.validate(e,this._namespaceURI),e=e||"",this._localName=e.split(":")[1]||null,this.prefix=e.split(":")[0]||null,this._nodeName=e}),core.Node.prototype.__defineGetter__("qualifiedName",function(){return this._nodeName}),core.NamedNodeMap.prototype._map=function(e){var t,o=[],r=this.length,n=0;for(n;r>n;n++)t=this.item(n),e&&e(t)&&o.push(t);return o},core.Element.prototype.getAttributeNS=function(e,t){var o=this._attributes.getNamedItemNS(e,t);return o?o.nodeValue:""},core.Element.prototype.setAttributeNS=function(e,t,o){var r,n=t.split(":"),i=n.pop(),c=n.pop()||null;if(ns.validate(t,e),"xml"===t.split(":").shift()&&"http://www.w3.org/XML/1998/namespace"!==e)throw new core.DOMException(core.NAMESPACE_ERR);if("xmlns"===c&&"http://www.w3.org/2000/xmlns/"!==e)throw new core.DOMException(core.NAMESPACE_ERR);if(t.split(":").length>1&&!e)throw new core.DOMException(core.NAMESPACE_ERR);r=this._attributes.getNamedItemNS(e,i),r||(r=this.ownerDocument.createAttributeNS(e,t,o),this._attributes.setNamedItemNS(r)),r._namespaceURI=e,r._prefix=c,r._created=!0,r.value=o,r._localName=i},core.Element.prototype.removeAttributeNS=function(e,t){if(this.readonly)throw new core.DOMException(core.NO_MODIFICATION_ALLOWED_ERR);var o,r,n,i,r,t,c=this.ownerDocument;c.doctype&&c.doctype._attributes&&(o=c.doctype._attributes,n=o.getNamedItemNS(e,this.localName)),n&&(i=n.getAttributeNodeNS(e,t)),this._attributes.removeNamedItemNS(e,t),i&&(this.setAttributeNS(i.namespaceURI,i.name,i.value),t=i.name.split(":").pop(),r=this.getAttributeNS(i.namespaceURI,t),r._specified=!1)},core.Element.prototype.getAttributeNodeNS=function(e,t){return this._attributes.getNamedItemNS(e,t)},core.Element.prototype._created=!1,core.Element.prototype.setAttributeNodeNS=function(e){if(e.ownerElement)throw new core.DOMException(core.INUSE_ATTRIBUTE_ERR);var t=null;try{t=this._attributes.removeNamedItemNS(e.namespaceURI,e.localName)}catch(o){}return this._attributes.setNamedItemNS(e)||t},core.Element.prototype.getElementsByTagNameNS=function(e,t){function o(o){o.nodeType&&o.nodeType===this.ENTITY_REFERENCE_NODE&&(o=o._entity);var r=o.localName===t,n=o.namespaceURI===e;return!r&&"*"!==t||!n&&"*"!==e||o.nodeType!==o.ELEMENT_NODE?!1:!0}return new core.NodeList(this.ownerDocument||this,core.mapper(this,o))},core.Element.prototype.hasAttribute=function(e){return this._attributes?this._attributes.exists(e):!1},core.Element.prototype.hasAttributeNS=function(e,t){return this._attributes.getNamedItemNS(e,t)?!0:this.hasAttribute(t)?!0:!1},core.DocumentType.prototype.__defineGetter__("publicId",function(){return this._publicId||""}),core.DocumentType.prototype.__defineGetter__("systemId",function(){return this._systemId||""}),core.DocumentType.prototype.__defineGetter__("internalSubset",function(){return this._internalSubset||null}),core.Document.prototype.importNode=function(e,t){function o(e){var t,o,n,c;if(e._ownerDocument=r,e.id&&(r._ids||(r._ids={}),r._ids[e.id]||(r._ids[e.id]=[]),r._ids[e.id].push(e)),e._attributes)for(e._attributes._ownerDocument=r,n=0,c=e._attributes.length;c>n;n++)t=e._attributes.item(n),t._ownerDocument=r,t._specified=!0;i&&(o=i.getNamedItemNS(e._namespaceURI,e._localName),o&&o._attributes._map(function(t){if(!e.hasAttributeNS(t.namespaceURL,t.localName)){var o=t.cloneNode(!0);o._namespaceURI=t._namespaceURI,o._prefix=t._prefix,o._localName=t._localName,e.setAttributeNodeNS(o),o._specified=!1}}))}if(e&&e.nodeType&&(e.nodeType===this.DOCUMENT_NODE||e.nodeType===this.DOCUMENT_TYPE_NODE))throw new core.DOMException(core.NOT_SUPPORTED_ERR);var r=this,n=e.cloneNode(t,function(e,t){t._namespaceURI=e._namespaceURI,t._nodeName=e._nodeName,t._localName=e._localName}),i=!1;return this.doctype&&this.doctype._attributes&&(i=this.doctype._attributes),t?core.visitTree(n,o):o(n),n.nodeType==n.ATTRIBUTE_NODE&&(n._specified=!0),n},core.Document.prototype.createElementNS=function(e,t){var o,r,n=t.split(":");if(n.length>1&&!e)throw new core.DOMException(core.NAMESPACE_ERR);return ns.validate(t,e),o=this.createElement(t),o._created=!1,o._namespaceURI=e,o._nodeName=t,o._localName=n.pop(),n.length>0&&(r=n.pop(),o.prefix=r),o._created=!0,o},core.Document.prototype.createAttributeNS=function(e,t){var o,r=t.split(":");if(r.length>1&&!e)throw new core.DOMException(core.NAMESPACE_ERR,"Prefix specified without namespaceURI ("+t+")");return ns.validate(t,e),o=this.createAttribute(t),o.namespaceURI=e,o.qualifiedName=t,o._localName=r.pop(),o._prefix=r.length>0?r.pop():null,o},core.Document.prototype.getElementsByTagNameNS=function(e,t){return core.Element.prototype.getElementsByTagNameNS.call(this,e,t)},core.Element.prototype.__defineSetter__("id",function(e){this.setAttribute("id",e)}),core.Element.prototype.__defineGetter__("id",function(){return this.getAttribute("id")}),core.Document.prototype.getElementById=function(e){return this._ids&&this._ids[e]&&this._ids[e].length>0?this._ids[e][0]:null},exports.dom={level2:{core:core}};