function fetchStylesheet(e,t){html.resourceLoader.load(this,e,function(s){evaluateStylesheet.call(this,s,t,e)})}function evaluateStylesheet(e,t,s){var l=cssom.parse(e),r=l.cssRules;r.unshift(0,t.cssRules.length),Array.prototype.splice.apply(t.cssRules,r),scanForImportRules.call(this,t.cssRules,s)}function scanForImportRules(e,t){if(e)for(var s=0;s<e.length;++s)e[s].cssRules?scanForImportRules.call(this,e[s].cssRules,t):e[s].href&&fetchStylesheet.call(this,e[s].href,this.sheet)}function evaluateStyleAttribute(e){for(var t,s,l,r=cssom.parse("dummy{"+e+"}"),o=this.style;o.length;)o.removeProperty(o[0]);if(r.cssRules.length>0&&r.cssRules[0].style)for(t=r.cssRules[0].style,s=0;s<t.length;++s)l=t[s],o.setProperty(l,t.getPropertyValue(l),t.getPropertyPriority(l))}function StyleAttr(e,t){this._node=e,core.Attr.call(this,e.ownerDocument,"style"),this.nodeValue=t}var getOrCreateSheet,core=require("./core").dom.level2.core,html=require("./html").dom.level2.html,utils=require("../utils"),cssom=require("cssom"),cssstyle=require("cssstyle"),assert=null;core.StyleSheet=cssom.StyleSheet,core.MediaList=cssom.MediaList,core.CSSStyleSheet=cssom.CSSStyleSheet,core.CSSRule=cssom.CSSRule,core.CSSStyleRule=cssom.CSSStyleRule,core.CSSMediaRule=cssom.CSSMediaRule,core.CSSImportRule=cssom.CSSImportRule,core.CSSStyleDeclaration=cssstyle.CSSStyleDeclaration,core.StyleSheetList=core.NodeList,core.Document.prototype.__defineGetter__("styleSheets",function(){return this._styleSheets||(this._styleSheets=new core.StyleSheetList),this._styleSheets}),StyleAttr.prototype={get nodeValue(){return this._node.style.cssText},set nodeValue(e){evaluateStyleAttribute.call(this._node,e)}},StyleAttr.prototype.__proto__=core.Attr.prototype,utils.intercept(core.AttrNodeMap,"setNamedItem",function(e,t,s){return"style"==s.name&&(s=new StyleAttr(this._parentNode,s.nodeValue)),e.call(this,s)}),html.HTMLElement.prototype.__defineGetter__("style",function(){var e=this._cssStyleDeclaration;return e||(e=this._cssStyleDeclaration=new cssstyle.CSSStyleDeclaration,this.getAttributeNode("style")||this.setAttribute("style","")),e}),assert.equal(void 0,html.HTMLLinkElement._init),html.HTMLLinkElement._init=function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(){/(?:[ \t\n\r\f]|^)stylesheet(?:[ \t\n\r\f]|$)/i.test(this.rel)&&this.href&&fetchStylesheet.call(this,this.href,this.sheet)}),this.addEventListener("DOMNodeRemovedFromDocument",function(){})},getOrCreateSheet=function(){return this._cssStyleSheet||(this._cssStyleSheet=new cssom.CSSStyleSheet),this._cssStyleSheet},html.HTMLLinkElement.prototype.__defineGetter__("sheet",getOrCreateSheet),assert.equal(void 0,html.HTMLStyleElement._init),html.HTMLStyleElement._init=function(){this.addEventListener("DOMNodeInsertedIntoDocument",function(){this.type&&"text/css"!==this.type||evaluateStylesheet.call(this,this.textContent,this.sheet,this._ownerDocument.URL)})},html.HTMLStyleElement.prototype.__defineGetter__("sheet",getOrCreateSheet),exports.dom={level2:{html:html,core:core}};