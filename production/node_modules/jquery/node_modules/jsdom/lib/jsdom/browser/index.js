function NOT_IMPLEMENTED(e){return function(){if(!jsdom.debugMode){var t=e?e.raise:this.raise;t.call(this,"error","NOT IMPLEMENTED")}}}function getDefaultParser(){if(null===defaultParser)try{defaultParser=null}catch(e){try{defaultParser=null}catch(t){defaultParser=void 0}}return defaultParser}var defaultParser,browserAugmentation,http=null,URL=null,HtmlToDom=null.HtmlToDom,domToHtml=null.domToHtml,htmlencoding=null,HTMLEncode=htmlencoding.HTMLEncode,HTMLDecode=htmlencoding.HTMLDecode,jsdom=null,Contextify=null;try{Contextify=null}catch(e){Contextify=function(e){var t=null,n=t.createContext(e),o=null;return e.run=function(e,o){return t.runInContext(e,n,o)},e.getGlobal=function(){return o||(o=t.runInContext("this",n)),o},e.dispose=function(){o=null,e.run=function(){throw Error("Called run() after dispose().")},e.getGlobal=function(){throw Error("Called getGlobal() after dispose().")},e.dispose=function(){throw Error("Called dispose() after dispose().")}},e}}exports.windowAugmentation=function(e,t){var n,o,r,i;return t=t||{},n=exports.createWindow(e,t),t.document||(o=browserAugmentation(e,t),t.features&&t.features.QuerySelector&&require(__dirname+"/../selectors/index").applyQuerySelectorPrototype(o),t.document=o.HTMLDocument?new o.HTMLDocument(t):new o.Document(t),t.document.write("<html><head></head><body></body></html>")),r=n.document=t.document,r.addEventListener&&("complete"==r.readyState?(i=r.createEvent("HTMLEvents"),i.initEvent("load",!1,!1),n.dispatchEvent(i)):r.addEventListener("load",function(e){n.dispatchEvent(e)})),n},exports.createWindow=function(e,t){function n(e,t,n,o){var r=e(n,o);return u.push([r,t]),r}function o(e){if(void 0!==e)for(var t in u)if(u[t][0]===e){u[t][1].call(this,e),u.splice(t,1);break}}function r(){u.forEach(function(e){e[1].call(this,e[0])}),u=[]}function i(t){var i,s=(t||{}).url||"file://"+__filename;this.location=URL.parse(s),this.location.reload=NOT_IMPLEMENTED(this),this.location.replace=NOT_IMPLEMENTED(this),this.location.toString=function(){return s},i=this.console._window=this,this.location.__defineGetter__("hash",function(){return i.location.href.split("#").length>1?"#"+i.location.href.split("#")[1]:""}),this.location.__defineSetter__("hash",function(e){i.location.href=i.location.href.split("#")[0]+e}),this.location.__defineGetter__("search",function(){return i.location.href.split("?").length>1?"?"+i.location.href.match(/\?([^#]+)/)[1]:""}),this.location.__defineSetter__("search",function(e){i.location.href=i.location.href.indexOf("?")>0?i.location.href.replace(/\?([^#]+)/,e):i.location.href.match(/^([^#?]+)/)[0]+e+i.location.hash}),t&&t.document&&(t.document.location=this.location),this.addEventListener=function(){e.Node.prototype.addEventListener.apply(i,arguments)},this.removeEventListener=function(){e.Node.prototype.removeEventListener.apply(i,arguments)},this.dispatchEvent=function(){e.Node.prototype.dispatchEvent.apply(i,arguments)},this.raise=function(){e.Node.prototype.raise.apply(i.document,arguments)},this.setTimeout=function(e,t){return n(setTimeout,clearTimeout,e,t)},this.setInterval=function(e,t){return n(setInterval,clearInterval,e,t)},this.clearInterval=o,this.clearTimeout=o,this.__stopAllTimers=r}var s,l,u=[];return i.prototype={__proto__:e,_length:0,get length(){return this._length},close:function(){var e=this;!function t(n){var o;if(n.length>0)for(o=0;o<n.length;o++)t(n[o]);n!==e&&n.close()}(this),this.document&&(this.document.body&&(this.document.body.innerHTML=""),this.document.close&&(this.document._listeners=[],this.document.close()),delete this.document),r(),this.dispose()},getComputedStyle:function(e){var t,n=e.style,o={};for(t in n)o[t]=n[t];return o.__proto__={getPropertyValue:function(t){return e.style[t]}},o},console:{log:function(e){this._window.raise("log",e)},info:function(e){this._window.raise("info",e)},warn:function(e){this._window.raise("warn",e)},error:function(e){this._window.raise("error",e)}},navigator:{userAgent:"Node.js ("+process.platform+"; U; rv:"+process.version+")",appName:"Node.js jsDom",platform:process.platform,appVersion:process.version},XMLHttpRequest:function(){},name:"nodejs",innerWidth:1024,innerHeight:768,outerWidth:1024,outerHeight:768,pageXOffset:0,pageYOffset:0,screenX:0,screenY:0,screenLeft:0,screenTop:0,scrollX:0,scrollY:0,scrollTop:0,scrollLeft:0,alert:NOT_IMPLEMENTED(),blur:NOT_IMPLEMENTED(),confirm:NOT_IMPLEMENTED(),createPopup:NOT_IMPLEMENTED(),focus:NOT_IMPLEMENTED(),moveBy:NOT_IMPLEMENTED(),moveTo:NOT_IMPLEMENTED(),open:NOT_IMPLEMENTED(),print:NOT_IMPLEMENTED(),prompt:NOT_IMPLEMENTED(),resizeBy:NOT_IMPLEMENTED(),resizeTo:NOT_IMPLEMENTED(),scroll:NOT_IMPLEMENTED(),scrollBy:NOT_IMPLEMENTED(),scrollTo:NOT_IMPLEMENTED(),screen:{width:0,height:0},Image:NOT_IMPLEMENTED()},s=new i(t),Contextify(s),l=s.getGlobal(),s.window=s.frames=s.self=s.parent=s.top=l,s},defaultParser=null,browserAugmentation=exports.browserAugmentation=function(e,t){function n(t,n){var o,u,c,a,d,p="",f="",h="",_="HTML",m=n.match(r);if(t._doctype=null,m&&m[0])h=m[0];else{if(u=n.indexOf(s),c=n.indexOf(l),0>u||0>c)return;if(o=n.substr(u,c-u+l.length),m=o.replace(/[\n\r]/g,"").match(i),!m)return;h=m[0],m=m[1].split(' "'),a=m.length?m.pop().replace(/"/g,""):"",d=m.length?m.pop().replace(/"/g,""):"",-1!==a.indexOf("-//")&&(p=a),-1!==d.indexOf("-//")&&(p=d),-1!==a.indexOf("://")&&(f=a),-1!==d.indexOf("://")&&(f=d),m.length&&(m=m[0].split(" "),_=m[0].toUpperCase())}t._doctype=(new e.DOMImplementation).createDocumentType(_,p,f),t._doctype._ownerDocument=t,t._doctype._fullDT=h,t._doctype.toString=function(){return this._fullDT}}var o,r,i,s,l;return e._augmented?e:(t||(t={}),o=new HtmlToDom(t.parser||getDefaultParser()),e.HTMLDocument||(e.HTMLDocument=e.Document),e.HTMLDocument.prototype.write||(e.HTMLDocument.prototype.write=function(e){this.innerHTML=e}),e.Element.prototype.getElementsByClassName=function(t){function n(n){var o,r,i;if(!n)return!1;if(n.nodeType&&n.nodeType===e.Node.ENTITY_REFERENCE_NODE&&(n=n._entity),o=n.className)for(r=o.split(" "),i=0;i<r.length;i++)if(r[i]===t)return!0;return!1}return new e.NodeList(this.ownerDocument||this,e.mapper(this,n))},e.Element.prototype.__defineGetter__("sourceIndex",function(){var e,t=this.ownerDocument.getElementsByTagName("*"),n=t.length;for(e=0;n>e;e++)if(t[e]===this)return e}),e.Document.prototype.__defineGetter__("outerHTML",function(){return domToHtml(this,!0)}),e.Element.prototype.__defineGetter__("outerHTML",function(){return domToHtml(this,!0)}),e.Element.prototype.__defineGetter__("innerHTML",function(){if(/^(?:script|style)$/.test(this._tagName)){var e=this.getAttribute("type");if(!e||/^text\//i.test(e)||/\/javascript$/i.test(e))return domToHtml(this._childNodes,!0,!0)}return domToHtml(this._childNodes,!0)}),e.Element.prototype.__defineSetter__("doctype",function(){throw new core.DOMException(NO_MODIFICATION_ALLOWED_ERR)}),e.Element.prototype.__defineGetter__("doctype",function(){var e=null;return"#document"==this.nodeName&&this._doctype&&(e=this._doctype),e}),e.Element.prototype.__defineSetter__("innerHTML",function(e){for(var t;t=this._childNodes[0];)this.removeChild(t);return"#document"===this.nodeName&&n(this,e),""!==e&&null!=e&&o.appendHtmlToElement(e,this),e}),e.Document.prototype.__defineGetter__("innerHTML",function(){return domToHtml(this._childNodes,!0)}),e.Document.prototype.__defineSetter__("innerHTML",function(e){for(var t;t=this._childNodes[0];)this.removeChild(t);return"#document"===this.nodeName&&n(this,e),""!==e&&null!=e&&o.appendHtmlToElement(e,this),e}),r=/<!doctype html>/i,i=/<!DOCTYPE (\w(.|\n)*)">/i,s="<!DOCTYPE ",l='">',e.Document.prototype.getElementsByClassName=function(t){function n(n){var o,r,i;if(!n)return!1;if(n.nodeType&&n.nodeType===e.Node.ENTITY_REFERENCE_NODE&&(n=n._entity),o=n.className)for(r=o.split(" "),i=0;i<r.length;i++)if(r[i]===t)return!0;return!1}return new e.NodeList(this.ownerDocument||this,e.mapper(this,n))},e.Element.prototype.__defineGetter__("nodeName",function(){return this._nodeName.toUpperCase()}),e.Element.prototype.__defineGetter__("tagName",function(){var e=this._tagName.toUpperCase();return"#document"===this.nodeName&&(e=null),e}),e.Element.prototype.scrollTop=0,e.Element.prototype.scrollLeft=0,e.Document.prototype.__defineGetter__("parentWindow",function(){if(!this._parentWindow){var t=exports.windowAugmentation(e,{document:this,url:this.URL});this._parentWindow=t.getGlobal()}return this._parentWindow}),e.Document.prototype.__defineSetter__("parentWindow",function(e){this._parentWindow=e.getGlobal()}),e.Document.prototype.__defineGetter__("defaultView",function(){return this.parentWindow}),e._augmented=!0,e)};