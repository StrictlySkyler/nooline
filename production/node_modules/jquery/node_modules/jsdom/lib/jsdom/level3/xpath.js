!function(){function e(e,n,t,r){var o,s,i=e(n,t);if(null==i)return null;for(;o=n.trypop(r);){if(s=e(n,t),null==s)throw new J(J.INVALID_EXPRESSION_ERR,"Position "+n.position()+": Expected something after "+o);i=t.node(o,i,s)}return i}function n(e,n){return t(e,n)||o(null,e,n)}function t(e,n){var t,r=e.peek();return"/"===r||"//"===r?(t=n.node("Root"),o(t,e,n,!0)):null}function o(e,n,t,r){var o,i;if(null==e&&(e=s(n,t),null==e))return e;for(;o=n.trypop(["/","//"]);){if("//"===o&&(e=t.node("/",e,t.node("Axis","descendant-or-self","node",void 0))),i=s(n,t),null==i&&"/"===o&&r)return e;if(r=!1,null==i)throw new J(J.INVALID_EXPRESSION_ERR,"Position "+n.position()+": Expected step after "+o);e=t.node("/",e,i)}return e}function s(e,n){var t,r,o,s,h,p=e.trypop([".",".."]);if("."===p)return n.node("Axis","self","node");if(".."===p)return n.node("Axis","parent","node");if(t=i(e,n),r=u(e,n),null==r&&(o=l(e,n)),null==t&&null==r&&null==o)return null;if(null==r&&null==o)throw new J(J.INVALID_EXPRESSION_ERR,"Position "+e.position()+": Expected nodeTest after axisSpecifier "+t);for(null==t&&(t="child"),null==r&&(r="attribute"===t?"attribute":"namespace"===t?"namespace":"element"),s=n.node("Axis",t,r,o);null!=(h=a(s,e,n));)s=h;return s}function i(e){var n,t,r=e.trypop("@");if(null!=r)return"attribute";if(n=e.trypopaxisname(),null!=n){if(t=e.trypop("::"),null==t)throw new J(J.INVALID_EXPRESSION_ERR,"Position "+e.position()+": Should not happen. Should be ::.");return n}}function u(e){var n,t;if("("!==e.peek2())return null;if(n=e.trypop(["comment","text","processing-instruction","node"]),null!=n){if(null==e.trypop("("))throw new J(J.INVALID_EXPRESSION_ERR,"Position "+e.position()+": Should not happen.");if(t=void 0,"processing-instruction"==n&&(t=e.trypopliteral()),null==e.trypop(")"))throw new J(J.INVALID_EXPRESSION_ERR,"Position "+e.position()+": Expected close parens.");return n}}function l(e){var n=e.trypopnametest();return null!=n?n:null}function a(e,n,t){if(null==n.trypop("["))return null;var r=E(n,t);if(null==r)throw new J(J.INVALID_EXPRESSION_ERR,"Position "+n.position()+": Expected expression after [");if(null==n.trypop("]"))throw new J(J.INVALID_EXPRESSION_ERR,"Position "+n.position()+": Expected ] after expression.");return t.node("Predicate",e,r)}function h(e,n){var t,r,o,s=e.trypopliteral();if(null==s&&(s=e.trypopnumber()),null!=s)return s;if(t=e.trypopvarref(),null!=t)return n.node("VariableReference",t);if(r=p(e,n),null!=r)return r;if(e.trypop("(")){if(o=E(e,n),null==o)throw new J(J.INVALID_EXPRESSION_ERR,"Position "+e.position()+": Expected expression after (.");if(null==e.trypop(")"))throw new J(J.INVALID_EXPRESSION_ERR,"Position "+e.position()+": Expected ) after expression.");return o}return null}function p(e,n){var t,r,o,s=e.trypopfuncname(e,n);if(null==s)return null;if(null==e.trypop("("))throw new J(J.INVALID_EXPRESSION_ERR,"Position "+e.position()+": Expected ( ) after function name.");for(t=[],r=!0;null==e.trypop(")");){if(!r&&null==e.trypop(","))throw new J(J.INVALID_EXPRESSION_ERR,"Position "+e.position()+": Expected , between arguments of the function.");if(r=!1,o=E(e,n),null==o)throw new J(J.INVALID_EXPRESSION_ERR,"Position "+e.position()+": Expected expression as argument of function.");t.push(o)}return n.node("FunctionCall",s,t)}function f(n,t){return e(c,n,t,"|")}function c(e,t){var r,s,i=d(e,t);if(null==i){if(r=n(e,t),null==r)throw Error();return t.node("PathExpr",r)}return s=o(i,e,t,!1),i===s?s:t.node("PathExpr",s)}function d(e,n){var t,r,o=h(e,n);if(null==o)return null;for(r=o;null!=(t=a(r,e,n));)r=t;return r}function E(n,t){(n.peeked||"")+n.str;var r=e(g,n,t,"or");return(n.peeked||"")+n.str,r}function g(n,t){return e(R,n,t,"and")}function R(n,t){return e(_,n,t,["=","!="])}function _(n,t){return e(N,n,t,["<",">","<=",">="])}function N(n,t){return e(m,n,t,["+","-"])}function m(n,t){return e(y,n,t,["*","div","mod"])}function y(e,n){if(e.trypop("-")){var t=y(e,n);if(null==t)throw new J(J.INVALID_EXPRESSION_ERR,"Position "+e.position()+": Expected unary expression after -");return n.node("UnaryMinus",t)}return f(e,n)}function v(e){this.nodes=[],this.pos=[],this.lasts=[],this.nextPos=[],this.seriesIndexes=[],this.isReverseAxis=e,this._pushToNodes=e?Array.prototype.unshift:Array.prototype.push}function T(e){var n,t,r,o=[];for(n=0;n<e.nodes.length;n++)if(t=e.nodes[n],e.pos)for(r=0;r<e.pos[n].length;++r)o.push({nodes:[t],pos:[[e.pos[n][r]]],lasts:[[e.lasts[n][r]]]});else o.push({nodes:[t],pos:[[n+1]],lasts:[[e.nodes.length]]});return o}function w(e,n,t){this.nodeTypeNum=e,this.nodeName=n,this.shouldLowerCase=t,this.nodeNameTest=null==n?this._alwaysTrue:t?this._nodeNameLowerCaseEquals:this._nodeNameEquals}function P(e,n,t,r,o,s,i,u,l){for(var a,h,p=new w(n,t,r),f=new v(l);0<e.length;){for(a=o.call(e),console.assert(null!=a),a=i(a),f.pushSeries(),h=1;null!=a;)!u&&p.matches(a)&&f.addNode(a),a===s.call(e)&&(o.call(e),f.pushSeries(),h++),u&&p.matches(a)&&f.addNode(a),a=i(a);for(;0<h--;)f.popSeries()}return f}function O(e){if(e.ownerElement){if(e.ownerElement.firstChild)return e.ownerElement.firstChild;e=e.ownerElement}do if(e.nextSibling)return e.nextSibling;while(e=e.parentNode);return null}function D(e){if(e.ownerElement&&(e=e.ownerElement),null!=e.firstChild)return e.firstChild;do{if(null!=e.nextSibling)return e.nextSibling;e=e.parentNode}while(e);return null}function b(e){if(e.ownerElement)return e.ownerElement;if(null!=e.previousSibling){for(e=e.previousSibling;null!=e.lastChild;)e=e.lastChild;return e}return null!=e.parentNode?e.parentNode:null}function S(e,n,t,r){var o,s,i,u,l=new w(n,t,r),a=new v(!1),h=e[0],p=[];for(o=0;o<e.length;o++)s=e[o],i=O(s),i&&p.push(i);if(0===p.length)return{nodes:[]};for(u=0;h=D(h);){for(o=p.length-1;o>=0;o--)h===p[o]&&(a.pushSeries(),p.splice(o,o+1),u++);u&&l.matches(h)&&a.addNode(h)}for(console.assert(0===p.length),o=0;u>o;o++)a.popSeries();return a.finalize()}function I(e,n,t,r){var o,s,i,u,l,a,h,p,f,c=new w(n,t,r),d=e.pop();if(null==d)return{nodes:{}};for(o={nodes:[],pos:[],lasts:[]},s=[d.parentNode||d.ownerElement],i=[1];d=b(d);){for(d===e[e.length-1]&&(s.push(e.pop()),i.push(1)),u=c.matches(d),a=!1,u&&(l=i.slice()),h=0;h<s.length;++h)d===s[h]?(s[h]=d.parentNode||d.ownerElement,u&&(l[h]=null)):u&&(l[h]=i[h]++,a=!0);a&&(o.nodes.unshift(d),o.pos.unshift(l))}for(h=0;h<o.pos.length;++h)for(p=[],o.lasts.push(p),f=o.pos[h].length-1;f>=0;f--)null==o.pos[h][f]?o.pos[h].splice(f,f+1):p.unshift(i[f]-1);return o}function A(e,n,t,r,o,s,i){for(var u,l,a,h,p;0<t.length&&null!=t[0].ownerElement;)u=t.shift(),o&&r.matches(u)&&(i.push(u),s.push(e.nodes.length));if(null==n||o||r.matches(n)&&e.addNode(n),l=!1,null==n){if(0===t.length)return;n=t.shift(),e.pushSeries(),l=!0}else 0<t.length&&n===t[0]&&(e.pushSeries(),l=!0,t.shift());for(o&&r.matches(n)&&e.addNode(n),a=n.childNodes,h=0;h<a.length;++h)p=a[h],A(e,p,t,r,o,s,i);l&&e.popSeries()}function x(e,n,t,r,o){for(var s,i=new w(n,t,r),u=new v(!1),l=[],a=[];0<e.length;)A(u,null,e,i,o,l,a);for(u.finalize(),s=a.length-1;s>=0;--s)u.nodes.splice(l[s],l[s],a[s]),u.pos.splice(l[s],l[s],[1]),u.lasts.splice(l[s],l[s],[1]);return u}function Y(e,n,t,r,o){var s,i,u,l,a,h,p,f,c=new w(n,t,r),d=[];for(s=0;s<e.length;++s){for(i=e[s],u=!0,l=[];null!=i;)(!u||o)&&c.matches(i)&&l.push(i),u=!1,i=i.parentNode||i.ownerElement;0<l.length&&d.push(l)}for(a=[],s=0;s<d.length;++s)a.push(d[s].length);for(new v(!0),h={nodes:[],pos:[],lasts:[]};0<d.length;){for(p=[d[0].length],f=[a[0]],i=d[0].pop(),s=d.length-1;s>0;--s)i===d[s][d[s].length-1]&&(p.push(d[s].length),f.push(a[s]),d[s].pop(),0===d[s].length&&(d.splice(s,s+1),a.splice(s,s+1)));0===d[0].length&&(d.shift(),a.shift()),h.nodes.push(i),h.pos.push(p),h.lasts.push(f)}return h}function L(e){var n,t=[e];for(null!=e.ownerElement&&(e=e.ownerElement,t.push(-1));null!=e;){for(n=0;null!=e.previousSibling;)e=e.previousSibling,n++;t.push(n),e=e.parentNode}return t}function V(e,n){var t,r,o=Math.min(e.length-1,n.length-1),s=e.length,i=n.length;if(e[0]===n[0])return 0;for(r=0;o>r&&(t=e[s-r-1]-n[i-r-1],0===t);++r);return(null==t||0===t)&&(t=s-i),0===t&&(t=e.nodeName-n.nodeName),0===t&&(t=1),t}function X(e){function n(e,n){return V(e.v,n.v)}var t,r,o,s=[];for(t=0;t<e.nodes.length;t++)r=L(e.nodes[t]),s.push({v:r,n:e.nodes[t],p:e.pos[t],l:e.lasts[t]});for(s.sort(n),o={nodes:[],pos:[],lasts:[]},t=0;t<s.length;++t)o.nodes.push(s[t].n),o.pos.push(s[t].p),o.lasts.push(s[t].l);return o}function k(e,n){var t,r,o,s,i,u=[];if("object"!=typeof e)throw new J(J.INVALID_EXPRESSION_ERR,"Invalid LHS for | operator (expected node-set): "+e);if("object"!=typeof n)throw new J(J.INVALID_EXPRESSION_ERR,"Invalid LHS for | operator (expected node-set): "+n);for(;;){if(null==t&&(t=e.shift(),null!=t&&(o=L(t))),null==r&&(r=n.shift(),null!=r&&(s=L(r))),null==t||null==r)break;i=V(o,s),0>i?(u.push(t),t=null,o=null):i>0?(u.push(r),r=null,s=null):t.nodeName<r.nodeName?(u.push(t),t=null,o=null):t.nodeName>r.nodeName?(u.push(r),r=null,s=null):t!==r?(u.push(r),r=null,s=null):(console.assert(t===r,i),r=null,s=null)}for(;t;)u.push(t),t=e.shift();for(;r;)u.push(r),r=n.shift();return u}function U(e,n,t,r){var o,s,i,u,l,a,h,p;if(o=r?q.number:"boolean"==typeof n||"boolean"==typeof t?q["boolean"]:"number"==typeof n||"number"==typeof t?q.number:q.string,"object"==typeof n&&"object"==typeof t){for(s=0;s<n.nodes.length;++s)for(i=o({nodes:[n.nodes[s]]}),u=0;u<t.nodes.length;++u)if(l=o({nodes:[t.nodes[u]]}),e(i,l))return!0;return!1}if("object"==typeof n&&n.nodes&&n.nodes.length){for(s=0;s<n.nodes.length;++s)if(i=o({nodes:[n.nodes[s]]}),a=o(t),e(i,a))return!0;return!1}if("object"==typeof t&&n.nodes&&n.nodes.length){for(s=0;s<n.nodes.length;++s)if(h=o({nodes:[t.nodes[s]]}),p=o(n),e(p,h))return!0;return!1}return p=o(n),a=o(t),e(p,a)}var M,j,C,H,B,z,F,q,$,G,W,J,Q,Z,K;"function"==typeof require?(M=require("../level3/core").dom.level3.core,j=exports):(M=this,j={}),C=j.Stream=function(e){this.original=this.str=e,this.peeked=null,this.prev=null,this.prevprev=null},C.prototype={peek:function(){if(this.peeked)return this.peeked;var e=this.re.exec(this.str);return e?(this.str=this.str.substr(e[0].length),this.peeked=e[1]):null},peek2:function(){this.peek();var e=this.re.exec(this.str);return e?e[1]:null},pop:function(){var e=this.peek();return this.peeked=null,this.prevprev=this.prev,this.prev=e,e},trypop:function(e){var n,t,r=this.peek();if(r===e)return this.pop();if(Array.isArray(e))for(n=0;n<e.length;++n)if(t=e[n],t==r)return this.pop()},trypopfuncname:function(){var e=this.peek();if(!this.isQnameRe.test(e))return null;switch(e){case"comment":case"text":case"processing-instruction":case"node":return null}return"("!=this.peek2()?null:this.pop()},trypopaxisname:function(){var e=this.peek();switch(e){case"ancestor":case"ancestor-or-self":case"attribute":case"child":case"descendant":case"descendant-or-self":case"following":case"following-sibling":case"namespace":case"parent":case"preceding":case"preceding-sibling":case"self":if("::"==this.peek2())return this.pop()}return null},trypopnametest:function(){var e=this.peek();return"*"===e||this.startsWithNcNameRe.test(e)?this.pop():null},trypopliteral:function(){var e,n,t=this.peek();return null==t?null:(e=t.charAt(0),n=t.charAt(t.length-1),'"'===e&&'"'===n||"'"===e&&"'"===n?(this.pop(),t.substr(1,t.length-2)):void 0)},trypopnumber:function(){var e=this.peek();return this.isNumberRe.test(e)?parseFloat(this.pop()):null},trypopvarref:function(){var e=this.peek();return null==e?null:"$"===e.charAt(0)?this.pop().substr(1):null},position:function(){return this.original.length-this.str.length}},function(){var e="A-Z_a-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�",n=e+"\\-\\.0-9·̀-ͯ‿-⁀",t="["+e+"]["+n+"]*",r=t+"(?::"+t+")?",o="\\.\\.|[\\(\\)\\[\\].@,]|::",s="and|or|mod|div|//|!=|<=|>=|[*/|+\\-=<>]",i="\"[^\"]*\"|'[^']*'",u="[0-9]+(?:\\.[0-9]*)?|\\.[0-9]+",l="\\$"+r,a="\\*|"+t+":\\*|"+r,h="[ 	\r\n]*",p=RegExp("^"+h+"("+u+"|"+o+"|"+a+"|"+s+"|"+i+"|"+l+")");C.prototype.re=p,C.prototype.startsWithNcNameRe=RegExp("^"+t),C.prototype.isQnameRe=RegExp("^"+r+"$"),C.prototype.isNumberRe=RegExp("^"+u+"$")}(),H=j.parse=function(e,n){for(var t,r=E(e,n),o=[];t=e.pop();)o.push(t);if(o.length)throw new J(J.INVALID_EXPRESSION_ERR,"Position "+e.position()+": Unparsed tokens: "+o.join(" "));return r},B={node:function(){return Array.prototype.slice.call(arguments)}},v.prototype={pushSeries:function(){this.nextPos.push(1),this.seriesIndexes.push(this.nodes.length)},popSeries:function(){var e,n,t,r,o;for(console.assert(0<this.nextPos.length,this.nextPos),e=this.nextPos.pop()-1,n=this.nextPos.length,t=this.seriesIndexes.pop(),r=this.nodes.length,o=t;r>o;++o)console.assert(n<this.lasts[o].length),console.assert(void 0===this.lasts[o][n]),this.lasts[o][n]=e},finalize:function(){var e,n;if(null==this.nextPos)return this;for(console.assert(0===this.nextPos.length),e=0;e<this.lasts.length;++e)for(n=0;n<this.lasts[e].length;++n)console.assert(null!=this.lasts[e][n],e+","+n+":"+JSON.stringify(this.lasts));return this.pushSeries=this.popSeries=this.addNode=function(){throw Error("Already finalized.")},this},addNode:function(e){console.assert(e),this._pushToNodes.call(this.nodes,e),this._pushToNodes.call(this.pos,this.nextPos.slice()),this._pushToNodes.call(this.lasts,Array(this.nextPos.length));for(var n=0;n<this.nextPos.length;++n)this.nextPos[n]++},simplify:function(){return this.finalize(),{nodes:this.nodes,pos:this.pos,lasts:this.lasts}}},w.prototype={matches:function(e){return(0===this.nodeTypeNum||e.nodeType===this.nodeTypeNum)&&this.nodeNameTest(e.nodeName)},_alwaysTrue:function(){return!0},_nodeNameEquals:function(e){return this.nodeName===e},_nodeNameLowerCaseEquals:function(e){return this.nodeName===e.toLowerCase()}},z=j.sortUniqDocumentOrder=function(e){var n,t,r,o,s=[];for(n=0;n<e.length;n++)t=e[n],r=L(t),s.push(r);for(s.sort(V),o=[],n=0;n<s.length;n++)n>0&&s[n][0]===s[n-1][0]||o.push(s[n][0]);return o},F=j.axes={ancestor:function(e,n,t,r){return Y(e,n,t,r,!1)},"ancestor-or-self":function(e,n,t,r){return Y(e,n,t,r,!0)},attribute:function(e,n,t,r){var o,s,i,u,l=new w(n,t,r),a=new v(!1);if(null!=t)for(o=0;o<e.length;++o)s=e[o],null!=s.getAttributeNode&&(i=s.getAttributeNode(t),null!=i&&l.matches(i)&&(a.pushSeries(),a.addNode(i),a.popSeries()));else for(o=0;o<e.length;++o)if(s=e[o],null!=s.attributes){for(a.pushSeries(),u=0;u<s.attributes.length;u++)i=s.attributes[u],l.matches(i)&&a.addNode(i);a.popSeries()}return a.finalize()},child:function en(e,n,t,o){var s,i,u,l,en,a=new w(n,t,o),h=new v(!1);for(s=0;s<e.length;++s)if(i=e[s],!i.ownerElement&&i.childNodes){for(h.pushSeries(),u=1===n&&null!=i.children?i.children:i.childNodes,l=0;l<u.length;++l)en=u[l],a.matches(en)&&h.addNode(en);h.popSeries()}return h.finalize(),r=X(h)},descendant:function(e,n,t,r){return x(e,n,t,r,!1)},"descendant-or-self":function(e,n,t,r){return x(e,n,t,r,!0)},following:function(e,n,t,r){return S(e,n,t,r)},"following-sibling":function(e,n,t,r){return P(e,n,t,r,Array.prototype.shift,function(){return this[0]},function(e){return e.nextSibling})},namespace:function(){},parent:function nn(e,n,t,r){var o,nn,s=new w(n,t,r),i=[],u=[];for(o=0;o<e.length;++o)nn=e[o].parentNode||e[o].ownerElement,null!=nn&&s.matches(nn)&&(i.length>0&&nn===i[i.length-1]||(i.push(nn),u.push([1])));return{nodes:i,pos:u,lasts:u}},preceding:function(e,n,t,r){return I(e,n,t,r)},"preceding-sibling":function(e,n,t,r){return P(e,n,t,r,Array.prototype.pop,function(){return this[this.length-1]},function(e){return e.previousSibling},!1,!0)},self:function(e,n,t,r){var o,s=[],i=[],u=new w(n,t,r);for(o=0;o<e.length;++o)u.matches(e[o])&&(s.push(e[o]),i.push([1]));return{nodes:s,pos:i,lasts:i}}},q={number:function(e){return"number"==typeof e?e:"string"==typeof e?parseFloat(e):"boolean"==typeof e?+e:q.number(q.string.call(this,e))},string:function(e){return null==e?q.string(this):"string"==typeof e||"boolean"==typeof e||"number"==typeof e?""+e:0==e.nodes.length?"":null!=e.nodes[0].textContent?e.nodes[0].textContent:e.nodes[0].nodeValue},"boolean":function(e){return"object"==typeof e?e.nodes.length>0:!!e},last:function(){return console.assert(Array.isArray(this.pos)),console.assert(Array.isArray(this.lasts)),console.assert(1===this.pos.length),console.assert(1===this.lasts.length),console.assert(1===this.lasts[0].length),this.lasts[0][0]},position:function(){return console.assert(Array.isArray(this.pos)),console.assert(Array.isArray(this.lasts)),console.assert(1===this.pos.length),console.assert(1===this.lasts.length),console.assert(1===this.pos[0].length),this.pos[0][0]},count:function(e){if("object"!=typeof e)throw new J(J.INVALID_EXPRESSION_ERR,"Position "+stream.position()+": Function count(node-set) "+"got wrong argument type: "+e);return e.nodes.length},id:function tn(e){var n,t,r,o,s,tn,i,u={nodes:[]},l=this.nodes[0].ownerDocument||this.nodes[0];if(console.assert(l),"object"==typeof e)for(n=[],t=0;t<e.nodes.length;++t)r=e.nodes[t],o=q.string({nodes:[r]}),s=o.split(/[ \t\r\n]+/g),Array.prototype.push.apply(n,s);else o=q.string(e),s=o.split(/[ \t\r\n]+/g),n=s;for(t=0;t<n.length;++t)tn=n[t],0!==tn.length&&(i=l.getElementById(tn),null!=i&&u.nodes.push(i));return u.nodes=z(u.nodes),u},"local-name":function(e){if(null==e)return q.name(this);if(null==e.nodes)throw new J(J.INVALID_EXPRESSION_ERR,"argument to name() must be a node-set. got "+e);return e.nodes[0].nodeName.toLowerCase()},"namespace-uri":function(){throw Error("not implemented yet")},name:function(e){if(null==e)return q.name(this);if(null==e.nodes)throw new J(J.INVALID_EXPRESSION_ERR,"argument to name() must be a node-set. got "+e);return e.nodes[0].nodeName.toLowerCase()},concat:function(){var e,n=[];for(e=0;e<arguments.length;++e)n.push(q.string(arguments[e]));return n.join("")},"starts-with":function(e,n){var t=q.string(e),r=q.string(n);return t.substr(0,r.length)===r},contains:function(e,n){var t=q.string(e),r=q.string(n),o=t.indexOf(r);return-1===o?!1:!0},"substring-before":function(e,n){var t=q.string(e),r=q.string(n),o=t.indexOf(r);return-1===o?"":t.substr(0,o)},"substring-after":function(e,n){var t=q.string(e),r=q.string(n),o=t.indexOf(r);return-1===o?"":t.substr(o+r.length)},substring:function(e,n,t){if(null==e||null==n)throw new J(J.INVALID_EXPRESSION_ERR,"Must be at least 2 arguments to string()");var r=q.string(e),o=q.round(n),s=null==t?null:q.round(t);return null==s?r.substr(o-1):r.substr(o-1,s)},"string-length":function(e){return q.string.call(this,e).length},"normalize-space":function(e){var n=q.string.call(this,e);return n.replace(/[ \t\r\n]+/g," ").replace(/^ | $/g,"")},translate:function(e,n,t){var r,o,s,i=q.string.call(this,e),u=q.string(n),l=q.string(t),a=[],h={};for(r=0;r<u.length;++r)o=u.charAt(r),h[o]=l.charAt(r),a.push(o.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08"));return s=RegExp(a.join("|"),"g"),i.replace(s,function(e){return h[e]})},not:function(e){var n=q["boolean"](e);return!n},"true":function(){return!0},"false":function(){return!1},lang:function(){throw Error("Not implemented")},sum:function rn(e){var rn,n,t,r;if(null==e)return q.sum(this);for(rn=0,n=0;n<e.nodes.length;++n)t=e.nodes[n],r=q.number({nodes:[t]}),rn+=r;return rn},floor:function(e){return Math.floor(q.number(e))},ceiling:function(e){return Math.ceil(q.number(e))},round:function(e){return Math.round(q.number(e))}},$={UnaryMinus:function(e){return-q.number(e)},"+":function(e,n){return q.number(e)+q.number(n)},"-":function(e,n){return q.number(e)-q.number(n)},"*":function(e,n){return q.number(e)*q.number(n)},div:function(e,n){return q.number(e)/q.number(n)},mod:function(e,n){return q.number(e)%q.number(n)},"<":function(e,n){return U(function(e,n){return q.number(e)<q.number(n)},e,n,!0)},"<=":function(e,n){return U(function(e,n){return q.number(e)<=q.number(n)},e,n,!0)},">":function(e,n){return U(function(e,n){return q.number(e)>q.number(n)},e,n,!0)},">=":function(e,n){return U(function(e,n){return q.number(e)>=q.number(n)},e,n,!0)},and:function(e,n){return q["boolean"](e)&&q["boolean"](n)},or:function(e,n){return q["boolean"](e)||q["boolean"](n)},"|":function(e,n){return{nodes:k(e.nodes,n.nodes)}},"=":function(e,n){var t,r,o;if("object"==typeof e&&"object"==typeof n){for(t={},r=0;r<e.nodes.length;++r)o=q.string({nodes:[e.nodes[r]]}),t[o]=!0;for(r=0;r<n.nodes.length;++r)if(o=q.string({nodes:[n.nodes[r]]}),t[o])return!0;return!1}return U(function(e,n){return e===n},e,n)},"!=":function(e,n){var t,r,o;if("object"==typeof e&&"object"==typeof n){if(0===e.nodes.length||0===n.nodes.length)return!1;for(t={},r=0;r<e.nodes.length;++r)o=q.string({nodes:[e.nodes[r]]}),t[o]=!0;for(r=0;r<n.nodes.length;++r)if(o=q.string({nodes:[n.nodes[r]]}),!t[o])return!0;return!1}return U(function(e,n){return e!==n},e,n)}},G=j.nodeTypes={node:0,attribute:2,comment:8,text:3,"processing-instruction":7,element:1},j.stringifyObject=function(e){function n(e){var r,o;if(Array.isArray(e))return e.map(function(e){return n(e)});if("object"!=typeof e)return e;if(null==e)return e;if(null!=e.outerHTML)return e.outerHTML;if(null!=e.nodeValue)return e.nodeName+"="+e.nodeValue;if(e[t])return"[circular]";e[t]=!0,r={};for(o in e)if(t!==o)try{r[o]=n(e[o])}catch(s){r[o]="[exception: "+s.message+"]"}return delete e[t],r}var t="seen"+Math.floor(1e9*Math.random());return JSON.stringify(n(e))},W=j.Evaluator=function(e){this.doc=e},W.prototype={val:function(e,n){var t,r,o,s,i,u,l,a,h,p,f,c,d,E,g,R,_,N,m;if(console.assert(n.nodes),"number"==typeof e||"string"==typeof e)return e;if($[e[0]]){for(t=[],r=1;r<e.length;++r)t.push(this.val(e[r],n));return o=$[e[0]].apply(n,t)}switch(e[0]){case"Root":return{nodes:[this.doc]};case"FunctionCall":if(s=e[1],i=e[2],null==q[s])throw new J(J.INVALID_EXPRESSION_ERR,"Unknown function: "+s);for(t=[],r=0;r<i.length;++r)t.push(this.val(i[r],n));return o=q[s].apply(n,t);case"Predicate":for(u=this.val(e[1],n),l={nodes:[]},a=T(u),r=0;r<a.length;++r)if(h=a[r],p=this.val(e[2],h),f="number"==typeof p?p===h.pos[0][0]:q["boolean"](p))for(c=h.nodes[0],l.nodes.push(c);r+1<a.length&&c===a[r+1].nodes[0];)r++;return l;case"PathExpr":if(d=this.val(e[1],n),d.finalize){for(r=0;r<d.nodes.length;++r)console.assert(null!=d.nodes[r].nodeType);return{nodes:d.nodes}}return d;case"/":return u=this.val(e[1],n),console.assert(null!=u),o=this.val(e[2],u),console.assert(null!=o),o;case"Axis":return E=e[1],g=e[2],R=G[g],_=!0,N=e[3]&&_?e[3].toLowerCase():e[3],N="*"===N?null:N,"object"!=typeof n?{nodes:[],pos:[]}:(m=n.nodes.slice(),o=F[E](m,R,N,_))}}},j.evaluate=function(e,n,t){var r=new C(e),o=H(r,B),s=new W(n).val(o,{nodes:[t]});return s},J=j.XPathException=function(e,n){var t=Error(n);this.__proto__=t,this.name="XPathException",this.code=e},J.prototype=Error.prototype,J.prototype.__proto__=J,J.INVALID_EXPRESSION_ERR=51,J.TYPE_ERR=52,Q=j.XPathEvaluator=function(){},Q.prototype={createExpression:function(e,n){return new Z(e,n)},createNSResolver:function(){},evaluate:function(e,n,t,r,o){var s=new Z(e,t);return s.evaluate(n,r,o)}},Z=j.XPathExpression=function(e,n,t){var r=new C(e);this._ast=H(r,B),this._doc=t},Z.prototype={evaluate:function(e,n){var t,r,o;if(null==e.nodeType)throw Error("bad argument (expected context node): "+e);if(t=e.ownerDocument||e,null!=this._doc&&this._doc!==t)throw new M.DOMException(M.WRONG_DOCUMENT_ERR,"The document must be the same as the context node's document.");if(r=new W(t),o=r.val(this._ast,{nodes:[e]}),K.NUMBER_TYPE===n)o=q.number(o);else if(K.STRING_TYPE===n)o=q.string(o);else if(K.BOOLEAN_TYPE===n)o=q["boolean"](o);else{if(K.ANY_TYPE!==n&&K.UNORDERED_NODE_ITERATOR_TYPE!==n&&K.ORDERED_NODE_ITERATOR_TYPE!==n&&K.UNORDERED_NODE_SNAPSHOT_TYPE!==n&&K.ORDERED_NODE_SNAPSHOT_TYPE!==n&&K.ANY_UNORDERED_NODE_TYPE!==n&&K.FIRST_ORDERED_NODE_TYPE!==n)throw new M.DOMException(M.NOT_SUPPORTED_ERR,"You must provide an XPath result type (0=any).");if(K.ANY_TYPE!==n&&"object"!=typeof o)throw new J(J.TYPE_ERR,"Value should be a node-set: "+o)}return new K(t,o,n)}},K=j.XPathResult=function on(e,n,t){function r(){o._invalidated=!0,e.removeEventListener("DOMSubtreeModified",r,!0)}if(this._value=n,this._resultType=t,this._i=0,this._invalidated=!1,this.resultType===on.UNORDERED_NODE_ITERATOR_TYPE||this.resultType===on.ORDERED_NODE_ITERATOR_TYPE){e.addEventListener("DOMSubtreeModified",r,!0);var o=this}},K.ANY_TYPE=0,K.NUMBER_TYPE=1,K.STRING_TYPE=2,K.BOOLEAN_TYPE=3,K.UNORDERED_NODE_ITERATOR_TYPE=4,K.ORDERED_NODE_ITERATOR_TYPE=5,K.UNORDERED_NODE_SNAPSHOT_TYPE=6,K.ORDERED_NODE_SNAPSHOT_TYPE=7,K.ANY_UNORDERED_NODE_TYPE=8,K.FIRST_ORDERED_NODE_TYPE=9,K.prototype={get resultType(){if(this._resultType)return this._resultType;switch(typeof this._value){case"number":return K.NUMBER_TYPE;case"string":return K.STRING_TYPE;case"boolean":return K.BOOLEAN_TYPE;default:return K.UNORDERED_NODE_ITERATOR_TYPE}},get numberValue(){if(K.NUMBER_TYPE!==this.resultType)throw new J(J.TYPE_ERR,"You should have asked for a NUMBER_TYPE.");return this._value},get stringValue(){if(K.STRING_TYPE!==this.resultType)throw new J(J.TYPE_ERR,"You should have asked for a STRING_TYPE.");return this._value},get booleanValue(){if(K.BOOLEAN_TYPE!==this.resultType)throw new J(J.TYPE_ERR,"You should have asked for a BOOLEAN_TYPE.");return this._value},get singleNodeValue(){if(K.ANY_UNORDERED_NODE_TYPE!==this.resultType&&K.FIRST_ORDERED_NODE_TYPE!==this.resultType)throw new J(J.TYPE_ERR,"You should have asked for a FIRST_ORDERED_NODE_TYPE.");return this._value.nodes[0]||null},get invalidIteratorState(){return K.UNORDERED_NODE_ITERATOR_TYPE!==this.resultType&&K.ORDERED_NODE_ITERATOR_TYPE!==this.resultType?!1:!!this._invalidated},get snapshotLength(){if(K.UNORDERED_NODE_SNAPSHOT_TYPE!==this.resultType&&K.ORDERED_NODE_SNAPSHOT_TYPE!==this.resultType)throw new J(J.TYPE_ERR,"You should have asked for a ORDERED_NODE_SNAPSHOT_TYPE.");return this._value.nodes.length},iterateNext:function(){if(K.UNORDERED_NODE_ITERATOR_TYPE!==this.resultType&&K.ORDERED_NODE_ITERATOR_TYPE!==this.resultType)throw new J(J.TYPE_ERR,"You should have asked for a ORDERED_NODE_ITERATOR_TYPE.");if(this.invalidIteratorState)throw new M.DOMException(M.INVALID_STATE_ERR,"The document has been mutated since the result was returned");return this._value.nodes[this._i++]||null},snapshotItem:function(e){if(K.UNORDERED_NODE_SNAPSHOT_TYPE!==this.resultType&&K.ORDERED_NODE_SNAPSHOT_TYPE!==this.resultType)throw new J(J.TYPE_ERR,"You should have asked for a ORDERED_NODE_SNAPSHOT_TYPE.");return this._value.nodes[e]||null}},K.prototype.__proto__=K,M.XPathException=J,M.XPathExpression=Z,M.XPathResult=K,M.XPathEvaluator=Q,M.Document.prototype.createExpression=Q.prototype.createExpression,M.Document.prototype.createNSResolver=Q.prototype.createNSResolver,M.Document.prototype.evaluate=Q.prototype.evaluate}();