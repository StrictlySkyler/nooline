// Copyright 2010-2012 Mikeal Rogers
//
//    Licensed under the Apache License, Version 2.0 (the "License");
//    you may not use this file except in compliance with the License.
//    You may obtain a copy of the License at
//
//        http://www.apache.org/licenses/LICENSE-2.0
//
//    Unless required by applicable law or agreed to in writing, software
//    distributed under the License is distributed on an "AS IS" BASIS,
//    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//    See the License for the specific language governing permissions and
//    limitations under the License.

function initParams(e,t,o){return"function"!=typeof t||o||(o=t),t&&"object"==typeof t?t.uri=e:"string"==typeof e?t={uri:e}:(t=e,e=t.uri),{uri:e,options:t,callback:o}}function request(e,t,o){if(void 0===e)throw Error("undefined is not a valid uri or options object.");"function"!=typeof t||o||(o=t),t&&"object"==typeof t?t.uri=e:t="string"==typeof e?{uri:e}:e,t=copy(t),o&&(t.callback=o);var r=new Request(t);return r}var Cookie=null,CookieJar=Cookie.Jar,cookieJar=new CookieJar,copy=null,Request=null;module.exports=request,request.Request=Request,request.debug=process.env.NODE_DEBUG&&/request/.test(process.env.NODE_DEBUG),request.initParams=initParams,request.defaults=function(e,t){var o=function(o){var r=function(r,n,u){var i,s=initParams(r,n,u);for(i in e)void 0===s.options[i]&&(s.options[i]=e[i]);return"function"==typeof t&&(o===request?o=t:s.options._requester=t),o(s.options,s.callback)};return r},r=o(request);return r.get=o(request.get),r.patch=o(request.patch),r.post=o(request.post),r.put=o(request.put),r.head=o(request.head),r.del=o(request.del),r.cookie=o(request.cookie),r.jar=request.jar,r},request.forever=function(e,t){var o={};if(t)for(option in t)o[option]=t[option];return e&&(o.agentOptions=e),o.forever=!0,request.defaults(o)},request.get=request,request.post=function(e,t,o){var r=initParams(e,t,o);return r.options.method="POST",request(r.uri||null,r.options,r.callback)},request.put=function(e,t,o){var r=initParams(e,t,o);return r.options.method="PUT",request(r.uri||null,r.options,r.callback)},request.patch=function(e,t,o){var r=initParams(e,t,o);return r.options.method="PATCH",request(r.uri||null,r.options,r.callback)},request.head=function(e,t,o){var r=initParams(e,t,o);if(r.options.method="HEAD",r.options.body||r.options.requestBodyStream||r.options.json&&"boolean"!=typeof r.options.json||r.options.multipart)throw Error("HTTP HEAD requests MUST NOT include a request body.");return request(r.uri||null,r.options,r.callback)},request.del=function(e,t,o){var r=initParams(e,t,o);return r.options.method="DELETE","function"==typeof r.options._requester&&(request=r.options._requester),request(r.uri||null,r.options,r.callback)},request.jar=function(){return new CookieJar},request.cookie=function(e){if(e&&e.uri&&(e=e.uri),"string"!=typeof e)throw Error("The cookie function only accepts STRING as param");return new Cookie(e)};