var ca,agent,fs=require("fs"),https=require("https"),options={key:fs.readFileSync("./server.key"),cert:fs.readFileSync("./server.crt")},server=https.createServer(options,function(e,t){t.writeHead(200),t.end(),server.close()});server.listen(1337),ca=fs.readFileSync("./ca.crt"),agent=new https.Agent({host:"localhost",port:1337,ca:ca}),https.request({host:"localhost",method:"HEAD",port:1337,headers:{host:"testing.request.mikealrogers.com"},agent:agent,ca:[ca],path:"/"},function(e){if(!e.client.authorized)throw Error(e.client.authorizationError);console.log("node test: OK")}).end();