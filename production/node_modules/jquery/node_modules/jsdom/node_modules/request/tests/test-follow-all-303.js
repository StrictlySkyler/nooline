var request=null,http=null,requests=0,assert=null,server=http.createServer(function(e,r){console.error(e.method,e.url),requests++,"POST"===e.method?(console.error("send 303"),r.setHeader("location",e.url),r.statusCode=303,r.end("try again, i guess\n")):(console.error("send 200"),r.end("ok: "+requests))});server.listen(6767),request.post({url:"http://localhost:6767/foo",followAllRedirects:!0,form:{foo:"bar"}},function(e,r,s){if(e)throw e;assert.equal(s,"ok: 2"),assert.equal(requests,2),console.error("ok - "+process.version),server.close()});