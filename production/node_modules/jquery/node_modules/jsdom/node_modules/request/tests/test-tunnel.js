function notInstalled(){console.error("squid must be installed to run this test."),console.error("skipping this test. please install squid and run again if you need to test tunneling."),c=null,hadError=null,process.exit(0)}var server=null,assert=null,request=null,fs=null,path=null,caFile=path.resolve(__dirname,"ssl/npm-ca.crt"),ca=fs.readFileSync(caFile),child_process=null,sqConf=path.resolve(__dirname,"squid.conf"),sqArgs=["-f",sqConf,"-N","-d","5"],proxy="http://localhost:3128",hadError=null,squid=child_process.spawn("squid",sqArgs),ready=!1;squid.stderr.on("data",function(r){console.error("SQUIDERR "+(""+r).trim().split("\n").join("\nSQUIDERR ")),ready=(""+r).match(/ready to serve requests|Accepting HTTP Socket connections/i)}),squid.stdout.on("data",function(r){console.error("SQUIDOUT "+(""+r).trim().split("\n").join("\nSQUIDOUT "))}),squid.on("error",function(r){return console.error("squid: error "+r),r&&!ready?(notInstalled(),void 0):void 0}),squid.on("exit",function(r){if(console.error("squid: exit "+r),r&&!ready)return notInstalled(),void 0;if(r&&(hadError=hadError||Error("Squid exited with "+r)),hadError)throw hadError}),setTimeout(function r(){return ready?(request({uri:"https://registry.npmjs.org/",proxy:"http://localhost:3128",strictSSL:!0,ca:ca,json:!0},function(r,o){hadError=r,console.log(r||typeof o),r||console.log("ok"),squid.kill("SIGKILL")}),void 0):setTimeout(r,100)},100);