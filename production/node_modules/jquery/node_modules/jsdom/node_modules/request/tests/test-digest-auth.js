var assert=null,http=null,request=null,numDigestRequests=0,digestServer=http.createServer(function(e,t){console.error("Digest auth server: ",e.method,e.url),numDigestRequests++;var s;e.headers.authorization?s='Digest username="test", realm="Private", nonce="WpcHS2/TBAA=dffcc0dbd5f96d49a5477166649b7c0ae3866a93", uri="/test/", qop="auth", response="54753ce37c10cb20b09b769f0bed730e", nc="1", cnonce=""'==e.headers.authorization?!0:!1:(s=!1,t.setHeader("www-authenticate",'Digest realm="Private", nonce="WpcHS2/TBAA=dffcc0dbd5f96d49a5477166649b7c0ae3866a93", algorithm=MD5, qop="auth"')),s?(console.log("request ok"),t.end("ok")):(console.log("status=401"),t.statusCode=401,t.end("401"))});digestServer.listen(6767),request({method:"GET",uri:"http://localhost:6767/test/",auth:{user:"test",pass:"testing",sendImmediately:!1}},function(e,t){assert.equal(t.statusCode,200),assert.equal(numDigestRequests,2),request({method:"GET",uri:"http://localhost:6767/test/",auth:{user:"test",pass:"testing"}},function(e,t){assert.equal(t.statusCode,401),assert.equal(numDigestRequests,3),console.log("All tests passed"),digestServer.close()})});