var assert=null,http=null,path=null,mime=null,request=null,fs=null,remoteFile="http://nodejs.org/images/logo.png",FIELDS=[{name:"my_field",value:"my_value"},{name:"my_buffer",value:new Buffer([1,2,3])},{name:"my_file",value:fs.createReadStream(__dirname+"/unicycle.jpg")},{name:"remote_file",value:request(remoteFile)}],server=http.createServer(function(e,a){var n="";e.setEncoding("utf8"),e.on("data",function(e){n+=e}),e.on("end",function(){var e=FIELDS.shift();assert.ok(-1!=n.indexOf('form-data; name="'+e.name+'"')),assert.ok(-1!=n.indexOf(e.value)),e=FIELDS.shift(),assert.ok(-1!=n.indexOf('form-data; name="'+e.name+'"')),assert.ok(-1!=n.indexOf(e.value)),e=FIELDS.shift(),assert.ok(-1!=n.indexOf('form-data; name="'+e.name+'"')),assert.ok(-1!=n.indexOf('; filename="'+path.basename(e.value.path)+'"')),assert.ok(-1!=n.indexOf("2005:06:21 01:44:12")),assert.ok(-1!=n.indexOf("Content-Type: "+mime.lookup(e.value.path))),e=FIELDS.shift(),assert.ok(-1!=n.indexOf('form-data; name="'+e.name+'"')),assert.ok(-1!=n.indexOf('; filename="'+path.basename(e.value.path)+'"')),assert.ok(-1!=n.indexOf("ImageReady")),assert.ok(-1!=n.indexOf("Content-Type: "+mime.lookup(remoteFile))),a.writeHead(200),a.end("done")})});server.listen(8080,function(){var e=request.post("http://localhost:8080/upload",function(){server.close()}),a=e.form();FIELDS.forEach(function(e){a.append(e.name,e.value)})}),process.on("exit",function(){assert.strictEqual(FIELDS.length,0)});