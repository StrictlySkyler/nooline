var request=null,http=null,requests=0,assert=null,server=http.createServer(function(e,r){requests++;var s=e.headers.cookie;return s=s?+s.split("=")[1]||0:0,s>3?(r.end("ok: "+requests),void 0):(r.setHeader("set-cookie","c="+(s+1)),r.setHeader("location",e.url),r.statusCode=302,r.end("try again, i guess\n"),void 0)});server.listen(6767),request.post({url:"http://localhost:6767/foo",followAllRedirects:!0,jar:!0,form:{foo:"bar"}},function(e,r,s){if(e)throw e;assert.equal(s,"ok: 5"),assert.equal(requests,5),console.error("ok - "+process.version),server.close()});