var http=null,assert=null,request=null,server=http.createServer(function(t,e){if(e.statusCode=200,"/get"===t.url)return assert.equal(t.method,"GET"),e.write("content"),e.end(),void 0;if("/put"===t.url){var r="";return assert.equal(t.method,"PUT"),t.on("data",function(t){r+=t}),t.on("end",function(){assert.equal(r,"content"),e.write("success"),e.end()}),void 0}if("/proxy"===t.url)return assert.equal(t.method,"PUT"),t.pipe(request("http://localhost:8080/put")).pipe(e);if("/test"===t.url)return request("http://localhost:8080/get").pipe(request.put("http://localhost:8080/proxy")).pipe(e);throw Error("Unknown url",t.url)}).listen(8080,function(){request("http://localhost:8080/test",function(t,e,r){if(t)throw t;if(200!==e.statusCode)throw Error("statusCode not 200 "+e.statusCode);assert.equal(r,"success"),server.close()})});