var Url=null,Hoek=null,Cryptiles=null,Crypto=null,Utils=null,internals={};exports.header=function(t,e,a){var o,r,s,l,n,i,h={field:"",artifacts:{}};return t&&("string"==typeof t||"object"==typeof t)&&e&&"string"==typeof e&&a&&"object"==typeof a?(o=a.timestamp||Math.floor((Utils.now()+(a.localtimeOffsetMsec||0))/1e3),r=a.credentials,r&&r.id&&r.key&&r.algorithm?-1===Crypto.algorithms.indexOf(r.algorithm)?h:("string"==typeof t&&(t=Url.parse(t)),s={ts:o,nonce:a.nonce||Cryptiles.randomString(6),method:e,resource:t.pathname+(t.search||""),host:t.hostname,port:t.port||("http:"===t.protocol?80:443),hash:a.hash,ext:a.ext,app:a.app,dlg:a.dlg},h.artifacts=s,!s.hash&&a.hasOwnProperty("payload")&&(s.hash=Crypto.calculatePayloadHash(a.payload,r.algorithm,a.contentType)),l=Crypto.calculateMac("header",r,s),n=null!==s.ext&&void 0!==s.ext&&""!==s.ext,i='Hawk id="'+r.id+'", ts="'+s.ts+'", nonce="'+s.nonce+(s.hash?'", hash="'+s.hash:"")+(n?'", ext="'+Utils.escapeHeaderAttribute(s.ext):"")+'", mac="'+l+'"',s.app&&(i+=', app="'+s.app+(s.dlg?'", dlg="'+s.dlg:"")+'"'),h.field=i,h):h):h},exports.authenticate=function(t,e,a,o){var r,s,l,n;if(a=Hoek.clone(a),o=o||{},t.headers["www-authenticate"]){if(r=Utils.parseAuthorizationHeader(t.headers["www-authenticate"],["ts","tsm","error"]),r instanceof Error)return!1;if(r.ts&&(s=Crypto.calculateTsMac(r.ts,e),s!==r.tsm))return!1}return t.headers["server-authorization"]||o.required?(r=Utils.parseAuthorizationHeader(t.headers["server-authorization"],["mac","ext","hash"]),r instanceof Error?!1:(a.ext=r.ext,a.hash=r.hash,l=Crypto.calculateMac("response",e,a),l!==r.mac?!1:o.hasOwnProperty("payload")?r.hash?(n=Crypto.calculatePayloadHash(o.payload,e.algorithm,t.headers["content-type"]),n===r.hash):!1:!0)):!0},exports.getBewit=function(t,e){var a,o,r,s,l;return t&&("string"==typeof t||"object"==typeof t)&&e&&"object"==typeof e&&e.ttlSec?(e.ext=null===e.ext||void 0===e.ext?"":e.ext,a=Utils.now()+(e.localtimeOffsetMsec||0),o=e.credentials,o&&o.id&&o.key&&o.algorithm?-1===Crypto.algorithms.indexOf(o.algorithm)?"":("string"==typeof t&&(t=Url.parse(t)),r=Math.floor(a/1e3)+e.ttlSec,s=Crypto.calculateMac("bewit",o,{ts:r,nonce:"",method:"GET",resource:t.pathname+(t.search||""),host:t.hostname,port:t.port||("http:"===t.protocol?80:443),ext:e.ext}),l=o.id+"\\"+r+"\\"+s+"\\"+e.ext,Utils.base64urlEncode(l)):""):""},exports.message=function(t,e,a,o){var r,s,l,n;return t&&"string"==typeof t&&e&&"number"==typeof e&&null!==a&&void 0!==a&&"string"==typeof a&&o&&"object"==typeof o?(r=o.timestamp||Math.floor((Utils.now()+(o.localtimeOffsetMsec||0))/1e3),s=o.credentials,s&&s.id&&s.key&&s.algorithm?-1===Crypto.algorithms.indexOf(s.algorithm)?null:(l={ts:r,nonce:o.nonce||Cryptiles.randomString(6),host:t,port:e,hash:Crypto.calculatePayloadHash(a,s.algorithm)},n={id:s.id,ts:l.ts,nonce:l.nonce,hash:l.hash,mac:Crypto.calculateMac("message",s,l)}):null):null};