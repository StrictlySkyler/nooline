/*!
 * knox - auth
 * Copyright(c) 2010 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

function authorization(e){return"AWS "+e.key+":"+sign(e)}function hmacSha1(e){return crypto.createHmac("sha1",e.secret).update(e.message).digest("base64")}function sign(e){return e.message=stringToSign(e),hmacSha1(e)}function signQuery(e){return e.message=queryStringToSign(e),hmacSha1(e)}function stringToSign(e){var n,r=e.amazonHeaders||"";return r&&(r+="\n"),n=[e.verb,e.md5,e.contentType,e.date.toUTCString(),r+e.resource],n.join("\n")}function queryStringToSign(e){return"GET\n\n\n"+e.date+"\n"+e.resource}function canonicalizeHeaders(e){var n,r,o,t,i=[],a=Object.keys(e);for(n=0,r=a.length;r>n;++n)o=a[n],t=e[o],o=o.toLowerCase(),0===o.indexOf("x-amz")&&i.push(o+":"+t);return i.sort().join("\n")}function canonicalizeResource(e){var n=parse(e,!0),r=n.pathname,o=[];return Object.keys(n.query).forEach(function(e){if(~keys.indexOf(e)){var r=""==n.query[e]?"":"="+encodeURIComponent(n.query[e]);o.push(e+r)}}),r+(o.length?"?"+o.sort().join("&"):"")}var crypto=null,parse=null.parse,keys=["acl","location","logging","notification","partNumber","policy","requestPayment","torrent","uploadId","uploads","versionId","versioning","versions","website"];module.exports=authorization,module.exports.authorization=authorization,module.exports.hmacSha1=hmacSha1,module.exports.sign=sign,module.exports.signQuery=signQuery,module.exports.queryStringToSign=stringToSign,module.exports.queryStringToSign=queryStringToSign,module.exports.canonicalizeHeaders=canonicalizeHeaders,module.exports.canonicalizeResource=canonicalizeResource;