function ForeverAgent(e){var t=this;t.options=e||{},t.requests={},t.sockets={},t.freeSockets={},t.maxSockets=t.options.maxSockets||Agent.defaultMaxSockets,t.minSockets=t.options.minSockets||ForeverAgent.defaultMinSockets,t.on("free",function(e,o,r){function s(){e.destroy()}var n=o+":"+r;t.requests[n]&&t.requests[n].length?t.requests[n].shift().onSocket(e):t.sockets[n].length<t.minSockets?(t.freeSockets[n]||(t.freeSockets[n]=[]),t.freeSockets[n].push(e),e._onIdleError=s,e.on("error",s)):e.destroy()})}function ForeverAgentSSL(e){ForeverAgent.call(this,e)}function createConnectionSSL(e,t,o){return o="object"==typeof e?e:"object"==typeof t?t:"object"==typeof o?o:{},"number"==typeof e&&(o.port=e),"string"==typeof t&&(o.host=t),tls.connect(o)}module.exports=ForeverAgent,ForeverAgent.SSL=ForeverAgentSSL;var util=null,Agent=null.Agent,net=null,tls=null,AgentSSL=null.Agent;util.inherits(ForeverAgent,Agent),ForeverAgent.defaultMinSockets=5,ForeverAgent.prototype.createConnection=net.createConnection,ForeverAgent.prototype.addRequestNoreuse=Agent.prototype.addRequest,ForeverAgent.prototype.addRequest=function(e,t,o){var r,s=t+":"+o;this.freeSockets[s]&&this.freeSockets[s].length>0&&!e.useChunkedEncodingByDefault?(r=this.freeSockets[s].pop(),r.removeListener("error",r._onIdleError),delete r._onIdleError,e._reusedSocket=!0,e.onSocket(r)):this.addRequestNoreuse(e,t,o)},ForeverAgent.prototype.removeSocket=function(e,t,o,r){var s;this.sockets[t]?(s=this.sockets[t].indexOf(e),-1!==s&&this.sockets[t].splice(s,1)):this.sockets[t]&&0===this.sockets[t].length&&(delete this.sockets[t],delete this.requests[t]),this.freeSockets[t]&&(s=this.freeSockets[t].indexOf(e),-1!==s&&(this.freeSockets[t].splice(s,1),0===this.freeSockets[t].length&&delete this.freeSockets[t])),this.requests[t]&&this.requests[t].length&&this.createSocket(t,o,r).emit("free")},util.inherits(ForeverAgentSSL,ForeverAgent),ForeverAgentSSL.prototype.createConnection=createConnectionSSL,ForeverAgentSSL.prototype.addRequestNoreuse=AgentSSL.prototype.addRequest;