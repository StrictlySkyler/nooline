var Fs=null,Escape=null,internals={};exports.clone=function(e,r){var t,n,o,a;if("object"!=typeof e||null===e)return e;if(r=r||{orig:[],copy:[]},t=r.orig.indexOf(e),-1!==t)return r.copy[t];n=e instanceof Array?[]:{},r.orig.push(e),r.copy.push(n);for(o in e)e.hasOwnProperty(o)&&(e[o]instanceof Buffer?n[o]=new Buffer(e[o]):e[o]instanceof Date?n[o]=new Date(e[o].getTime()):e[o]instanceof RegExp?(a=""+(e[o].global?"g":"")+(e[o].ignoreCase?"i":"")+(e[o].multiline?"m":""),n[o]=RegExp(e[o].source,a)):n[o]=exports.clone(e[o],r));return n},exports.merge=function(e,r,t,n){var o,a,s,c,u,i,p;if(exports.assert(e&&"object"==typeof e,"Invalid target value: must be an object"),exports.assert(null===r||void 0===r||"object"==typeof r,"Invalid source value: must be null, undefined, or an object"),!r)return e;if(r instanceof Array){for(exports.assert(e instanceof Array,"Cannot merge array onto an object"),n===!1&&(e.length=0),o=0,a=r.length;a>o;++o)e.push(r[o]);return e}for(s=Object.keys(r),c=0,u=s.length;u>c;++c)i=s[c],p=r[i],p&&"object"==typeof p?e[i]&&"object"==typeof e[i]?exports.merge(e[i],r[i],t,n):e[i]=exports.clone(p):null!==p&&void 0!==p?e[i]=p:t!==!1&&(e[i]=p);return e},exports.applyToDefaults=function(e,r){if(exports.assert(e&&"object"==typeof e,"Invalid defaults value: must be an object"),exports.assert(!r||r===!0||"object"==typeof r,"Invalid options value: must be true, falsy or an object"),!r)return null;var t=exports.clone(e);return r===!0?t:exports.merge(t,r,!1,!1)},exports.unique=function(e,r){var t,n,o,a={},s=[];for(t=0,n=e.length;n>t;++t)o=r?e[t][r]:e[t],a[o]!==!0&&(s.push(e[t]),a[o]=!0);return s},exports.mapToObject=function(e,r){var t,n,o;if(!e)return null;for(t={},n=0,o=e.length;o>n;++n)r?e[n][r]&&(t[e[n][r]]=!0):t[e[n]]=!0;return t},exports.intersect=function(e,r,t){var n,o,a,s,c;if(!e||!r)return[];for(n=[],o=e instanceof Array?exports.mapToObject(e):e,a={},s=0,c=r.length;c>s;++s)if(o[r[s]]&&!a[r[s]]){if(t)return r[s];n.push(r[s]),a[r[s]]=!0}return t?null:n},exports.matchKeys=function(e,r){var t,n,o=[];for(t=0,n=r.length;n>t;++t)e.hasOwnProperty(r[t])&&o.push(r[t]);return o},exports.flatten=function(e,r){var t,n,o=r||[];for(t=0,n=e.length;n>t;++t)Array.isArray(e[t])?exports.flatten(e[t],o):o.push(e[t]);return o},exports.removeKeys=function(e,r){for(var t=0,n=r.length;n>t;t++)delete e[r[t]]},exports.reach=function(e,r){var t,n,o=r.split("."),a=e;for(t=0,n=o.length;n>t;++t)a&&(a=a[o[t]]);return a},exports.inheritAsync=function(e,r,t){t=t||null;for(var n in r)if(r.hasOwnProperty(n)){if(t instanceof Array&&t.indexOf(n)<0)continue;e.prototype[n]=function(e){return function(r){var t=null;try{t=e()}catch(n){return r(n)}return r(null,t)}}(r[n])}},exports.formatStack=function(e){var r,t,n,o=[];for(r=0,t=e.length;t>r;++r)n=e[r],o.push([n.getFileName(),n.getLineNumber(),n.getColumnNumber(),n.getFunctionName(),n.isConstructor()]);return o},exports.formatTrace=function(e){var r,t,n,o=[];for(r=0,t=e.length;t>r;++r)n=e[r],o.push((n[4]?"new ":"")+n[3]+" ("+n[0]+":"+n[1]+":"+n[2]+")");return o},exports.callStack=function(e){var r,t,n,o=Error.prepareStackTrace;return Error.prepareStackTrace=function(e,r){return r},r={},Error.captureStackTrace(r,arguments.callee),t=r.stack,Error.prepareStackTrace=o,n=exports.formatStack(t),e?n.slice(e):n},exports.displayStack=function(e){var r=exports.callStack(void 0===e?1:e+1);return exports.formatTrace(r)},exports.abortThrow=!1,exports.abort=function(e,r){if("test"===process.env.NODE_ENV||exports.abortThrow===!0)throw Error(e||"Unknown error");var t="";r||(t=exports.displayStack(1).join("\n	")),console.log("ABORT: "+e+"\n	"+t),process.exit(1)},exports.assert=function(e){if(!e){var r=Array.prototype.slice.call(arguments,1);throw r=r.map(function(e){return"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}),Error(r.join(" ")||"Unknown error")}},exports.loadDirModules=function(e,r,t){var n,o,a,s,c,u,i={};for(n=0,o=r.length;o>n;++n)i[r[n]+".js"]=!0;for(a=Fs.readdirSync(e),n=0,o=a.length;o>n;++n)s=a[n],/\.js$/.test(s)&&!i[s]&&(c=s.substr(0,s.lastIndexOf(".")),u=c.charAt(0).toUpperCase()+c.substr(1).toLowerCase(),"function"!=typeof t?t[u]=require(e+"/"+c):t(e+"/"+c,c,u))},exports.rename=function(e,r,t){e[t]=e[r],delete e[r]},exports.Timer=function(){this.reset()},exports.Timer.prototype.reset=function(){this.ts=Date.now()},exports.Timer.prototype.elapsed=function(){return Date.now()-this.ts},exports.loadPackage=function(e){var r={},t=(e||process.env.PWD)+"/package.json";if(Fs.existsSync(t))try{r=JSON.parse(Fs.readFileSync(t))}catch(n){}return r},exports.escapeRegex=function(e){return e.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")},exports.toss=function(e){var r=3===arguments.length?arguments[1]:"",t=3===arguments.length?arguments[2]:arguments[1],n=r instanceof Error?r:r?Error(r):e instanceof Error?e:Error();return e instanceof Error||!e?t(n):void 0},exports.base64urlEncode=function(e){return new Buffer(e,"binary").toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")},exports.base64urlDecode=function(e){if(e&&!e.match(/^[\w\-]*$/))return Error("Invalid character");try{return new Buffer(e.replace(/-/g,"+").replace(/:/g,"/"),"base64").toString("binary")}catch(r){return r}},exports.escapeHeaderAttribute=function(e){return exports.assert(e.match(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~\"\\]*$/),"Bad attribute value ("+e+")"),e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')},exports.escapeHtml=function(e){return Escape.escapeHtml(e)},exports.escapeJavaScript=function(e){return Escape.escapeJavaScript(e)},exports.consoleFunc=console.log,exports.printEvent=function(e){var r,t=function(e){return(10>e?"0":"")+e},n=new Date(e.timestamp),o=""+(n.getYear()-100)+t(n.getMonth()+1)+t(n.getDate())+"/"+t(n.getHours())+t(n.getMinutes())+t(n.getSeconds())+"."+n.getMilliseconds(),a=e.data;if("string"!=typeof e.data)try{a=JSON.stringify(e.data)}catch(s){a="JSON Error: "+s.message}r=o+", "+e.tags[0]+", "+a,exports.consoleFunc(r)},exports.nextTick=function(e){return function(){var r=arguments;process.nextTick(function(){e.apply(null,r)})}};