function FormData(){this._overheadLength=0,this._valueLength=0,this._lengthRetrievers=[],CombinedStream.call(this)}function populate(t,e){for(var r in e)t[r]||(t[r]=e[r]);return t}var CombinedStream=null,util=null,path=null,http=null,https=null,parseUrl=null.parse,fs=null,mime=null,async=null;module.exports=FormData,util.inherits(FormData,CombinedStream),FormData.LINE_BREAK="\r\n",FormData.prototype.append=function(t,e,r){var n,o,a;return r=r||{},n=CombinedStream.prototype.append.bind(this),"number"==typeof e&&(e=""+e),util.isArray(e)?(this._error(Error("Arrays are not supported.")),void 0):(o=this._multiPartHeader(t,e,r),a=this._multiPartFooter(t,e,r),n(o),n(e),n(a),this._trackLength(o,e,r),void 0)},FormData.prototype._trackLength=function(t,e,r){var n=0;null!=r.knownLength?n+=+r.knownLength:Buffer.isBuffer(e)?n=e.length:"string"==typeof e&&(n=Buffer.byteLength(e)),this._valueLength+=n,this._overheadLength+=Buffer.byteLength(t)+ +FormData.LINE_BREAK.length,e&&(e.path||e.readable&&e.hasOwnProperty("httpVersion"))&&(r.knownLength||this._lengthRetrievers.push(function(t){e.hasOwnProperty("fd")?fs.stat(e.path,function(e,r){return e?(t(e),void 0):(t(null,r.size),void 0)}):e.hasOwnProperty("httpVersion")?t(null,+e.headers["content-length"]):e.hasOwnProperty("httpModule")?(e.on("response",function(r){e.pause(),t(null,+r.headers["content-length"])}),e.resume()):t("Unknown stream")}))},FormData.prototype._multiPartHeader=function(t,e,r){var n=this.getBoundary(),o="";return null!=r.header?o=r.header:(o+="--"+n+FormData.LINE_BREAK+'Content-Disposition: form-data; name="'+t+'"',r.filename||e.path?o+='; filename="'+path.basename(r.filename||e.path)+'"'+FormData.LINE_BREAK+"Content-Type: "+(r.contentType||mime.lookup(r.filename||e.path)):e.readable&&e.hasOwnProperty("httpVersion")&&(o+='; filename="'+path.basename(e.client._httpMessage.path)+'"'+FormData.LINE_BREAK+"Content-Type: "+e.headers["content-type"]),o+=FormData.LINE_BREAK+FormData.LINE_BREAK),o},FormData.prototype._multiPartFooter=function(){return function(t){var e=FormData.LINE_BREAK,r=0===this._streams.length;r&&(e+=this._lastBoundary()),t(e)}.bind(this)},FormData.prototype._lastBoundary=function(){return"--"+this.getBoundary()+"--"},FormData.prototype.getHeaders=function(t){var e,r={"content-type":"multipart/form-data; boundary="+this.getBoundary()};for(e in t)r[e.toLowerCase()]=t[e];return r},FormData.prototype.getCustomHeaders=function(t){t=t?t:"multipart/form-data";var e={"content-type":t+"; boundary="+this.getBoundary(),"content-length":this.getLengthSync()};return e},FormData.prototype.getBoundary=function(){return this._boundary||this._generateBoundary(),this._boundary},FormData.prototype._generateBoundary=function(){var t,e="--------------------------";for(t=0;24>t;t++)e+=Math.floor(10*Math.random()).toString(16);this._boundary=e},FormData.prototype.getLengthSync=function(){var t=this._overheadLength+this._valueLength;return this._streams.length&&(t+=this._lastBoundary().length),this._lengthRetrievers.length&&this._error(Error("Cannot calculate proper length in synchronous way.")),t},FormData.prototype.getLength=function(t){var e=this._overheadLength+this._valueLength;return this._streams.length&&(e+=this._lastBoundary().length),this._lengthRetrievers.length?(async.parallel(this._lengthRetrievers,function(r,n){return r?(t(r),void 0):(n.forEach(function(t){e+=t}),t(null,e),void 0)}),void 0):(process.nextTick(t.bind(this,null,e)),void 0)},FormData.prototype.submit=function(t,e){var r,n,o={method:"post",headers:this.getHeaders()};return"string"==typeof t?(t=parseUrl(t),n=populate({port:t.port,path:t.pathname,host:t.hostname},o)):(n=populate(t,o),n.port||(n.port="https:"==n.protocol?443:80)),r="https:"==t.protocol?https.request(n):http.request(n),this.getLength(function(t,n){r.setHeader("Content-Length",n),this.pipe(r),e&&(r.on("error",e),r.on("response",e.bind(this,null)))}.bind(this)),r},FormData.prototype._error=function(t){this.error||(this.error=t,this.pause(),this.emit("error",t))};