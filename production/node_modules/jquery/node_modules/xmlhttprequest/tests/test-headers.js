var sys=require("util"),assert=require("assert"),XMLHttpRequest=require("../lib/XMLHttpRequest").XMLHttpRequest,xhr=new XMLHttpRequest,http=require("http"),server=http.createServer(function(e,t){assert.equal("Foobar",e.headers["x-test"]);var s="Hello World";t.writeHead(200,{"Content-Type":"text/plain","Content-Length":Buffer.byteLength(s),"Set-Cookie":"foo=bar","Set-Cookie2":"bar=baz",Connection:"close"}),t.write("Hello World"),t.end(),this.close()}).listen(8e3);xhr.onreadystatechange=function(){if(4==this.readyState){var e="content-type: text/plain\r\ncontent-length: 11\r\nconnection: close";assert.equal(e,this.getAllResponseHeaders()),assert.equal("text/plain",this.getResponseHeader("Content-Type")),assert.equal("text/plain",this.getResponseHeader("Content-type")),assert.equal("text/plain",this.getResponseHeader("content-Type")),assert.equal("text/plain",this.getResponseHeader("content-type")),this.abort(),assert.equal("",this.getAllResponseHeaders()),assert.equal(null,this.getResponseHeader("Connection")),sys.puts("done")}},assert.equal(null,xhr.getResponseHeader("Content-Type"));try{xhr.open("GET","http://localhost:8000/"),xhr.setRequestHeader("X-Test","Foobar"),xhr.setRequestHeader("Content-Length",0),assert.equal("Foobar",xhr.getRequestHeader("X-Test")),xhr.send()}catch(e){console.log("ERROR: Exception raised",e)}