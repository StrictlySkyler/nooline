var Contextify=null;exports["basic tests"]={"blank context":function(t){var e=Contextify({});t.notEqual(e,null),t.notEqual(e,void 0),t.done()},"basic context":function(t){var e={prop1:"prop1",prop2:"prop2"};Contextify(e),t.equal(e.prop1,"prop1"),t.equal(e.prop2,"prop2"),t.done()},"basic createContext":function(t){var e={prop1:"prop1",prop2:"prop2"};Contextify.createContext(e),t.equal(e.prop1,"prop1"),t.equal(e.prop2,"prop2"),t.done()},"test contextified object extra properties":function(t){var e=Contextify({});t.notEqual(e.run,void 0),t.notEqual(e.getGlobal,void 0),t.notEqual(e.dispose,void 0),t.done()},"createContext should not modify the sandbox":function(t){var e={};Contextify.createContext(e),t.equal(e.run,void 0),t.equal(e.getGlobal,void 0),t.equal(e.dispose,void 0),t.done()},"test undefined sandbox":function(t){t.notEqual(Contextify(void 0,void 0),void 0),t.notEqual(Contextify(),void 0),t.done()},"sandbox prototype properties should be searched":function(t){var e={};e.__proto__={prop1:"test"},Contextify(e),t.equal(e.getGlobal().prop1,"test"),t.done()},"test for nonexistent properties":function(t){var e=Contextify({}).getGlobal();t.equal(e.test1,void 0),t.done()},'test for "undefined" properties':function(t){var e={x:void 0};Contextify(e),e.run("_x = x"),t.equal(e._x,void 0),t.done()},'test for "undefined" properties with createContext':function(t){var e={x:void 0},o=Contextify.createContext(e);o.run("_x = x"),t.equal(e._x,void 0),t.done()},'test for "undefined" variables':function(t){var e={};Contextify(e),e.run("var y; (function() { var _y ; y = _y })()"),t.equal(e._y,void 0),e.run("var z; _z = z"),t.equal(e._z,void 0),t.equal(e.getGlobal().z,void 0),t.done()},"test run with filename":function(t){var e=Contextify();e.run("var x = 3","test.js"),t.equal(e.x,3),t.done()},"test run with createContext":function(t){var e={},o=Contextify.createContext(e);o.run("var x = 3","test.js"),t.equal(e.x,3),t.done()},"test accessors on sandbox":function(t){var e,o={};o.__defineGetter__("test",function(){return 3}),o.__defineSetter__("test2",function(t){this.x=t}),Contextify(o),e=o.getGlobal(),t.equal(e.test,3),o.test2=5,t.equal(o.x,5),e.test2=7,t.equal(e.x,7),t.equal(o.x,7),t.done()},"test dispose":function(t){var e=Contextify();t.notEqual(e.run,void 0),t.notEqual(e.getGlobal,void 0),t.notEqual(e.dispose,void 0),e.dispose(),t.throws(function(){e.run()},Error),t.throws(function(){e.getGlobal()},Error),t.throws(function(){e.dispose()},Error),t.done()}},exports["synchronous script tests"]={"global variables in scripts should go on sandbox":function(t){var e={prop1:"prop1",prop2:"prop2"};Contextify(e),e.run("x = 3"),t.equal(e.x,3),t.done()},"sandbox properties should be globals":function(t){var e={prop1:"prop1",prop2:"prop2"};Contextify(e),e.run("test1 = (prop1 == 'prop1');test2 = (prop2 == 'prop2');"),t.ok(e.test1),t.ok(e.test2),t.done()}},exports["asynchronous script tests"]={"global variables in scripts should go on sandbox":function(t){var e={setTimeout:setTimeout,prop1:"prop1",prop2:"prop2"};Contextify(e),e.run("setTimeout(function () {x = 3}, 0);"),t.equal(e.x,void 0),setTimeout(function(){t.equal(e.x,3),t.done()},0)},"sandbox properties should be globals":function(t){var e={setTimeout:setTimeout,prop1:"prop1",prop2:"prop2"};Contextify(e),e.run("setTimeout(function () {test1 = (prop1 == 'prop1');test2 = (prop2 == 'prop2');}, 0)"),t.equal(e.test1,void 0),t.equal(e.test2,void 0),setTimeout(function(){t.ok(e.test1),t.ok(e.test2),t.done()},0)},"createContext: sandbox properties should be globals":function(t){var e={setTimeout:setTimeout,prop1:"prop1",prop2:"prop2"},o=Contextify.createContext(e);o.run("setTimeout(function () {test1 = (prop1 == 'prop1');test2 = (prop2 == 'prop2');}, 0)"),t.equal(e.test1,void 0),t.equal(e.test2,void 0),setTimeout(function(){t.ok(e.test1),t.ok(e.test2),t.done()},0)}},exports["test global"]={"basic test":function(t){var e,o={prop1:"prop1",prop2:"prop2"};Contextify(o),e=o.getGlobal(),t.notDeepEqual(e,null),t.notDeepEqual(e,void 0),t.equal(e.prop1,"prop1"),t.equal(e.prop2,"prop2"),e.prop3="prop3",t.equal(o.prop3,"prop3"),t.done()},"self references to the global object":function(t){var e=Contextify({}),o=e.getGlobal();e.ref1=o,e.ref2={ref2:o},e.run("test1 = (this == ref1);test2 = (this == ref2.ref2);"),t.ok(e.test1),t.ok(e.test2),t.done()},"test enumerator":function(t){var e={prop1:"prop1",prop2:"prop2"},o=Contextify(e).getGlobal(),n=Object.keys(o);t.equal(n.length,5),t.ok(-1!=n.indexOf("prop1")),t.ok(-1!=n.indexOf("prop2")),t.ok(-1!=n.indexOf("run")),t.ok(-1!=n.indexOf("getGlobal")),t.ok(-1!=n.indexOf("dispose")),t.done()},"test deleter":function(t){var e={prop1:"prop1",prop2:"prop2"},o=Contextify(e).getGlobal();t.equal(Object.keys(o).length,5),t.equal(Object.keys(e).length,5),delete o.prop1,t.equal(Object.keys(o).length,4),t.equal(Object.keys(e).length,4),delete o.prop2,t.equal(Object.keys(o).length,3),t.equal(Object.keys(e).length,3),delete o.run,t.equal(Object.keys(o).length,2),t.equal(Object.keys(e).length,2),delete o.getGlobal,t.equal(Object.keys(o).length,1),t.equal(Object.keys(e).length,1),delete o.dispose,t.equal(Object.keys(o).length,0),t.equal(Object.keys(e).length,0),t.done()},"test global class name":function(t){function e(){}var o=Contextify(new e),n=o.getGlobal();t.equal(o.constructor.name,"DOMWindow"),t.equal(o.constructor.name,n.constructor.name),o.run("thisName = this.constructor.name"),t.equal(o.thisName,o.constructor.name),t.done()},"test global functions":function(t){var e=Contextify(),o=e.getGlobal();e.run("function testing () {}"),t.notEqual(o.testing,void 0),t.done()},"test global.run()":function(t){var e=Contextify().getGlobal();e.run("x = 5"),t.equal(e.x,5),t.done()},"test global.getGlobal()":function(t){var e=Contextify().getGlobal();t.deepEqual(e,e.getGlobal()),t.done()},"test global.dispose()":function(t){var e=Contextify(),o=e.getGlobal();t.notEqual(o.run,void 0),t.notEqual(o.getGlobal,void 0),t.notEqual(o.dispose,void 0),o.dispose(),t.throws(function(){e.run()},Error),t.throws(function(){e.getGlobal()},Error),t.throws(function(){e.dispose()},Error),t.done()}},exports["test multiple contexts"]=function(t){var e={prop1:"prop1",prop2:"prop2"},o={prop1:"prop1",prop2:"prop2"},n=Contextify(e).getGlobal(),r=Contextify(o).getGlobal();t.equal(n.prop1,"prop1"),t.equal(r.prop1,"prop1"),e.run("test = 3"),o.run("test = 4"),t.equal(e.test,3),t.equal(n.test,3),t.equal(o.test,4),t.equal(r.test,4),t.done()},exports["test console"]=function(t){var e={console:console,prop1:"prop1"};Contextify(e),t.doesNotThrow(function(){e.run("console.log(prop1);")}),t.done()},exports["test eval"]={"basic test":function(t){var e=Contextify();e.run('eval("test1 = 1")'),t.equal(e.test1,1),e.run('(function() { eval("test2 = 2") })()'),t.equal(e.test2,2),t.done()},"this test":function(t){var e=Contextify();e.run('e = eval ; e("test1 = 1")'),t.equal(e.test1,1),e.run('var t = 1 ; (function() { var t = 2; test2 = eval("t") })()'),t.equal(e.test2,2),e.run('t = 1 ; (function() { var t = 2; e = eval; test3 = e("t") })()'),t.equal(e.test3,1),e.run('var t = 1 ; global = this; (function() { var t = 2; e = eval; test4 = global.eval.call(global, "t") })()'),t.equal(e.test4,1),t.done()}},exports["test exceptions"]={"basic test":function(t){var e=Contextify(),o=e.run("ReferenceError"),n=e.run("SyntaxError");t.throws(function(){e.run("doh")},o),t.throws(function(){e.run("x = y")},o),t.throws(function(){e.run("function ( { (( }{);")},n),t.done()},"test double dispose() - sandbox":function(t){var e=Contextify();t.doesNotThrow(function(){e.dispose()}),t.throws(function(){e.dispose()},"Called dispose() twice."),t.done()},"test double dispose - global":function(t){var e=Contextify(),o=e.getGlobal();t.doesNotThrow(function(){o.dispose()}),t.throws(function(){o.dispose()},"Called dispose() twice."),t.done()},"test run() after dispose()":function(t){var e=Contextify();t.doesNotThrow(function(){e.dispose()}),t.throws(function(){e.run("var x = 3")},"Called run() after dispose()."),t.done()},"test getGlobal() after dispose()":function(t){var e=Contextify();t.doesNotThrow(function(){e.dispose()}),t.throws(function(){e.getGlobal()},"Called getGlobal() after dispose()."),t.done()}},exports["test scripts"]={"test createScript()":function(t){var e=Contextify.createScript("var x = 3","test.js");t.equal(typeof e.runInContext,"function"),t.done()},"test createScript() without code":function(t){t.throws(function(){Contextify.createScript()}),t.throws(function(){Contextify.createScript(!0)}),t.throws(function(){Contextify.createScript(null)}),t.throws(function(){Contextify.createScript(1)}),t.done()},"test runInContext":function(t){var e={},o=Contextify.createScript("var x = 3","test.js"),n=Contextify.createContext(e);o.runInContext(n),t.equal(e.x,3),t.done()}};