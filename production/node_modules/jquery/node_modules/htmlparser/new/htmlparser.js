!function(){function t(){return"function"==typeof require&&"object"==typeof exports&&"object"==typeof module&&"string"==typeof __filename&&"string"==typeof __dirname}function e(t){var e,a;if(t.isScript?(c.lastIndex=t.pos,e=c.exec(t.data),e=e?e.index:-1):e=t.data.indexOf("<",t.pos),a=-1===e?t.data.substring(t.pos,t.data.length):t.data.substring(t.pos,e),0>e&&t.done&&(e=t.data.length),0>e){if(t.isScript)return t.needData=!0,void 0;t.pendingText||(t.pendingText=[]),t.pendingText.push(t.data.substring(t.pos,t.data.length)),t.pos=t.data.length}else t.pendingText?(t.pendingText.push(t.data.substring(t.pos,e)),a=t.pendingText.join(""),t.pendingText=null):a=t.data.substring(t.pos,e),""!==a&&t.output.push({type:h.Text,data:a}),t.pos=e+1,t.mode=h.Tag}function a(t){var e,a,s;if(u.lastIndex=t.pos,e=u.exec(t.data)){if(!e[1]&&"!--"===e[2].substr(0,3))return t.mode=h.Comment,t.pos+=3,void 0;if(!e[1]&&"![CDATA["===e[2].substr(0,8))return t.mode=h.CData,t.pos+=8,void 0;if(!t.done&&t.pos+e[0].length===t.data.length)return t.needData=!0,void 0;">"===e[4]?(t.mode=h.Text,a=e[0].substr(0,e[0].length-1)):(t.mode=h.Attr,a=e[0]),t.pos+=e[0].length,s={type:h.Tag,name:e[1]+e[2],raw:a},t.mode===h.Attr&&(t.lastTag=s),"script"===s.name.toLowerCase()?t.isScript=!0:"/script"===s.name.toLowerCase()&&(t.isScript=!1),t.output.push(s)}else t.needData=!0}function s(t){g.lastIndex=t.pos;var e=g.exec(t.data);return e?t.pos+e[0].length!==g.lastIndex?null:{match:e[0],name:e[1]}:null}function n(t){m.lastIndex=t.pos;var e=m.exec(t.data);return e?t.pos+e[0].length!==m.lastIndex?null:{match:e[0],value:e[1]||e[2]||e[3]}:t.done?(f.lastIndex=t.pos,e=f.exec(t.data),e?{match:e[0],value:""!==e[1]?e[1]:null}:null):null}function i(t){var e,a,i,o=s(t);if(o){if(!t.done&&t.pos+o.match.length===t.data.length)return t.needData=!0,null;if(t.pos+=o.match.length,i=n(t)){if(!t.done&&t.pos+i.match.length===t.data.length)return t.needData=!0,t.pos-=o.match.length,void 0;t.pos+=i.match.length}else{if(x.lastIndex=t.pos,x.exec(t.data))return t.needData=!0,t.pos-=o.match.length,void 0;i={match:"",value:null}}t.lastTag.raw+=o.match+i.match,t.output.push({type:h.Attr,name:o.name,data:i.value})}else{if(T.lastIndex=t.pos,e=T.exec(t.data),e&&e.index===t.pos){if(!t.done&&!e[2]&&t.pos+e[0].length===t.data.length)return t.needData=!0,void 0;t.lastTag.raw+=e[1],t.output.push({type:h.Tag,name:"/"+t.lastTag.name,raw:null}),t.pos+=e[1].length}if(a=t.data.indexOf(">",t.pos),0>a){if(t.done)return t.lastTag.raw+=t.data.substr(t.pos),t.pos=t.data.length,void 0;t.needData=!0}else t.pos=a+1,t.mode=h.Text}}function o(t){var e,a,s=t.data.indexOf("]]>",t.pos);if(0>s&&t.done&&(s=t.data.length),0>s){if(y.lastIndex=t.pos,e=y.exec(t.data))return t.needData=!0,void 0;t.pendingText||(t.pendingText=[]),t.pendingText.push(t.data.substr(t.pos,t.data.length)),t.pos=t.data.length,t.needData=!0}else t.pendingText?(t.pendingText.push(t.data.substring(t.pos,s)),a=t.pendingText.join(""),t.pendingText=null):a=t.data.substring(t.pos,s),t.output.push({type:h.CData,data:a}),t.mode=h.Text,t.pos=s+3}function r(t){var e,a,s=t.data.indexOf("-->",t.pos);if(0>s&&t.done&&(s=t.data.length),0>s){if(_.lastIndex=t.pos,e=_.exec(t.data))return t.needData=!0,void 0;t.pendingText||(t.pendingText=[]),t.pendingText.push(t.data.substr(t.pos,t.data.length)),t.pos=t.data.length,t.needData=!0}else t.pendingText?(t.pendingText.push(t.data.substring(t.pos,s)),a=t.pendingText.join(""),t.pendingText=null):a=t.data.substring(t.pos,s),t.output.push({type:h.Comment,data:a}),t.mode=h.Text,t.pos=s+3}function p(t){switch(t.mode){case h.Text:return e(t);case h.Tag:return a(t);case h.Attr:return i(t);case h.CData:return o(t);case h.Comment:return r(t)}}function d(t,e){this._options=e?e:{},void 0==this._options.includeLocation&&(this._options.includeLocation=!1),this.validateHandler(t),this._handler=t,this.reset()}function l(t,e){this.reset(),this._options=t?t:{},void 0==this._options.ignoreWhitespace&&(this._options.ignoreWhitespace=!1),void 0==this._options.trackPosition&&(this._options.trackPosition=!1),void 0==this._options.verbose&&(this._options.verbose=!0),void 0==this._options.enforceEmptyTags&&(this._options.enforceEmptyTags=!0),void 0==this._options.caseSensitiveTags&&(this._options.caseSensitiveTags=!1),void 0==this._options.caseSensitiveAttr&&(this._options.caseSensitiveAttr=!1),"function"==typeof e&&(this._callback=e)}var h,c,u,g,m,f,x,T,y,_;if(!t()){if(this.Tautologistics){if(this.Tautologistics.NodeHtmlParser)return}else this.Tautologistics={};this.Tautologistics.NodeHtmlParser={},exports=this.Tautologistics.NodeHtmlParser}h={Text:"text",Tag:"tag",Attr:"attr",CData:"cdata",Comment:"comment"},c=/<\s*\/\s*script/gi,u=/\s*(\/?)\s*([^\s>\/]+)(\s*)(>?)/g,g=/\s*([^=<>\s'"\/]+)\s*/g,m=/\s*=\s*(?:'([^']*)'|"([^"]*)"|([^'"\s\/>]+))\s*/g,f=/\s*=\s*['"]?(.*)$/g,x=/\s*=\s*['"]?/g,T=/(\s*\/\s*)(>?)/g,y=/\]{1,2}$/,_=/\-{1,2}$/,d.prototype.reset=function(){this.state={mode:h.Text,pos:0,data:null,pendingText:null,lastTag:null,isScript:!1,needData:!1,done:!1}},d.prototype.parseChunk=function(t){for(this.state.needData=!1,this.state.data=null!==this.state.data?this.state.data.substr(this.pos)+t:t;this.state.pos<this.state.data.length&&!this.state.needData;)p(this.state)},d.prototype.parseComplete=function(t){this.reset(),this.parseChunk(t),this.done()},d.prototype.done=function(){this.state.done=!0,p(this.state)},d.prototype.validateHandler=function(t){if("object"!=typeof t)throw Error("Handler is not an object");if("function"!=typeof t.reset)throw Error("Handler method 'reset' is invalid");if("function"!=typeof t.done)throw Error("Handler method 'done' is invalid");if("function"!=typeof t.write)throw Error("Handler method 'write' is invalid");if("function"!=typeof t.error)throw Error("Handler method 'error' is invalid")},l._emptyTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1},l.reWhitespace=/^\s*$/,l.prototype.dom=null,l.prototype.reset=function(){this.dom=[],this._done=!1,this._tagStack=[],this._tagStack.last=function(){return this.length?this[this.length-1]:null}},l.prototype.done=function(){this._done=!0,this.handleCallback(null)},l.prototype.error=function(t){this.handleCallback(t)},l.prototype.handleCallback=function(t){if("function"==typeof this._callback)this._callback(t,this.dom);else if(t)throw t},l.prototype.isEmptyTag=function(t){var e=t.name.toLowerCase();return"/"==e.charAt(0)&&(e=e.substring(1)),this._options.enforceEmptyTags&&!!l._emptyTags[e]},l.prototype._copyElement=function(t){var e={type:t.type};if(this._options.verbose&&void 0!==t.raw&&(e.raw=t.raw),void 0!==t.name)switch(t.type){case h.Tag:e.name=this._options.caseSensitiveTags?t.name:t.name.toLowerCase();break;case h.Attr:e.name=this._options.caseSensitiveAttr?t.name:t.name.toLowerCase();break;default:e.name=this._options.caseSensitiveTags?t.name:t.name.toLowerCase()}return void 0!==t.data&&(e.data=t.name),e},l.prototype.write=function(t){var e,a,s;if(this._done&&this.handleCallback(Error("Writing to the handler after done() called is not allowed without a reset()")),t.type!==h.Text||!this._options.ignoreWhitespace||!l.reWhitespace.test(t.data))if(this._options.verbose||(delete t.raw,("tag"==t.type||"script"==t.type||"style"==t.type)&&delete t.data),this._tagStack.last())if(t.type!=h.Text&&t.type!=h.Comment&&t.type!=h.CData)if("/"==t.name.charAt(0)){if(a=this._options.caseSensitiveTags?t.name.substring(1):t.name.substring(1).toLowerCase(),!this.isEmptyTag(t)){for(s=this._tagStack.length-1;s>-1&&this._tagStack[s--].name!=a;);if(s>-1||this._tagStack[0].name==a)for(;s<this._tagStack.length-1;)this._tagStack.pop()}}else this._tagStack.last().children||(this._tagStack.last().children=[]),e=this._copyElement(t),this._tagStack.last().children.push(e),this.isEmptyTag(e)||this._tagStack.push(e);else this._tagStack.last().children||(this._tagStack.last().children=[]),this._tagStack.last().children.push(this._copyElement(t));else t.type!=h.Text&&t.type!=h.Comment&&t.type!=h.CData?"/"!=t.name.charAt(0)&&(e=this._copyElement(t),this.dom.push(e),this.isEmptyTag(e)||this._tagStack.push(e)):this.dom.push(this._copyElement(t))},l.prototype._options=null,l.prototype._callback=null,l.prototype._done=!1,l.prototype._tagStack=null,exports.Parser=d,exports.HtmlHandler=l,exports.ElementType=h}();