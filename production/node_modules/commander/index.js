function Option(n,t){this.flags=n,this.required=~n.indexOf("<"),this.optional=~n.indexOf("["),this.bool=!~n.indexOf("-no-"),n=n.split(/[ ,|]+/),n.length>1&&!/^[[<]/.test(n[1])&&(this.short=n.shift()),this.long=n.shift(),this.description=t||""}function Command(n){this.commands=[],this.options=[],this._execs=[],this._args=[],this._name=n}function camelcase(n){return n.split("-").reduce(function(n,t){return n+t[0].toUpperCase()+t.slice(1)})}function pad(n,t){var o=Math.max(0,t-n.length);return n+Array(o+1).join(" ")}function outputHelpIfNecessary(n,t){t=t||[];for(var o=0;o<t.length;o++)("--help"==t[o]||"-h"==t[o])&&(n.outputHelp(),process.exit(0))}var EventEmitter=null.EventEmitter,spawn=null.spawn,fs=null,exists=fs.existsSync,path=null,dirname=path.dirname,basename=path.basename;exports=module.exports=new Command,exports.Command=Command,exports.Option=Option,Option.prototype.name=function(){return this.long.replace("--","").replace("no-","")},Option.prototype.is=function(n){return n==this.short||n==this.long},Command.prototype.__proto__=EventEmitter.prototype,Command.prototype.command=function(n,t){var o=n.split(/ +/),e=new Command(o.shift());return t&&e.description(t),t&&(this.executables=!0),t&&(this._execs[e._name]=!0),this.commands.push(e),e.parseExpectedArgs(o),e.parent=this,t?this:e},Command.prototype.addImplicitHelpCommand=function(){this.command("help [cmd]","display help for [cmd]")},Command.prototype.parseExpectedArgs=function(n){if(n.length){var t=this;return n.forEach(function(n){switch(n[0]){case"<":t._args.push({required:!0,name:n.slice(1,-1)});break;case"[":t._args.push({required:!1,name:n.slice(1,-1)})}}),this}},Command.prototype.action=function(n){var t=this;return this.parent.on(this._name,function(o,e){e=e||[];var i=t.parseOptions(e);outputHelpIfNecessary(t,i.unknown),i.unknown.length>0&&t.unknownOption(i.unknown[0]),i.args.length&&(o=i.args.concat(o)),t._args.forEach(function(n,e){n.required&&null==o[e]&&t.missingArgument(n.name)}),t._args.length?o[t._args.length]=t:o.push(t),n.apply(this,o)}),this},Command.prototype.option=function(n,t,o,e){var i=this,s=new Option(n,t),r=s.name(),p=camelcase(r);return"function"!=typeof o&&(e=o,o=null),(0==s.bool||s.optional||s.required)&&(0==s.bool&&(e=!0),void 0!==e&&(i[p]=e)),this.options.push(s),this.on(r,function(n){null!=n&&o&&(n=o(n)),"boolean"==typeof i[p]||void 0===i[p]?i[p]=null==n?s.bool?e||!0:!1:n:null!==n&&(i[p]=n)}),this},Command.prototype.parse=function(n){var t,o,e,i;return this.executables&&this.addImplicitHelpCommand(),this.rawArgs=n,this._name=this._name||basename(n[1]),t=this.parseOptions(this.normalize(n.slice(2))),o=this.args=t.args,e=this.parseArgs(this.args,t.unknown),i=e.args[0],this._execs[i]?this.executeSubCommand(n,o,t.unknown):e},Command.prototype.executeSubCommand=function(n,t,o){var e,i,s,r;t=t.concat(o),t.length||this.help(),"help"==t[0]&&1==t.length&&this.help(),"help"==t[0]&&(t[0]=t[1],t[1]="--help"),e=dirname(n[1]),i=basename(n[1])+"-"+t[0],s=path.join(e,i),t=t.slice(1),r=spawn(s,t,{stdio:"inherit",customFds:[0,1,2]}),r.on("error",function(n){"ENOENT"==n.code?console.error("\n  %s(1) does not exist, try --help\n",i):"EACCES"==n.code&&console.error("\n  %s(1) not executable. try chmod or run with root\n",i)}),this.runningCommand=r},Command.prototype.normalize=function(n){var t,o,e,i,s=[];for(e=0,i=n.length;i>e;++e)t=n[e],t.length>1&&"-"==t[0]&&"-"!=t[1]?t.slice(1).split("").forEach(function(n){s.push("-"+n)}):/^--/.test(t)&&~(o=t.indexOf("="))?s.push(t.slice(0,o),t.slice(o+1)):s.push(t);return s},Command.prototype.parseArgs=function(n,t){var o,e=this.commands;return e.length,n.length?(o=n[0],this.listeners(o).length?this.emit(n.shift(),n,t):this.emit("*",n)):(outputHelpIfNecessary(this,t),t.length>0&&this.unknownOption(t[0])),this},Command.prototype.optionFor=function(n){for(var t=0,o=this.options.length;o>t;++t)if(this.options[t].is(n))return this.options[t]},Command.prototype.parseOptions=function(n){var t,o,e,i,s=[],r=n.length,p=[];for(i=0;r>i;++i)if(e=n[i],"--"!=e)if(t)s.push(e);else if(o=this.optionFor(e))if(o.required){if(e=n[++i],null==e)return this.optionMissingArgument(o);if("-"==e[0]&&"-"!=e)return this.optionMissingArgument(o,e);this.emit(o.name(),e)}else o.optional?(e=n[i+1],null==e||"-"==e[0]&&"-"!=e?e=null:++i,this.emit(o.name(),e)):this.emit(o.name());else e.length>1&&"-"==e[0]?(p.push(e),n[i+1]&&"-"!=n[i+1][0]&&p.push(n[++i])):s.push(e);else t=!0;return{args:s,unknown:p}},Command.prototype.missingArgument=function(n){console.error(),console.error("  error: missing required argument `%s'",n),console.error(),process.exit(1)},Command.prototype.optionMissingArgument=function(n,t){console.error(),t?console.error("  error: option `%s' argument missing, got `%s'",n.flags,t):console.error("  error: option `%s' argument missing",n.flags),console.error(),process.exit(1)},Command.prototype.unknownOption=function(n){console.error(),console.error("  error: unknown option `%s'",n),console.error(),process.exit(1)},Command.prototype.version=function(n,t){return 0==arguments.length?this._version:(this._version=n,t=t||"-V, --version",this.option(t,"output the version number"),this.on("version",function(){console.log(n),process.exit(0)}),this)},Command.prototype.description=function(n){return 0==arguments.length?this._description:(this._description=n,this)},Command.prototype.usage=function(n){var t=this._args.map(function(n){return n.required?"<"+n.name+">":"["+n.name+"]"}),o="[options"+(this.commands.length?"] [command":"")+"]"+(this._args.length?" "+t:"");return 0==arguments.length?this._usage||o:(this._usage=n,this)},Command.prototype.largestOptionLength=function(){return this.options.reduce(function(n,t){return Math.max(n,t.flags.length)},0)},Command.prototype.optionHelp=function(){var n=this.largestOptionLength();return[pad("-h, --help",n)+"  "+"output usage information"].concat(this.options.map(function(t){return pad(t.flags,n)+"  "+t.description})).join("\n")},Command.prototype.commandHelp=function(){return this.commands.length?["","  Commands:","",this.commands.map(function(n){var t=n._args.map(function(n){return n.required?"<"+n.name+">":"["+n.name+"]"}).join(" ");return pad(n._name+(n.options.length?" [options]":"")+" "+t,22)+(n.description()?" "+n.description():"")}).join("\n").replace(/^/gm,"    "),""].join("\n"):""},Command.prototype.helpInformation=function(){return["","  Usage: "+this._name+" "+this.usage(),""+this.commandHelp(),"  Options:","",""+this.optionHelp().replace(/^/gm,"    "),"",""].join("\n")},Command.prototype.outputHelp=function(){process.stdout.write(this.helpInformation()),this.emit("--help")},Command.prototype.help=function(){this.outputHelp(),process.exit()};