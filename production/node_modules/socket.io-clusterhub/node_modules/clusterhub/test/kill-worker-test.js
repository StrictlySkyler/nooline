var workers,i,n,hub=null,cluster=null,WORKERS=2;if(cluster.isMaster){for(workers=[],i=0;WORKERS>i;i++)workers.push(cluster.fork());n=WORKERS,hub.on("hello",function(){0===--n&&hub.emit("done")}),describe("Master",function(){it("Waits then destroy a random worker",function(e){hub.on("done",e),hub.ready(function(){var e=workers[Math.floor(Math.random()*WORKERS)];cluster.on("exit",function(){cluster.fork()}),e.destroy()})})})}else describe("Worker",function(){describe("Calls hub method",function(){it("No errors until master finished",function(e){hub.on("done",e),hub.ready(function(){setTimeout(function(){hub.emit("hello")},100)})})})});