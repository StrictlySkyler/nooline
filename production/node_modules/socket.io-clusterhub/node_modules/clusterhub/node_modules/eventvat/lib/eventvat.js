!function(t){function e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var i,h,s,r;if(!i&&require&&(i=null.EventEmitter2,!i))throw Error("`EventEmitter2` is not defined.");h=t.exports=function n(t){if(!(this instanceof n))return new n(t);var e=this;this.hash={},this.autoexpire=t&&t.autoexpire||0,t&&t.data&&Object.keys(t.data).forEach(function(i){e.hash[i]={value:t.data[i]}})},s=h.prototype;for(r in i.prototype)s[r]=i.prototype[r];s.publish=i.prototype.emit,s.subscribe=i.prototype.on,s.unsubscribe=i.prototype.removeListener,s.die=function(){for(var t in this.hash)e(this.hash,t)&&this.hash[t].tid&&clearTimeout(this.hash[t].tid)},s.del=function(){var t,i,h,s=0;for(i=0,h=arguments.length;h>i;i++)t=arguments[i],e(this.hash,t)&&(this.persist(t),delete this.hash[t],this.emit("del "+t),this.emit("del",t),s++);return s},s.exists=function(t){var i=e(this.hash,t);return this.emit("exists "+t,i),this.emit("exists",t,i),i},s.expire=function(t,i){var h,s;return e(this.hash,t)&&"number"==typeof i&&i>-1?(this.hash[t].tid&&clearTimeout(this.hash[t].tid),h=1e3*i,s=this,s.hash[t].tid=setTimeout(function(){s.del(t)},h),s.hash[t].tend=+new Date+h,this.emit("expire "+t,i),this.emit("expire",t,i),!0):!1},s.expireat=function(t,e){var i=e-Math.round(new Date/1e3),h=this.expire(t,i);return h&&(this.emit("expireat "+t,e),this.emit("expireat",t,e)),h},s.keys=function(t){var i,h=[];if(!t)return Object.keys(this.hash).length;"string"==typeof t&&(t=RegExp(t));for(i in this.hash)e(this.hash,i)&&t.test(i)&&h.push(i);return this.emit("keys",t,h),h},s.move=function(t,e){return e&&e.hash?(this.persist(t),e.hash[t]=this.hash[t],delete this.hash[t],this.emit("move "+t,e),this.emit("move",t,e),!0):!1},s.object=function(){throw Error("Not implemented.")},s.persist=function(t){return e(this.hash,t)&&this.hash[t].tid?(clearTimeout(this.hash[t].tid),delete this.hash[t].tid,delete this.hash[t].tend,this.emit("persist "+t),this.emit("persist",t),!0):!1},s.randomkey=function(){var t=this.keys(/^/),e=Math.floor(Math.random()*t.length),i=t[e]||null;return this.emit("randomkey",i),i},s.rename=function(t,i){return e(this.hash,t)?(this.persist(t),this.persist(i),this.hash[i]=this.hash[t],delete this.hash[t],this.emit("rename "+t,i),this.emit("rename",t,i),!0):!1},s.renamenx=function(t,i){return e(this.hash,t)&&!e(this.hash,i)?(this.persist(t),this.hash[i]=this.hash[t],this.emit("renamenx "+t,i),this.emit("renamenx",t,i),!0):!1},s.sort=function(){throw Error("Not implemented.")},s.type=function(t){var i,h;return e(this.hash,t)?(i=this.hash[t].value,h=typeof i,"object"===h?this.hash[t].type||("[object Array]"===Object.prototype.toString.call(i)?"list":"hash"):h):"none"},s.ttl=function(t){var i=e(this.hash,t)&&this.hash[t].tid?Math.round((this.hash[t].tend-new Date)/1e3):-1;return this.emit("ttl "+t,i),this.emit("ttl",t,i),i},s.append=function(t,e){var i,h,s=this.type(t);if("none"===s)this.hash[t]={value:""};else{if("string"!==s)return 0;this.persist(t)}return i=this.hash[t].value+=e,h=i.length,this.emit("append "+t,e,h),this.emit("append",t,e,h),h},s.decr=function(t){var e=this.decrby(t,1);return e!==!1&&(this.emit("decr "+t,e),this.emit("decr",t,e)),e},s.decrby=function(t,i){if(e(this.hash,t)){if("number"!==this.type(t))return!1}else this.hash[t]={value:0};this.persist(t);var h=i?this.hash[t].value-=i:this.hash[t].value--;return this.emit("decrby "+t,i,h),this.emit("decrby",t,i,h),h},s.get=function(t){var i=null;return e(this.hash,t)&&(i=this.hash[t].value,this.emit("get "+t,i),this.emit("get",t,i)),i},s.getDel=function(t){var e=s.get(t);s.del(t),this.emit("getdel "+t,e),this.emit("getdel",t,e)},s.gettime=function(){var t=null;return e(this.hash,key)&&(t=this.hash[key].time,this.emit("gettime "+key,t),this.emit("gettime",key,t)),t},s.getbit=function(){throw Error("Not implemented.")},s.getrange=function(t,e,i){if("string"===this.type(t)){var h=this.hash[t].value.slice(e,i);return this.emit("getrange "+t,e,i,h),this.emit("getrange",t,e,i,h),h}return!1},s.getset=function(t,e){var i=this.get(t);return this.set(t,e),this.emit("getset "+t,e,i),this.emit("getset",t,e,i),i},s.incr=function(t){var e=this.incrby(t,1);return e!==!1&&(this.emit("incr "+t,e),this.emit("incr",t,e)),e},s.incrby=function(t,i){if(i=+i,e(this.hash,t)){if("number"!==this.type(t))return!1}else this.hash[t]={value:0};this.persist(t);var h=this.hash[t].value+=i;return this.emit("incrby "+t,i,h),this.emit("incrby",t,i,h),h},s.mget=function(){var t,e,i=Array.prototype.slice.call(arguments),h=[];for(t=0,e=i.length;e>t;t++)h.push(this.get(i[t]));return i.unshift("mget"),i.push(h),this.emit.apply(this,i),h},s.mset=function(){var t,i,h,s,r;for(h=0,s=arguments.length;s>h;h+=2)t=arguments[h],i=arguments[h+1],e(this.hash,t)?(this.persist(t),delete this.hash[t].type,this.hash[t].value=i):this.hash[t]={value:i};for(h=0,s=arguments.length;s>h;h+=2)t=arguments[h],i=arguments[h+1],this.emit("set "+t,i),this.emit("set",t,i);return r=Array.prototype.slice.call(arguments),r.unshift("mset"),0===arguments.length%2?this.expire(t,arguments[arguments.length-1]):this.autoexpire&&this.expire(t,this.autoexpire),this.emit.apply(this,r),!0},s.msetnx=function(){var t,i,h,s,r;for(h=0,s=arguments.length;s>h;h+=2)if(e(this.hash,arguments[h]))return!1;for(h=0,s=arguments.length;s>h;h+=2)t=arguments[h],i=arguments[h+1],e(this.hash,t)||(this.hash[t]={value:i});for(h=0,s=arguments.length;s>h;h+=2)t=arguments[h],i=arguments[h+1],this.emit("set "+t,i),this.emit("set",t,i),this.emit("setnx "+t,i),this.emit("setnx",t,i);return r=Array.prototype.slice.call(arguments),r.unshift("msetnx"),this.emit.apply(this,r),!0},s.set=function(t,i,h){return e(this.hash,t)?(delete this.hash[t].type,this.hash[t].value=i):this.hash[t]={value:i},this.hash[t].time=""+Date.now(),this.persist(t),(h||this.autoexpire)&&this.expire(t,h||this.autoexpire),this.emit("set "+t,i),this.emit("set",t,i),!0},s.setbit=function(){throw Error("Not implemented.")},s.setex=function(){throw Error("Not implemented.")},s.setnx=function(t,i,h){return e(this.hash,t)?!1:(this.set(t,i,h),this.emit("setnx "+t,i),this.emit("setnx",t,i),!0)},s.setrange=function(t,e,i){var h,s,r,n;return"string"===this.type(t)?(h=this.hash[t].value.slice(0,e),s=this.hash[t].value.slice(e+i.length),r=h+i+s,n=r.length,this.persist(t),this.hash.value=r,this.emit("setrange "+t,e,i,n),this.emit("setrange",t,e,i,n),n):!1},s.strlen=function(t){if("string"===this.type(t)){var e=this.hash[t].value.length;return this.emit("strlen "+t,e),this.emit("strlen",t,e),e}return 0},s.hdel=function(t){var i,h,s,r=0;if("hash"===this.type(t))for(this.persist(t),h=1,s=arguments.length;s>h;h++)i=arguments[h],e(this.hash[t].value,i)&&(delete this.hash[t].value[i],this.emit("hdel "+t,i),this.emit("hdel",t,i),r++);return r},s.hexists=function(t,i){var h="hash"===this.type(t)&&e(this.hash[t].value,i);return this.emit("hexists "+t,i,h),this.emit("hexists",t,i,h),h},s.hget=function(t,i){if("hash"===this.type(t)&&e(this.hash[t].value,i)){var h=this.hash[t].value[i];return this.emit("hget "+t,i,h),this.emit("hget",t,i,h),h}return null},s.hgetall=function(t){var e="hash"===this.type(t)?this.hash[t].value:{};return this.emit("hgetall "+t,e),this.emit("hgetall",t,e),e},s.hincr=function(t,e){var i=this.hincrby(t,e,1);return i!==!1&&(this.emit("hincr "+t,e,i),this.emit("hincr",t,e,i)),i},s.hincrby=function(t,i,h){var s,r;if(h=+h,s=this.type(t),"none"===s)this.hash[t]={value:{},type:"hash"};else if("hash"!==s)return!1;if(e(this.hash[t].value,i)){if("number"!=typeof this.hash[t].value[i])return!1}else this.hash[t].value[i]=0;return r=this.hash[t].value[i]+=h,this.emit("hincrby "+t,i,h,r),this.emit("hincrby",t,i,h,r),r},s.hdecr=function(t,e){var i=this.hdecrby(t,e,1);return i!==!1&&(this.emit("hdecr "+t,e,i),this.emit("hdecr",t,e,i)),i},s.hdecrby=function(t,i,h){var s,r;if(h=+h,s=this.type(t),"none"===s)this.hash[t]={value:{},type:"hash"};else{if("hash"!==s)return!1;this.persist(t)}if(e(this.hash[t].value,i)){if("number"!=typeof this.hash[t].value[i])return!1}else this.hash[t].value[i]=0;return r=this.hash[t].value[i]-=h,this.emit("hdecrby "+t,i,h,r),this.emit("hdecrby",t,i,h,r),r},s.hkeys=function(t){var i,h,s=[];if("hash"===this.type(t)){i=this.hash[t].value;for(h in i)e(i,h)&&s.push(h)}return this.emit("hkeys "+t,s),this.emit("hkeys",t,s),s},s.hlen=function(t){var i,h,s=0;if("hash"===this.type(t)){i=this.hash[t].value;for(h in i)e(i,h)&&s++}return this.emit("hlen "+t,s),this.emit("hlen",t,s),s},s.hmget=function(t){var e,i,h=[];for(e=1,i=arguments.length;i>e;e++)h.push(this.hget(t,arguments[e]));return this.emit("hmget "+t,h),this.emit("hmget",t,h),h},s.hmset=function(t){var e,i,h,s,r,n=this.type(t);if("none"===n)this.hash[t]={value:{},type:"hash"};else{if("hash"!==n)return!1;this.persist(t)}for(e=1,i=arguments.length;i>e;e+=2)this.hash[t].value[arguments[e]]=arguments[e+1];for(e=1,i=arguments.length;i>e;e+=2)h=arguments[e],s=arguments[e+1],this.emit("hset "+t,h,s),this.emit("hset",t,h,s);return r=Array.prototype.slice.call(arguments),this.emit.apply(this,["hmset "+t].concat(r.slice(1))),this.emit.apply(this,["hmset"].concat(r)),!0},s.hset=function(t,i,h){var s,r=this.type(t);if("none"===r)this.hash[t]={value:{},type:"hash"},s=!1;else{if("hash"!==r)return!1;this.persist(t),s=e(this.hash[t].value,i)}return this.hash[t].value[i]=h,0===arguments.length%2?this.expire(t,arguments[arguments.length-1]):this.autoexpire&&this.expire(t,this.autoexpire),this.emit("hset "+t,i,h,s),this.emit("hset",t,i,h,s),s},s.hsetnx=function(t,i,h){var s=this.type(t);if("none"===s)this.hash[t]={value:{},type:"hash"};else{if("hash"!==s)return!1;this.persist(t)}return e(this.hash[t].value,i)?!1:(this.hset(t,i,h),this.emit("hsetnx "+t,i,h),this.emit("hsetnx",t,i,h),!0)},s.hvals=function(t){var i,h,s=[];if("hash"===this.type(t)){i=this.hash[t].value;for(h in i)e(i,h)&&s.push(i[h])}return this.emit("hvals "+t,s),this.emit("hvals",t,s),s},s.lindex=function(t,e){var i,h,s;return"list"===this.type(t)?(i=this.hash[t].value,h=i.length,0>e&&(e=h+e),0>e||e>=h?null:(s=i[e],this.emit("lindex "+t,e,s),this.emit("lindex",t,e,s),s)):!1},s.linsert=function(){throw Error("Not implemented.")},s.llen=function(t){var e,i=this.type(t);return"none"===i?!1:(e="list"===i?this.hash[t].value.length:0,this.emit("llen "+t,e),this.emit("llen",t,e),e)},s.lpop=function(t){if("list"===this.type(t)){this.persist(t);var e=this.hash[t].value.shift()||null;return this.emit("lpop "+t,e),this.emit("lpop",t,e),e}return null},s.lpush=function(t){var e,i,h,s,r,n=this.type(t);if("none"===n)e=[],this.hash[t]={value:e,type:"list"};else{if("list"!==n)return!1;this.persist(t),e=this.hash[t].value}for(i=1,h=arguments.length;h>i;i++)s=arguments[i],r=e.unshift(s),this.emit("lpush "+t,s,r),this.emit("lpush",t,s,r);return this.autoexpire&&this.expire(t,this.autoexpire),r},s.lpushx=function(t,e){if("list"===this.type(t)){var i=this.hash[t].value.unshift(e);return this.emit("lpushx "+t,e,i),this.emit("lpushx",t,e,i),i}return 0},s.lrange=function(t,e,i){var h="list"===this.type(t)?this.hash[t].value.slice(e,i):[];return this.emit("lrange "+t,e,i,h),this.emit("lrange",t,e,i,h),h},s.lrem=function(t,e,i){var h,s,r,n,a,u,l;if("list"===this.type(t)){for(this.persist(t),h=this.hash[t].value,s=0,l=e,l>=0?(r=0,n=function(){return r<h.length},a=function(){r++},u=function(){r--},0===l&&(l=1/0)):(r=h.length,n=function(){return r>=0},a=function(){r--},u=function(){},l*=-1);n()&&(h[r]!==i||(h.splice(r,1),u(),++s!==l));a());return this.emit("lrem "+t,e,i,s),this.emit("lrem",t,e,i,s),s}return 0},s.lset=function(t,e,i){var h,s;return"list"===this.type(t)?(this.persist(t),h=this.hash[t].value,s=h.length,0>e&&(e=s+e),0>e||e>=s?!1:(h[e]=i,this.emit("lset "+t,e,i),this.emit("lset",t,e,i),this.autoexpire&&this.expire(t,this.autoexpire),!0)):!1},s.ltrim=function(t,e,i){return"list"===this.type(t)?(this.persist(t),this.hash[t].value=this.hash[t].value.slice(e,i),this.emit("ltrim "+t,e,i),this.emit("ltrim",t,e,i),!0):!1},s.rpop=function(t){if("list"===this.type(t)){this.persist(t);var e=this.hash[t].value.pop()||null;return this.emit("rpop "+t,e),this.emit("rpop",t,e),e}return null},s.rpoplpush=function(t,e){var i,h,s,r;if("list"===this.type(t)){if(i=this.type(e),"none"===i)h=[],this.hash[e]={value:h,type:"list"};else{if("list"!==i)return null;this.persist(e),h=this.hash[e].value}return this.persist(t),s=this.hash[t].value.pop(),r=h.unshift(s),this.emit("rpoplpush "+t,e,s),this.emit("rpoplpush",t,e,s),this.emit("rpop "+t,s),this.emit("rpop",t,s),this.emit("lpush "+e,s,r),this.emit("lpush",e,s,r),s}return null},s.rpush=function(t){var e,i,h,s,r,n=this.type(t);if("none"===n)e=[],this.hash[t]={value:e,type:"list"};else{if("list"!==n)return!1;this.persist(t),e=this.hash[t].value}for(i=1,h=arguments.length;h>i;i++)s=arguments[i],r=e.push(s),this.emit("rpush "+t,s,r),this.emit("rpush",t,s,r);return this.autoexpire&&this.expire(t,this.autoexpire),r},s.rpushx=function(t,e){if("list"===this.type(t)){var i=this.hash[t].value.push(e);return this.emit("rpushx "+t,e,i),this.emit("rpushx",t,e,i),i}return 0},s.dump=function(t){var i,h={};for(i in this.hash)e(this.hash,i)&&(h[i]=this.hash[i].value);return h=t?JSON.stringify(h):h,this.emit("dump",null,h),h},s.swap=function(t,i,h){var s,r;return e(this.hash,t)&&e(this.hash,i)?(s=this.hash[t],r=this.hash[i],h?s=this.hash[t]=[r,r=this.hash[i]=s][0]:s.value=[r.value,r.value=s.value][0],this.persist(t),this.persist(i),this.emit("swap "+t,i,h),this.emit("swap "+i,t,h),this.emit("swap",t,i,h),h?[t,i]:[t.value,i.value]):!1},s.findin=function(t,i){if(e(this.hash,t)){var h=this.hash[t].value.indexOf(i);return this.emit("findin "+t,i,h),this.emit("findin",t,i,h),h}return!1}}("undefined"!=typeof process&&void 0!==process.title?module:window);