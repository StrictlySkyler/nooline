function OpenReq(n,e,o,c){this.path=n,this.flags=e,this.mode=o,this.cb=c}function noop(){}function gracefulOpen(n,e,o,c){return"function"==typeof o&&(c=o,o=null),"function"!=typeof c&&(c=noop),fs._curOpen>=fs.MAX_OPEN?(queue.push(new OpenReq(n,e,o,c)),setTimeout(flush),void 0):(open(n,e,o,function(s,t){return s&&"EMFILE"===s.code&&fs._curOpen>fs.MIN_MAX_OPEN?(fs.MAX_OPEN=fs._curOpen-1,fs.open(n,e,o,c)):(c(s,t),void 0)}),void 0)}function open(n,e,o,c){c=c||noop,fs._curOpen++,fs._originalFs.open.call(fs,n,e,o,function(n,e){n&&onclose(),c(n,e)})}function onclose(){fs._curOpen--,flush()}function flush(){for(;fs._curOpen<fs.MAX_OPEN;){var n=queue.shift();if(!n)return;switch(n.constructor.name){case"OpenReq":open(n.path,n.flags||"r",n.mode||511,n.cb);break;case"ReaddirReq":readdir(n.path,n.cb);break;case"ReadFileReq":readFile(n.path,n.options,n.cb);break;case"WriteFileReq":writeFile(n.path,n.data,n.options,n.cb);break;default:throw Error("Unknown req type: "+n.constructor.name)}}}function gracefulReaddir(n,e){return fs._curOpen>=fs.MAX_OPEN?(queue.push(new ReaddirReq(n,e)),setTimeout(flush),void 0):(readdir(n,function(o,c){return o&&"EMFILE"===o.code&&fs._curOpen>fs.MIN_MAX_OPEN?(fs.MAX_OPEN=fs._curOpen-1,fs.readdir(n,e)):(e(o,c),void 0)}),void 0)}function readdir(n,e){e=e||noop,fs._curOpen++,fs._originalFs.readdir.call(fs,n,function(n,o){onclose(),e(n,o)})}function ReaddirReq(n,e){this.path=n,this.cb=e}function gracefulReadFile(n,e,o){return"function"==typeof e&&(o=e,e=null),"function"!=typeof o&&(o=noop),fs._curOpen>=fs.MAX_OPEN?(queue.push(new ReadFileReq(n,e,o)),setTimeout(flush),void 0):(readFile(n,e,function(c,s){return c&&"EMFILE"===c.code&&fs._curOpen>fs.MIN_MAX_OPEN?(fs.MAX_OPEN=fs._curOpen-1,fs.readFile(n,e,o)):(o(c,s),void 0)}),void 0)}function readFile(n,e,o){o=o||noop,fs._curOpen++,fs._originalFs.readFile.call(fs,n,e,function(n,e){onclose(),o(n,e)})}function ReadFileReq(n,e,o){this.path=n,this.options=e,this.cb=o}function gracefulWriteFile(n,e,o,c){return"function"==typeof o&&(c=o,o=null),"function"!=typeof c&&(c=noop),fs._curOpen>=fs.MAX_OPEN?(queue.push(new WriteFileReq(n,e,o,c)),setTimeout(flush),void 0):(writeFile(n,e,o,function(s){return s&&"EMFILE"===s.code&&fs._curOpen>fs.MIN_MAX_OPEN?(fs.MAX_OPEN=fs._curOpen-1,fs.writeFile(n,e,o,c)):(c(s),void 0)}),void 0)}function writeFile(n,e,o,c){c=c||noop,fs._curOpen++,fs._originalFs.writeFile.call(fs,n,e,o,function(n){onclose(),c(n)})}function WriteFileReq(n,e,o,c){this.path=n,this.data=e,this.options=o,this.cb=c}function chownFix(n){return n?function(e,o,c,s){return n.call(fs,e,o,c,function(n,e){chownErOk(n)&&(n=null),s(n,e)})}:n}function chownFixSync(n){return n?function(e,o,c){try{return n.call(fs,e,o,c)}catch(s){if(!chownErOk(s))throw s}}:n}function chownErOk(n){return n&&(process.getuid&&0===process.getuid()||"EINVAL"!==n.code&&"EPERM"!==n.code)?void 0:!0}var queue,constants,rename_,read,readSync,fs=exports=module.exports={};fs._originalFs=require("fs"),Object.getOwnPropertyNames(fs._originalFs).forEach(function(n){var e=Object.getOwnPropertyDescriptor(fs._originalFs,n);Object.defineProperty(fs,n,e)}),queue=[],constants=require("constants"),fs._curOpen=0,fs.MIN_MAX_OPEN=64,fs.MAX_OPEN=1024,fs.open=gracefulOpen,fs.openSync=function(n,e,o){var c;return c=fs._originalFs.openSync.call(fs,n,e,o),fs._curOpen++,c},fs.close=function(n,e){e=e||noop,fs._originalFs.close.call(fs,n,function(n){onclose(),e(n)})},fs.closeSync=function(n){try{return fs._originalFs.closeSync.call(fs,n)}finally{onclose()}},fs.readdir=gracefulReaddir,fs.readFile=gracefulReadFile,fs.writeFile=gracefulWriteFile,constants=require("constants"),constants.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&(fs.lchmod=function(n,e,o){o=o||noop,fs.open(n,constants.O_WRONLY|constants.O_SYMLINK,e,function(n,c){return n?(o(n),void 0):(fs.fchmod(c,e,function(n){fs.close(c,function(e){o(n||e)})}),void 0)})},fs.lchmodSync=function(n,e){var o,c,s,t=fs.openSync(n,constants.O_WRONLY|constants.O_SYMLINK,e);try{s=fs.fchmodSync(t,e)}catch(f){o=f}try{fs.closeSync(t)}catch(f){c=f}if(o||c)throw o||c;return s}),fs.lutimes||(constants.hasOwnProperty("O_SYMLINK")?(fs.lutimes=function(n,e,o,c){fs.open(n,constants.O_SYMLINK,function(n,s){return c=c||noop,n?c(n):(fs.futimes(s,e,o,function(n){fs.close(s,function(e){return c(n||e)})}),void 0)})},fs.lutimesSync=function(n,e,o){var c,s,t,f=fs.openSync(n,constants.O_SYMLINK);try{t=fs.futimesSync(f,e,o)}catch(r){c=r}try{fs.closeSync(f)}catch(r){s=r}if(c||s)throw c||s;return t}):fs.utimensat&&constants.hasOwnProperty("AT_SYMLINK_NOFOLLOW")?(fs.lutimes=function(n,e,o,c){fs.utimensat(n,e,o,constants.AT_SYMLINK_NOFOLLOW,c)},fs.lutimesSync=function(n,e,o){return fs.utimensatSync(n,e,o,constants.AT_SYMLINK_NOFOLLOW)}):(fs.lutimes=function(n,e,o,c){process.nextTick(c)},fs.lutimesSync=function(){})),fs.chown=chownFix(fs.chown),fs.fchown=chownFix(fs.fchown),fs.lchown=chownFix(fs.lchown),fs.chownSync=chownFixSync(fs.chownSync),fs.fchownSync=chownFixSync(fs.fchownSync),fs.lchownSync=chownFixSync(fs.lchownSync),fs.lchmod||(fs.lchmod=function(n,e,o){process.nextTick(o)},fs.lchmodSync=function(){}),fs.lchown||(fs.lchown=function(n,e,o,c){process.nextTick(c)},fs.lchownSync=function(){}),"win32"===process.platform&&(rename_=fs.rename,fs.rename=function(n,e,o){var c=Date.now();rename_(n,e,function s(t){return t&&("EACCES"===t.code||"EPERM"===t.code)&&Date.now()-c<1e3?rename_(n,e,s):(o(t),void 0)})}),read=fs.read,fs.read=function(n,e,o,c,s,t){var f,r;return t&&"function"==typeof t&&(r=0,f=function(i){return i&&"EAGAIN"===i.code&&10>r?(r++,read.call(fs,n,e,o,c,s,f)):(t.apply(this,arguments),void 0)}),read.call(fs,n,e,o,c,s,f)},readSync=fs.readSync,fs.readSync=function(n,e,o,c,s){for(var t=0;;)try{return readSync.call(fs,n,e,o,c,s)}catch(f){if("EAGAIN"===f.code&&10>t){t++;continue}throw f}};