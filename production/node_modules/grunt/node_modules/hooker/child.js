function sendMessage(e){process.stdout.write(JSON.stringify(e)+"\n")}var currentModule,path=null,fs=null,nodeunit=null,filepaths=fs.readdirSync("test").map(function(e){return path.join("test",e)}),unfinished={};process.on("uncaughtException",function(e){sendMessage({error:[e.name,e.message,e.stack]}),process.exit()}),unfinished={},process.on("exit",function(){var e=Object.keys(unfinished).length;e>0?sendMessage({exit:["UNFINISHED"]}):sendMessage({exit:["finished"]})}),nodeunit.reporters.test={run:function(e){var n=e.map(function(e){return path.resolve(e)});nodeunit.runFiles(n,{testspec:void 0,moduleStart:function(e){currentModule=e,sendMessage({moduleStart:[""+e]})},moduleDone:function(e){e===currentModule&&sendMessage({moduleDone:[""+e]})},testStart:function(e){unfinished[e]=e,sendMessage({testStart:[""+e]})},testDone:function(e,n){delete unfinished[e],sendMessage({testDone:[""+e,n.failures(),n.map(function(e){var n=e.error;return n&&(e.error={name:n.name,message:n.message,stack:n.stack}),e})]})},done:function(e){sendMessage({done:[e.failures(),e.duration,e]})}})}},nodeunit.reporters.test.run(filepaths,{});