$(document).ready(function(){module("Collections"),test("each",function(){var e,n;_.each([1,2,3],function(e,n){equal(e,n+1,"each iterators provide value and iteration count")}),e=[],_.each([1,2,3],function(n){e.push(n*this.multiplier)},{multiplier:5}),equal(e.join(", "),"5, 10, 15","context object property accessed"),e=[],_.forEach([1,2,3],function(n){e.push(n)}),equal(e.join(", "),"1, 2, 3",'aliased as "forEach"'),e=[],n={one:1,two:2,three:3},n.constructor.prototype.four=4,_.each(n,function(n,t){e.push(t)}),equal(e.join(", "),"one, two, three","iterating over objects works, and ignores the object prototype."),delete n.constructor.prototype.four,answer=null,_.each([1,2,3],function(e,n,t){_.include(t,e)&&(answer=!0)}),ok(answer,"can reference the original collection from inside the iterator"),e=0,_.each(null,function(){++e}),equal(e,0,"handles a null properly")}),test("map",function(){var e,n,t,o=_.map([1,2,3],function(e){return 2*e});equal(o.join(", "),"2, 4, 6","doubled numbers"),o=_.collect([1,2,3],function(e){return 2*e}),equal(o.join(", "),"2, 4, 6",'aliased as "collect"'),e=_.map([1,2,3],function(e){return e*this.multiplier},{multiplier:3}),equal(e.join(", "),"3, 6, 9","tripled numbers with context"),o=_([1,2,3]).map(function(e){return 2*e}),equal(o.join(", "),"2, 4, 6","OO-style doubled numbers"),document.querySelectorAll&&(n=_.map(document.querySelectorAll("#map-test *"),function(e){return e.id}),deepEqual(n,["id1","id2"],"Can use collection methods on NodeLists.")),n=_.map($("#map-test").children(),function(e){return e.id}),deepEqual(n,["id1","id2"],"Can use collection methods on jQuery Array-likes."),n=_.map(document.images,function(e){return e.id}),ok("chart_image"==n[0],"can use collection methods on HTMLCollections"),t=_.map(null,function(){}),ok(_.isArray(t)&&0===t.length,"handles a null properly")}),test("reduce",function(){var e,n,t=_.reduce([1,2,3],function(e,n){return e+n},0);equal(t,6,"can sum up an array"),e={multiplier:3},t=_.reduce([1,2,3],function(e,n){return e+n*this.multiplier},0,e),equal(t,18,"can reduce with a context object"),t=_.inject([1,2,3],function(e,n){return e+n},0),equal(t,6,'aliased as "inject"'),t=_([1,2,3]).reduce(function(e,n){return e+n},0),equal(t,6,"OO-style reduce"),t=_.reduce([1,2,3],function(e,n){return e+n}),equal(t,6,"default initial value");try{_.reduce(null,function(){})}catch(o){n=o}ok(n instanceof TypeError,"handles a null (without inital value) properly"),ok(138===_.reduce(null,function(){},138),"handles a null (with initial value) properly"),equal(_.reduce([],function(){},void 0),void 0,"undefined can be passed as a special case"),raises(function(){_.reduce([],function(){})},TypeError,"throws an error for empty arrays with no initial value")}),test("reduceRight",function(){var e,n,t,o,a,r,u,i=_.reduceRight(["foo","bar","baz"],function(e,n){return e+n},"");equal(i,"bazbarfoo","can perform right folds"),i=_.foldr(["foo","bar","baz"],function(e,n){return e+n},""),equal(i,"bazbarfoo",'aliased as "foldr"'),i=_.foldr(["foo","bar","baz"],function(e,n){return e+n}),equal(i,"bazbarfoo","default initial value");try{_.reduceRight(null,function(){})}catch(l){e=l}ok(e instanceof TypeError,"handles a null (without inital value) properly"),n=_.reduceRight({a:1,b:2,c:3},function(e,n){return e+n}),equal(n,6,"default initial value on object"),ok(138===_.reduceRight(null,function(){},138),"handles a null (with initial value) properly"),equal(_.reduceRight([],function(){},void 0),void 0,"undefined can be passed as a special case"),raises(function(){_.reduceRight([],function(){})},TypeError,"throws an error for empty arrays with no initial value"),o={},a={a:1,b:2},r=_.keys(a).pop(),u="a"==r?[o,1,"a",a]:[o,2,"b",a],_.reduceRight(a,function(){t||(t=_.toArray(arguments))},o),deepEqual(t,u),a={2:"a",1:"b"},r=_.keys(a).pop(),t=null,u="2"==r?[o,"a","2",a]:[o,"b","1",a],_.reduceRight(a,function(){t||(t=_.toArray(arguments))},o),deepEqual(t,u)}),test("find",function(){var e=[1,2,3,4];strictEqual(_.find(e,function(e){return e>2}),3,"should return first found `value`"),strictEqual(_.find(e,function(){return!1}),void 0,"should return `undefined` if `value` is not found")}),test("detect",function(){var e=_.detect([1,2,3],function(e){return 4==2*e});equal(e,2,'found the first "2" and broke the loop')}),test("select",function(){var e=_.select([1,2,3,4,5,6],function(e){return 0==e%2});equal(e.join(", "),"2, 4, 6","selected each even number"),e=_.filter([1,2,3,4,5,6],function(e){return 0==e%2}),equal(e.join(", "),"2, 4, 6",'aliased as "filter"')}),test("reject",function(){var e,n,t=_.reject([1,2,3,4,5,6],function(e){return 0==e%2});equal(t.join(", "),"1, 3, 5","rejected each even number"),e="obj",n=_.reject([1,2,3,4,5,6],function(n){return equal(e,"obj"),0!=n%2},e),equal(n.join(", "),"2, 4, 6","rejected each odd number")}),test("all",function(){ok(_.all([],_.identity),"the empty set"),ok(_.all([!0,!0,!0],_.identity),"all true values"),ok(!_.all([!0,!1,!0],_.identity),"one false value"),ok(_.all([0,10,28],function(e){return 0==e%2}),"even numbers"),ok(!_.all([0,11,28],function(e){return 0==e%2}),"an odd number"),ok(_.all([1],_.identity)===!0,"cast to boolean - true"),ok(_.all([0],_.identity)===!1,"cast to boolean - false"),ok(_.every([!0,!0,!0],_.identity),'aliased as "every"'),ok(!_.all([void 0,void 0,void 0],_.identity),"works with arrays of undefined")}),test("any",function(){var e=Array.prototype.some;Array.prototype.some=null,ok(!_.any([]),"the empty set"),ok(!_.any([!1,!1,!1]),"all false values"),ok(_.any([!1,!1,!0]),"one true value"),ok(_.any([null,0,"yes",!1]),"a string"),ok(!_.any([null,0,"",!1]),"falsy values"),ok(!_.any([1,11,29],function(e){return 0==e%2}),"all odd numbers"),ok(_.any([1,10,29],function(e){return 0==e%2}),"an even number"),ok(_.any([1],_.identity)===!0,"cast to boolean - true"),ok(_.any([0],_.identity)===!1,"cast to boolean - false"),ok(_.some([!1,!1,!0]),'aliased as "some"'),Array.prototype.some=e}),test("include",function(){ok(_.include([1,2,3],2),"two is in the array"),ok(!_.include([1,3,9],2),"two is not in the array"),ok(_.contains({moe:1,larry:3,curly:9},3)===!0,"_.include on objects checks their values"),ok(_([1,2,3]).include(2),"OO-style include")}),test("invoke",function(){var e=[[5,1,7],[3,2,1]],n=_.invoke(e,"sort");equal(n[0].join(", "),"1, 5, 7","first array sorted"),equal(n[1].join(", "),"1, 2, 3","second array sorted")}),test("invoke w/ function reference",function(){var e=[[5,1,7],[3,2,1]],n=_.invoke(e,Array.prototype.sort);equal(n[0].join(", "),"1, 5, 7","first array sorted"),equal(n[1].join(", "),"1, 2, 3","second array sorted")}),test("invoke when strings have a call method",function(){var e,n,t;String.prototype.call=function(){return 42},e=[[5,1,7],[3,2,1]],n="foo",equal(n.call(),42,"call function exists"),t=_.invoke(e,"sort"),equal(t[0].join(", "),"1, 5, 7","first array sorted"),equal(t[1].join(", "),"1, 2, 3","second array sorted"),delete String.prototype.call,equal(n.call,void 0,"call function removed")}),test("pluck",function(){var e=[{name:"moe",age:30},{name:"curly",age:50}];equal(_.pluck(e,"name").join(", "),"moe, curly","pulls names out of objects")}),test("where",function(){var e=[{a:1,b:2},{a:2,b:2},{a:1,b:3},{a:1,b:4}],n=_.where(e,{a:1});equal(n.length,3),equal(n[n.length-1].b,4),n=_.where(e,{b:2}),equal(n.length,2),equal(n[0].a,1)}),test("max",function(){equal(3,_.max([1,2,3]),"can perform a regular Math.max");var e=_.max([1,2,3],function(e){return-e});equal(e,1,"can perform a computation-based max"),equal(-1/0,_.max({}),"Maximum value of an empty object"),equal(-1/0,_.max([]),"Maximum value of an empty array"),equal(299999,_.max(_.range(1,3e5)),"Maximum value of a too-big array")}),test("min",function(){var e,n,t;equal(1,_.min([1,2,3]),"can perform a regular Math.min"),e=_.min([1,2,3],function(e){return-e}),equal(e,3,"can perform a computation-based min"),equal(1/0,_.min({}),"Minimum value of an empty object"),equal(1/0,_.min([]),"Minimum value of an empty array"),n=new Date(9999999999),t=new Date(0),equal(_.min([n,t]),t),equal(1,_.min(_.range(1,3e5)),"Minimum value of a too-big array")}),test("sortBy",function(){function e(e,n){this.x=e,this.y=n}var n,t,o,a,r=[{name:"curly",age:50},{name:"moe",age:30}];r=_.sortBy(r,function(e){return e.age}),equal(_.pluck(r,"name").join(", "),"moe, curly","stooges sorted by age"),n=[void 0,4,1,void 0,3,2],equal(_.sortBy(n,_.identity).join(","),"1,2,3,4,,","sortBy with undefined values"),n=["one","two","three","four","five"],t=_.sortBy(n,"length"),equal(t.join(" "),"one two four five three","sorted by length"),o=[new e(1,1),new e(1,2),new e(1,3),new e(1,4),new e(1,5),new e(1,6),new e(2,1),new e(2,2),new e(2,3),new e(2,4),new e(2,5),new e(2,6),new e(void 0,1),new e(void 0,2),new e(void 0,3),new e(void 0,4),new e(void 0,5),new e(void 0,6)],a=_.sortBy(o,function(e){return e.x}),deepEqual(a,o,"sortBy should be stable")}),test("groupBy",function(){var e,n,t,o,a=_.groupBy([1,2,3,4,5,6],function(e){return e%2});ok("0"in a&&"1"in a,"created a group for each value"),equal(a[0].join(", "),"2, 4, 6","put each even number in the right group"),e=["one","two","three","four","five","six","seven","eight","nine","ten"],n=_.groupBy(e,"length"),equal(n["3"].join(" "),"one two six ten"),equal(n["4"].join(" "),"four five nine"),equal(n["5"].join(" "),"three seven eight"),t={},_.groupBy([{}],function(){ok(this===t)},t),n=_.groupBy([4.2,6.1,6.4],function(e){return Math.floor(e)>4?"hasOwnProperty":"constructor"}),equal(n.constructor.length,1),equal(n.hasOwnProperty.length,2),o=[{}],_.groupBy(o,function(e,n,t){ok(t===o)})}),test("countBy",function(){var e,n,t,o,a=_.countBy([1,2,3,4,5],function(e){return 0==e%2});equal(a["true"],2),equal(a["false"],3),e=["one","two","three","four","five","six","seven","eight","nine","ten"],n=_.countBy(e,"length"),equal(n["3"],4),equal(n["4"],3),equal(n["5"],3),t={},_.countBy([{}],function(){ok(this===t)},t),n=_.countBy([4.2,6.1,6.4],function(e){return Math.floor(e)>4?"hasOwnProperty":"constructor"}),equal(n.constructor,1),equal(n.hasOwnProperty,2),o=[{}],_.countBy(o,function(e,n,t){ok(t===o)})}),test("sortedIndex",function(){var e,n,t,o,a=[10,20,30,40,50],r=35,u=_.sortedIndex(a,r);equal(u,3,"35 should be inserted at index 3"),e=_.sortedIndex(a,30),equal(e,2,"30 should be inserted at index 2"),n=[{x:10},{x:20},{x:30},{x:40}],t=function(e){return e.x},strictEqual(_.sortedIndex(n,{x:25},t),2),strictEqual(_.sortedIndex(n,{x:35},"x"),3),o={1:2,2:3,3:4},t=function(e){return this[e]},strictEqual(_.sortedIndex([1,3],2,t,o),1)}),test("shuffle",function(){var e=_.range(10),n=_.shuffle(e).sort();notStrictEqual(e,n,"original object is unmodified"),equal(n.join(","),e.join(","),"contains the same members before and after shuffle")}),test("toArray",function(){var e,n;ok(!_.isArray(arguments),"arguments object is not an array"),ok(_.isArray(_.toArray(arguments)),"arguments object converted into array"),e=[1,2,3],ok(_.toArray(e)!==e,"array is cloned"),equal(_.toArray(e).join(", "),"1, 2, 3","cloned array contains same elements"),n=_.toArray({one:1,two:2,three:3}),equal(n.join(", "),"1, 2, 3","object flattened into array")}),test("size",function(){equal(_.size({one:1,two:2,three:3}),3,"can compute the size of an object"),equal(_.size([1,2,3]),3,"can compute the size of an array");var e=function(){return _.size(arguments)};equal(e(1,2,3,4),4,"can test the size of the arguments object"),equal(_.size("hello"),5,"can compute the size of a string"),equal(_.size(null),0,"handles nulls")})});