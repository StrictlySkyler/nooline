function FileReader(e){var r=this;if(!(r instanceof FileReader))throw Error("FileReader must be called as constructor.");if(!("Link"===e.type&&e.Link||"File"===e.type&&e.File))throw Error("Non-file type "+e.type);r._buffer=[],r._bytesEmitted=0,Reader.call(r,e)}module.exports=FileReader;var fs=require("../../graceful-fs/graceful-fs.js"),fstream=require("../fstream.js"),Reader=fstream.Reader,inherits=require("../../inherits/inherits.js"),mkdir=require("../../mkdirp"),Reader=require("./reader.js"),EOF={EOF:!0},CLOSE={CLOSE:!0};inherits(FileReader,Reader),FileReader.prototype._getStream=function(){var e=this,r=e._stream=fs.createReadStream(e._path,e.props);e.props.blksize&&(r.bufferSize=e.props.blksize),r.on("open",e.emit.bind(e,"open")),r.on("data",function(r){e._bytesEmitted+=r.length,r.length&&(e._paused||e._buffer.length?(e._buffer.push(r),e._read()):e.emit("data",r))}),r.on("end",function(){e._paused||e._buffer.length?(e._buffer.push(EOF),e._read()):e.emit("end"),e._bytesEmitted!==e.props.size&&e.error("Didn't get expected byte count\nexpect: "+e.props.size+"\n"+"actual: "+e._bytesEmitted)}),r.on("close",function(){e._paused||e._buffer.length?(e._buffer.push(CLOSE),e._read()):e.emit("close")}),e._read()},FileReader.prototype._read=function(){var e,r,t,i,a=this;if(!a._paused){if(!a._stream)return a._getStream();if(a._buffer.length){for(e=a._buffer,r=0,t=e.length;t>r;r++)if(i=e[r],i===EOF?a.emit("end"):i===CLOSE?a.emit("close"):a.emit("data",i),a._paused)return a._buffer=e.slice(r),void 0;a._buffer.length=0}}},FileReader.prototype.pause=function(e){var r=this;r._paused||(e=e||r,r._paused=!0,r._stream&&r._stream.pause(),r.emit("pause",e))},FileReader.prototype.resume=function(e){var r=this;r._paused&&(e=e||r,r.emit("resume",e),r._paused=!1,r._stream&&r._stream.resume(),r._read())};