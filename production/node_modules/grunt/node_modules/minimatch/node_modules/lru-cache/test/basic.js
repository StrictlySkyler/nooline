var test=require("tap").test,LRU=require("../");test("basic",function(e){var t=new LRU({max:10});t.set("key","value"),e.equal(t.get("key"),"value"),e.equal(t.get("nada"),void 0),e.equal(t.length,1),e.equal(t.max,10),e.end()}),test("least recently set",function(e){var t=new LRU(2);t.set("a","A"),t.set("b","B"),t.set("c","C"),e.equal(t.get("c"),"C"),e.equal(t.get("b"),"B"),e.equal(t.get("a"),void 0),e.end()}),test("lru recently gotten",function(e){var t=new LRU(2);t.set("a","A"),t.set("b","B"),t.get("a"),t.set("c","C"),e.equal(t.get("c"),"C"),e.equal(t.get("b"),void 0),e.equal(t.get("a"),"A"),e.end()}),test("del",function(e){var t=new LRU(2);t.set("a","A"),t.del("a"),e.equal(t.get("a"),void 0),e.end()}),test("max",function(e){var t,a=new LRU(3);for(a.max=100,t=0;100>t;t++)a.set(t,t);for(e.equal(a.length,100),t=0;100>t;t++)e.equal(a.get(t),t);for(a.max=3,e.equal(a.length,3),t=0;97>t;t++)e.equal(a.get(t),void 0);for(t=98;100>t;t++)e.equal(a.get(t),t);for(a.max="hello",t=0;100>t;t++)a.set(t,t);for(e.equal(a.length,100),t=0;100>t;t++)e.equal(a.get(t),t);for(a.max=3,e.equal(a.length,3),t=0;97>t;t++)e.equal(a.get(t),void 0);for(t=98;100>t;t++)e.equal(a.get(t),t);e.end()}),test("reset",function(e){var t=new LRU(10);t.set("a","A"),t.set("b","B"),t.reset(),e.equal(t.length,0),e.equal(t.max,10),e.equal(t.get("a"),void 0),e.equal(t.get("b"),void 0),e.end()}),test("dump",function(e){var t=new LRU(10),a=t.dump();e.equal(Object.keys(a).length,0,"nothing in dump for empty cache"),t.set("a","A"),a=t.dump(),e.ok(a.a),e.equal(a.a.key,"a"),e.equal(a.a.value,"A"),e.equal(a.a.lu,0),t.set("b","B"),t.get("b"),a=t.dump(),e.ok(a.b),e.equal(a.b.key,"b"),e.equal(a.b.value,"B"),e.equal(a.b.lu,2),e.end()}),test("basic with weighed length",function(e){var t=new LRU({max:100,length:function(e){return e.size}});t.set("key",{val:"value",size:50}),e.equal(t.get("key").val,"value"),e.equal(t.get("nada"),void 0),e.equal(t.lengthCalculator(t.get("key")),50),e.equal(t.length,50),e.equal(t.max,100),e.end()}),test("weighed length item too large",function(e){var t=new LRU({max:10,length:function(e){return e.size}});e.equal(t.max,10),t.set("key",{val:"value",size:50}),e.equal(t.length,0),e.equal(t.get("key"),void 0),e.end()}),test("least recently set with weighed length",function(e){var t=new LRU({max:8,length:function(e){return e.length}});t.set("a","A"),t.set("b","BB"),t.set("c","CCC"),t.set("d","DDDD"),e.equal(t.get("d"),"DDDD"),e.equal(t.get("c"),"CCC"),e.equal(t.get("b"),void 0),e.equal(t.get("a"),void 0),e.end()}),test("lru recently gotten with weighed length",function(e){var t=new LRU({max:8,length:function(e){return e.length}});t.set("a","A"),t.set("b","BB"),t.set("c","CCC"),t.get("a"),t.get("b"),t.set("d","DDDD"),e.equal(t.get("c"),void 0),e.equal(t.get("d"),"DDDD"),e.equal(t.get("b"),"BB"),e.equal(t.get("a"),"A"),e.end()}),test("set returns proper booleans",function(e){var t=new LRU({max:5,length:function(e){return e.length}});e.equal(t.set("a","A"),!0),e.equal(t.set("b","donuts"),!1),e.equal(t.set("b","B"),!0),e.equal(t.set("c","CCCC"),!0),e.end()}),test("drop the old items",function(e){var t=new LRU({max:5,maxAge:50});t.set("a","A"),setTimeout(function(){t.set("b","b"),e.equal(t.get("a"),"A")},25),setTimeout(function(){t.set("c","C"),e.notOk(t.get("a"))},60),setTimeout(function(){e.notOk(t.get("b")),e.equal(t.get("c"),"C")},90),setTimeout(function(){e.notOk(t.get("c")),e.end()},155)}),test("disposal function",function(e){var t=!1,a=new LRU({max:1,dispose:function(e,a){t=a}});a.set(1,1),a.set(2,2),e.equal(t,1),a.set(3,3),e.equal(t,2),a.reset(),e.equal(t,3),e.end()}),test("disposal function on too big of item",function(e){var t=!1,a=new LRU({max:1,length:function(e){return e.length},dispose:function(e,a){t=a}}),n=[1,2];e.equal(t,!1),a.set("obj",n),e.equal(t,n),e.end()}),test("has()",function(e){var t=new LRU({max:1,maxAge:10});t.set("foo","bar"),e.equal(t.has("foo"),!0),t.set("blu","baz"),e.equal(t.has("foo"),!1),e.equal(t.has("blu"),!0),setTimeout(function(){e.equal(t.has("blu"),!1),e.end()},15)}),test("stale",function(e){var t=new LRU({maxAge:10,stale:!0});t.set("foo","bar"),e.equal(t.get("foo"),"bar"),e.equal(t.has("foo"),!0),setTimeout(function(){e.equal(t.has("foo"),!1),e.equal(t.get("foo"),"bar"),e.equal(t.get("foo"),void 0),e.end()},15)}),test("lru update via set",function(e){var t=LRU({max:2});t.set("foo",1),t.set("bar",2),t.del("bar"),t.set("baz",3),t.set("qux",4),e.equal(t.get("foo"),void 0),e.equal(t.get("bar"),void 0),e.equal(t.get("baz"),3),e.equal(t.get("qux"),4),e.end()}),test("least recently set w/ peek",function(e){var t=new LRU(2);t.set("a","A"),t.set("b","B"),e.equal(t.peek("a"),"A"),t.set("c","C"),e.equal(t.get("c"),"C"),e.equal(t.get("b"),"B"),e.equal(t.get("a"),void 0),e.end()});