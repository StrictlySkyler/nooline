(function(){var t,n,e,i,r,s,o,a,l,c,E,T,u,N,h,I,p,d,f=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1},R=[].slice;for(exports.Rewriter=function(){function t(){}return t.prototype.rewrite=function(t){return this.tokens=t,this.removeLeadingNewlines(),this.removeMidExpressionNewlines(),this.closeOpenCalls(),this.closeOpenIndexes(),this.addImplicitIndentation(),this.tagPostfixConditionals(),this.addImplicitBraces(),this.addImplicitParentheses(),this.tokens},t.prototype.scanTokens=function(t){var n,e,i;for(i=this.tokens,n=0;e=i[n];)n+=t.call(this,e,n,i);return!0},t.prototype.detectEnd=function(t,n,r){var s,o,a,l,c;for(a=this.tokens,s=0;o=a[t];){if(0===s&&n.call(this,o,t))return r.call(this,o,t);if(!o||0>s)return r.call(this,o,t-1);l=o[0],f.call(i,l)>=0?s+=1:(c=o[0],f.call(e,c)>=0&&(s-=1)),t+=1}return t-1},t.prototype.removeLeadingNewlines=function(){var t,n,e,i,r;for(r=this.tokens,t=e=0,i=r.length;i>e&&(n=r[t][0],"TERMINATOR"===n);t=++e);return t?this.tokens.splice(0,t):void 0},t.prototype.removeMidExpressionNewlines=function(){return this.scanTokens(function(t,e,i){var r;return"TERMINATOR"===t[0]&&(r=this.tag(e+1),f.call(n,r)>=0)?(i.splice(e,1),0):1})},t.prototype.closeOpenCalls=function(){var t,n;return n=function(t,n){var e;return")"===(e=t[0])||"CALL_END"===e||"OUTDENT"===t[0]&&")"===this.tag(n-1)},t=function(t,n){return this.tokens["OUTDENT"===t[0]?n-1:n][0]="CALL_END"},this.scanTokens(function(e,i){return"CALL_START"===e[0]&&this.detectEnd(i+1,n,t),1})},t.prototype.closeOpenIndexes=function(){var t,n;return n=function(t){var n;return"]"===(n=t[0])||"INDEX_END"===n},t=function(t){return t[0]="INDEX_END"},this.scanTokens(function(e,i){return"INDEX_START"===e[0]&&this.detectEnd(i+1,n,t),1})},t.prototype.addImplicitBraces=function(){var t,n,r,s,a,l,c,T;return s=[],a=null,T=null,r=!0,l=0,c=0,n=function(t,n){var e,i,s,a,l,u;return l=this.tokens.slice(n+1,n+3+1||9e9),e=l[0],a=l[1],s=l[2],"HERECOMMENT"===(null!=e?e[0]:void 0)?!1:(i=t[0],f.call(E,i)>=0&&(r=!1),("TERMINATOR"===i||"OUTDENT"===i||f.call(o,i)>=0&&r&&!(1===n-c))&&(!T&&","!==this.tag(n-1)||!(":"===(null!=a?a[0]:void 0)||"@"===(null!=e?e[0]:void 0)&&":"===(null!=s?s[0]:void 0)))||","===i&&e&&"IDENTIFIER"!==(u=e[0])&&"NUMBER"!==u&&"STRING"!==u&&"@"!==u&&"TERMINATOR"!==u&&"OUTDENT"!==u)},t=function(t,n){var e;return e=this.generate("}","}",t[2]),this.tokens.splice(n,0,e)},this.scanTokens(function(o,l,u){var N,h,I,p,d,R,L,A;if(L=p=o[0],f.call(i,L)>=0)return s.push(["INDENT"===p&&"{"===this.tag(l-1)?"{":p,l]),1;if(f.call(e,p)>=0)return a=s.pop(),1;if(":"!==p||":"!==(N=this.tag(l-2))&&"{"===(null!=(A=s[s.length-1])?A[0]:void 0))return 1;for(r=!0,c=l+1,s.push(["{"]),h="@"===N?l-2:l-1;"HERECOMMENT"===this.tag(h-2);)h-=2;return I=this.tag(h-1),T=!I||f.call(E,I)>=0,R=new String("{"),R.generated=!0,d=this.generate("{",R,o[2]),u.splice(h,0,d),this.detectEnd(l+2,n,t),2})},t.prototype.addImplicitParentheses=function(){var t,n,e,i,c;return e=c=i=!1,n=function(t,n){var e,s,a,l;return s=t[0],!c&&t.fromThen?!0:(("IF"===s||"ELSE"===s||"CATCH"===s||"->"===s||"=>"===s||"CLASS"===s)&&(c=!0),("IF"===s||"ELSE"===s||"SWITCH"===s||"TRY"===s||"="===s)&&(i=!0),"."!==s&&"?."!==s&&"::"!==s||"OUTDENT"!==this.tag(n-1)?!t.generated&&","!==this.tag(n-1)&&(f.call(o,s)>=0||"INDENT"===s&&!i)&&("INDENT"!==s||"CLASS"!==(a=this.tag(n-2))&&"EXTENDS"!==a&&(l=this.tag(n-1),f.call(r,l)<0)&&!((e=this.tokens[n+1])&&e.generated&&"{"===e[0])):!0)},t=function(t,n){return this.tokens.splice(n,0,this.generate("CALL_END",")",t[2]))},this.scanTokens(function(r,o,T){var u,N,h,I,p,d,R,L;return p=r[0],("CLASS"===p||"IF"===p||"FOR"===p||"WHILE"===p)&&(e=!0),d=T.slice(o-1,o+1+1||9e9),I=d[0],N=d[1],h=d[2],u=!e&&"INDENT"===p&&h&&h.generated&&"{"===h[0]&&I&&(R=I[0],f.call(a,R)>=0),c=!1,i=!1,f.call(E,p)>=0&&(e=!1),I&&!I.spaced&&"?"===p&&(r.call=!0),r.fromThen?1:u||(null!=I?I.spaced:void 0)&&(I.call||(L=I[0],f.call(a,L)>=0))&&(f.call(s,p)>=0||!r.spaced&&!r.newLine&&f.call(l,p)>=0)?(T.splice(o,0,this.generate("CALL_START","(",r[2])),this.detectEnd(o+1,n,t),"?"===I[0]&&(I[0]="FUNC_EXIST"),2):1})},t.prototype.addImplicitIndentation=function(){var t,n,e,i,r;return r=e=i=null,n=function(t){var n;return";"!==t[1]&&(n=t[0],f.call(T,n)>=0)&&!("ELSE"===t[0]&&"IF"!==r&&"THEN"!==r)},t=function(t,n){return this.tokens.splice(","===this.tag(n-1)?n-1:n,0,i)},this.scanTokens(function(s,o,a){var l,c,E;return l=s[0],"TERMINATOR"===l&&"THEN"===this.tag(o+1)?(a.splice(o,1),0):"ELSE"===l&&"OUTDENT"!==this.tag(o-1)?(a.splice.apply(a,[o,0].concat(R.call(this.indentation(s)))),2):"CATCH"!==l||"OUTDENT"!==(c=this.tag(o+2))&&"TERMINATOR"!==c&&"FINALLY"!==c?f.call(u,l)>=0&&"INDENT"!==this.tag(o+1)&&("ELSE"!==l||"IF"!==this.tag(o+1))?(r=l,E=this.indentation(s,!0),e=E[0],i=E[1],"THEN"===r&&(e.fromThen=!0),a.splice(o+1,0,e),this.detectEnd(o+2,n,t),"THEN"===l&&a.splice(o,1),1):1:(a.splice.apply(a,[o+2,0].concat(R.call(this.indentation(s)))),4)})},t.prototype.tagPostfixConditionals=function(){var t,n,e;return e=null,n=function(t){var n;return"TERMINATOR"===(n=t[0])||"INDENT"===n},t=function(t){return"INDENT"!==t[0]||t.generated&&!t.fromThen?e[0]="POST_"+e[0]:void 0},this.scanTokens(function(i,r){return"IF"!==i[0]?1:(e=i,this.detectEnd(r+1,n,t),1)})},t.prototype.indentation=function(t,n){var e,i;return null==n&&(n=!1),e=["INDENT",2,t[2]],i=["OUTDENT",2,t[2]],n&&(e.generated=i.generated=!0),[e,i]},t.prototype.generate=function(t,n,e){var i;return i=[t,n,e],i.generated=!0,i},t.prototype.tag=function(t){var n;return null!=(n=this.tokens[t])?n[0]:void 0},t}(),t=[["(",")"],["[","]"],["{","}"],["INDENT","OUTDENT"],["CALL_START","CALL_END"],["PARAM_START","PARAM_END"],["INDEX_START","INDEX_END"]],exports.INVERSES=c={},i=[],e=[],I=0,p=t.length;p>I;I++)d=t[I],N=d[0],h=d[1],i.push(c[h]=N),e.push(c[N]=h);n=["CATCH","WHEN","ELSE","FINALLY"].concat(e),a=["IDENTIFIER","SUPER",")","CALL_END","]","INDEX_END","@","THIS"],s=["IDENTIFIER","NUMBER","STRING","JS","REGEX","NEW","PARAM_START","CLASS","IF","TRY","SWITCH","THIS","BOOL","NULL","UNDEFINED","UNARY","SUPER","@","->","=>","[","(","{","--","++"],l=["+","-"],r=["->","=>","{","[",","],o=["POST_IF","FOR","WHILE","UNTIL","WHEN","BY","LOOP","TERMINATOR"],u=["ELSE","->","=>","TRY","FINALLY","THEN"],T=["TERMINATOR","CATCH","FINALLY","ELSE","OUTDENT","LEADING_WHEN"],E=["TERMINATOR","INDENT","OUTDENT"]}).call(this);