(function(){var t,e,n,i,s,r,o,h,c,a,l,u,p,f,d,T,k,g,E,N,R,S,I,O,x,A,v,w,b,y,m,D,L,F,G,U,_,M,C,H,P,X,B,z,W,Y,$,K,j=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};$=null,G=$.Rewriter,k=$.INVERSES,K=null,B=K.count,Y=K.starts,X=K.compact,W=K.last,exports.Lexer=O=function(){function t(){}return t.prototype.tokenize=function(t,e){var n,i;for(null==e&&(e={}),P.test(t)&&(t="\n"+t),t=t.replace(/\r/g,"").replace(C,""),this.code=t,this.line=e.line||0,this.indent=0,this.indebt=0,this.outdebt=0,this.indents=[],this.ends=[],this.tokens=[],n=0;this.chunk=t.slice(n);)n+=this.identifierToken()||this.commentToken()||this.whitespaceToken()||this.lineToken()||this.heredocToken()||this.stringToken()||this.numberToken()||this.regexToken()||this.jsToken()||this.literalToken();return this.closeIndentation(),(i=this.ends.pop())&&this.error("missing "+i),e.rewrite===!1?this.tokens:(new G).rewrite(this.tokens)},t.prototype.identifierToken=function(){var t,e,n,o,h,c,a,l,u;return(h=d.exec(this.chunk))?(o=h[0],n=h[1],t=h[2],"own"===n&&"FOR"===this.tag()?(this.token("OWN",n),n.length):(e=t||(c=W(this.tokens))&&("."===(l=c[0])||"?."===l||"::"===l||!c.spaced&&"@"===c[0]),a="IDENTIFIER",!e&&(j.call(N,n)>=0||j.call(r,n)>=0)&&(a=n.toUpperCase(),"WHEN"===a&&(u=this.tag(),j.call(R,u)>=0)?a="LEADING_WHEN":"FOR"===a?this.seenFor=!0:"UNLESS"===a?a="IF":j.call(H,a)>=0?a="UNARY":j.call(L,a)>=0&&("INSTANCEOF"!==a&&this.seenFor?(a="FOR"+a,this.seenFor=!1):(a="RELATION","!"===this.value()&&(this.tokens.pop(),n="!"+n)))),j.call(E,n)>=0&&(e?(a="IDENTIFIER",n=new String(n),n.reserved=!0):j.call(F,n)>=0&&this.error('reserved word "'+n+'"')),e||(j.call(i,n)>=0&&(n=s[n]),a=function(){switch(n){case"!":return"UNARY";case"==":case"!=":return"COMPARE";case"&&":case"||":return"LOGIC";case"true":case"false":return"BOOL";case"break":case"continue":return"STATEMENT";default:return a}}()),this.token(a,n),t&&this.token(":",":"),o.length)):0},t.prototype.numberToken=function(){var t,e,n,i,s;return(n=y.exec(this.chunk))?(i=n[0],/^0[BOX]/.test(i)?this.error("radix prefix '"+i+"' must be lowercase"):/E/.test(i)&&!/^0x/.test(i)?this.error("exponential notation '"+i+"' must be indicated with a lowercase 'e'"):/^0\d*[89]/.test(i)?this.error("decimal literal '"+i+"' must not be prefixed with '0'"):/^0\d+/.test(i)&&this.error("octal literal '"+i+"' must be prefixed with '0o'"),e=i.length,(s=/^0o([0-7]+)/.exec(i))&&(i="0x"+parseInt(s[1],8).toString(16)),(t=/^0b([01]+)/.exec(i))&&(i="0x"+parseInt(t[1],2).toString(16)),this.token("NUMBER",i),e):0},t.prototype.stringToken=function(){var t,e,n;switch(this.chunk.charAt(0)){case"'":if(!(t=_.exec(this.chunk)))return 0;this.token("STRING",(n=t[0]).replace(A,"\\\n"));break;case'"':if(!(n=this.balancedString(this.chunk,'"')))return 0;0<n.indexOf("#{",1)?this.interpolateString(n.slice(1,-1)):this.token("STRING",this.escapeLines(n));break;default:return 0}return(e=/^(?:\\.|[^\\])*\\(?:0[0-7]|[1-7])/.test(n))&&this.error("octal escape sequences "+n+" are not allowed"),this.line+=B(n,"\n"),n.length},t.prototype.heredocToken=function(){var t,e,n,i;return(n=a.exec(this.chunk))?(e=n[0],i=e.charAt(0),t=this.sanitizeHeredoc(n[2],{quote:i,indent:null}),'"'===i&&0<=t.indexOf("#{")?this.interpolateString(t,{heredoc:!0}):this.token("STRING",this.makeString(t,i,!0)),this.line+=B(e,"\n"),e.length):0},t.prototype.commentToken=function(){var t,e,n;return(n=this.chunk.match(o))?(t=n[0],e=n[1],e&&this.token("HERECOMMENT",this.sanitizeHeredoc(e,{herecomment:!0,indent:Array(this.indent+1).join(" ")})),this.line+=B(t,"\n"),t.length):0},t.prototype.jsToken=function(){var t,e;return"`"===this.chunk.charAt(0)&&(t=g.exec(this.chunk))?(this.token("JS",(e=t[0]).slice(1,-1)),e.length):0},t.prototype.regexToken=function(){var t,e,n,i,s,r,o;return"/"!==this.chunk.charAt(0)?0:(n=p.exec(this.chunk))?(e=this.heregexToken(n),this.line+=B(n[0],"\n"),e):(i=W(this.tokens),i&&(r=i[0],j.call(i.spaced?w:b,r)>=0)?0:(n=D.exec(this.chunk))?(o=n,n=o[0],s=o[1],t=o[2],"/*"===s.slice(0,2)&&this.error("regular expressions cannot begin with `*`"),"//"===s&&(s="/(?:)/"),this.token("REGEX",""+s+t),n.length):0)},t.prototype.heregexToken=function(t){var e,n,i,s,r,o,h,c,a,l,u,p,d;if(i=t[0],e=t[1],n=t[2],0>e.indexOf("#{"))return s=e.replace(f,"").replace(/\//g,"\\/"),s.match(/^\*/)&&this.error("regular expressions cannot begin with `*`"),this.token("REGEX","/"+(s||"(?:)")+"/"+n),i.length;for(this.token("IDENTIFIER","RegExp"),this.tokens.push(["CALL_START","("]),o=[],l=this.interpolateString(e,{regex:!0}),c=0,a=l.length;a>c;c++){if(u=l[c],r=u[0],h=u[1],"TOKENS"===r)o.push.apply(o,h);else{if(!(h=h.replace(f,"")))continue;h=h.replace(/\\/g,"\\\\"),o.push(["STRING",this.makeString(h,'"',!0)])}o.push(["+","+"])}return o.pop(),"STRING"!==(null!=(p=o[0])?p[0]:void 0)&&this.tokens.push(["STRING",'""'],["+","+"]),(d=this.tokens).push.apply(d,o),n&&this.tokens.push([",",","],["STRING",'"'+n+'"']),this.token(")",")"),i.length},t.prototype.lineToken=function(){var t,e,n,i,s,r;if(!(n=v.exec(this.chunk)))return 0;if(e=n[0],this.line+=B(e,"\n"),this.seenFor=!1,s=W(this.tokens,1),r=e.length-1-e.lastIndexOf("\n"),i=this.unfinished(),r-this.indebt===this.indent)return i?this.suppressNewlines():this.newlineToken(),e.length;if(r>this.indent){if(i)return this.indebt=r-this.indent,this.suppressNewlines(),e.length;t=r-this.indent+this.outdebt,this.token("INDENT",t),this.indents.push(t),this.ends.push("OUTDENT"),this.outdebt=this.indebt=0}else this.indebt=0,this.outdentToken(this.indent-r,i);return this.indent=r,e.length},t.prototype.outdentToken=function(t,e){for(var n,i;t>0;)i=this.indents.length-1,void 0===this.indents[i]?t=0:this.indents[i]===this.outdebt?(t-=this.outdebt,this.outdebt=0):this.indents[i]<this.outdebt?(this.outdebt-=this.indents[i],t-=this.indents[i]):(n=this.indents.pop()-this.outdebt,t-=n,this.outdebt=0,this.pair("OUTDENT"),this.token("OUTDENT",n));for(n&&(this.outdebt-=t);";"===this.value();)this.tokens.pop();return"TERMINATOR"===this.tag()||e||this.token("TERMINATOR","\n"),this},t.prototype.whitespaceToken=function(){var t,e,n;return(t=P.exec(this.chunk))||(e="\n"===this.chunk.charAt(0))?(n=W(this.tokens),n&&(n[t?"spaced":"newLine"]=!0),t?t[0].length:0):0},t.prototype.newlineToken=function(){for(;";"===this.value();)this.tokens.pop();return"TERMINATOR"!==this.tag()&&this.token("TERMINATOR","\n"),this},t.prototype.suppressNewlines=function(){return"\\"===this.value()&&this.tokens.pop(),this},t.prototype.literalToken=function(){var t,i,s,r,o,a,l,u;if((t=m.exec(this.chunk))?(r=t[0],n.test(r)&&this.tagParameters()):r=this.chunk.charAt(0),s=r,i=W(this.tokens),"="===r&&i&&(!i[1].reserved&&(o=i[1],j.call(E,o)>=0)&&this.error('reserved word "'+this.value()+"\" can't be assigned"),"||"===(a=i[1])||"&&"===a))return i[0]="COMPOUND_ASSIGN",i[1]+="=",r.length;if(";"===r)this.seenFor=!1,s="TERMINATOR";else if(j.call(x,r)>=0)s="MATH";else if(j.call(h,r)>=0)s="COMPARE";else if(j.call(c,r)>=0)s="COMPOUND_ASSIGN";else if(j.call(H,r)>=0)s="UNARY";else if(j.call(U,r)>=0)s="SHIFT";else if(j.call(I,r)>=0||"?"===r&&(null!=i?i.spaced:void 0))s="LOGIC";else if(i&&!i.spaced)if("("===r&&(l=i[0],j.call(e,l)>=0))"?"===i[0]&&(i[0]="FUNC_EXIST"),s="CALL_START";else if("["===r&&(u=i[0],j.call(T,u)>=0))switch(s="INDEX_START",i[0]){case"?":i[0]="INDEX_SOAK"}switch(r){case"(":case"{":case"[":this.ends.push(k[r]);break;case")":case"}":case"]":this.pair(r)}return this.token(s,r),r.length},t.prototype.sanitizeHeredoc=function(t,e){var n,i,s,r,o;if(s=e.indent,i=e.herecomment){if(l.test(t)&&this.error('block comment cannot contain "*/", starting'),t.indexOf("\n")<=0)return t}else for(;r=u.exec(t);)n=r[1],(null===s||0<(o=n.length)&&o<s.length)&&(s=n);return s&&(t=t.replace(RegExp("\\n"+s,"g"),"\n")),i||(t=t.replace(/^\n/,"")),t},t.prototype.tagParameters=function(){var t,e,n,i;if(")"!==this.tag())return this;for(e=[],i=this.tokens,t=i.length,i[--t][0]="PARAM_END";n=i[--t];)switch(n[0]){case")":e.push(n);break;case"(":case"CALL_START":if(!e.length)return"("===n[0]?(n[0]="PARAM_START",this):this;e.pop()}return this},t.prototype.closeIndentation=function(){return this.outdentToken(this.indent)},t.prototype.balancedString=function(t,e){var n,i,s,r,o,h,c,a;for(n=0,h=[e],i=c=1,a=t.length;a>=1?a>c:c>a;i=a>=1?++c:--c)if(n)--n;else{switch(s=t.charAt(i)){case"\\":++n;continue;case e:if(h.pop(),!h.length)return t.slice(0,i+1||9e9);e=h[h.length-1];continue}"}"!==e||'"'!==s&&"'"!==s?"}"===e&&"/"===s&&(r=p.exec(t.slice(i))||D.exec(t.slice(i)))?n+=r[0].length-1:"}"===e&&"{"===s?h.push(e="}"):'"'===e&&"#"===o&&"{"===s&&h.push(e="}"):h.push(e=s),o=s}return this.error("missing "+h.pop()+", starting")},t.prototype.interpolateString=function(e,n){var i,s,r,o,h,c,a,l,u,p,f,d,T,k,g,E,N,R;for(null==n&&(n={}),s=n.heredoc,p=n.regex,d=[],u=0,r=-1;a=e.charAt(r+=1);)"\\"!==a?"#"===a&&"{"===e.charAt(r+1)&&(i=this.balancedString(e.slice(r+1),"}"))&&(r>u&&d.push(["NEOSTRING",e.slice(u,r)]),o=i.slice(1,-1),o.length&&(l=(new t).tokenize(o,{line:this.line,rewrite:!1}),l.pop(),"TERMINATOR"===(null!=(E=l[0])?E[0]:void 0)&&l.shift(),(c=l.length)&&(c>1&&(l.unshift(["(","(",this.line]),l.push([")",")",this.line])),d.push(["TOKENS",l]))),r+=i.length,u=r+1):r+=1;if(r>u&&u<e.length&&d.push(["NEOSTRING",e.slice(u)]),p)return d;if(!d.length)return this.token("STRING",'""');for("NEOSTRING"!==d[0][0]&&d.unshift(["",""]),(h=d.length>1)&&this.token("(","("),r=k=0,g=d.length;g>k;r=++k)N=d[r],f=N[0],T=N[1],r&&this.token("+","+"),"TOKENS"===f?(R=this.tokens).push.apply(R,T):this.token("STRING",this.makeString(T,'"',s));return h&&this.token(")",")"),d},t.prototype.pair=function(t){var e,n;return t!==(n=W(this.ends))?("OUTDENT"!==n&&this.error("unmatched "+t),this.indent-=e=W(this.indents),this.outdentToken(e,!0),this.pair(t)):this.ends.pop()},t.prototype.token=function(t,e){return this.tokens.push([t,e,this.line])},t.prototype.tag=function(t,e){var n;return(n=W(this.tokens,t))&&(e?n[0]=e:n[0])},t.prototype.value=function(t,e){var n;return(n=W(this.tokens,t))&&(e?n[1]=e:n[1])},t.prototype.unfinished=function(){var t;return S.test(this.chunk)||"\\"===(t=this.tag())||"."===t||"?."===t||"UNARY"===t||"MATH"===t||"+"===t||"-"===t||"SHIFT"===t||"RELATION"===t||"COMPARE"===t||"LOGIC"===t||"THROW"===t||"EXTENDS"===t},t.prototype.escapeLines=function(t,e){return t.replace(A,e?"\\n":"")},t.prototype.makeString=function(t,e,n){return t?(t=t.replace(/\\([\s\S])/g,function(t,n){return"\n"===n||n===e?n:t}),t=t.replace(RegExp(""+e,"g"),"\\$&"),e+this.escapeLines(t,n)+e):e+e},t.prototype.error=function(t){throw SyntaxError(""+t+" on line "+(this.line+1))},t}(),N=["true","false","null","this","new","delete","typeof","in","instanceof","return","throw","break","continue","debugger","if","else","switch","for","while","do","try","catch","finally","class","extends","super"],r=["undefined","then","unless","until","loop","of","by","when"],s={and:"&&",or:"||",is:"==",isnt:"!=",not:"!",yes:"true",no:"false",on:"true",off:"false"},i=function(){var t;t=[];for(z in s)t.push(z);return t}(),r=r.concat(i),F=["case","default","function","var","void","with","const","let","enum","export","import","native","__hasProp","__extends","__slice","__bind","__indexOf","implements","interface","let","package","private","protected","public","static","yield"],M=["arguments","eval"],E=N.concat(F).concat(M),exports.RESERVED=F.concat(N).concat(r).concat(M),exports.STRICT_PROSCRIBED=M,d=/^([$A-Za-z_\x7f-\uffff][$\w\x7f-\uffff]*)([^\n\S]*:(?!:))?/,y=/^0b[01]+|^0o[0-7]+|^0x[\da-f]+|^\d*\.?\d+(?:e[+-]?\d+)?/i,a=/^("""|''')([\s\S]*?)(?:\n[^\n\S]*)?\1/,m=/^(?:[-=]>|[-+*\/%<>&|^!?=]=|>>>=?|([-+:])\1|([&|<>])\2=?|\?\.|\.{2,3})/,P=/^[^\n\S]+/,o=/^###([^#][\s\S]*?)(?:###[^\n\S]*|(?:###)?$)|^(?:\s*#(?!##[^#]).*)+/,n=/^[-=]>/,v=/^(?:\n[^\n\S]*)+/,_=/^'[^\\']*(?:\\.[^\\']*)*'/,g=/^`[^\\`]*(?:\\.[^\\`]*)*`/,D=/^(\/(?![\s=])[^[\/\n\\]*(?:(?:\\[\s\S]|\[[^\]\n\\]*(?:\\[\s\S][^\]\n\\]*)*])[^[\/\n\\]*)*\/)([imgy]{0,4})(?!\w)/,p=/^\/{3}([\s\S]+?)\/{3}([imgy]{0,4})(?!\w)/,f=/\s+(?:#.*)?/g,A=/\n/g,u=/\n+([^\n\S]*)/g,l=/\*\//,S=/^\s*(?:,|\??\.(?![.\d])|::)/,C=/\s+$/,c=["-=","+=","/=","*=","%=","||=","&&=","?=","<<=",">>=",">>>=","&=","^=","|="],H=["!","~","NEW","TYPEOF","DELETE","DO"],I=["&&","||","&","|","^"],U=["<<",">>",">>>"],h=["==","!=","<",">","<=",">="],x=["*","/","%"],L=["IN","OF","INSTANCEOF"],t=["TRUE","FALSE"],w=["NUMBER","REGEX","BOOL","NULL","UNDEFINED","++","--","]"],b=w.concat(")","}","THIS","IDENTIFIER","STRING"),e=["IDENTIFIER","STRING","REGEX",")","]","}","?","::","@","THIS","SUPER"],T=e.concat("NUMBER","BOOL","NULL","UNDEFINED"),R=["INDENT","OUTDENT","TERMINATOR"]}).call(this);