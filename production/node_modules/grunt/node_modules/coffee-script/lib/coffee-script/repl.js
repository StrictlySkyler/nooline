(function(){var t,n,r,e,o,u,i,c,p,s,l,a,f,m,h,v,d,w,g,_,O,P,b;P=process.openStdin(),b=process.stdout,n=null,g=null,v=null.inspect,c=null.Script,r=null,e="coffee> ",u="------> ",o="......> ",f=!1,"win32"!==process.platform&&(f=!process.env.NODE_DISABLE_COLORS),m=function(t){return b.write((t.stack||""+t)+"\n")},t=/\s*([\w\.]+)(?:\.(\w*))$/,i=/(\w+)$/i,p=function(t){return l(t)||a(t)||[[],t]},l=function(n){var r,e,o,u,i,p,s,l;if(u=n.match(t)){r=u[0],i=u[1],s=u[2];try{l=c.runInThisContext(i)}catch(a){return}l=Object(l),p=Object.getOwnPropertyNames(l);for(o in l)~p.indexOf(l)&&p.push(o);return e=h(s,p),[e,s]}},a=function(t){var r,e,o,u,p,s,l;return e=null!=(l=t.match(i))?l[1]:void 0,""===t&&(e=""),null!=e?(s=c.runInThisContext("Object.getOwnPropertyNames(Object(this))"),o=function(){var t,r,e,o;for(e=n.RESERVED,o=[],t=0,r=e.length;r>t;t++)p=e[t],"__"!==p.slice(0,2)&&o.push(p);return o}(),u=s.concat(o),r=h(e,u),[r,e]):void 0},h=function(t,n){var r,e,o,u;for(u=[],e=0,o=n.length;o>e;e++)r=n[e],0===r.indexOf(t)&&u.push(r);return u},process.on("uncaughtException",m),s="",O=function(t){var r,u,i;if(t=t.replace(/(^|[\r\n]+)(\s*)##?(?:[^#\r\n][^\r\n]*|)($|[\r\n])/,"$1$2$3"),t=t.replace(/[\r\n]+$/,""),d)return s+=""+t+"\n",_.setPrompt(o),_.prompt(),void 0;if(!(""+t).trim()&&!s)return _.prompt(),void 0;if(r=s+=t,"\\"===r[r.length-1])return s=""+s.slice(0,-1)+"\n",_.setPrompt(o),_.prompt(),void 0;_.setPrompt(e),s="";try{i=global._,u=n.eval("_=("+r+"\n)",{filename:"repl",modulename:"repl"}),void 0===u&&(global._=i),_.output.write(""+v(u,!1,2,f)+"\n")}catch(c){m(c)}return _.prompt()},P.readable?(w="",_={prompt:function(){return b.write(this._prompt)},setPrompt:function(t){return this._prompt=t},input:P,output:b,on:function(){}},P.on("data",function(t){var n,r,e,o,u;if(w+=t,/\n/.test(w))for(r=w.split("\n"),w=r[r.length-1],u=r.slice(0,-1),e=0,o=u.length;o>e;e++)n=u[e],n&&(b.write(""+n+"\n"),O(n))}),P.on("end",function(){var t,n,r,e;for(e=w.trim().split("\n"),n=0,r=e.length;r>n;n++)t=e[n],t&&(b.write(""+t+"\n"),O(t));return b.write("\n"),process.exit(0)})):g.createInterface.length<3?(_=g.createInterface(P,p),P.on("data",function(t){return _.write(t)})):_=g.createInterface(P,b,p),d=!1,_.input.on("keypress",function(t,n){var r,o;if(n&&n.ctrl&&!n.meta&&!n.shift&&"v"===n.name)return r=_.cursor,_.output.cursorTo(0),_.output.clearLine(1),d=!d,!d&&s&&_._line(),s="",_.setPrompt(o=d?u:e),_.prompt(),_.output.cursorTo(o.length+(_.cursor=r))}),_.input.on("keypress",function(t,n){return d&&_.line&&n&&n.ctrl&&!n.meta&&!n.shift&&"d"===n.name?(d=!1,_._line()):void 0}),_.on("attemptClose",function(){return d?(d=!1,_.output.cursorTo(0),_.output.clearLine(1),_._onLine(_.line),void 0):s?(s="",_.output.write("\n"),_.setPrompt(e),_.prompt()):_.close()}),_.on("close",function(){return _.output.write("\n"),_.input.destroy()}),_.on("line",O),_.setPrompt(e),_.prompt()}).call(this);