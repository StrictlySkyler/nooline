(function(){var t,e,n,i,r,s,o,a,p,h,u,l,c,f,m,d,y,v,b,w,x,g,S,j,C,k,N,_,R,V,E,A,B,O,P,T,I,D,q,F,U,$,K,L,M,W,z,Z,G,H,J,Q,X,Y,te,ee,ne,ie,re,se,oe,ae,pe,he={}.hasOwnProperty,ue=function(t,e){function n(){this.constructor=t}for(var i in e)he.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},le=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};q=null.Scope,ae=null,O=ae.RESERVED,D=ae.STRICT_PROSCRIBED,pe=null,J=pe.compact,te=pe.flatten,Y=pe.extend,ne=pe.merge,Q=pe.del,re=pe.starts,X=pe.ends,ee=pe.last,exports.extend=Y,H=function(){return!0},R=function(){return!1},L=function(){return this},_=function(){return this.negated=!this.negated,this},exports.Base=i=function(){function t(){}return t.prototype.compile=function(t,e){var n;return t=Y({},t),e&&(t.level=e),n=this.unfoldSoak(t)||this,n.tab=t.indent,t.level!==C&&n.isStatement(t)?n.compileClosure(t):n.compileNode(t)},t.prototype.compileClosure=function(t){if(this.jumps())throw SyntaxError("cannot use a pure statement in an expression.");return t.sharedScope=!0,a.wrap(this).compileNode(t)},t.prototype.cache=function(t,e,i){var r,s;return this.isComplex()?(r=new k(i||t.scope.freeVariable("ref")),s=new n(r,this),e?[s.compile(t,e),r.value]:[s,r]):(r=e?this.compile(t,e):this,[r,r])},t.prototype.compileLoopReference=function(t,e){var n,i;return n=i=this.compile(t,g),+n>-1/0&&1/0>+n||f.test(n)&&t.scope.check(n,!0)||(n=""+(i=t.scope.freeVariable(e))+" = "+n),[n,i]},t.prototype.makeReturn=function(t){var e;return e=this.unwrapAll(),t?new s(new k(""+t+".push"),[e]):new T(e)},t.prototype.contains=function(t){var e;return e=!1,this.traverseChildren(!1,function(n){return t(n)?(e=!0,!1):void 0}),e},t.prototype.containsType=function(t){return this instanceof t||this.contains(function(e){return e instanceof t})},t.prototype.lastNonComment=function(t){var e;for(e=t.length;e--;)if(!(t[e]instanceof h))return t[e];return null},t.prototype.toString=function(t,e){var n;return null==t&&(t=""),null==e&&(e=this.constructor.name),n="\n"+t+e,this.soak&&(n+="?"),this.eachChild(function(e){return n+=e.toString(t+K)}),n},t.prototype.eachChild=function(t){var e,n,i,r,s,o,a,p;if(!this.children)return this;for(a=this.children,i=0,s=a.length;s>i;i++)if(e=a[i],this[e])for(p=te([this[e]]),r=0,o=p.length;o>r;r++)if(n=p[r],t(n)===!1)return this;return this},t.prototype.traverseChildren=function(t,e){return this.eachChild(function(n){return e(n)===!1?!1:n.traverseChildren(t,e)})},t.prototype.invert=function(){return new E("!",this)},t.prototype.unwrapAll=function(){var t;for(t=this;t!==(t=t.unwrap()););return t},t.prototype.children=[],t.prototype.isStatement=R,t.prototype.jumps=R,t.prototype.isComplex=H,t.prototype.isChainable=R,t.prototype.isAssignable=R,t.prototype.unwrap=L,t.prototype.unfoldSoak=R,t.prototype.assigns=R,t}(),exports.Block=r=function(t){function e(t){this.expressions=J(te(t||[]))}return ue(e,t),e.prototype.children=["expressions"],e.prototype.push=function(t){return this.expressions.push(t),this},e.prototype.pop=function(){return this.expressions.pop()},e.prototype.unshift=function(t){return this.expressions.unshift(t),this},e.prototype.unwrap=function(){return 1===this.expressions.length?this.expressions[0]:this},e.prototype.isEmpty=function(){return!this.expressions.length},e.prototype.isStatement=function(t){var e,n,i,r;for(r=this.expressions,n=0,i=r.length;i>n;n++)if(e=r[n],e.isStatement(t))return!0;return!1},e.prototype.jumps=function(t){var e,n,i,r;for(r=this.expressions,n=0,i=r.length;i>n;n++)if(e=r[n],e.jumps(t))return e},e.prototype.makeReturn=function(t){var e,n;for(n=this.expressions.length;n--;)if(e=this.expressions[n],!(e instanceof h)){this.expressions[n]=e.makeReturn(t),e instanceof T&&!e.expression&&this.expressions.splice(n,1);break}return this},e.prototype.compile=function(t,n){return null==t&&(t={}),t.scope?e.__super__.compile.call(this,t,n):this.compileRoot(t)},e.prototype.compileNode=function(t){var n,i,r,s,o,a,p;for(this.tab=t.indent,s=t.level===C,i=[],p=this.expressions,o=0,a=p.length;a>o;o++)r=p[o],r=r.unwrapAll(),r=r.unfoldSoak(t)||r,r instanceof e?i.push(r.compileNode(t)):s?(r.front=!0,n=r.compile(t),r.isStatement(t)||(n=""+this.tab+n+";",r instanceof k&&(n=""+n+"\n")),i.push(n)):i.push(r.compile(t,g));return s?this.spaced?"\n"+i.join("\n\n")+"\n":i.join("\n"):(n=i.join(", ")||"void 0",i.length>1&&t.level>=g?"("+n+")":n)},e.prototype.compileRoot=function(t){var e,n,i,r,s,o;return t.indent=t.bare?"":K,t.scope=new q(null,this,null),t.level=C,this.spaced=!0,r="",t.bare||(s=function(){var t,e,r,s;for(r=this.expressions,s=[],i=t=0,e=r.length;e>t&&(n=r[i],n.unwrap()instanceof h);i=++t)s.push(n);return s}.call(this),o=this.expressions.slice(s.length),this.expressions=s,s.length&&(r=""+this.compileNode(ne(t,{indent:""}))+"\n"),this.expressions=o),e=this.compileWithDeclarations(t),t.bare?e:""+r+"(function() {\n"+e+"\n}).call(this);\n"},e.prototype.compileWithDeclarations=function(t){var e,n,i,r,s,o,a,p,u,l,c,f,m,d;for(n=o="",f=this.expressions,s=l=0,c=f.length;c>l&&(r=f[s],r=r.unwrap(),r instanceof h||r instanceof k);s=++l);return t=ne(t,{level:C}),s&&(a=this.expressions.splice(s,9e9),m=[this.spaced,!1],u=m[0],this.spaced=m[1],d=[this.compileNode(t),u],n=d[0],this.spaced=d[1],this.expressions=a),o=this.compileNode(t),p=t.scope,p.expressions===this&&(i=t.scope.hasDeclarations(),e=p.hasAssignments,(i||e)&&(s&&(n+="\n"),n+=""+this.tab+"var ",i&&(n+=p.declaredVariables().join(", ")),e&&(i&&(n+=",\n"+(this.tab+K)),n+=p.assignedVariables().join(",\n"+(this.tab+K))),n+=";\n")),n+o},e.wrap=function(t){return 1===t.length&&t[0]instanceof e?t[0]:new e(t)},e}(i),exports.Literal=k=function(t){function e(t){this.value=t}return ue(e,t),e.prototype.makeReturn=function(){return this.isStatement()?this:e.__super__.makeReturn.apply(this,arguments)},e.prototype.isAssignable=function(){return f.test(this.value)},e.prototype.isStatement=function(){var t;return"break"===(t=this.value)||"continue"===t||"debugger"===t},e.prototype.isComplex=R,e.prototype.assigns=function(t){return t===this.value},e.prototype.jumps=function(t){return"break"!==this.value||(null!=t?t.loop:void 0)||(null!=t?t.block:void 0)?"continue"!==this.value||(null!=t?t.loop:void 0)?void 0:this:this},e.prototype.compileNode=function(t){var e,n;return e="this"===this.value?(null!=(n=t.scope.method)?n.bound:void 0)?t.scope.method.context:this.value:this.value.reserved?'"'+this.value+'"':this.value,this.isStatement()?""+this.tab+e+";":e},e.prototype.toString=function(){return' "'+this.value+'"'},e}(i),exports.Undefined=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return ue(e,t),e.prototype.isAssignable=R,e.prototype.isComplex=R,e.prototype.compileNode=function(t){return t.level>=w?"(void 0)":"void 0"},e}(i),exports.Null=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return ue(e,t),e.prototype.isAssignable=R,e.prototype.isComplex=R,e.prototype.compileNode=function(){return"null"},e}(i),exports.Bool=function(t){function e(t){this.val=t}return ue(e,t),e.prototype.isAssignable=R,e.prototype.isComplex=R,e.prototype.compileNode=function(){return this.val},e}(i),exports.Return=T=function(t){function e(t){t&&!t.unwrap().isUndefined&&(this.expression=t)}return ue(e,t),e.prototype.children=["expression"],e.prototype.isStatement=H,e.prototype.makeReturn=L,e.prototype.jumps=L,e.prototype.compile=function(t,n){var i,r;return i=null!=(r=this.expression)?r.makeReturn():void 0,!i||i instanceof e?e.__super__.compile.call(this,t,n):i.compile(t,n)},e.prototype.compileNode=function(t){return this.tab+("return"+[this.expression?" "+this.expression.compile(t,j):void 0]+";")},e}(i),exports.Value=Z=function(t){function i(t,e,n){return!e&&t instanceof i?t:(this.base=t,this.properties=e||[],n&&(this[n]=!0),this)}return ue(i,t),i.prototype.children=["base","properties"],i.prototype.add=function(t){return this.properties=this.properties.concat(t),this},i.prototype.hasProperties=function(){return!!this.properties.length},i.prototype.isArray=function(){return!this.properties.length&&this.base instanceof e},i.prototype.isComplex=function(){return this.hasProperties()||this.base.isComplex()},i.prototype.isAssignable=function(){return this.hasProperties()||this.base.isAssignable()},i.prototype.isSimpleNumber=function(){return this.base instanceof k&&I.test(this.base.value)},i.prototype.isString=function(){return this.base instanceof k&&d.test(this.base.value)},i.prototype.isAtomic=function(){var t,e,n,i;for(i=this.properties.concat(this.base),e=0,n=i.length;n>e;e++)if(t=i[e],t.soak||t instanceof s)return!1;return!0},i.prototype.isStatement=function(t){return!this.properties.length&&this.base.isStatement(t)},i.prototype.assigns=function(t){return!this.properties.length&&this.base.assigns(t)},i.prototype.jumps=function(t){return!this.properties.length&&this.base.jumps(t)},i.prototype.isObject=function(t){return this.properties.length?!1:this.base instanceof V&&(!t||this.base.generated)},i.prototype.isSplice=function(){return ee(this.properties)instanceof F},i.prototype.unwrap=function(){return this.properties.length?this:this.base},i.prototype.cacheReference=function(t){var e,r,s,o;return s=ee(this.properties),this.properties.length<2&&!this.base.isComplex()&&!(null!=s?s.isComplex():void 0)?[this,this]:(e=new i(this.base,this.properties.slice(0,-1)),e.isComplex()&&(r=new k(t.scope.freeVariable("base")),e=new i(new B(new n(r,e)))),s?(s.isComplex()&&(o=new k(t.scope.freeVariable("name")),s=new b(new n(o,s.index)),o=new b(o)),[e.add(s),new i(r||e.base,[o||s])]):[e,r])},i.prototype.compileNode=function(t){var e,n,i,r,s;for(this.base.front=this.front,i=this.properties,e=this.base.compile(t,i.length?w:null),(this.base instanceof B||i.length)&&I.test(e)&&(e=""+e+"."),r=0,s=i.length;s>r;r++)n=i[r],e+=n.compile(t);return e},i.prototype.unfoldSoak=function(t){var e,r=this;return null!=this.unfoldedSoak?this.unfoldedSoak:(e=function(){var e,s,o,a,p,h,l,c,f;if(o=r.base.unfoldSoak(t))return Array.prototype.push.apply(o.body.properties,r.properties),o;for(f=r.properties,s=l=0,c=f.length;c>l;s=++l)if(a=f[s],a.soak)return a.soak=!1,e=new i(r.base,r.properties.slice(0,s)),h=new i(r.base,r.properties.slice(s)),e.isComplex()&&(p=new k(t.scope.freeVariable("ref")),e=new B(new n(p,e)),h.base=p),new y(new u(e),h,{soak:!0});return null}(),this.unfoldedSoak=e||!1)},i}(i),exports.Comment=h=function(t){function e(t){this.comment=t}return ue(e,t),e.prototype.isStatement=H,e.prototype.makeReturn=L,e.prototype.compileNode=function(t,e){var n;return n="/*"+ie(this.comment,this.tab)+("\n"+this.tab+"*/\n"),(e||t.level)===C&&(n=t.indent+n),n},e}(i),exports.Call=s=function(e){function i(t,e,n){this.args=null!=e?e:[],this.soak=n,this.isNew=!1,this.isSuper="super"===t,this.variable=this.isSuper?null:t}return ue(i,e),i.prototype.children=["variable","args"],i.prototype.newInstance=function(){var t,e;return t=(null!=(e=this.variable)?e.base:void 0)||this.variable,t instanceof i&&!t.isNew?t.newInstance():this.isNew=!0,this},i.prototype.superReference=function(e){var n,i,r;if(i=e.scope.namedMethod(),!i)throw SyntaxError("cannot call super outside of a function.");if(r=i.name,null==r)throw SyntaxError("cannot call super on an anonymous function.");return i.klass?(n=[new t(new k("__super__"))],i["static"]&&n.push(new t(new k("constructor"))),n.push(new t(new k(r))),new Z(new k(i.klass),n).compile(e)):""+r+".__super__.constructor"},i.prototype.superThis=function(t){var e;return e=t.scope.method,e&&!e.klass&&e.context||"this"},i.prototype.unfoldSoak=function(t){var e,n,r,s,o,a,p,h,u;if(this.soak){if(this.variable){if(n=se(t,this,"variable"))return n;h=new Z(this.variable).cacheReference(t),r=h[0],o=h[1]}else r=new k(this.superReference(t)),o=new Z(r);return o=new i(o,this.args),o.isNew=this.isNew,r=new k("typeof "+r.compile(t)+' === "function"'),new y(r,new Z(o),{soak:!0})}for(e=this,s=[];;)if(e.variable instanceof i)s.push(e),e=e.variable;else{if(!(e.variable instanceof Z))break;if(s.push(e),!((e=e.variable.base)instanceof i))break}for(u=s.reverse(),a=0,p=u.length;p>a;a++)e=u[a],n&&(e.variable instanceof i?e.variable=n:e.variable.base=n),n=se(t,e,"variable");return n},i.prototype.filterImplicitObjects=function(t){var e,i,r,s,o,a,p,u,l,c;for(i=[],a=0,u=t.length;u>a;a++)if(e=t[a],("function"==typeof e.isObject?e.isObject():void 0)&&e.base.generated)for(r=null,c=e.base.properties,p=0,l=c.length;l>p;p++)s=c[p],s instanceof n||s instanceof h?(r||i.push(r=new V(o=[],!0)),o.push(s)):(i.push(s),r=null);else i.push(e);return i},i.prototype.compileNode=function(t){var e,n,i,r;return null!=(r=this.variable)&&(r.front=this.front),(i=U.compileSplattedArray(t,this.args,!0))?this.compileSplat(t,i):(n=this.filterImplicitObjects(this.args),n=function(){var i,r,s;for(s=[],i=0,r=n.length;r>i;i++)e=n[i],s.push(e.compile(t,g));return s}().join(", "),this.isSuper?this.superReference(t)+(".call("+this.superThis(t)+(n&&", "+n)+")"):(this.isNew?"new ":"")+this.variable.compile(t,w)+("("+n+")"))},i.prototype.compileSuper=function(t,e){return""+this.superReference(e)+".call("+this.superThis(e)+(t.length?", ":"")+t+")"},i.prototype.compileSplat=function(t,e){var n,i,r,s,o;return this.isSuper?""+this.superReference(t)+".apply("+this.superThis(t)+", "+e+")":this.isNew?(r=this.tab+K,"(function(func, args, ctor) {\n"+r+"ctor.prototype = func.prototype;\n"+r+"var child = new ctor, result = func.apply(child, args), t = typeof result;\n"+r+'return t == "object" || t == "function" ? result || child : child;\n'+this.tab+"})("+this.variable.compile(t,g)+", "+e+", function(){})"):(n=new Z(this.variable),(s=n.properties.pop())&&n.isComplex()?(o=t.scope.freeVariable("ref"),i="("+o+" = "+n.compile(t,g)+")"+s.compile(t)):(i=n.compile(t,w),I.test(i)&&(i="("+i+")"),s?(o=i,i+=s.compile(t)):o="null"),""+i+".apply("+o+", "+e+")")},i}(i),exports.Extends=l=function(t){function e(t,e){this.child=t,this.parent=e}return ue(e,t),e.prototype.children=["child","parent"],e.prototype.compile=function(t){return new s(new Z(new k(oe("extends"))),[this.child,this.parent]).compile(t)},e}(i),exports.Access=t=function(t){function e(t,e){this.name=t,this.name.asKey=!0,this.soak="soak"===e}return ue(e,t),e.prototype.children=["name"],e.prototype.compile=function(t){var e;return e=this.name.compile(t),f.test(e)?"."+e:"["+e+"]"},e.prototype.isComplex=R,e}(i),exports.Index=b=function(t){function e(t){this.index=t}return ue(e,t),e.prototype.children=["index"],e.prototype.compile=function(t){return"["+this.index.compile(t,j)+"]"},e.prototype.isComplex=function(){return this.index.isComplex()},e}(i),exports.Range=P=function(t){function e(t,e,n){this.from=t,this.to=e,this.exclusive="exclusive"===n,this.equals=this.exclusive?"":"="}return ue(e,t),e.prototype.children=["from","to"],e.prototype.compileVariables=function(t){var e,n,i,r,s;return t=ne(t,{top:!0}),n=this.from.cache(t,g),this.fromC=n[0],this.fromVar=n[1],i=this.to.cache(t,g),this.toC=i[0],this.toVar=i[1],(e=Q(t,"step"))&&(r=e.cache(t,g),this.step=r[0],this.stepVar=r[1]),s=[this.fromVar.match(I),this.toVar.match(I)],this.fromNum=s[0],this.toNum=s[1],this.stepVar?this.stepNum=this.stepVar.match(I):void 0},e.prototype.compileNode=function(t){var e,n,i,r,s,o,a,p,h,u,l,c,f,m;return this.fromVar||this.compileVariables(t),t.index?(a=this.fromNum&&this.toNum,s=Q(t,"index"),o=Q(t,"name"),h=o&&o!==s,c=""+s+" = "+this.fromC,this.toC!==this.toVar&&(c+=", "+this.toC),this.step!==this.stepVar&&(c+=", "+this.step),f=[""+s+" <"+this.equals,""+s+" >"+this.equals],p=f[0],r=f[1],n=this.stepNum?+this.stepNum>0?""+p+" "+this.toVar:""+r+" "+this.toVar:a?(m=[+this.fromNum,+this.toNum],i=m[0],l=m[1],m,l>=i?""+p+" "+l:""+r+" "+l):(e=""+this.fromVar+" <= "+this.toVar,""+e+" ? "+p+" "+this.toVar+" : "+r+" "+this.toVar),u=this.stepVar?""+s+" += "+this.stepVar:a?h?l>=i?"++"+s:"--"+s:l>=i?""+s+"++":""+s+"--":h?""+e+" ? ++"+s+" : --"+s:""+e+" ? "+s+"++ : "+s+"--",h&&(c=""+o+" = "+c),h&&(u=""+o+" = "+u),""+c+"; "+n+"; "+u):this.compileArray(t)},e.prototype.compileArray=function(t){var e,n,i,r,s,o,a,p,h,u,l,c,f;return this.fromNum&&this.toNum&&Math.abs(this.fromNum-this.toNum)<=20?(h=function(){f=[];for(var t=c=+this.fromNum,e=+this.toNum;e>=c?e>=t:t>=e;e>=c?t++:t--)f.push(t);return f}.apply(this),this.exclusive&&h.pop(),"["+h.join(", ")+"]"):(o=this.tab+K,s=t.scope.freeVariable("i"),u=t.scope.freeVariable("results"),p="\n"+o+u+" = [];",this.fromNum&&this.toNum?(t.index=s,n=this.compileNode(t)):(l=""+s+" = "+this.fromC+(this.toC!==this.toVar?", "+this.toC:""),i=""+this.fromVar+" <= "+this.toVar,n="var "+l+"; "+i+" ? "+s+" <"+this.equals+" "+this.toVar+" : "+s+" >"+this.equals+" "+this.toVar+"; "+i+" ? "+s+"++ : "+s+"--"),a="{ "+u+".push("+s+"); }\n"+o+"return "+u+";\n"+t.indent,r=function(t){return null!=t?t.contains(function(t){return t instanceof k&&"arguments"===t.value&&!t.asKey}):void 0},(r(this.from)||r(this.to))&&(e=", arguments"),"(function() {"+p+"\n"+o+"for ("+n+")"+a+"}).apply(this"+(null!=e?e:"")+")")},e}(i),exports.Slice=F=function(t){function e(t){this.range=t,e.__super__.constructor.call(this)}return ue(e,t),e.prototype.children=["range"],e.prototype.compileNode=function(t){var e,n,i,r,s,o;return o=this.range,r=o.to,n=o.from,i=n&&n.compile(t,j)||"0",e=r&&r.compile(t,j),r&&(this.range.exclusive||-1!==+e)&&(s=", "+(this.range.exclusive?e:I.test(e)?""+(+e+1):(e=r.compile(t,w),""+e+" + 1 || 9e9"))),".slice("+i+(s||"")+")"},e}(i),exports.Obj=V=function(t){function e(t,e){this.generated=null!=e?e:!1,this.objects=this.properties=t||[]}return ue(e,t),e.prototype.children=["properties"],e.prototype.compileNode=function(t){var e,i,r,s,o,a,p,u,l,c,f,m,d,y,v,b;for(f=this.properties,c=[],b=this.properties,m=0,y=b.length;y>m;m++)if(u=b[m],u.isComplex()&&(u=u.variable),null!=u){if(l=""+u.unwrapAll().value,le.call(c,l)>=0)throw SyntaxError('multiple object literal properties named "'+l+'"');c.push(l)}if(!f.length)return this.front?"({})":"{}";if(this.generated)for(d=0,v=f.length;v>d;d++)if(a=f[d],a instanceof Z)throw Error("cannot have an implicit value in an implicit object");return i=t.indent+=K,o=this.lastNonComment(this.properties),f=function(){var a,p,l;for(l=[],e=a=0,p=f.length;p>a;e=++a)u=f[e],s=e===f.length-1?"":u===o||u instanceof h?"\n":",\n",r=u instanceof h?"":i,u instanceof Z&&u["this"]&&(u=new n(u.properties[0].name,u,"object")),u instanceof h||(u instanceof n||(u=new n(u,u,"object")),(u.variable.base||u.variable).asKey=!0),l.push(r+u.compile(t,C)+s);return l}(),f=f.join(""),p="{"+(f&&"\n"+f+"\n"+this.tab)+"}",this.front?"("+p+")":p},e.prototype.assigns=function(t){var e,n,i,r;for(r=this.properties,n=0,i=r.length;i>n;n++)if(e=r[n],e.assigns(t))return!0;return!1},e}(i),exports.Arr=e=function(t){function e(t){this.objects=t||[]}return ue(e,t),e.prototype.children=["objects"],e.prototype.filterImplicitObjects=s.prototype.filterImplicitObjects,e.prototype.compileNode=function(t){var e,n,i;return this.objects.length?(t.indent+=K,i=this.filterImplicitObjects(this.objects),(e=U.compileSplattedArray(t,i))?e:(e=function(){var e,r,s;for(s=[],e=0,r=i.length;r>e;e++)n=i[e],s.push(n.compile(t,g));return s}().join(", "),e.indexOf("\n")>=0?"[\n"+t.indent+e+"\n"+this.tab+"]":"["+e+"]")):"[]"},e.prototype.assigns=function(t){var e,n,i,r;for(r=this.objects,n=0,i=r.length;i>n;n++)if(e=r[n],e.assigns(t))return!0;return!1},e}(i),exports.Class=o=function(e){function i(t,e,n){this.variable=t,this.parent=e,this.body=null!=n?n:new r,this.boundFuncs=[],this.body.classBody=!0}return ue(i,e),i.prototype.children=["variable","parent","body"],i.prototype.determineName=function(){var e,n;if(!this.variable)return null;if(e=(n=ee(this.variable.properties))?n instanceof t&&n.name.value:this.variable.base.value,le.call(D,e)>=0)throw SyntaxError("variable name may not be "+e);return e&&(e=f.test(e)&&e)},i.prototype.setContext=function(t){return this.body.traverseChildren(!1,function(e){return e.classBody?!1:e instanceof k&&"this"===e.value?e.value=t:e instanceof p&&(e.klass=t,e.bound)?e.context=t:void 0})},i.prototype.addBoundFunctions=function(e){var n,i,r,s,o,a;if(this.boundFuncs.length){for(o=this.boundFuncs,a=[],r=0,s=o.length;s>r;r++)n=o[r],i=new Z(new k("this"),[new t(n)]).compile(e),a.push(this.ctor.body.unshift(new k(""+i+" = "+oe("bind")+"("+i+", this)")));return a}},i.prototype.addProperties=function(e,i,r){var s,o,a,h,u;return u=e.base.properties.slice(0),a=function(){var e;for(e=[];s=u.shift();){if(s instanceof n)if(o=s.variable.base,delete s.context,h=s.value,"constructor"===o.value){if(this.ctor)throw Error("cannot define more than one constructor in a class");if(h.bound)throw Error("cannot define a constructor as a bound function");h instanceof p?s=this.ctor=h:(this.externalCtor=r.scope.freeVariable("class"),s=new n(new k(this.externalCtor),h))}else s.variable["this"]?(h["static"]=!0,h.bound&&(h.context=i)):(s.variable=new Z(new k(i),[new t(new k("prototype")),new t(o)]),h instanceof p&&h.bound&&(this.boundFuncs.push(o),h.bound=!1));e.push(s)}return e}.call(this),J(a)},i.prototype.walkBody=function(t,e){var n=this;return this.traverseChildren(!1,function(s){var o,a,p,h,u,l;if(s instanceof i)return!1;if(s instanceof r){for(l=o=s.expressions,a=h=0,u=l.length;u>h;a=++h)p=l[a],p instanceof Z&&p.isObject(!0)&&(o[a]=n.addProperties(p,t,e));return s.expressions=o=te(o)}})},i.prototype.hoistDirectivePrologue=function(){var t,e,n;for(e=0,t=this.body.expressions;(n=t[e])&&n instanceof h||n instanceof Z&&n.isString();)++e;return this.directives=t.splice(0,e)},i.prototype.ensureConstructor=function(t){return this.ctor||(this.ctor=new p,this.parent&&this.ctor.body.push(new k(""+t+".__super__.constructor.apply(this, arguments)")),this.externalCtor&&this.ctor.body.push(new k(""+this.externalCtor+".apply(this, arguments)")),this.ctor.body.makeReturn(),this.body.expressions.unshift(this.ctor)),this.ctor.ctor=this.ctor.name=t,this.ctor.klass=null,this.ctor.noReturn=!0},i.prototype.compileNode=function(t){var e,i,r,s,o,h,u;return i=this.determineName(),o=i||"_Class",o.reserved&&(o="_"+o),s=new k(o),this.hoistDirectivePrologue(),this.setContext(o),this.walkBody(o,t),this.ensureConstructor(o),this.body.spaced=!0,this.ctor instanceof p||this.body.expressions.unshift(this.ctor),this.body.expressions.push(s),(u=this.body.expressions).unshift.apply(u,this.directives),this.addBoundFunctions(t),e=a.wrap(this.body),this.parent&&(this.superClass=new k(t.scope.freeVariable("super",!1)),this.body.expressions.unshift(new l(s,this.superClass)),e.args.push(this.parent),h=e.variable.params||e.variable.base.params,h.push(new A(this.superClass))),r=new B(e,!0),this.variable&&(r=new n(this.variable,r)),r.compile(t)},i}(i),exports.Assign=n=function(e){function n(t,e,n,i){var r,s,o;if(this.variable=t,this.value=e,this.context=n,this.param=i&&i.param,this.subpattern=i&&i.subpattern,o=s=this.variable.unwrapAll().value,r=le.call(D,o)>=0,r&&"object"!==this.context)throw SyntaxError('variable name may not be "'+s+'"')}return ue(n,e),n.prototype.children=["variable","value"],n.prototype.isStatement=function(t){return(null!=t?t.level:void 0)===C&&null!=this.context&&le.call(this.context,"?")>=0},n.prototype.assigns=function(t){return this["object"===this.context?"value":"variable"].assigns(t)},n.prototype.unfoldSoak=function(t){return se(t,this,"variable")},n.prototype.compileNode=function(t){var e,n,i,r,s,o,a,h,u;if(e=this.variable instanceof Z){if(this.variable.isArray()||this.variable.isObject())return this.compilePatternMatch(t);if(this.variable.isSplice())return this.compileSplice(t);if("||="===(o=this.context)||"&&="===o||"?="===o)return this.compileConditional(t)}if(i=this.variable.compile(t,g),!this.context){if(!(s=this.variable.unwrapAll()).isAssignable())throw SyntaxError('"'+this.variable.compile(t)+'" cannot be assigned.');("function"==typeof s.hasProperties?s.hasProperties():void 0)||(this.param?t.scope.add(i,"var"):t.scope.find(i))}return this.value instanceof p&&(n=N.exec(i))&&(n[1]&&(this.value.klass=n[1]),this.value.name=null!=(a=null!=(h=null!=(u=n[2])?u:n[3])?h:n[4])?a:n[5]),r=this.value.compile(t,g),"object"===this.context?""+i+": "+r:(r=i+(" "+(this.context||"=")+" ")+r,t.level<=g?r:"("+r+")")},n.prototype.compilePatternMatch=function(e){var i,r,s,o,a,p,h,u,l,c,m,d,y,v,w,x,j,N,_,R,V,E,A,P,T,I,D;if(w=e.level===C,j=this.value,c=this.variable.base.objects,!(m=c.length))return s=j.compile(e),e.level>=S?"("+s+")":s;if(p=this.variable.isObject(),w&&1===m&&!((l=c[0])instanceof U)){if(l instanceof n?(V=l,E=V.variable,a=E.base,l=V.value):l.base instanceof B?(A=new Z(l.unwrapAll()).cacheReference(e),l=A[0],a=A[1]):a=p?l["this"]?l.properties[0].name:l:new k(0),i=f.test(a.unwrap().value||0),j=new Z(j),j.properties.push(new(i?t:b)(a)),P=l.unwrap().value,le.call(O,P)>=0)throw new SyntaxError("assignment to a reserved word: "+l.compile(e)+" = "+j.compile(e));return new n(l,j,null,{param:this.param}).compile(e,C)}for(N=j.compile(e,g),r=[],v=!1,(!f.test(N)||this.variable.assigns(N))&&(r.push(""+(d=e.scope.freeVariable("ref"))+" = "+N),N=d),o=_=0,R=c.length;R>_;o=++_){if(l=c[o],a=o,p&&(l instanceof n?(T=l,I=T.variable,a=I.base,l=T.value):l.base instanceof B?(D=new Z(l.unwrapAll()).cacheReference(e),l=D[0],a=D[1]):a=l["this"]?l.properties[0].name:l),!v&&l instanceof U)u=l.name.unwrap().value,l=l.unwrap(),x=""+m+" <= "+N+".length ? "+oe("slice")+".call("+N+", "+o,(y=m-o-1)?(h=e.scope.freeVariable("i"),x+=", "+h+" = "+N+".length - "+y+") : ("+h+" = "+o+", [])"):x+=") : []",x=new k(x),v=""+h+"++";else{if(u=l.unwrap().value,l instanceof U)throw l=l.name.compile(e),new SyntaxError("multiple splats are disallowed in an assignment: "+l+"...");"number"==typeof a?(a=new k(v||a),i=!1):i=p&&f.test(a.unwrap().value||0),x=new Z(new k(N),[new(i?t:b)(a)])}if(null!=u&&le.call(O,u)>=0)throw new SyntaxError("assignment to a reserved word: "+l.compile(e)+" = "+x.compile(e));r.push(new n(l,x,null,{param:this.param,subpattern:!0}).compile(e,g))}return w||this.subpattern||r.push(N),s=r.join(", "),e.level<g?s:"("+s+")"},n.prototype.compileConditional=function(t){var e,i,r;if(r=this.variable.cacheReference(t),e=r[0],i=r[1],!e.properties.length&&e.base instanceof k&&"this"!==e.base.value&&!t.scope.check(e.base.value))throw Error('the variable "'+e.base.value+"\" can't be assigned with "+this.context+" because it has not been defined.");return le.call(this.context,"?")>=0&&(t.isExistentialEquals=!0),new E(this.context.slice(0,-1),e,new n(i,this.value,"=")).compile(t)},n.prototype.compileSplice=function(t){var e,n,i,r,s,o,a,p,h,u,l,c;return u=this.variable.properties.pop().range,i=u.from,a=u.to,n=u.exclusive,o=this.variable.compile(t),l=(null!=i?i.cache(t,S):void 0)||["0","0"],r=l[0],s=l[1],a?(null!=i?i.isSimpleNumber():void 0)&&a.isSimpleNumber()?(a=+a.compile(t)-+s,n||(a+=1)):(a=a.compile(t,w)+" - "+s,n||(a+=" + 1")):a="9e9",c=this.value.cache(t,g),p=c[0],h=c[1],e="[].splice.apply("+o+", ["+r+", "+a+"].concat("+p+")), "+h,t.level>C?"("+e+")":e},n}(i),exports.Code=p=function(t){function i(t,e,n){this.params=t||[],this.body=e||new r,this.bound="boundfunc"===n,this.bound&&(this.context="_this")}return ue(i,t),i.prototype.children=["params","body"],i.prototype.isStatement=function(){return!!this.ctor},i.prototype.jumps=R,i.prototype.compileNode=function(t){var i,r,s,o,a,p,h,u,l,c,f,m,d,v,b,x,g,S,j,C,N,_,R,V,A,B,O,P,T,I,D,F,U;for(t.scope=new q(t.scope,this.body,this),t.scope.shared=Q(t,"sharedScope"),t.indent+=K,delete t.bare,delete t.isExistentialEquals,l=[],r=[],O=this.paramNames(),b=0,j=O.length;j>b;b++)p=O[b],t.scope.check(p)||t.scope.parameter(p);for(P=this.params,x=0,C=P.length;C>x;x++)if(u=P[x],u.splat){for(T=this.params,g=0,N=T.length;N>g;g++)h=T[g].name,h["this"]&&(h=h.properties[0].name),h.value&&t.scope.add(h.value,"var",!0);f=new n(new Z(new e(function(){var e,n,i,r;for(i=this.params,r=[],e=0,n=i.length;n>e;e++)h=i[e],r.push(h.asReference(t));return r}.call(this))),new Z(new k("arguments")));break}for(I=this.params,S=0,_=I.length;_>S;S++)u=I[S],u.isComplex()?(d=c=u.asReference(t),u.value&&(d=new E("?",c,u.value)),r.push(new n(new Z(u.name),d,"=",{param:!0}))):(c=u,u.value&&(a=new k(c.name.value+" == null"),d=new n(new Z(u.name),u.value,"="),r.push(new y(a,d)))),f||l.push(c);for(v=this.body.isEmpty(),f&&r.unshift(f),r.length&&(D=this.body.expressions).unshift.apply(D,r),s=A=0,R=l.length;R>A;s=++A)h=l[s],t.scope.parameter(l[s]=h.compile(t));for(m=[],F=this.paramNames(),B=0,V=F.length;V>B;B++){if(p=F[B],le.call(m,p)>=0)throw SyntaxError("multiple parameters named '"+p+"'");m.push(p)}return v||this.noReturn||this.body.makeReturn(),this.bound&&((null!=(U=t.scope.parent.method)?U.bound:void 0)?this.bound=this.context=t.scope.parent.method.context:this["static"]||t.scope.parent.assign("_this","this")),o=t.indent,i="function",this.ctor&&(i+=" "+this.name),i+="("+l.join(", ")+") {",this.body.isEmpty()||(i+="\n"+this.body.compileWithDeclarations(t)+"\n"+this.tab),i+="}",this.ctor?this.tab+i:this.front||t.level>=w?"("+i+")":i},i.prototype.paramNames=function(){var t,e,n,i,r;for(t=[],r=this.params,n=0,i=r.length;i>n;n++)e=r[n],t.push.apply(t,e.names());return t},i.prototype.traverseChildren=function(t,e){return t?i.__super__.traverseChildren.call(this,t,e):void 0},i}(i),exports.Param=A=function(t){function e(t,e,n){var i;if(this.name=t,this.value=e,this.splat=n,i=t=this.name.unwrapAll().value,le.call(D,i)>=0)throw SyntaxError('parameter name "'+t+'" is not allowed')}return ue(e,t),e.prototype.children=["name","value"],e.prototype.compile=function(t){return this.name.compile(t,g)},e.prototype.asReference=function(t){var e;return this.reference?this.reference:(e=this.name,e["this"]?(e=e.properties[0].name,e.value.reserved&&(e=new k(t.scope.freeVariable(e.value)))):e.isComplex()&&(e=new k(t.scope.freeVariable("arg"))),e=new Z(e),this.splat&&(e=new U(e)),this.reference=e)},e.prototype.isComplex=function(){return this.name.isComplex()},e.prototype.names=function(t){var e,i,r,s,o,a;if(null==t&&(t=this.name),e=function(t){var e;return e=t.properties[0].name.value,e.reserved?[]:[e]},t instanceof k)return[t.value];if(t instanceof Z)return e(t);for(i=[],a=t.objects,s=0,o=a.length;o>s;s++)if(r=a[s],r instanceof n)i.push(r.value.unwrap().value);else if(r instanceof U)i.push(r.name.unwrap().value);else{if(!(r instanceof Z))throw SyntaxError("illegal parameter "+r.compile());r.isArray()||r.isObject()?i.push.apply(i,this.names(r.base)):r["this"]?i.push.apply(i,e(r)):i.push(r.base.value)}return i},e}(i),exports.Splat=U=function(t){function e(t){this.name=t.compile?t:new k(t)}return ue(e,t),e.prototype.children=["name"],e.prototype.isAssignable=H,e.prototype.assigns=function(t){return this.name.assigns(t)},e.prototype.compile=function(t){return null!=this.index?this.compileParam(t):this.name.compile(t)},e.prototype.unwrap=function(){return this.name},e.compileSplattedArray=function(t,n,i){var r,s,o,a,p,h,u,l;for(p=-1;(h=n[++p])&&!(h instanceof e););if(p>=n.length)return"";if(1===n.length)return o=n[0].compile(t,g),i?o:""+oe("slice")+".call("+o+")";for(r=n.slice(p),a=u=0,l=r.length;l>u;a=++u)h=r[a],o=h.compile(t,g),r[a]=h instanceof e?""+oe("slice")+".call("+o+")":"["+o+"]";return 0===p?r[0]+(".concat("+r.slice(1).join(", ")+")"):(s=function(){var e,i,r,s;for(r=n.slice(0,p),s=[],e=0,i=r.length;i>e;e++)h=r[e],s.push(h.compile(t,g));return s}(),"["+s.join(", ")+"].concat("+r.join(", ")+")")},e}(i),exports.While=G=function(t){function e(t,e){this.condition=(null!=e?e.invert:void 0)?t.invert():t,this.guard=null!=e?e.guard:void 0}return ue(e,t),e.prototype.children=["condition","guard","body"],e.prototype.isStatement=H,e.prototype.makeReturn=function(t){return t?e.__super__.makeReturn.apply(this,arguments):(this.returns=!this.jumps({loop:!0}),this)},e.prototype.addBody=function(t){return this.body=t,this},e.prototype.jumps=function(){var t,e,n,i;if(t=this.body.expressions,!t.length)return!1;for(n=0,i=t.length;i>n;n++)if(e=t[n],e.jumps({loop:!0}))return e;return!1
},e.prototype.compileNode=function(t){var e,n,i,s;return t.indent+=K,s="",e=this.body,e.isEmpty()?e="":(this.returns&&(e.makeReturn(i=t.scope.freeVariable("results")),s=""+this.tab+i+" = [];\n"),this.guard&&(e.expressions.length>1?e.expressions.unshift(new y(new B(this.guard).invert(),new k("continue"))):this.guard&&(e=r.wrap([new y(this.guard,e)]))),e="\n"+e.compile(t,C)+"\n"+this.tab),n=s+this.tab+("while ("+this.condition.compile(t,j)+") {"+e+"}"),this.returns&&(n+="\n"+this.tab+"return "+i+";"),n},e}(i),exports.Op=E=function(t){function e(t,e,n,r){if("in"===t)return new v(e,n);if("do"===t)return this.generateDo(e);if("new"===t){if(e instanceof s&&!e["do"]&&!e.isNew)return e.newInstance();(e instanceof p&&e.bound||e["do"])&&(e=new B(e))}return this.operator=i[t]||t,this.first=e,this.second=n,this.flip=!!r,this}var i,r;return ue(e,t),i={"==":"===","!=":"!==",of:"in"},r={"!==":"===","===":"!=="},e.prototype.children=["first","second"],e.prototype.isSimpleNumber=R,e.prototype.isUnary=function(){return!this.second},e.prototype.isComplex=function(){var t;return!(this.isUnary()&&("+"===(t=this.operator)||"-"===t))||this.first.isComplex()},e.prototype.isChainable=function(){var t;return"<"===(t=this.operator)||">"===t||">="===t||"<="===t||"==="===t||"!=="===t},e.prototype.invert=function(){var t,n,i,s,o;if(this.isChainable()&&this.first.isChainable()){for(t=!0,n=this;n&&n.operator;)t&&(t=n.operator in r),n=n.first;if(!t)return new B(this).invert();for(n=this;n&&n.operator;)n.invert=!n.invert,n.operator=r[n.operator],n=n.first;return this}return(s=r[this.operator])?(this.operator=s,this.first.unwrap()instanceof e&&this.first.invert(),this):this.second?new B(this).invert():"!"===this.operator&&(i=this.first.unwrap())instanceof e&&("!"===(o=i.operator)||"in"===o||"instanceof"===o)?i:new e("!",this)},e.prototype.unfoldSoak=function(t){var e;return("++"===(e=this.operator)||"--"===e||"delete"===e)&&se(t,this,"first")},e.prototype.generateDo=function(t){var e,i,r,o,a,h,u,l;for(o=[],i=t instanceof n&&(a=t.value.unwrap())instanceof p?a:t,l=i.params||[],h=0,u=l.length;u>h;h++)r=l[h],r.value?(o.push(r.value),delete r.value):o.push(r);return e=new s(t,o),e["do"]=!0,e},e.prototype.compileNode=function(t){var e,n,i,r;if(n=this.isChainable()&&this.first.isChainable(),n||(this.first.front=this.front),"delete"===this.operator&&t.scope.check(this.first.unwrapAll().value))throw SyntaxError("delete operand may not be argument or var");if(("--"===(i=this.operator)||"++"===i)&&(r=this.first.unwrapAll().value,le.call(D,r)>=0))throw SyntaxError("prefix increment/decrement may not have eval or arguments operand");return this.isUnary()?this.compileUnary(t):n?this.compileChain(t):"?"===this.operator?this.compileExistence(t):(e=this.first.compile(t,S)+" "+this.operator+" "+this.second.compile(t,S),t.level<=S?e:"("+e+")")},e.prototype.compileChain=function(t){var e,n,i,r;return r=this.first.second.cache(t),this.first.second=r[0],i=r[1],n=this.first.compile(t,S),e=""+n+" "+(this.invert?"&&":"||")+" "+i.compile(t)+" "+this.operator+" "+this.second.compile(t,S),"("+e+")"},e.prototype.compileExistence=function(t){var e,i;return this.first.isComplex()?(i=new k(t.scope.freeVariable("ref")),e=new B(new n(i,this.first))):(e=this.first,i=e),new y(new u(e),i,{type:"if"}).addElse(this.second).compile(t)},e.prototype.compileUnary=function(t){var n,i,r;return t.level>=w?new B(this).compile(t):(i=[n=this.operator],r="+"===n||"-"===n,("new"===n||"typeof"===n||"delete"===n||r&&this.first instanceof e&&this.first.operator===n)&&i.push(" "),(r&&this.first instanceof e||"new"===n&&this.first.isStatement(t))&&(this.first=new B(this.first)),i.push(this.first.compile(t,S)),this.flip&&i.reverse(),i.join(""))},e.prototype.toString=function(t){return e.__super__.toString.call(this,t,this.constructor.name+" "+this.operator)},e}(i),exports.In=v=function(t){function e(t,e){this.object=t,this.array=e}return ue(e,t),e.prototype.children=["object","array"],e.prototype.invert=_,e.prototype.compileNode=function(t){var e,n,i,r,s;if(this.array instanceof Z&&this.array.isArray()){for(s=this.array.base.objects,i=0,r=s.length;r>i;i++)if(n=s[i],n instanceof U){e=!0;break}if(!e)return this.compileOrTest(t)}return this.compileLoopTest(t)},e.prototype.compileOrTest=function(t){var e,n,i,r,s,o,a,p,h;return 0===this.array.base.objects.length?""+!!this.negated:(p=this.object.cache(t,S),o=p[0],s=p[1],h=this.negated?[" !== "," && "]:[" === "," || "],e=h[0],n=h[1],a=function(){var n,a,p,h;for(p=this.array.base.objects,h=[],i=n=0,a=p.length;a>n;i=++n)r=p[i],h.push((i?s:o)+e+r.compile(t,w));return h}.call(this),a=a.join(n),t.level<S?a:"("+a+")")},e.prototype.compileLoopTest=function(t){var e,n,i,r;return r=this.object.cache(t,g),i=r[0],n=r[1],e=oe("indexOf")+(".call("+this.array.compile(t,g)+", "+n+") ")+(this.negated?"< 0":">= 0"),i===n?e:(e=i+", "+e,t.level<g?e:"("+e+")")},e.prototype.toString=function(t){return e.__super__.toString.call(this,t,this.constructor.name+(this.negated?"!":""))},e}(i),exports.Try=W=function(t){function e(t,e,n,i){this.attempt=t,this.error=e,this.recovery=n,this.ensure=i}return ue(e,t),e.prototype.children=["attempt","recovery","ensure"],e.prototype.isStatement=H,e.prototype.jumps=function(t){var e;return this.attempt.jumps(t)||(null!=(e=this.recovery)?e.jumps(t):void 0)},e.prototype.makeReturn=function(t){return this.attempt&&(this.attempt=this.attempt.makeReturn(t)),this.recovery&&(this.recovery=this.recovery.makeReturn(t)),this},e.prototype.compileNode=function(t){var e,n,i,r;return t.indent+=K,i=this.error?" ("+this.error.compile(t)+") ":" ",r=this.attempt.compile(t,C),e=function(){var e;if(this.recovery){if(e=this.error.value,le.call(D,e)>=0)throw SyntaxError('catch variable may not be "'+this.error.value+'"');return t.scope.check(this.error.value)||t.scope.add(this.error.value,"param")," catch"+i+"{\n"+this.recovery.compile(t,C)+"\n"+this.tab+"}"}return this.ensure||this.recovery?void 0:" catch (_error) {}"}.call(this),n=this.ensure?" finally {\n"+this.ensure.compile(t,C)+"\n"+this.tab+"}":"",""+this.tab+"try {\n"+r+"\n"+this.tab+"}"+(e||"")+n},e}(i),exports.Throw=M=function(t){function e(t){this.expression=t}return ue(e,t),e.prototype.children=["expression"],e.prototype.isStatement=H,e.prototype.jumps=R,e.prototype.makeReturn=L,e.prototype.compileNode=function(t){return this.tab+("throw "+this.expression.compile(t)+";")},e}(i),exports.Existence=u=function(t){function e(t){this.expression=t}return ue(e,t),e.prototype.children=["expression"],e.prototype.invert=_,e.prototype.compileNode=function(t){var e,n,i,r;return this.expression.front=this.front,i=this.expression.compile(t,S),f.test(i)&&!t.scope.check(i)?(r=this.negated?["===","||"]:["!==","&&"],e=r[0],n=r[1],i="typeof "+i+" "+e+' "undefined" '+n+" "+i+" "+e+" null"):i=""+i+" "+(this.negated?"==":"!=")+" null",t.level<=x?i:"("+i+")"},e}(i),exports.Parens=B=function(t){function e(t){this.body=t}return ue(e,t),e.prototype.children=["body"],e.prototype.unwrap=function(){return this.body},e.prototype.isComplex=function(){return this.body.isComplex()},e.prototype.compileNode=function(t){var e,n,i;return i=this.body.unwrap(),i instanceof Z&&i.isAtomic()?(i.front=this.front,i.compile(t)):(n=i.compile(t,j),e=t.level<S&&(i instanceof E||i instanceof s||i instanceof c&&i.returns),e?n:"("+n+")")},e}(i),exports.For=c=function(t){function e(t,e){var n;if(this.source=e.source,this.guard=e.guard,this.step=e.step,this.name=e.name,this.index=e.index,this.body=r.wrap([t]),this.own=!!e.own,this.object=!!e.object,this.object&&(n=[this.index,this.name],this.name=n[0],this.index=n[1]),this.index instanceof Z)throw SyntaxError("index cannot be a pattern matching expression");if(this.range=this.source instanceof Z&&this.source.base instanceof P&&!this.source.properties.length,this.pattern=this.name instanceof Z,this.range&&this.index)throw SyntaxError("indexes do not apply to range loops");if(this.range&&this.pattern)throw SyntaxError("cannot pattern match over range loops");this.returns=!1}return ue(e,t),e.prototype.children=["body","source","guard","step"],e.prototype.compileNode=function(t){var e,i,s,o,a,p,h,u,l,c,m,d,v,b,w,x,j,N,_,R,V,E,A,O,P;return e=r.wrap([this.body]),m=null!=(P=ee(e.expressions))?P.jumps():void 0,m&&m instanceof T&&(this.returns=!1),R=this.range?this.source.base:this.source,_=t.scope,v=this.name&&this.name.compile(t,g),h=this.index&&this.index.compile(t,g),v&&!this.pattern&&_.find(v),h&&_.find(h),this.returns&&(N=_.freeVariable("results")),u=this.object&&h||_.freeVariable("i"),l=this.range&&v||h||u,c=l!==u?""+l+" = ":"",this.step&&!this.range&&(E=_.freeVariable("step")),this.pattern&&(v=u),O="",a="",i="",p=this.tab+K,this.range?s=R.compile(ne(t,{index:u,name:v,step:this.step})):(A=this.source.compile(t,g),!v&&!this.own||f.test(A)||(i=""+this.tab+(w=_.freeVariable("ref"))+" = "+A+";\n",A=w),v&&!this.pattern&&(b=""+v+" = "+A+"["+l+"]"),this.object||(d=_.freeVariable("len"),o=""+c+u+" = 0, "+d+" = "+A+".length",this.step&&(o+=", "+E+" = "+this.step.compile(t,S)),V=""+c+(this.step?""+u+" += "+E:l!==u?"++"+u:""+u+"++"),s=""+o+"; "+u+" < "+d+"; "+V)),this.returns&&(x=""+this.tab+N+" = [];\n",j="\n"+this.tab+"return "+N+";",e.makeReturn(N)),this.guard&&(e.expressions.length>1?e.expressions.unshift(new y(new B(this.guard).invert(),new k("continue"))):this.guard&&(e=r.wrap([new y(this.guard,e)]))),this.pattern&&e.expressions.unshift(new n(this.name,new k(""+A+"["+l+"]"))),i+=this.pluckDirectCall(t,e),b&&(O="\n"+p+b+";"),this.object&&(s=""+l+" in "+A,this.own&&(a="\n"+p+"if (!"+oe("hasProp")+".call("+A+", "+l+")) continue;")),e=e.compile(ne(t,{indent:p}),C),e&&(e="\n"+e+"\n"),""+i+(x||"")+this.tab+"for ("+s+") {"+a+O+e+this.tab+"}"+(j||"")},e.prototype.pluckDirectCall=function(t,e){var i,r,o,a,h,u,l,c,f,m,d,y,v,b,w;for(r="",m=e.expressions,h=c=0,f=m.length;f>c;h=++c)o=m[h],o=o.unwrapAll(),o instanceof s&&(l=o.variable.unwrapAll(),(l instanceof p||l instanceof Z&&(null!=(d=l.base)?d.unwrapAll():void 0)instanceof p&&1===l.properties.length&&("call"===(y=null!=(v=l.properties[0].name)?v.value:void 0)||"apply"===y))&&(a=(null!=(b=l.base)?b.unwrapAll():void 0)||l,u=new k(t.scope.freeVariable("fn")),i=new Z(u),l.base&&(w=[i,l],l.base=w[0],i=w[1]),e.expressions[h]=new s(i,o.args),r+=this.tab+new n(u,a).compile(t,C)+";\n"));return r},e}(G),exports.Switch=$=function(t){function e(t,e,n){this.subject=t,this.cases=e,this.otherwise=n}return ue(e,t),e.prototype.children=["subject","cases","otherwise"],e.prototype.isStatement=H,e.prototype.jumps=function(t){var e,n,i,r,s,o,a;for(null==t&&(t={block:!0}),s=this.cases,i=0,r=s.length;r>i;i++)if(o=s[i],n=o[0],e=o[1],e.jumps(t))return e;return null!=(a=this.otherwise)?a.jumps(t):void 0},e.prototype.makeReturn=function(t){var e,n,i,s,o;for(s=this.cases,n=0,i=s.length;i>n;n++)e=s[n],e[1].makeReturn(t);return t&&(this.otherwise||(this.otherwise=new r([new k("void 0")]))),null!=(o=this.otherwise)&&o.makeReturn(t),this},e.prototype.compileNode=function(t){var e,n,i,r,s,o,a,p,h,u,l,c,f,m,d,y,v;for(p=t.indent+K,h=t.indent=p+K,i=this.tab+("switch ("+((null!=(m=this.subject)?m.compile(t,j):void 0)||!1)+") {\n"),d=this.cases,a=u=0,c=d.length;c>u;a=++u){for(y=d[a],s=y[0],e=y[1],v=te([s]),l=0,f=v.length;f>l;l++)r=v[l],this.subject||(r=r.invert()),i+=p+("case "+r.compile(t,j)+":\n");if((n=e.compile(t,C))&&(i+=n+"\n"),a===this.cases.length-1&&!this.otherwise)break;o=this.lastNonComment(e.expressions),o instanceof T||o instanceof k&&o.jumps()&&"debugger"!==o.value||(i+=h+"break;\n")}return this.otherwise&&this.otherwise.expressions.length&&(i+=p+("default:\n"+this.otherwise.compile(t,C)+"\n")),i+this.tab+"}"},e}(i),exports.If=y=function(t){function e(t,e,n){this.body=e,null==n&&(n={}),this.condition="unless"===n.type?t.invert():t,this.elseBody=null,this.isChain=!1,this.soak=n.soak}return ue(e,t),e.prototype.children=["condition","body","elseBody"],e.prototype.bodyNode=function(){var t;return null!=(t=this.body)?t.unwrap():void 0},e.prototype.elseBodyNode=function(){var t;return null!=(t=this.elseBody)?t.unwrap():void 0},e.prototype.addElse=function(t){return this.isChain?this.elseBodyNode().addElse(t):(this.isChain=t instanceof e,this.elseBody=this.ensureBlock(t)),this},e.prototype.isStatement=function(t){var e;return(null!=t?t.level:void 0)===C||this.bodyNode().isStatement(t)||(null!=(e=this.elseBodyNode())?e.isStatement(t):void 0)},e.prototype.jumps=function(t){var e;return this.body.jumps(t)||(null!=(e=this.elseBody)?e.jumps(t):void 0)},e.prototype.compileNode=function(t){return this.isStatement(t)?this.compileStatement(t):this.compileExpression(t)},e.prototype.makeReturn=function(t){return t&&(this.elseBody||(this.elseBody=new r([new k("void 0")]))),this.body&&(this.body=new r([this.body.makeReturn(t)])),this.elseBody&&(this.elseBody=new r([this.elseBody.makeReturn(t)])),this},e.prototype.ensureBlock=function(t){return t instanceof r?t:new r([t])},e.prototype.compileStatement=function(t){var n,i,r,s,o;return i=Q(t,"chainChild"),(s=Q(t,"isExistentialEquals"))?new e(this.condition.invert(),this.elseBodyNode(),{type:"if"}).compile(t):(r=this.condition.compile(t,j),t.indent+=K,n=this.ensureBlock(this.body),o="if ("+r+") {\n"+n.compile(t)+"\n"+this.tab+"}",i||(o=this.tab+o),this.elseBody?o+" else "+(this.isChain?(t.indent=this.tab,t.chainChild=!0,this.elseBody.unwrap().compile(t,C)):"{\n"+this.elseBody.compile(t,C)+"\n"+this.tab+"}"):o)},e.prototype.compileExpression=function(t){var e,n,i,r;return r=this.condition.compile(t,x),n=this.bodyNode().compile(t,g),e=this.elseBodyNode()?this.elseBodyNode().compile(t,g):"void 0",i=""+r+" ? "+n+" : "+e,t.level>=x?"("+i+")":i},e.prototype.unfoldSoak=function(){return this.soak&&this},e}(i),a={wrap:function(e,n,i){var o,a,h,u,l;return e.jumps()?e:(h=new p([],r.wrap([e])),o=[],((u=e.contains(this.literalArgs))||e.contains(this.literalThis))&&(l=new k(u?"apply":"call"),o=[new k("this")],u&&o.push(new k("arguments")),h=new Z(h,[new t(l)])),h.noReturn=i,a=new s(h,o),n?r.wrap([a]):a)},literalArgs:function(t){return t instanceof k&&"arguments"===t.value&&!t.asKey},literalThis:function(t){return t instanceof k&&"this"===t.value&&!t.asKey||t instanceof p&&t.bound||t instanceof s&&t.isSuper}},se=function(t,e,n){var i;if(i=e[n].unfoldSoak(t))return e[n]=i.body,i.body=new Z(e),i},z={"extends":function(){return"function(child, parent) { for (var key in parent) { if ("+oe("hasProp")+".call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; }"},bind:function(){return"function(fn, me){ return function(){ return fn.apply(me, arguments); }; }"},indexOf:function(){return"[].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; }"},hasProp:function(){return"{}.hasOwnProperty"},slice:function(){return"[].slice"}},C=1,j=2,g=3,x=4,S=5,w=6,K="  ",m="[$A-Za-z_\\x7f-\\uffff][$\\w\\x7f-\\uffff]*",f=RegExp("^"+m+"$"),I=/^[+-]?\d+$/,N=RegExp("^(?:("+m+")\\.prototype(?:\\.("+m+")|\\[(\"(?:[^\\\\\"\\r\\n]|\\\\.)*\"|'(?:[^\\\\'\\r\\n]|\\\\.)*')\\]|\\[(0x[\\da-fA-F]+|\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\]))|("+m+")$"),d=/^['"]/,oe=function(t){var e;return e="__"+t,q.root.assign(e,z[t]()),e},ie=function(t,e){return t=t.replace(/\n/g,"$&"+e),t.replace(/\s+$/,"")}}).call(this);