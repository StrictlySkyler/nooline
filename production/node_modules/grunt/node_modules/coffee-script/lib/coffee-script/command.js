(function(){var e,n,t,r,i,o,u,c,s,l,a,f,p,d,h,m,v,w,g,E,j,x,N,O,T,y,S,b,k,F,R,q,I,J,L,P,z,C,D,_,A;f=null,O=null,p=null,E=null,n=null,A=null,R=A.spawn,l=A.exec,t=null.EventEmitter,p.extend(n,new t),T=function(e){return process.stdout.write(e+"\n")},S=function(e){return process.stderr.write(e+"\n")},d=function(e){return/^\.|~$/.test(e)},e="Usage: coffee [options] path/to/script.coffee -- [args]\n\nIf called without options, `coffee` will run your script.",r=[["-b","--bare","compile without a top-level function wrapper"],["-c","--compile","compile to JavaScript and save as .js files"],["-e","--eval","pass a string from the command line as input"],["-h","--help","display this help message"],["-i","--interactive","run an interactive CoffeeScript REPL"],["-j","--join [FILE]","concatenate the source CoffeeScript before compiling"],["-l","--lint","pipe the compiled JavaScript through JavaScript Lint"],["-n","--nodes","print out the parse tree that the parser produces"],["--nodejs [ARGS]",'pass options directly to the "node" binary'],["-o","--output [DIR]","set the output directory for compiled JavaScript"],["-p","--print","print out the compiled JavaScript"],["-r","--require [FILE*]","require a library before executing your script"],["-s","--stdio","listen for and compile scripts over stdio"],["-t","--tokens","print out the tokens that the lexer/rewriter produce"],["-v","--version","display the version number"],["-w","--watch","watch scripts for changes and rerun commands"]],j={},F=[],k=[],w={},D={},g=null,exports.run=function(){var e,n,t,r,i;if(N(),j.nodejs)return a();if(j.help)return J();if(j.version)return L();if(j.require&&v(),j.interactive)return null;if(j.watch&&!f.watch)return S("The --watch feature depends on Node v0.6.0+. You are running "+process.version+".");if(j.stdio)return s();if(j.eval)return c(null,F[0]);if(!F.length)return null;for(e=j.run?F.splice(1):[],process.argv=process.argv.slice(0,2).concat(e),process.argv[0]="coffee",process.execPath=require.main.filename,i=[],t=0,r=F.length;r>t;t++)n=F[t],i.push(u(n,!0,O.normalize(n)));return i},u=function(e,n,t){return f.stat(e,function(r,i){if(r&&"ENOENT"!==r.code)throw r;return"ENOENT"===(null!=r?r.code:void 0)?n&&".coffee"!==e.slice(-7)?(e=F[F.indexOf(e)]=""+e+".coffee",u(e,n,t)):(n&&(console.error("File not found: "+e),process.exit(1)),void 0):i.isDirectory()?(j.watch&&C(e,t),f.readdir(e,function(n,r){var i,o,c,s;if(n&&"ENOENT"!==n.code)throw n;if("ENOENT"!==(null!=n?n.code:void 0))return o=F.indexOf(e),r=r.filter(function(e){return!d(e)}),[].splice.apply(F,[o,o-o+1].concat(c=function(){var n,t,o;for(o=[],n=0,t=r.length;t>n;n++)i=r[n],o.push(O.join(e,i));return o}())),c,[].splice.apply(k,[o,o-o+1].concat(s=r.map(function(){return null}))),s,r.forEach(function(n){return u(O.join(e,n),!1,t)})})):n||".coffee"===O.extname(e)?(j.watch&&z(e,t),f.readFile(e,function(n,r){if(n&&"ENOENT"!==n.code)throw n;if("ENOENT"!==(null!=n?n.code:void 0))return c(e,""+r,t)})):(w[e]=!0,b(e,t))})},c=function(e,t,r){var u,c,s,l;u=j,c=o(e);try{if(s=l={file:e,input:t,options:c},n.emit("compile",l),u.tokens)return y(n.tokens(s.input));if(u.nodes)return T((""+n.nodes(s.input)).trim());if(u.run)return n.run(s.input,s.options);if(u.join&&s.file!==u.join)return k[F.indexOf(s.file)]=s.input,i();if(s.output=n.compile(s.input,s.options),n.emit("success",l),u.print)return T(s.output.trim());if(u.compile)return _(s.file,s.output,r);if(u.lint)return m(s.file,s.output)}catch(a){if(n.emit("failure",a,l),n.listeners("failure").length)return;return u.watch?T(a.message+""):(S(a instanceof Error&&a.stack||"ERROR: "+a),process.exit(1))}},s=function(){var e,n;return e="",n=process.openStdin(),n.on("data",function(n){return n?e+=""+n:void 0}),n.on("end",function(){return c(null,e)})},h=null,i=function(){return j.join?k.some(function(e){return null===e})?void 0:(clearTimeout(h),h=P(100,function(){return c(j.join,k.join("\n"),j.join)})):void 0},v=function(){var e,n,t,r,i;for(e=module.filename,module.filename=".",i=j.require,t=0,r=i.length;r>t;t++)n=i[t],require(n);return module.filename=e},z=function(e,n){var t,r,o,u,s,l;o=null,r=null,s=function(r){if("ENOENT"!==r.code)throw r;if(-1!==F.indexOf(e))try{return u(),t()}catch(r){return b(e,n,!0),i()}},t=function(){return clearTimeout(r),r=P(25,function(){return f.stat(e,function(t,r){return t?s(t):o&&r.size===o.size&&r.mtime.getTime()===o.mtime.getTime()?u():(o=r,f.readFile(e,function(t,r){return t?s(t):(c(e,""+r,n),u())}))})})};try{l=f.watch(e,t)}catch(a){s(a)}return u=function(){return null!=l&&l.close(),l=f.watch(e,t)}},C=function(e,n){var t,r;t=null;try{return r=f.watch(e,function(){return clearTimeout(t),t=P(25,function(){return f.readdir(e,function(t,i){var o,c,s,l;if(t){if("ENOENT"!==t.code)throw t;return r.close(),I(e,n)}for(l=[],c=0,s=i.length;s>c;c++)o=i[c],d(o)||w[o]||(o=O.join(e,o),F.some(function(e){return e.indexOf(o)>=0})||(F.push(o),k.push(null),l.push(u(o,!1,n))));return l})})})}catch(i){if("ENOENT"!==i.code)throw i}},I=function(e,n){var t,r,o,u,c;for(r=F.slice(0),o=function(){var n,r,i;for(i=[],n=0,r=F.length;r>n;n++)t=F[n],t.indexOf(e)>=0&&i.push(t);return i}(),u=0,c=o.length;c>u;u++)t=o[u],b(t,n,!0);return F.some(function(e,n){return r[n]!==e})?i():void 0},b=function(e,n,t){var r,i;return r=F.indexOf(e),F.splice(r,1),k.splice(r,1),t&&!j.join?(i=x(e,n),O.exists(i,function(n){return n?f.unlink(i,function(n){if(n&&"ENOENT"!==n.code)throw n;return q("removed "+e)}):void 0})):void 0},x=function(e,n){var t,r,i,o;return i=O.basename(e,O.extname(e))+".js",o=O.dirname(e),t="."===n?o:o.substring(n.length),r=j.output?O.join(j.output,t):o,O.join(r,i)},_=function(e,n,t){var r,i,o;return o=x(e,t),i=O.dirname(o),r=function(){return n.length<=0&&(n=" "),f.writeFile(o,n,function(n){return n?T(n.message):j.compile&&j.watch?q("compiled "+e):void 0})},O.exists(i,function(e){return e?r():l("mkdir -p "+i,r)})},P=function(e,n){return setTimeout(n,e)},q=function(e){return console.log(""+(new Date).toLocaleTimeString()+" - "+e)},m=function(e,n){var t,r,i;return i=function(n){return T(e+":	"+(""+n).trim())},t=__dirname+"/../../extras/jsl.conf",r=R("jsl",["-nologo","-stdin","-conf",t]),r.stdout.on("data",i),r.stderr.on("data",i),r.stdin.write(n),r.stdin.end()},y=function(e){var n,t,r,i;return n=function(){var n,o,u,c;for(c=[],n=0,o=e.length;o>n;n++)r=e[n],u=[r[0],(""+r[1]).replace(/\n/,"\\n")],t=u[0],i=u[1],c.push("["+t+" "+i+"]");return c}(),T(n.join(" "))},N=function(){var n,t,i,o,u;for(g=new E.OptionParser(r,e),t=j=g.parse(process.argv.slice(2)),t.compile||(t.compile=!!t.output),t.run=!(t.compile||t.print||t.lint),t.print=!!(t.print||t.eval||t.stdio&&t.compile),F=t.arguments,n=o=0,u=F.length;u>o;n=++o)i=F[n],k[n]=null},o=function(e){return{filename:e,bare:j.bare,header:j.compile}},a=function(){var e,n;return n=j.nodejs.split(/\s+/),e=process.argv.slice(1),e.splice(e.indexOf("--nodejs"),2),R(process.execPath,n.concat(e),{cwd:process.cwd(),env:process.env,customFds:[0,1,2]})},J=function(){return T(new E.OptionParser(r,e).help())},L=function(){return T("CoffeeScript version "+n.VERSION)}}).call(this);