function EntryWriter(e){var r=this;return r instanceof EntryWriter?(Stream.apply(this),r.writable=!0,r.readable=!0,r._stream=new BlockStream(512),r._stream.on("data",function(e){r.emit("data",e)}),r._stream.on("drain",function(){r.emit("drain")}),r._stream.on("end",function(){r.emit("end"),r.emit("close")}),r.props=e,"Directory"===e.type&&(e.size=0),e.ustar="ustar\x00",e.ustarver="00",r.path=e.path,r._buffer=[],r._didHeader=!1,r._meta=!1,r.on("pipe",function(){r._process()}),void 0):new EntryWriter(e)}module.exports=EntryWriter;var tar=require("../tar.js"),TarHeader=require("./header.js"),Entry=require("./entry.js"),inherits=require("../vendor/inherits/inherits.js"),BlockStream=require("../vendor/block-stream/block-stream.js"),ExtendedHeaderWriter,Stream=require("stream").Stream,EOF={};inherits(EntryWriter,Stream),EntryWriter.prototype.write=function(e){return this._ended?this.emit("error",Error("write after end")):(this._buffer.push(e),this._process(),this._needDrain=this._buffer.length>0,!this._needDrain)},EntryWriter.prototype.end=function(e){e&&this._buffer.push(e),this._buffer.push(EOF),this._ended=!0,this._process(),this._needDrain=this._buffer.length>0},EntryWriter.prototype.pause=function(){this._paused=!0,this.emit("pause")},EntryWriter.prototype.resume=function(){this._paused=!1,this.emit("resume"),this._process()},EntryWriter.prototype.add=function(e){return this.parent?(this._ended||this.end(),this.parent.add(e)):this.emit("error",Error("no parent"))},EntryWriter.prototype._header=function(){var e,r;this._didHeader||(this._didHeader=!0,e=TarHeader.encode(this.props),this.props.needExtended&&!this._meta&&(r=this,ExtendedHeaderWriter=ExtendedHeaderWriter||require("./extended-header-writer.js"),ExtendedHeaderWriter(this.props).on("data",function(e){r.emit("data",e)}).on("error",function(e){r.emit("error",e)}).end()),this.emit("data",e),this.emit("header"))},EntryWriter.prototype._process=function(){var e,r,t;if(this._didHeader||this._meta||this._header(),!this._paused&&!this._processing){for(this._processing=!0,e=this._buffer,r=0;r<e.length;r++)if(t=e[r],t===EOF?this._stream.end():this._stream.write(t),this._paused)return this._processing=!1,r<e.length&&(this._needDrain=!0,this._buffer=e.slice(r+1)),void 0;this._buffer.length=0,this._processing=!1,this.emit("drain")}},EntryWriter.prototype.destroy=function(){};