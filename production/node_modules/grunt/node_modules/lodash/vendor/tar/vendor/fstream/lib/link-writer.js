function LinkWriter(i){var r=this;if(!(r instanceof LinkWriter))throw Error("LinkWriter must be called as constructor.");if(!("Link"===i.type&&i.Link||"SymbolicLink"===i.type&&i.SymbolicLink))throw Error("Non-link type "+i.type);""===i.linkpath&&(i.linkpath="."),i.linkpath||r.error("Need linkpath property to create "+i.type),Writer.call(this,i)}function clobber(i,r,e){rimraf(i._path,function(t){return t?i.error(t):(create(i,r,e),void 0)})}function create(i,r,e){fs[e](r,i._path,function(r){if(r){if("ENOENT"!==r.code&&"EACCES"!==r.code&&"EPERM"!==r.code||"win32"!==process.platform)return i.error(r);i.ready=!0,i.emit("ready"),i.emit("end"),i.emit("close"),i.end=i._finish=function(){}}finish(i)})}function finish(i){i.ready=!0,i.emit("ready"),i._ended&&!i._finished&&i._finish()}module.exports=LinkWriter;var fs=require("../../graceful-fs/graceful-fs.js"),Writer=require("./writer.js"),inherits=require("../../inherits/inherits.js"),path=require("path"),rimraf=require("../../rimraf/rimraf.js");inherits(LinkWriter,Writer),LinkWriter.prototype._create=function(){var i=this,r="Link"===i.type||"win32"===process.platform,e=r?"link":"symlink",t=r?path.resolve(i.dirname,i.linkpath):i.linkpath;return r?clobber(i,t,e):(fs.readlink(i._path,function(r,n){return n&&n===t?finish(i):(clobber(i,t,e),void 0)}),void 0)},LinkWriter.prototype.end=function(){this._ended=!0,this.ready&&(this._finished=!0,this._finish())};