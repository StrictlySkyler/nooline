function collect(e){function n(e){"string"==typeof e&&(e=new Buffer(e)),(!Buffer.isBuffer(e)||e.length)&&r.push(e)}function t(e){collect(e),i.push(e)}function o(e){e.pause()}var r,i;e._collected||(e._collected=!0,e.pause(),e.on("data",n),e.on("end",n),r=[],e.on("entry",t),i=[],e.on("proxy",o),e.pipe=function(o){return function(u){function c(){e.removeListener("entry",t),e.removeListener("data",n),e.removeListener("end",n),e.pipe=o,u&&e.pipe(u),r.forEach(function(n){n?e.emit("data",n):e.emit("end")}),e.resume()}var f=0;return function p(){var n=i[f++];return n?(n.on("end",p),u?u.add(n):e.emit("entry",n),void 0):c()}(),u}}(e.pipe))}module.exports=collect;