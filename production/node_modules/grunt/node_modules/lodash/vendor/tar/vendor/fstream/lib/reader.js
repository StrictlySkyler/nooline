function Reader(e,r){var t,a,i=this;if(!(i instanceof Reader))return new Reader(e,r);switch("string"==typeof e&&(e={path:e}),e.path||i.error("Must provide a path",null,!0),e.type&&"function"==typeof e.type?(t=e.type,a=t):(t=getType(e),a=Reader),r&&!t&&(t=getType(r),e[t]=!0,e.type=t),t){case"Directory":a=DirReader;break;case"Link":case"File":a=FileReader;break;case"SymbolicLink":a=LinkReader;break;case"Socket":a=SocketReader;break;case null:a=ProxyReader}return i instanceof a?(Abstract.call(i),i.readable=!0,i.writable=!1,i.type=t,i.props=e,i.depth=e.depth=e.depth||0,i.parent=e.parent||null,i.root=e.root||e.parent&&e.parent.root||i,i._path=i.path=path.resolve(e.path),"win32"===process.platform&&(i.path=i._path=i.path.replace(/\?/g,"_"),i._path.length>=260&&(i._swallowErrors=!0,i._path="\\\\?\\"+i.path.replace(/\//g,"\\"))),i.basename=e.basename=path.basename(i.path),i.dirname=e.dirname=path.dirname(i.path),e.parent=e.root=null,i.size=e.size,i.filter="function"==typeof e.filter?e.filter:null,"alpha"===e.sort&&(e.sort=alphasort),i._stat(r),void 0):new a(e)}function alphasort(e,r){return e===r?0:e.toLowerCase()>r.toLowerCase()?1:e.toLowerCase()<r.toLowerCase()?-1:e>r?1:-1}var fs,Stream,inherits,path,getType,hardLinks,Abstract,DirReader,FileReader,LinkReader,SocketReader,ProxyReader;module.exports=Reader,fs=require("../../graceful-fs/graceful-fs.js"),Stream=require("stream").Stream,inherits=require("../../inherits/inherits.js"),path=require("path"),getType=require("./get-type.js"),hardLinks=Reader.hardLinks={},Abstract=require("./abstract.js"),inherits(Reader,Abstract),DirReader=require("./dir-reader.js"),FileReader=require("./file-reader.js"),LinkReader=require("./link-reader.js"),SocketReader=require("./socket-reader.js"),ProxyReader=require("./proxy-reader.js"),Reader.prototype._stat=function(e){function r(e,r){var i,s,n,o,p;return e?t.error(e):(Object.keys(r).forEach(function(e){a[e]=r[e]}),void 0!==t.size&&a.size!==t.size?t.error("incorrect size"):(t.size=a.size,i=getType(a),"Directory"!==i&&a.nlink&&a.nlink>1&&(s=a.dev+":"+a.ino,hardLinks[s]!==t._path&&hardLinks[s]?(i=t.type=t.props.type="Link",t.Link=t.props.Link=!0,t.linkpath=t.props.linkpath=hardLinks[s],t._stat=t._read=LinkReader.prototype._read):hardLinks[s]=t._path),t.type&&t.type!==i&&t.error("Unexpected type: "+i),t.filter&&(n=t._proxy||t,!t.filter.call(n,n,a))?(t._disowned||(t.abort(),t.emit("end"),t.emit("close")),void 0):(o=["_stat","stat","ready"],p=0,function d(){if(t._aborted)return t.emit("end"),t.emit("close"),void 0;if(t._paused)return t.once("resume",d),void 0;var e=o[p++];return e?(t.emit(e,a),d(),void 0):t._read()}(),void 0)))}var t=this,a=t.props,i=a.follow?"stat":"lstat";e?process.nextTick(r.bind(null,null,e)):fs[i](t._path,r)},Reader.prototype.pipe=function(e){var r=this;return"function"==typeof e.add&&r.on("entry",function(t){var a=e.add(t);!1===a&&r.pause()}),Stream.prototype.pipe.apply(this,arguments)},Reader.prototype.pause=function(e){this._paused=!0,e=e||this,this.emit("pause",e),this._stream&&this._stream.pause(e)},Reader.prototype.resume=function(e){this._paused=!1,e=e||this,this.emit("resume",e),this._stream&&this._stream.resume(e),this._read()},Reader.prototype._read=function(){this.error("Cannot read unknown type: "+this.type)};