function Writer(e,r){var t,i,o=this;switch("string"==typeof e&&(e={path:e}),e.path||o.error("Must provide a path",null,!0),t=getType(e),i=Writer,t){case"Directory":i=DirWriter;break;case"File":i=FileWriter;break;case"Link":case"SymbolicLink":i=LinkWriter;break;case null:i=ProxyWriter}return o instanceof i?(Abstract.call(o),o.type=e.type,o.props=e,o.depth=e.depth||0,o.clobber=!1===e.clobber?e.clobber:!0,o.parent=e.parent||null,o.root=e.root||e.parent&&e.parent.root||o,o._path=o.path=path.resolve(e.path),"win32"===process.platform&&(o.path=o._path=o.path.replace(/\?/g,"_"),o._path.length>=260&&(o._swallowErrors=!0,o._path="\\\\?\\"+o.path.replace(/\//g,"\\"))),o.basename=path.basename(e.path),o.dirname=path.dirname(e.path),o.linkpath=e.linkpath||null,e.parent=e.root=null,o.size=e.size,"string"==typeof e.mode&&(e.mode=parseInt(e.mode,8)),o.readable=!1,o.writable=!0,o._buffer=[],o.ready=!1,o.filter="function"==typeof e.filter?e.filter:null,o._stat(r),void 0):new i(e)}function create(e){mkdir(path.dirname(e._path),Writer.dirmode,function(r,t){return r?e.error(r):(e._madeDir=t,e._create())})}function endChmod(e,r,t,i,o){var n,a=r.mode,p=r.follow||"SymbolicLink"!==e.type?"chmod":"lchmod";return fs[p]?"number"!=typeof a?o():(n=511&t.mode,a=511&a,a===n?o():(fs[p](i,a,o),void 0)):o()}function endChown(e,r,t,i,o){if("win32"===process.platform)return o();if(!process.getuid||0===!process.getuid())return o();if("number"!=typeof r.uid&&"number"!=typeof r.gid)return o();if(t.uid===r.uid&&t.gid===r.gid)return o();var n=e.props.follow||"SymbolicLink"!==e.type?"chown":"lchown";return fs[n]?("number"!=typeof r.uid&&(r.uid=t.uid),"number"!=typeof r.gid&&(r.gid=t.gid),fs[n](i,r.uid,r.gid,o),void 0):o()}function endUtimes(e,r,t,i,o){var n,a,p,s,d;return fs.utimes&&"win32"!==process.platform?(n=r.follow||"SymbolicLink"!==e.type?"utimes":"lutimes","lutimes"!==n||fs[n]||(n="utimes"),fs[n]?(a=t.atime,p=t.mtime,s=r.atime,d=r.mtime,void 0===s&&(s=a),void 0===d&&(d=p),isDate(s)||(s=new Date(s)),isDate(d)||(s=new Date(d)),s.getTime()===a.getTime()&&d.getTime()===p.getTime()?o():(fs[n](i,s,d,o),void 0)):o()):o()}function endMadeDir(e,r,t){var i=e._madeDir,o=path.dirname(r);endMadeDir_(e,o,function(r){return r?t(r):o===i?t():(endMadeDir(e,o,t),void 0)})}function endMadeDir_(e,r,t){function i(e){return n?void 0:e?t(n=e):0===--o?t():void 0}var o,n,a={};Object.keys(e.props).forEach(function(r){a[r]=e.props[r],"mode"===r&&"Directory"!==e.type&&(a[r]=73|a[r])}),o=3,n=null,fs.stat(r,function(o,p){return o?t(n=o):(endChmod(e,a,p,r,i),endChown(e,a,p,r,i),endUtimes(e,a,p,r,i),void 0)})}function objectToString(e){return Object.prototype.toString.call(e)}function isDate(e){return"object"==typeof e&&"[object Date]"===objectToString(e)}var fs,inherits,rimraf,mkdir,path,umask,getType,Abstract,DirWriter,LinkWriter,FileWriter,ProxyWriter;module.exports=Writer,fs=require("../../graceful-fs/graceful-fs.js"),inherits=require("../../inherits/inherits.js"),rimraf=require("../../rimraf/rimraf.js"),mkdir=require("../../mkdirp"),path=require("path"),umask="win32"===process.platform?0:process.umask(),getType=require("./get-type.js"),Abstract=require("./abstract.js"),inherits(Writer,Abstract),Writer.dirmode=511&~umask,Writer.filemode=438&~umask,DirWriter=require("./dir-writer.js"),LinkWriter=require("./link-writer.js"),FileWriter=require("./file-writer.js"),ProxyWriter=require("./proxy-writer.js"),Writer.prototype._create=function(){var e=this;fs[e.props.follow?"stat":"lstat"](e._path,function(r){return r?e.warn("Cannot create "+e._path+"\n"+"Unsupported type: "+e.type,"ENOTSUP"):(e._finish(),void 0)})},Writer.prototype._stat=function(e){function r(e,r){if(t.filter&&!t.filter.call(n,n,r))return t._aborted=!0,t.emit("end"),t.emit("close"),void 0;if(e||!r)return create(t);t._old=r;var i=getType(r);return i!==t.type?rimraf(t._path,function(e){return e?t.error(e):(t._old=null,create(t),void 0)}):(create(t),void 0)}var t=this,i=t.props,o=i.follow?"stat":"lstat",n=t._proxy||t;e?r(null,e):fs[o](t._path,r)},Writer.prototype._finish=function(){function e(e){endChmod(i,i.props,e,i._path,r("chmod")),endChown(i,i.props,e,i._path,r("chown")),endUtimes(i,i.props,e,i._path,r("chown"))}function r(e){return o++,function(r){function t(e){return e?(e.fstream_finish_call="setupMadeDir",i.error(e)):(i.emit("end"),i.emit("close"),void 0)}if(!n){if(r)return r.fstream_finish_call=e,i.error(n=r);if(!(--o>0||a))return a=!0,i._madeDir?(endMadeDir(i,i._path,t),void 0):t()}}}var t,i=this,o=0,n=null,a=!1;i._old?(i._old.atime=new Date(0),i._old.mtime=new Date(0),e(i._old)):(t=i.props.follow?"stat":"lstat",fs[t](i._path,function(r,t){return r?"ENOENT"!==r.code||"Link"!==i.type&&"SymbolicLink"!==i.type||"win32"!==process.platform?i.error(r):(i.ready=!0,i.emit("ready"),i.emit("end"),i.emit("close"),i.end=i._finish=function(){},void 0):(e(i._old=t),void 0)}))},Writer.prototype.pipe=function(){this.error("Can't pipe from writable stream")},Writer.prototype.add=function(){this.error("Cannot add to non-Directory type")},Writer.prototype.write=function(){return!0};