/*
 * grunt
 * http://gruntjs.com/
 *
 * Copyright (c) 2013 "Cowboy" Ben Alman
 * Licensed under the MIT license.
 * https://github.com/gruntjs/grunt/blob/master/LICENSE-MIT
 */

"use strict";var YAML,rimraf,iconv,win32,unixifyPath,processPatterns,pathSeparatorRe,grunt=null,fs=null,path=null,file=module.exports={};file.glob=null,file.minimatch=null,file.findup=null,YAML=null,rimraf=null,iconv=null,win32="win32"===process.platform,unixifyPath=function(r){return win32?r.replace(/\\/g,"/"):r},file.setBase=function(){var r=path.join.apply(path,arguments);process.chdir(r)},processPatterns=function(r,e){var t=[];return grunt.util._.flatten(r).forEach(function(r){var n,i=0===r.indexOf("!");i&&(r=r.slice(1)),n=e(r),t=i?grunt.util._.difference(t,n):grunt.util._.union(t,n)}),t},file.match=function(r,e,t){return"object"!==grunt.util.kindOf(r)&&(t=e,e=r,r={}),null==e||null==t?[]:(Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]),0===e.length||0===t.length?[]:processPatterns(e,function(e){return file.minimatch.match(t,e,r)}))},file.isMatch=function(){return file.match.apply(file,arguments).length>0},file.expand=function(){var r,e=grunt.util.toArray(arguments),t="object"===grunt.util.kindOf(e[0])?e.shift():{},n=Array.isArray(e[0])?e[0]:e;return 0===n.length?[]:(r=processPatterns(n,function(r){return file.glob.sync(r,t)}),t.filter&&(r=r.filter(function(r){r=path.join(t.cwd||"",r);try{return"function"==typeof t.filter?t.filter(r):fs.statSync(r)[t.filter]()}catch(e){return!1}})),r)},pathSeparatorRe=/[\/\\]/g,file.expandMapping=function(r,e,t){var n,i;return t=grunt.util._.defaults({},t,{rename:function(r,e){return path.join(r||"",e)}}),n=[],i={},file.expand(t,r).forEach(function(r){var a,o=r;t.flatten&&(o=path.basename(o)),t.ext&&(o=o.replace(/(\.[^\/]*)?$/,t.ext)),a=t.rename(e,o,t),t.cwd&&(r=path.join(t.cwd,r)),a=a.replace(pathSeparatorRe,"/"),r=r.replace(pathSeparatorRe,"/"),i[a]?i[a].src.push(r):(n.push({src:[r],dest:a}),i[a]=n[n.length-1])}),n},file.mkdir=function(r,e){grunt.option("no-write")||(null==e&&(e=parseInt("0777",8)&~process.umask()),r.split(pathSeparatorRe).reduce(function(r,t){r+=t+"/";var n=path.resolve(r);if(!file.exists(n))try{fs.mkdirSync(n,e)}catch(i){throw grunt.util.error('Unable to create directory "'+n+'" (Error code: '+i.code+").",i)}return r},""))},file.recurse=function r(e,t,n){var i=n?path.join(e,n):e;fs.readdirSync(i).forEach(function(a){var o=path.join(i,a);fs.statSync(o).isDirectory()?r(e,t,unixifyPath(path.join(n||"",a||""))):t(unixifyPath(o),e,n,a)})},file.defaultEncoding="utf8",file.read=function(r,e){e||(e={});var t;grunt.verbose.write("Reading "+r+"...");try{return t=fs.readFileSync(r+""),null!==e.encoding&&(t=iconv.decode(t,e.encoding||file.defaultEncoding),65279===t.charCodeAt(0)&&(t=t.substring(1))),grunt.verbose.ok(),t}catch(n){throw grunt.verbose.error(),grunt.util.error('Unable to read "'+r+'" file (Error code: '+n.code+").",n)}},file.readJSON=function(r,e){var t,n=file.read(r,e);grunt.verbose.write("Parsing "+r+"...");try{return t=JSON.parse(n),grunt.verbose.ok(),t}catch(i){throw grunt.verbose.error(),grunt.util.error('Unable to parse "'+r+'" file ('+i.message+").",i)}},file.readYAML=function(r,e){var t,n=file.read(r,e);grunt.verbose.write("Parsing "+r+"...");try{return t=YAML.load(n),grunt.verbose.ok(),t}catch(i){throw grunt.verbose.error(),grunt.util.error('Unable to parse "'+r+'" file ('+i.problem+").",i)}},file.write=function(r,e,t){t||(t={});var n=grunt.option("no-write");grunt.verbose.write((n?"Not actually writing ":"Writing ")+r+"..."),file.mkdir(path.dirname(r));try{return Buffer.isBuffer(e)||(e=iconv.encode(e,t.encoding||file.defaultEncoding)),n||fs.writeFileSync(r,e),grunt.verbose.ok(),!0}catch(i){throw grunt.verbose.error(),grunt.util.error('Unable to write "'+r+'" file (Error code: '+i.code+").",i)}},file.copy=function(r,e,t){var n,i,a;if(t||(t={}),n=t.process&&t.noProcess!==!0&&!(t.noProcess&&file.isMatch(t.noProcess,r)),i=n?t:{encoding:null},a=file.read(r,i),n){grunt.verbose.write("Processing source...");try{a=t.process(a,r),grunt.verbose.ok()}catch(o){throw grunt.verbose.error(),grunt.util.error('Error while processing "'+r+'" file.',o)}}a===!1?grunt.verbose.writeln("Write aborted."):file.write(e,a,i)},file.delete=function(r,e){r+="";var t=grunt.option("no-write");if(e||(e={force:grunt.option("force")||!1}),grunt.verbose.write((t?"Not actually deleting ":"Deleting ")+r+"..."),!file.exists(r))return grunt.verbose.error(),grunt.log.warn("Cannot delete nonexistent file."),!1;if(!e.force){if(file.isPathCwd(r))return grunt.verbose.error(),grunt.fail.warn("Cannot delete the current working directory."),!1;if(!file.isPathInCwd(r))return grunt.verbose.error(),grunt.fail.warn("Cannot delete files outside the current working directory."),!1}try{return t||rimraf.sync(r),grunt.verbose.ok(),!0}catch(n){throw grunt.verbose.error(),grunt.util.error('Unable to delete "'+r+'" file ('+n.message+").",n)}},file.exists=function(){var r=path.join.apply(path,arguments);return fs.existsSync(r)},file.isLink=function(){var r=path.join.apply(path,arguments);return file.exists(r)&&fs.lstatSync(r).isSymbolicLink()},file.isDir=function(){var r=path.join.apply(path,arguments);return file.exists(r)&&fs.statSync(r).isDirectory()},file.isFile=function(){var r=path.join.apply(path,arguments);return file.exists(r)&&fs.statSync(r).isFile()},file.isPathAbsolute=function(){var r=path.join.apply(path,arguments);return path.resolve(r)===r.replace(/[\/\\]+$/,"")},file.arePathsEquivalent=function(r){r=path.resolve(r);for(var e=1;e<arguments.length;e++)if(r!==path.resolve(arguments[e]))return!1;return!0},file.doesPathContain=function(r){var e,t;for(r=path.resolve(r),t=1;t<arguments.length;t++)if(e=path.relative(path.resolve(arguments[t]),r),""===e||/\w+/.test(e))return!1;return!0},file.isPathCwd=function(){var r=path.join.apply(path,arguments);try{return file.arePathsEquivalent(process.cwd(),fs.realpathSync(r))}catch(e){return!1}},file.isPathInCwd=function(){var r=path.join.apply(path,arguments);try{return file.doesPathContain(process.cwd(),fs.realpathSync(r))}catch(e){return!1}};