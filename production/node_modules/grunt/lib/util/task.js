/*
 * grunt
 * http://gruntjs.com/
 *
 * Copyright (c) 2013 "Cowboy" Ben Alman
 * Licensed under the MIT license.
 * https://github.com/gruntjs/grunt/blob/master/LICENSE-MIT
 */

!function(t){"use strict";function s(){this.current={},this._tasks={},this._queue=[],this._placeholder={placeholder:!0},this._marker={marker:!0},this._options={},this._running=!1,this._success={}}t.Task=s,t.create=function(){return new s},s.prototype._throwIfRunning=function(t){if(this._running||!this._options.error)throw t;this._options.error.call({name:null},t)},s.prototype.registerTask=function(t,s,r){null==r&&(r=s,s=null);var n;return"function"!=typeof r?(n=this.parseArgs([r]),r=this.run.bind(this,r),r.alias=!0,s||(s='Alias for "'+n.join('", "')+'" task'+(1===n.length?"":"s")+".")):s||(s="Custom task."),this._tasks[t]={name:t,info:s,fn:r},this},s.prototype.isTaskAlias=function(t){return!!this._tasks[t].fn.alias},s.prototype.renameTask=function(t,s){return this._tasks[s]=this._tasks[t],this._tasks[s].name=s,delete this._tasks[t],this},s.prototype.parseArgs=function(t){return Array.isArray(t[0])?t[0]:[].slice.call(t)},s.prototype.splitArgs=function(t){return t?(t=t.replace(/\\\\/g,"￿").replace(/\\:/g,"￾"),t.split(":").map(function(t){return t.replace(/\uFFFE/g,":").replace(/\uFFFF/g,"\\")})):[]},s.prototype._taskPlusArgs=function(t){var s,r,n,i=this.splitArgs(t),e=i.length;do s=this._tasks[i.slice(0,e).join(":")];while(!s&&--e>0);return r=i.slice(e),n={},r.forEach(function(t){n[t]=!0}),{task:s,nameArgs:t,args:r,flags:n}},s.prototype._push=function(t){var s=this._queue.indexOf(this._placeholder);-1===s?this._queue=this._queue.concat(t):[].splice.apply(this._queue,[s,0].concat(t))},s.prototype.run=function(){var t=this.parseArgs(arguments).map(this._taskPlusArgs,this),s=t.filter(function(t){return!t.task});return s.length>0?(this._throwIfRunning(Error('Task "'+s[0].nameArgs+'" not found.')),this):(this._push(t),this)},s.prototype.mark=function(){return this._push(this._marker),this},s.prototype.runTaskFn=function(t,s,r){var n,i=!1,e=function(s){var n=null;s===!1?n=Error('Task "'+t.nameArgs+'" failed.'):s instanceof Error||"[object Error]"==={}.toString.call(s)?(n=s,s=!1):s=!0,this.current={},this._success[t.nameArgs]=s,!s&&this._options.error&&this._options.error.call({name:t.name,nameArgs:t.nameArgs},n),r(n,s)}.bind(this);t.async=function(){return i=!0,function(t){setTimeout(function(){e(t)},1)}},this.current=t;try{n=s.call(t),i||e(n)}catch(o){e(o)}},s.prototype.start=function(){if(this._running)return!1;var t=function(){var s,r;do s=this._queue.shift();while(s===this._placeholder||s===this._marker);return s?(this._queue.unshift(this._placeholder),r={nameArgs:s.nameArgs,name:s.task.name,args:s.args,flags:s.flags},this.runTaskFn(r,function(){return s.task.fn.apply(this,this.args)},t),void 0):(this._running=!1,this._options.done&&this._options.done(),void 0)}.bind(this);this._running=!0,t()},s.prototype.clearQueue=function(t){return t||(t={}),t.untilMarker?this._queue.splice(0,this._queue.indexOf(this._marker)+1):this._queue=[],this},s.prototype.requires=function(){this.parseArgs(arguments).forEach(function(t){var s=this._success[t];if(!s)throw Error('Required task "'+t+'" '+(s===!1?"failed":"must be run first")+".")}.bind(this))},s.prototype.options=function(t){Object.keys(t).forEach(function(s){this._options[s]=t[s]}.bind(this))}}("object"==typeof exports&&exports||this);