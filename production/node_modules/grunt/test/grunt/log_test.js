"use strict";var grunt=null,log=grunt.log,fooBuffer=new Buffer("foo"),hooker=grunt.util.hooker,stdoutEqual=function(o,t,n){var u="";hooker.hook(process.stdout,"write",{pre:function(o){return u+=log.uncolor(o),hooker.preempt()}}),t(),hooker.unhook(process.stdout,"write"),o.equal(u,n)};exports.log={setUp:function(o){log.muted=!1,grunt.fail.errorcount=0,o()},write:function(o){o.expect(4),stdoutEqual(o,function(){log.write("")},""),stdoutEqual(o,function(){log.write("foo")},"foo"),stdoutEqual(o,function(){log.write("%s","foo")},"foo"),stdoutEqual(o,function(){log.write(fooBuffer)},"foo"),o.done()},writeln:function(o){o.expect(4),stdoutEqual(o,function(){log.writeln()},"\n"),stdoutEqual(o,function(){log.writeln("foo")},"foo\n"),stdoutEqual(o,function(){log.writeln("%s","foo")},"foo\n"),stdoutEqual(o,function(){log.writeln(fooBuffer)},"foo\n"),o.done()},warn:function(o){o.expect(5),stdoutEqual(o,function(){log.warn()},"ERROR\n"),stdoutEqual(o,function(){log.warn("foo")},">> foo\n"),stdoutEqual(o,function(){log.warn("%s","foo")},">> foo\n"),stdoutEqual(o,function(){log.warn(fooBuffer)},">> foo\n"),o.equal(grunt.fail.errorcount,0),o.done()},error:function(o){o.expect(5),stdoutEqual(o,function(){log.error()},"ERROR\n"),stdoutEqual(o,function(){log.error("foo")},">> foo\n"),stdoutEqual(o,function(){log.error("%s","foo")},">> foo\n"),stdoutEqual(o,function(){log.error(fooBuffer)},">> foo\n"),o.equal(grunt.fail.errorcount,4),o.done()},ok:function(o){o.expect(4),stdoutEqual(o,function(){log.ok()},"OK\n"),stdoutEqual(o,function(){log.ok("foo")},">> foo\n"),stdoutEqual(o,function(){log.ok("%s","foo")},">> foo\n"),stdoutEqual(o,function(){log.ok(fooBuffer)},">> foo\n"),o.done()},errorlns:function(o){o.expect(2),stdoutEqual(o,function(){log.errorlns(grunt.util._.repeat("foo",30," "))},">> "+grunt.util._.repeat("foo",19," ")+"\n"+">> "+grunt.util._.repeat("foo",11," ")+"\n"),o.equal(grunt.fail.errorcount,1),o.done()},oklns:function(o){o.expect(1),stdoutEqual(o,function(){log.oklns(grunt.util._.repeat("foo",30," "))},">> "+grunt.util._.repeat("foo",19," ")+"\n"+">> "+grunt.util._.repeat("foo",11," ")+"\n"),o.done()},success:function(o){o.expect(4),stdoutEqual(o,function(){log.success()},"\n"),stdoutEqual(o,function(){log.success("foo")},"foo\n"),stdoutEqual(o,function(){log.success("%s","foo")},"foo\n"),stdoutEqual(o,function(){log.success(fooBuffer)},"foo\n"),o.done()},fail:function(o){o.expect(4),stdoutEqual(o,function(){log.fail()},"\n"),stdoutEqual(o,function(){log.fail("foo")},"foo\n"),stdoutEqual(o,function(){log.fail("%s","foo")},"foo\n"),stdoutEqual(o,function(){log.fail(fooBuffer)},"foo\n"),o.done()},header:function(o){o.expect(4),stdoutEqual(o,function(){log.header()},"\n\n"),stdoutEqual(o,function(){log.header("foo")},"\nfoo\n"),stdoutEqual(o,function(){log.header("%s","foo")},"\nfoo\n"),stdoutEqual(o,function(){log.header(fooBuffer)},"\nfoo\n"),o.done()},subhead:function(o){o.expect(4),stdoutEqual(o,function(){log.subhead()},"\n\n"),stdoutEqual(o,function(){log.subhead("foo")},"\nfoo\n"),stdoutEqual(o,function(){log.subhead("%s","foo")},"\nfoo\n"),stdoutEqual(o,function(){log.subhead(fooBuffer)},"\nfoo\n"),o.done()},debug:function(o){o.expect(5);var t=grunt.option("debug");grunt.option("debug",!0),stdoutEqual(o,function(){log.debug()},"[D] \n"),stdoutEqual(o,function(){log.debug("foo")},"[D] foo\n"),stdoutEqual(o,function(){log.debug("%s","foo")},"[D] foo\n"),stdoutEqual(o,function(){log.debug(fooBuffer)},"[D] foo\n"),grunt.option("debug",!1),stdoutEqual(o,function(){log.debug("foo")},""),grunt.option("debug",t),o.done()},writetableln:function(o){o.expect(1),stdoutEqual(o,function(){log.writetableln([10],[grunt.util._.repeat("foo",10)])},"foofoofoof\noofoofoofo\nofoofoofoo\n"),o.done()},writelns:function(o){o.expect(1),stdoutEqual(o,function(){log.writelns(grunt.util._.repeat("foo",30," "))},grunt.util._.repeat("foo",20," ")+"\n"+grunt.util._.repeat("foo",10," ")+"\n"),o.done()},writeflags:function(o){o.expect(1),stdoutEqual(o,function(){log.writeflags(["foo","bar"],"test")},"test: foo, bar\n"),o.done()},verbose:function(o){o.expect(1),log.muted=!0;var t;["write","writeln","warn","error","ok"].forEach(function(o){t=t?t[o]("foo"):log.verbose[o]("foo")}),o.strictEqual(t,log.verbose),o.done()},notverbose:function(o){o.expect(1),hooker.hook(process.stdout,"write",{pre:function(){return hooker.preempt()}});var t;["write","writeln","warn","error","ok"].forEach(function(o){t=t?t[o]("foo"):log.notverbose[o]("foo")}),o.strictEqual(t,log.notverbose),hooker.unhook(process.stdout,"write"),o.done()}};