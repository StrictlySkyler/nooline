/*!
 * socket.io-node
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

function FlashSocket(t,o,e){return WebSocket.call(this,t,o,e)}var WebSocket=null;exports=module.exports=FlashSocket,FlashSocket.prototype.__proto__=WebSocket.prototype,FlashSocket.prototype.name="flashsocket",FlashSocket.init=function(t){function o(){t.get("flash policy server")&&(e=null.createServer({log:function(o){t.log.info(o)}},t.get("origins")),e.on("close",function(){e=null}),e.listen(t.get("flash policy port"),t.server),t.flashPolicyServer=e)}var e;t.on("set:origins",function(t){e&&(e.origins=Array.isArray(t)?t:[t],e.compile())}),t.on("set:flash policy port",function(s){var r=t.get("transports");if(~r.indexOf("flashsocket")){if(e){if(e.port===s)return;try{e.close()}catch(n){}}o()}}),t.on("set:flash policy server",function(s){var r=t.get("transports");if(~r.indexOf("flashsocket")){if(e&&!s)try{e.close()}catch(n){}}else!e&&s&&o()}),t.on("set:transports",function(){!e&&~t.get("transports").indexOf("flashsocket")&&o()}),~t.get("transports").indexOf("flashsocket")&&o()};