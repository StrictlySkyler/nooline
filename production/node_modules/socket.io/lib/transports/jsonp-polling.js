/*!
 * socket.io-node
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

function JSONPPolling(o,t,e){HTTPPolling.call(this,o,t,e),this.head="io.j[0](",this.foot=");",t.query.i&&jsonpolling_re.test(t.query.i)&&(this.head="io.j["+t.query.i+"](")}var HTTPPolling=null,jsonpolling_re=/^\d+$/;exports=module.exports=JSONPPolling,JSONPPolling.prototype.__proto__=HTTPPolling.prototype,JSONPPolling.prototype.name="jsonppolling",JSONPPolling.prototype.postEncoded=!0,JSONPPolling.prototype.onData=function(o){try{o=JSON.parse(o)}catch(t){return this.error("parse","reconnect"),void 0}HTTPPolling.prototype.onData.call(this,o)},JSONPPolling.prototype.doWrite=function(o){HTTPPolling.prototype.doWrite.call(this);var o=void 0===o?"":this.head+JSON.stringify(o)+this.foot;this.response.writeHead(200,{"Content-Type":"text/javascript; charset=UTF-8","Content-Length":Buffer.byteLength(o),Connection:"Keep-Alive","X-XSS-Protection":"0"}),this.response.write(o),this.log.debug(this.name+" writing",o)};