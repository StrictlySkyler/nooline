/*!
 * socket.io-node
 * Copyright(c) 2011 LearnBoost <dev@learnboost.com>
 * MIT Licensed
 */

function HTTPTransport(e,t,o){Transport.call(this,e,t,o)}var Transport=null,parser=null,qs=null;exports=module.exports=HTTPTransport,HTTPTransport.prototype.__proto__=Transport.prototype,HTTPTransport.prototype.handleRequest=function(e){if(this.response=e.res,"POST"==e.method){var t="",o=e.res,n=e.headers.origin,r={"Content-Length":1,"Content-Type":"text/plain; charset=UTF-8"},s=this;e.on("data",function(o){t+=o,Buffer.byteLength(t)>=s.manager.get("destroy buffer size")&&(t="",e.connection.destroy())}),e.on("end",function(){o.writeHead(200,r),o.end("1"),s.onData(s.postEncoded?qs.parse(t).d:t)}),e.on("close",function(){t="",s.onClose()}),n&&(r["Access-Control-Allow-Origin"]=n,r["Access-Control-Allow-Credentials"]="true")}else Transport.prototype.handleRequest.call(this,e)},HTTPTransport.prototype.onData=function(e){var t,o,n=parser.decodePayload(e);for(this.log.debug(this.name+" received data packet",e),t=0,o=n.length;o>t;t++)this.onMessage(n[t])},HTTPTransport.prototype.doClose=function(){this.response.end()},HTTPTransport.prototype.payload=function(e){this.write(parser.encodePayload(e))};