function Server(e,r){var t=this;this.origins=r||["*:*"],this.port=843,this.log=console.log,Object.keys(e).forEach(function(r){t[r]&&(t[r]=e[r])}),this.socket=net.createServer(function(e){e.on("error",function(){t.responder.call(t,e)}),t.responder.call(t,e)}),this.socket.on("error",function(e){13==e.errno?(t.log&&t.log("Unable to listen to port `"+t.port+"` as your Node.js instance does not have root privileges. "+(t.server?"The Flash Policy File requests will only be served inline over the supplied HTTP server. Inline serving is slower than a dedicated server instance.":"No fallback server supplied, we will be unable to answer Flash Policy File requests.")),t.emit("connect_failed",e),t.socket.removeAllListeners(),delete t.socket):t.log&&t.log("FlashPolicyFileServer received an error event:\n"+(e.message?e.message:e))}),this.socket.on("timeout",function(){}),this.socket.on("close",function(e){e&&t.log&&t.log("Server closing due to an error: \n"+(e.message?e.message:e)),t.server&&(t.server["@"]&&t.server.online&&t.server.removeListener("connection",t.server["@"]),delete t.server.online)}),this.compile()}var slice=Array.prototype.slice,net=null;Server.prototype.listen=function(){var e,r=this,t=slice.call(arguments,0);return t.forEach(function(t){var o=typeof t;"number"===o&&(r.port=t),"function"===o&&(e=t),"object"===o&&(r.server=t)}),this.server&&(this.server["@"]=function(e){e.once("data",function(t){if(t&&60===t[0]&&"<policy-file-request/>\x00"==""+t&&e&&("open"===e.readyState||"writeOnly"===e.readyState))try{e.end(r.buffer)}catch(o){}})},this.server.on("connection",this.server["@"])),this.port>=0&&this.socket.listen(this.port,function(){r.socket.online=!0,e&&(e.call(r),e=void 0)}),this},Server.prototype.responder=function(e){if(e&&"open"==e.readyState&&e.end)try{e.end(this.buffer)}catch(r){}},Server.prototype.compile=function(){var e=['<?xml version="1.0"?>','<!DOCTYPE cross-domain-policy SYSTEM "http://www.macromedia.com/xml/dtds/cross-domain-policy.dtd">',"<cross-domain-policy>"];return this.origins.forEach(function r(r){var t=r.split(":");e.push('<allow-access-from domain="'+t[0]+'" to-ports="'+t[1]+'"/>')}),e.push("</cross-domain-policy>"),this.buffer=new Buffer(e.join(""),"utf8"),this},Server.prototype.add=function(){for(var e=slice.call(arguments,0),r=e.length;r--;)this.origins.indexOf(e[r])>=0&&(e[r]=null);return Array.prototype.push.apply(this.origins,e.filter(function(e){return!!e})),this.compile(),this},Server.prototype.remove=function(e){var r=this.origins.indexOf(e);return r>0&&(this.origins.splice(r,1),this.compile()),this},Server.prototype.close=function(){return this.socket.removeAllListeners(),this.socket.close(),this},Object.keys(process.EventEmitter.prototype).forEach(function(e){Server.prototype[e]=Server.prototype[e]||function(){return this.socket&&this.socket[e].apply(this.socket,arguments),this}}),exports.createServer=function(e,r){return r=Array.isArray(r)?r:Array.isArray(e)?e:!1,e=!Array.isArray(e)&&e?e:{},new Server(e,r)},exports.Server=Server,exports.version="0.0.4";