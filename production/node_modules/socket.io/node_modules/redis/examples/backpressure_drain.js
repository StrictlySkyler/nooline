function op(){0>=remaining_ops&&(console.error("Finished."),process.exit(0)),remaining_ops--,client.hset("test hash","val "+remaining_ops,remaining_ops)===!1?(console.log("Pausing at "+remaining_ops),paused=!0):process.nextTick(op)}var redis=require("../index"),client=redis.createClient(null,null,{command_queue_high_water:5,command_queue_low_water:1}),remaining_ops=1e5,paused=!1;client.on("drain",function(){paused?(console.log("Resuming at "+remaining_ops),paused=!1,process.nextTick(op)):console.log("Got drain while not paused at "+remaining_ops)}),op();