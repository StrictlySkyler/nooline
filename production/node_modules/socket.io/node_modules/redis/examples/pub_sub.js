var redis=require("redis"),client1=redis.createClient(),msg_count=0,client2=redis.createClient();redis.debug_mode=!1,client1.on("subscribe",function(n,e){console.log("client1 subscribed to "+n+", "+e+" total subscriptions"),2===e&&(client2.publish("a nice channel","I am sending a message."),client2.publish("another one","I am sending a second message."),client2.publish("a nice channel","I am sending my last message."))}),client1.on("unsubscribe",function(n,e){console.log("client1 unsubscribed from "+n+", "+e+" total subscriptions"),0===e&&(client2.end(),client1.end())}),client1.on("message",function(n,e){console.log("client1 channel "+n+": "+e),msg_count+=1,3===msg_count&&client1.unsubscribe()}),client1.on("ready",function(){client1.incr("did a thing"),client1.subscribe("a nice channel","another one")}),client2.on("ready",function(){});