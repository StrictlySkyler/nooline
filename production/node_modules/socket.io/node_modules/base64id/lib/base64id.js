/*!
 * base64id v0.1.0
 */

var crypto=null,Base64Id=function(){};Base64Id.prototype.getRandomBytes=function(e){var t,s,n,r=4096,a=this;return e=e||12,e>r?crypto.randomBytes(e):(t=parseInt(r/e),(s=parseInt(.85*t))?(null==this.bytesBufferIndex&&(this.bytesBufferIndex=-1),this.bytesBufferIndex==t&&(this.bytesBuffer=null,this.bytesBufferIndex=-1),(-1==this.bytesBufferIndex||this.bytesBufferIndex>s)&&(this.isGeneratingBytes||(this.isGeneratingBytes=!0,crypto.randomBytes(r,function(e,t){a.bytesBuffer=t,a.bytesBufferIndex=0,a.isGeneratingBytes=!1})),-1==this.bytesBufferIndex)?crypto.randomBytes(e):(n=this.bytesBuffer.slice(e*this.bytesBufferIndex,e*(this.bytesBufferIndex+1)),this.bytesBufferIndex++,n)):crypto.randomBytes(e))},Base64Id.prototype.generateId=function(){var e=new Buffer(15);return e.writeInt32BE?(this.sequenceNumber=0|this.sequenceNumber+1,e.writeInt32BE(this.sequenceNumber,11),crypto.randomBytes?this.getRandomBytes(12).copy(e):[0,4,8].forEach(function(t){e.writeInt32BE(0|Math.random()*Math.pow(2,32),t)}),e.toString("base64").replace(/\//g,"_").replace(/\+/g,"-")):""+Math.abs(0|Math.random()*Math.random()*Date.now())+(""+Math.abs(0|Math.random()*Math.random()*Date.now()))},exports=module.exports=new Base64Id;